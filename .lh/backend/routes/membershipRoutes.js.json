{
    "sourceFile": "backend/routes/membershipRoutes.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 11,
            "patches": [
                {
                    "date": 1763694783794,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763695720309,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n // ==========================================\n import express from \"express\";\n // NOTE: Assuming verifyToken and authorizeRole are imported from a middleware file or authRoutes\n import { verifyToken, isAdmin as authorizeRole } from \"../routes/authRoutes.js\"; // Using isAdmin as placeholder for authorizeRole(\"admin\")\n-\n+import { verifyToken, isAdmin } from \"../middleware/authMiddleware.js\";\n // NOTE: Placeholder functions for controller logic below\n const submitMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: submitMembershipRequest\" });\n const getAllMembershipRequests = (req, res) => res.status(501).json({ message: \"Not Implemented: getAllMembershipRequests\" });\n const approveMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: approveMembershipRequest\" });\n"
                },
                {
                    "date": 1763695848314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n \n // ==========================================\n // Residents & Admins: Submit membership request\n // ==========================================\n-router.post(\"/request\",  submitMembershipRequest);\n+router.post(\"/request\", verifyToken, submitMembershipRequest);\n \n // ==========================================\n // Admin-only routes\n // ==========================================\n@@ -38,9 +38,9 @@\n // Delete membership request\n router.delete(\"/delete/:RequestID\", verifyToken, authorizeRole, deleteMembershipRequest);\n \n // Get all membership records (synced data)\n-router.get(\"/records\", verifyToken, authorizeRole, getAllMembershipRecords);\n+router.get(\"/records\", verifyToken, isAdmin, getAllMembershipRecords);\n router.get(\"/latest\", verifyToken, authorizeRole, getLatestMembershipRequest);\n // Sync membership records\n router.post(\"/sync\", verifyToken, authorizeRole, syncMembershipRecords);\n \n"
                },
                {
                    "date": 1763696678202,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,47 +1,50 @@\n // ==========================================\n // backend/routes/membershipRoutes.js\n // ==========================================\n import express from \"express\";\n-// NOTE: Assuming verifyToken and authorizeRole are imported from a middleware file or authRoutes\n-import { verifyToken, isAdmin as authorizeRole } from \"../routes/authRoutes.js\"; // Using isAdmin as placeholder for authorizeRole(\"admin\")\n-import { verifyToken, isAdmin } from \"../middleware/authMiddleware.js\";\n-// NOTE: Placeholder functions for controller logic below\n-const submitMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: submitMembershipRequest\" });\n-const getAllMembershipRequests = (req, res) => res.status(501).json({ message: \"Not Implemented: getAllMembershipRequests\" });\n-const approveMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: approveMembershipRequest\" });\n-const rejectMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: rejectMembershipRequest\" });\n-const deleteMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: deleteMembershipRequest\" });\n-const getAllMembershipRecords = (req, res) => res.status(501).json({ message: \"Not Implemented: getAllMembershipRecords\" });\n-const syncMembershipRecords = (req, res) => res.status(501).json({ message: \"Not Implemented: syncMembershipRecords\" });\n-const getLatestMembershipRequest = (req, res) =>   res.status(501).json({ message: \"Not Implemented: getLatestMembershipRequest\" });\n+import { authenticateJWT, requireAdmin } from \"../middleware/authMiddleware.js\";\n \n+import {\n+    submitMembershipRequest,\n+    getAllMembershipRequests,\n+    approveMembershipRequest,\n+    rejectMembershipRequest,\n+    deleteMembershipRequest,\n+    getAllMembershipRecords,\n+    syncMembershipRecords,\n+    getLatestMembershipRequest\n+} from \"../controllers/membershipController.js\";\n+\n const router = express.Router();\n \n-// ==========================================\n-// Residents & Admins: Submit membership request\n-// ==========================================\n-router.post(\"/request\", verifyToken, submitMembershipRequest);\n+// =======================================================\n+// RESIDENT ROUTE — Submit membership request\n+// =======================================================\n+router.post(\"/request\", authenticateJWT, submitMembershipRequest);\n \n-// ==========================================\n-// Admin-only routes\n-// ==========================================\n+// =======================================================\n+// ADMIN ROUTES (Protected by requireAdmin)\n+// =======================================================\n \n\\ No newline at end of file\n // Get all membership requests\n-router.get(\"/all\", verifyToken, authorizeRole, getAllMembershipRequests); // frontend calls this\n+router.get(\"/all\", authenticateJWT, requireAdmin, getAllMembershipRequests);\n \n // Approve membership request\n-router.patch(\"/approve/:RequestID\", verifyToken, authorizeRole, approveMembershipRequest); // frontend calls this\n+router.patch(\"/approve/:RequestID\", authenticateJWT, requireAdmin, approveMembershipRequest);\n \n // Reject membership request\n-router.patch(\"/reject/:RequestID\", verifyToken, authorizeRole, rejectMembershipRequest); // frontend calls this\n+router.patch(\"/reject/:RequestID\", authenticateJWT, requireAdmin, rejectMembershipRequest);\n \n-// Delete membership request\n-router.delete(\"/delete/:RequestID\", verifyToken, authorizeRole, deleteMembershipRequest);\n+// Delete a membership request\n+router.delete(\"/delete/:RequestID\", authenticateJWT, requireAdmin, deleteMembershipRequest);\n \n-// Get all membership records (synced data)\n-router.get(\"/records\", verifyToken, isAdmin, getAllMembershipRecords);\n-router.get(\"/latest\", verifyToken, authorizeRole, getLatestMembershipRequest);\n-// Sync membership records\n-router.post(\"/sync\", verifyToken, authorizeRole, syncMembershipRecords);\n+// View synced membership records\n+router.get(\"/records\", authenticateJWT, requireAdmin, getAllMembershipRecords);\n \n-export default router;\n+// Latest membership request details\n+router.get(\"/latest\", authenticateJWT, requireAdmin, getLatestMembershipRequest);\n+\n+// Sync membership records from external systems\n+router.post(\"/sync\", authenticateJWT, requireAdmin, syncMembershipRecords);\n+\n+export default router;\n"
                },
                {
                    "date": 1763697637701,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n // ==========================================\n // backend/routes/membershipRoutes.js\n // ==========================================\n import express from \"express\";\n-import { authenticateJWT, requireAdmin } from \"../middleware/authMiddleware.js\";\n+import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n \n import {\n     submitMembershipRequest,\n     getAllMembershipRequests,\n@@ -46,5 +46,5 @@\n \n // Sync membership records from external systems\n router.post(\"/sync\", authenticateJWT, requireAdmin, syncMembershipRecords);\n \n-export default router;\n\\ No newline at end of file\n+export default router;\n"
                },
                {
                    "date": 1763697654759,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,29 +22,29 @@\n // =======================================================\n router.post(\"/request\", authenticateJWT, submitMembershipRequest);\n \n // =======================================================\n-// ADMIN ROUTES (Protected by requireAdmin)\n+// ADMIN ROUTES (Protected by isAdmin)\n // =======================================================\n \n // Get all membership requests\n-router.get(\"/all\", authenticateJWT, requireAdmin, getAllMembershipRequests);\n+router.get(\"/all\", authenticateJWT, isAdmin, getAllMembershipRequests);\n \n // Approve membership request\n-router.patch(\"/approve/:RequestID\", authenticateJWT, requireAdmin, approveMembershipRequest);\n+router.patch(\"/approve/:RequestID\", authenticateJWT, isAdmin, approveMembershipRequest);\n \n // Reject membership request\n-router.patch(\"/reject/:RequestID\", authenticateJWT, requireAdmin, rejectMembershipRequest);\n+router.patch(\"/reject/:RequestID\", authenticateJWT, isAdmin, rejectMembershipRequest);\n \n // Delete a membership request\n-router.delete(\"/delete/:RequestID\", authenticateJWT, requireAdmin, deleteMembershipRequest);\n+router.delete(\"/delete/:RequestID\", authenticateJWT, isAdmin, deleteMembershipRequest);\n \n // View synced membership records\n-router.get(\"/records\", authenticateJWT, requireAdmin, getAllMembershipRecords);\n+router.get(\"/records\", authenticateJWT, isAdmin, getAllMembershipRecords);\n \n // Latest membership request details\n-router.get(\"/latest\", authenticateJWT, requireAdmin, getLatestMembershipRequest);\n+router.get(\"/latest\", authenticateJWT, isAdmin, getLatestMembershipRequest);\n \n // Sync membership records from external systems\n-router.post(\"/sync\", authenticateJWT, requireAdmin, syncMembershipRecords);\n+router.post(\"/sync\", authenticateJWT, isAdmin, syncMembershipRecords);\n \n export default router;\n"
                },
                {
                    "date": 1763729229217,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,50 +1,135 @@\n-// ==========================================\n-// backend/routes/membershipRoutes.js\n-// ==========================================\n-import express from \"express\";\n-import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n+// controllers/membershipController.js\n+import sql from \"mssql\";\n+import dotenv from \"dotenv\";\n+dotenv.config();\n \n-import {\n-    submitMembershipRequest,\n-    getAllMembershipRequests,\n-    approveMembershipRequest,\n-    rejectMembershipRequest,\n-    deleteMembershipRequest,\n-    getAllMembershipRecords,\n-    syncMembershipRecords,\n-    getLatestMembershipRequest\n-} from \"../controllers/membershipController.js\";\n+// ==============================\n+// DB CONFIG - Loads connection settings from environment variables\n+// ==============================\n+const dbConfig = {\n+  user: process.env.DB_USER || \"Beverly\",\n+  password: process.env.DB_PASSWORD || \"Bev@1234567\",\n+  server: process.env.DB_SERVER || \"localhost\",\n+  database: process.env.DB_NAME || \"EstateAccessManagementSystem\",\n+  options: { encrypt: true, trustServerCertificate: true },\n+};\n \n-const router = express.Router();\n+// ====================================================\n+// SUBMIT MEMBERSHIP REQUEST (POST /api/membership)\n+// ====================================================\n+export const submitMembershipRequest = async (req, res) => {\n+  const { ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName, RoleName, Action } = req.body;\n \n-// =======================================================\n-// RESIDENT ROUTE — Submit membership request\n-// =======================================================\n-router.post(\"/request\", authenticateJWT, submitMembershipRequest);\n+  // List of valid roles\n+  const validRoles = [\"Resident\", \"Security\", \"Admin\", \"Visitor\"];\n+  \n+  // 400 Bad Request if essential fields are missing\n+  if (!ResidentName || !NationalID || !PhoneNumber || !Email || !HouseNumber || !CourtName || !RoleName) {\n+    return res.status(400).json({ success: false, message: \"All fields except Action are required.\" });\n+  }\n \n-// =======================================================\n-// ADMIN ROUTES (Protected by isAdmin)\n-// =======================================================\n+  // Validate the role against the allowed list (to prevent \"Unknown role\" DB error)\n+  if (!validRoles.includes(RoleName)) {\n+      return res.status(400).json({ \n+          success: false, \n+          message: `Invalid role selected: ${RoleName}. Please select one of ${validRoles.join(', ')}.` \n+      });\n+  }\n \n-// Get all membership requests\n-router.get(\"/all\", authenticateJWT, isAdmin, getAllMembershipRequests);\n+  try {\n+    const pool = await sql.connect(dbConfig);\n \n-// Approve membership request\n-router.patch(\"/approve/:RequestID\", authenticateJWT, isAdmin, approveMembershipRequest);\n+    await pool.request()\n+      // Use robust NVarChar data types\n+      .input(\"ResidentName\", sql.NVarChar(100), ResidentName)\n+      .input(\"NationalID\", sql.NVarChar(50), NationalID)\n+      .input(\"PhoneNumber\", sql.NVarChar(50), PhoneNumber)\n+      .input(\"Email\", sql.NVarChar(100), Email)\n+      .input(\"HouseNumber\", sql.NVarChar(50), HouseNumber)\n+      .input(\"CourtName\", sql.NVarChar(50), CourtName)\n+      .input(\"RoleName\", sql.NVarChar(50), RoleName)\n+      // Pass NULL if Action is empty\n+      .input(\"Action\", sql.NVarChar(100), Action || null) \n+      .query(`\n+        INSERT INTO MembershipRequests\n+        (ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName, RoleName, Action, Status, RequestedAt)\n+        VALUES\n+        (@ResidentName, @NationalID, @PhoneNumber, @Email, @HouseNumber, @CourtName, @RoleName, @Action, 'Pending', GETDATE())\n+      `);\n \n-// Reject membership request\n-router.patch(\"/reject/:RequestID\", authenticateJWT, isAdmin, rejectMembershipRequest);\n+    res.status(201).json({ success: true, message: \"Membership request submitted successfully.\" });\n \n-// Delete a membership request\n-router.delete(\"/delete/:RequestID\", authenticateJWT, isAdmin, deleteMembershipRequest);\n+  } catch (err) {\n+    console.error(\"❌ Membership request failed:\", err);\n+    res.status(500).json({ \n+        success: false, \n+        message: \"Server error or Database connection failed.\", \n+        details: err.message \n+    });\n+  }\n+};\n \n-// View synced membership records\n-router.get(\"/records\", authenticateJWT, isAdmin, getAllMembershipRecords);\n+// ====================================================\n+// APPROVE MEMBERSHIP REQUEST (PUT /api/membership/approve/:RequestID)\n+// ====================================================\n+export const approveMembershipRequest = async (req, res) => {\n+  const { RequestID } = req.params;\n+  try {\n+    const pool = await sql.connect(dbConfig);\n+    const result = await pool.request()\n+      .input(\"RequestID\", sql.Int, RequestID)\n+      .query(\"UPDATE MembershipRequests SET Status = 'Approved' WHERE RequestID = @RequestID AND Status = 'Pending'\");\n \n-// Latest membership request details\n-router.get(\"/latest\", authenticateJWT, isAdmin, getLatestMembershipRequest);\n+    if (result.rowsAffected[0] === 0) {\n+      return res.status(404).json({ success: false, message: \"Request ID not found or already processed.\" });\n+    }\n \n-// Sync membership records from external systems\n-router.post(\"/sync\", authenticateJWT, isAdmin, syncMembershipRecords);\n+    res.json({ success: true, message: \"Request approved successfully.\" });\n+  } catch (err) {\n+    console.error(\"❌ approveMembershipRequest Error:\", err);\n+    res.status(500).json({ success: false, message: \"Server error\", details: err.message });\n+  }\n+};\n \n-export default router;\n+// ====================================================\n+// REJECT MEMBERSHIP REQUEST (PUT /api/membership/reject/:RequestID)\n+// ====================================================\n+export const rejectMembershipRequest = async (req, res) => {\n+  const { RequestID } = req.params;\n+  try {\n+    const pool = await sql.connect(dbConfig);\n+    const result = await pool.request()\n+      .input(\"RequestID\", sql.Int, RequestID)\n+      .query(\"UPDATE MembershipRequests SET Status = 'Rejected' WHERE RequestID = @RequestID AND Status = 'Pending'\");\n+\n+    if (result.rowsAffected[0] === 0) {\n+      return res.status(404).json({ success: false, message: \"Request ID not found or already processed.\" });\n+    }\n+\n+    res.json({ success: true, message: \"Request rejected successfully.\" });\n+  } catch (err) {\n+    console.error(\"❌ rejectMembershipRequest Error:\", err);\n+    res.status(500).json({ success: false, message: \"Server error\", details: err.message });\n+  }\n+};\n+\n+// ====================================================\n+// GET ALL MEMBERSHIP REQUESTS (GET /api/membership)\n+// ====================================================\n+export const getMembershipRequests = async (req, res) => {\n+    try {\n+        const pool = await sql.connect(dbConfig);\n+        const result = await pool.request().query(`\n+            SELECT \n+                RequestID, ResidentName, NationalID, PhoneNumber, Email, \n+                HouseNumber, CourtName, RoleName, Status, RequestedAt\n+            FROM MembershipRequests \n+            ORDER BY RequestedAt DESC\n+        `);\n+\n+        res.json({ success: true, requests: result.recordset });\n+    } catch (err) {\n+        console.error(\"❌ getMembershipRequests Error:\", err);\n+        res.status(500).json({ success: false, message: \"Server error fetching requests\", details: err.message });\n+    }\n+};\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763729242427,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,135 +1,50 @@\n-// controllers/membershipController.js\n-import sql from \"mssql\";\n-import dotenv from \"dotenv\";\n-dotenv.config();\n+// ==========================================\n+// backend/routes/membershipRoutes.js\n+// ==========================================\n+import express from \"express\";\n+import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n \n-// ==============================\n-// DB CONFIG - Loads connection settings from environment variables\n-// ==============================\n-const dbConfig = {\n-  user: process.env.DB_USER || \"Beverly\",\n-  password: process.env.DB_PASSWORD || \"Bev@1234567\",\n-  server: process.env.DB_SERVER || \"localhost\",\n-  database: process.env.DB_NAME || \"EstateAccessManagementSystem\",\n-  options: { encrypt: true, trustServerCertificate: true },\n-};\n+import {\n+    submitMembershipRequest,\n+    getAllMembershipRequests,\n+    approveMembershipRequest,\n+    rejectMembershipRequest,\n+    deleteMembershipRequest,\n+    getAllMembershipRecords,\n+    syncMembershipRecords,\n+    getLatestMembershipRequest\n+} from \"../controllers/membershipController.js\";\n \n-// ====================================================\n-// SUBMIT MEMBERSHIP REQUEST (POST /api/membership)\n-// ====================================================\n-export const submitMembershipRequest = async (req, res) => {\n-  const { ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName, RoleName, Action } = req.body;\n+const router = express.Router();\n \n-  // List of valid roles\n-  const validRoles = [\"Resident\", \"Security\", \"Admin\", \"Visitor\"];\n-  \n-  // 400 Bad Request if essential fields are missing\n-  if (!ResidentName || !NationalID || !PhoneNumber || !Email || !HouseNumber || !CourtName || !RoleName) {\n-    return res.status(400).json({ success: false, message: \"All fields except Action are required.\" });\n-  }\n+// =======================================================\n+// RESIDENT ROUTE — Submit membership request\n+// =======================================================\n+router.post(\"/request\", authenticateJWT, submitMembershipRequest);\n \n-  // Validate the role against the allowed list (to prevent \"Unknown role\" DB error)\n-  if (!validRoles.includes(RoleName)) {\n-      return res.status(400).json({ \n-          success: false, \n-          message: `Invalid role selected: ${RoleName}. Please select one of ${validRoles.join(', ')}.` \n-      });\n-  }\n+// =======================================================\n+// ADMIN ROUTES (Protected by isAdmin)\n+// =======================================================\n \n-  try {\n-    const pool = await sql.connect(dbConfig);\n+// Get all membership requests\n+router.get(\"/all\", authenticateJWT, isAdmin, getAllMembershipRequests);\n \n-    await pool.request()\n-      // Use robust NVarChar data types\n-      .input(\"ResidentName\", sql.NVarChar(100), ResidentName)\n-      .input(\"NationalID\", sql.NVarChar(50), NationalID)\n-      .input(\"PhoneNumber\", sql.NVarChar(50), PhoneNumber)\n-      .input(\"Email\", sql.NVarChar(100), Email)\n-      .input(\"HouseNumber\", sql.NVarChar(50), HouseNumber)\n-      .input(\"CourtName\", sql.NVarChar(50), CourtName)\n-      .input(\"RoleName\", sql.NVarChar(50), RoleName)\n-      // Pass NULL if Action is empty\n-      .input(\"Action\", sql.NVarChar(100), Action || null) \n-      .query(`\n-        INSERT INTO MembershipRequests\n-        (ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName, RoleName, Action, Status, RequestedAt)\n-        VALUES\n-        (@ResidentName, @NationalID, @PhoneNumber, @Email, @HouseNumber, @CourtName, @RoleName, @Action, 'Pending', GETDATE())\n-      `);\n+// Approve membership request\n+router.patch(\"/approve/:RequestID\", authenticateJWT, isAdmin, approveMembershipRequest);\n \n-    res.status(201).json({ success: true, message: \"Membership request submitted successfully.\" });\n+// Reject membership request\n+router.patch(\"/reject/:RequestID\", authenticateJWT, isAdmin, rejectMembershipRequest);\n \n-  } catch (err) {\n-    console.error(\"❌ Membership request failed:\", err);\n-    res.status(500).json({ \n-        success: false, \n-        message: \"Server error or Database connection failed.\", \n-        details: err.message \n-    });\n-  }\n-};\n+// Delete a membership request\n+router.delete(\"/delete/:RequestID\", authenticateJWT, isAdmin, deleteMembershipRequest);\n \n-// ====================================================\n-// APPROVE MEMBERSHIP REQUEST (PUT /api/membership/approve/:RequestID)\n-// ====================================================\n-export const approveMembershipRequest = async (req, res) => {\n-  const { RequestID } = req.params;\n-  try {\n-    const pool = await sql.connect(dbConfig);\n-    const result = await pool.request()\n-      .input(\"RequestID\", sql.Int, RequestID)\n-      .query(\"UPDATE MembershipRequests SET Status = 'Approved' WHERE RequestID = @RequestID AND Status = 'Pending'\");\n+// View synced membership records\n+router.get(\"/records\", authenticateJWT, isAdmin, getAllMembershipRecords);\n \n-    if (result.rowsAffected[0] === 0) {\n-      return res.status(404).json({ success: false, message: \"Request ID not found or already processed.\" });\n-    }\n+// Latest membership request details\n+router.get(\"/latest\", authenticateJWT, isAdmin, getLatestMembershipRequest);\n \n-    res.json({ success: true, message: \"Request approved successfully.\" });\n-  } catch (err) {\n-    console.error(\"❌ approveMembershipRequest Error:\", err);\n-    res.status(500).json({ success: false, message: \"Server error\", details: err.message });\n-  }\n-};\n+// Sync membership records from external systems\n+router.post(\"/sync\", authenticateJWT, isAdmin, syncMembershipRecords);\n \n-// ====================================================\n-// REJECT MEMBERSHIP REQUEST (PUT /api/membership/reject/:RequestID)\n-// ====================================================\n-export const rejectMembershipRequest = async (req, res) => {\n-  const { RequestID } = req.params;\n\\ No newline at end of file\n-  try {\n-    const pool = await sql.connect(dbConfig);\n-    const result = await pool.request()\n-      .input(\"RequestID\", sql.Int, RequestID)\n-      .query(\"UPDATE MembershipRequests SET Status = 'Rejected' WHERE RequestID = @RequestID AND Status = 'Pending'\");\n-\n-    if (result.rowsAffected[0] === 0) {\n-      return res.status(404).json({ success: false, message: \"Request ID not found or already processed.\" });\n-    }\n-\n-    res.json({ success: true, message: \"Request rejected successfully.\" });\n-  } catch (err) {\n-    console.error(\"❌ rejectMembershipRequest Error:\", err);\n-    res.status(500).json({ success: false, message: \"Server error\", details: err.message });\n-  }\n-};\n-\n-// ====================================================\n-// GET ALL MEMBERSHIP REQUESTS (GET /api/membership)\n-// ====================================================\n-export const getMembershipRequests = async (req, res) => {\n-    try {\n-        const pool = await sql.connect(dbConfig);\n-        const result = await pool.request().query(`\n-            SELECT \n-                RequestID, ResidentName, NationalID, PhoneNumber, Email, \n-                HouseNumber, CourtName, RoleName, Status, RequestedAt\n-            FROM MembershipRequests \n-            ORDER BY RequestedAt DESC\n-        `);\n-\n-        res.json({ success: true, requests: result.recordset });\n-    } catch (err) {\n-        console.error(\"❌ getMembershipRequests Error:\", err);\n-        res.status(500).json({ success: false, message: \"Server error fetching requests\", details: err.message });\n-    }\n-};\n+export default router;\n"
                },
                {
                    "date": 1763729305178,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,50 +1,35 @@\n-// ==========================================\n-// backend/routes/membershipRoutes.js\n-// ==========================================\n+// routes/membershipRoutes.js\n import express from \"express\";\n-import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n-\n-import {\n-    submitMembershipRequest,\n-    getAllMembershipRequests,\n-    approveMembershipRequest,\n+import { \n+    submitMembershipRequest, \n+    approveMembershipRequest, \n     rejectMembershipRequest,\n-    deleteMembershipRequest,\n-    getAllMembershipRecords,\n-    syncMembershipRecords,\n-    getLatestMembershipRequest\n-} from \"../controllers/membershipController.js\";\n+    getMembershipRequests\n+} from \"../controllers/membershipController.js\"; \n \n const router = express.Router();\n \n-// =======================================================\n-// RESIDENT ROUTE — Submit membership request\n-// =======================================================\n-router.post(\"/request\", authenticateJWT, submitMembershipRequest);\n+// ======================================\n+// PUBLIC ROUTE\n+// ======================================\n \n-// =======================================================\n-// ADMIN ROUTES (Protected by isAdmin)\n-// =======================================================\n+// POST /api/membership - Submit a new request\n+router.post(\"/\", submitMembershipRequest);\n \n-// Get all membership requests\n-router.get(\"/all\", authenticateJWT, isAdmin, getAllMembershipRequests);\n+// ======================================\n+// ADMIN/PROTECTED ROUTES (You may need to add middleware like verifyToken here)\n+// ======================================\n \n-// Approve membership request\n-router.patch(\"/approve/:RequestID\", authenticateJWT, isAdmin, approveMembershipRequest);\n+// GET /api/membership - Retrieve all requests\n+router.get(\"/\", getMembershipRequests); \n \n-// Reject membership request\n-router.patch(\"/reject/:RequestID\", authenticateJWT, isAdmin, rejectMembershipRequest);\n+// PUT /api/membership/approve/:RequestID - Approve a request\n+router.put(\"/approve/:RequestID\", approveMembershipRequest); \n \n-// Delete a membership request\n-router.delete(\"/delete/:RequestID\", authenticateJWT, isAdmin, deleteMembershipRequest);\n+// PUT /api/membership/reject/:RequestID - Reject a request\n+router.put(\"/reject/:RequestID\", rejectMembershipRequest); \n \n-// View synced membership records\n-router.get(\"/records\", authenticateJWT, isAdmin, getAllMembershipRecords);\n+// DELETE is often avoided for requests but can be added if needed:\n+// router.delete(\"/:RequestID\", deleteMembershipRequest); \n \n-// Latest membership request details\n-router.get(\"/latest\", authenticateJWT, isAdmin, getLatestMembershipRequest);\n-\n-// Sync membership records from external systems\n-router.post(\"/sync\", authenticateJWT, isAdmin, syncMembershipRecords);\n-\n-export default router;\n+export default router;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763788640587,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,18 +5,49 @@\n     approveMembershipRequest, \n     rejectMembershipRequest,\n     getMembershipRequests\n } from \"../controllers/membershipController.js\"; \n-\n+import { dbPool } from \"../server.js\";\n const router = express.Router();\n \n // ======================================\n // PUBLIC ROUTE\n // ======================================\n \n // POST /api/membership - Submit a new request\n router.post(\"/\", submitMembershipRequest);\n+router.post(\"/request\", async (req, res) => {\n+  try {\n+    const { ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName, RoleName } = req.body;\n \n+    // Validate input\n+    if (!ResidentName || !NationalID || !PhoneNumber || !Email || !HouseNumber || !CourtName || !RoleName) {\n+      return res.status(400).json({ message: \"All fields are required\" });\n+    }\n+\n+    const pool = await dbPool;\n+\n+    await pool.request()\n+      .input(\"ResidentName\", ResidentName)\n+      .input(\"NationalID\", NationalID)\n+      .input(\"PhoneNumber\", PhoneNumber)\n+      .input(\"Email\", Email)\n+      .input(\"HouseNumber\", HouseNumber)\n+      .input(\"CourtName\", CourtName)\n+      .input(\"RoleName\", RoleName)\n+      .query(`\n+        INSERT INTO MembershipRequests\n+        (ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName, RoleName, Status, RequestedAt)\n+        VALUES\n+        (@ResidentName, @NationalID, @PhoneNumber, @Email, @HouseNumber, @CourtName, @RoleName, 'Pending', GETDATE())\n+      `);\n+\n+    res.status(201).json({ message: \"Membership request submitted successfully\" });\n+  } catch (err) {\n+    console.error(\"Error creating membership request:\", err);\n+    res.status(500).json({ message: \"Server error\" });\n+  }\n+});\n // ======================================\n // ADMIN/PROTECTED ROUTES (You may need to add middleware like verifyToken here)\n // ======================================\n \n"
                },
                {
                    "date": 1763788741758,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,9 @@\n     rejectMembershipRequest,\n     getMembershipRequests\n } from \"../controllers/membershipController.js\"; \n import { dbPool } from \"../server.js\";\n+import membershipRoutes from \"./routes/membershipRoutes.js\";\n const router = express.Router();\n \n // ======================================\n // PUBLIC ROUTE\n"
                },
                {
                    "date": 1763795055744,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,18 +5,17 @@\n     approveMembershipRequest, \n     rejectMembershipRequest,\n     getMembershipRequests\n } from \"../controllers/membershipController.js\"; \n-import { dbPool } from \"../server.js\";\n-import membershipRoutes from \"./routes/membershipRoutes.js\";\n+import { dbPool } from \"../server.js\"; // needed for direct DB calls if used\n+\n const router = express.Router();\n \n // ======================================\n // PUBLIC ROUTE\n // ======================================\n \n-// POST /api/membership - Submit a new request\n-router.post(\"/\", submitMembershipRequest);\n+// POST /api/membership/request - Submit a new request\n router.post(\"/request\", async (req, res) => {\n   try {\n     const { ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName, RoleName } = req.body;\n \n@@ -47,10 +46,11 @@\n     console.error(\"Error creating membership request:\", err);\n     res.status(500).json({ message: \"Server error\" });\n   }\n });\n+\n // ======================================\n-// ADMIN/PROTECTED ROUTES (You may need to add middleware like verifyToken here)\n+// ADMIN/PROTECTED ROUTES\n // ======================================\n \n // GET /api/membership - Retrieve all requests\n router.get(\"/\", getMembershipRequests); \n@@ -60,8 +60,5 @@\n \n // PUT /api/membership/reject/:RequestID - Reject a request\n router.put(\"/reject/:RequestID\", rejectMembershipRequest); \n \n-// DELETE is often avoided for requests but can be added if needed:\n-// router.delete(\"/:RequestID\", deleteMembershipRequest); \n-\n-export default router;\n\\ No newline at end of file\n+export default router;\n"
                }
            ],
            "date": 1763694783794,
            "name": "Commit-0",
            "content": "// ==========================================\n// backend/routes/membershipRoutes.js\n// ==========================================\nimport express from \"express\";\n// NOTE: Assuming verifyToken and authorizeRole are imported from a middleware file or authRoutes\nimport { verifyToken, isAdmin as authorizeRole } from \"../routes/authRoutes.js\"; // Using isAdmin as placeholder for authorizeRole(\"admin\")\n\n// NOTE: Placeholder functions for controller logic below\nconst submitMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: submitMembershipRequest\" });\nconst getAllMembershipRequests = (req, res) => res.status(501).json({ message: \"Not Implemented: getAllMembershipRequests\" });\nconst approveMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: approveMembershipRequest\" });\nconst rejectMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: rejectMembershipRequest\" });\nconst deleteMembershipRequest = (req, res) => res.status(501).json({ message: \"Not Implemented: deleteMembershipRequest\" });\nconst getAllMembershipRecords = (req, res) => res.status(501).json({ message: \"Not Implemented: getAllMembershipRecords\" });\nconst syncMembershipRecords = (req, res) => res.status(501).json({ message: \"Not Implemented: syncMembershipRecords\" });\nconst getLatestMembershipRequest = (req, res) =>   res.status(501).json({ message: \"Not Implemented: getLatestMembershipRequest\" });\n\nconst router = express.Router();\n\n// ==========================================\n// Residents & Admins: Submit membership request\n// ==========================================\nrouter.post(\"/request\",  submitMembershipRequest);\n\n// ==========================================\n// Admin-only routes\n// ==========================================\n\n// Get all membership requests\nrouter.get(\"/all\", verifyToken, authorizeRole, getAllMembershipRequests); // frontend calls this\n\n// Approve membership request\nrouter.patch(\"/approve/:RequestID\", verifyToken, authorizeRole, approveMembershipRequest); // frontend calls this\n\n// Reject membership request\nrouter.patch(\"/reject/:RequestID\", verifyToken, authorizeRole, rejectMembershipRequest); // frontend calls this\n\n// Delete membership request\nrouter.delete(\"/delete/:RequestID\", verifyToken, authorizeRole, deleteMembershipRequest);\n\n// Get all membership records (synced data)\nrouter.get(\"/records\", verifyToken, authorizeRole, getAllMembershipRecords);\nrouter.get(\"/latest\", verifyToken, authorizeRole, getLatestMembershipRequest);\n// Sync membership records\nrouter.post(\"/sync\", verifyToken, authorizeRole, syncMembershipRecords);\n\nexport default router;"
        }
    ]
}