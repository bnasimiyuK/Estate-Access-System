{
    "sourceFile": "frontend/accesslogs.html",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1763846441145,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763846479088,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,45 +1,47 @@\n-// backend/routes/accessLogsRoutes.js\n-import { Router } from \"express\";\n-import { dbPool } from \"../server.js\";\n-import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n+<!DOCTYPE html>\n+<html lang=\"en\">\n+<head>\n+  <meta charset=\"utf-8\" />\n+  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n+  <title>Access Logs</title>\n+  <script src=\"https://cdn.tailwindcss.com\"></script>\n+  <script src=\"https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js\"></script>\n+</head>\n+<body class=\"bg-gray-100 min-h-screen\">\n+  <header class=\"bg-blue-600 text-white p-4 flex justify-between items-center\">\n+    <div class=\"max-w-6xl mx-auto w-full flex justify-between\">\n+      <h1 class=\"text-lg font-semibold\">Access Logs</h1>\n+      <a href=\"admindashboard.html\" class=\"bg-white text-blue-600 px-3 py-1 rounded\">Back to Dashboard</a>\n+    </div>\n+  </header>\n \n-const router = Router();\n+  <main class=\"max-w-6xl mx-auto p-6\">\n+    <section class=\"bg-white p-4 rounded shadow\">\n+      <div class=\"flex justify-between items-center mb-4\">\n+        <h2 class=\"text-xl font-bold\">Logs</h2>\n+        <div class=\"flex gap-2\">\n+          <input id=\"logsFrom\" type=\"date\" class=\"border p-2 rounded\" />\n+          <input id=\"logsTo\" type=\"date\" class=\"border p-2 rounded\" />\n+          <button id=\"logsFilter\" class=\"bg-blue-600 text-white px-3 py-1 rounded\">Filter</button>\n+          <button id=\"logsRefresh\" class=\"bg-gray-700 text-white px-3 py-1 rounded\">Refresh</button>\n+        </div>\n+      </div>\n \n-// GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\n-router.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\n-    try {\n-        const { from, to } = req.query;\n-        let query = `SELECT TOP (1000)\n-            [Id],\n-            [TimestampUtc],\n-            [UserId],\n-            [Action],\n-            [Resource],\n-            [IpAddress],\n-            [UserAgent],\n-            [Referrer],\n-            [Metadata],\n-            [LogType]\n-        FROM [EstateAccessManagementSystem].[dbo].[accesslogs]`;\n-        \n-        if (from && to) {\n-            query += \" WHERE CAST(TimestampUtc AS DATE) BETWEEN @from AND @to\";\n-        }\n-        query += \" ORDER BY TimestampUtc DESC\";\n+      <div class=\"overflow-x-auto\">\n+        <table class=\"min-w-full border\">\n+          <thead class=\"bg-gray-100\">\n+            <tr>\n+              <th class=\"p-2 border\">Timestamp</th>\n+              <th class=\"p-2 border\">Type</th>\n+              <th class=\"p-2 border\">Details</th>\n+            </tr>\n+          </thead>\n+          <tbody id=\"logsTbody\"></tbody>\n+        </table>\n+      </div>\n+    </section>\n+  </main>\n \n-        const pool = await dbPool;\n-        const request = pool.request();\n-        if (from && to) {\n-            request.input(\"from\", \"Date\", from);\n-            request.input(\"to\", \"Date\", to);\n-        }\n-\n-        const result = await request.query(query);\n-        res.json(result.recordset);\n-    } catch (err) {\n-        console.error(\"Access logs error:\", err);\n-        res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\n-    }\n-});\n-\n-export default router;\n+  <script src=\"/js/accesslogs.js\"></script>\n+</body>\n+</html>\n"
                },
                {
                    "date": 1763862458086,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,47 +1,97 @@\n <!DOCTYPE html>\n <html lang=\"en\">\n <head>\n-  <meta charset=\"utf-8\" />\n-  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n-  <title>Access Logs</title>\n-  <script src=\"https://cdn.tailwindcss.com\"></script>\n-  <script src=\"https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js\"></script>\n+    <meta charset=\"UTF-8\" />\n+    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n+    <title>Access Logs</title>\n+\n+    <style>\n+        body {\n+            font-family: Arial, sans-serif;\n+            padding: 20px;\n+            background: #f5f6f8;\n+        }\n+\n+        h1 {\n+            margin-bottom: 20px;\n+            color: #1f2937;\n+        }\n+\n+        .filter-box {\n+            margin-bottom: 15px;\n+        }\n+\n+        input[type=\"date\"] {\n+            padding: 8px;\n+            margin-right: 10px;\n+        }\n+\n+        button {\n+            padding: 8px 16px;\n+            background: #2563eb;\n+            color: white;\n+            border: none;\n+            cursor: pointer;\n+        }\n+\n+        button:hover {\n+            background: #1e40af;\n+        }\n+\n+        table {\n+            width: 100%;\n+            border-collapse: collapse;\n+            background: white;\n+            margin-top: 15px;\n+            box-shadow: 0 0 10px rgba(0,0,0,0.1);\n+        }\n+\n+        th {\n+            background: #2563eb;\n+            color: white;\n+            padding: 10px;\n+        }\n+\n+        td {\n+            padding: 10px;\n+            border-bottom: 1px solid #e5e7eb;\n+        }\n+\n+        tr:hover {\n+            background: #eef2ff;\n+        }\n+    </style>\n </head>\n-<body class=\"bg-gray-100 min-h-screen\">\n-  <header class=\"bg-blue-600 text-white p-4 flex justify-between items-center\">\n-    <div class=\"max-w-6xl mx-auto w-full flex justify-between\">\n-      <h1 class=\"text-lg font-semibold\">Access Logs</h1>\n-      <a href=\"admindashboard.html\" class=\"bg-white text-blue-600 px-3 py-1 rounded\">Back to Dashboard</a>\n+\n+<body>\n+\n+    <h1>Access Logs</h1>\n+\n+    <div class=\"filter-box\">\n+        <input type=\"date\" id=\"fromDate\" />\n+        <input type=\"date\" id=\"toDate\" />\n+        <button id=\"filterBtn\">Filter</button>\n     </div>\n-  </header>\n \n-  <main class=\"max-w-6xl mx-auto p-6\">\n-    <section class=\"bg-white p-4 rounded shadow\">\n-      <div class=\"flex justify-between items-center mb-4\">\n-        <h2 class=\"text-xl font-bold\">Logs</h2>\n-        <div class=\"flex gap-2\">\n-          <input id=\"logsFrom\" type=\"date\" class=\"border p-2 rounded\" />\n-          <input id=\"logsTo\" type=\"date\" class=\"border p-2 rounded\" />\n-          <button id=\"logsFilter\" class=\"bg-blue-600 text-white px-3 py-1 rounded\">Filter</button>\n-          <button id=\"logsRefresh\" class=\"bg-gray-700 text-white px-3 py-1 rounded\">Refresh</button>\n-        </div>\n-      </div>\n-\n-      <div class=\"overflow-x-auto\">\n-        <table class=\"min-w-full border\">\n-          <thead class=\"bg-gray-100\">\n+    <table>\n+        <thead>\n             <tr>\n-              <th class=\"p-2 border\">Timestamp</th>\n-              <th class=\"p-2 border\">Type</th>\n-              <th class=\"p-2 border\">Details</th>\n+                <th>#</th>\n+                <th>Timestamp</th>\n+                <th>User ID</th>\n+                <th>Action</th>\n+                <th>Resource</th>\n+                <th>IP Address</th>\n+                <th>User Agent</th>\n+                <th>Type</th>\n             </tr>\n-          </thead>\n-          <tbody id=\"logsTbody\"></tbody>\n-        </table>\n-      </div>\n-    </section>\n-  </main>\n+        </thead>\n+        <tbody id=\"logsTableBody\">\n+            <!-- Rows load from accesslogs.js -->\n+        </tbody>\n+    </table>\n \n-  <script src=\"/js/accesslogs.js\"></script>\n+    <script src=\"js/accesslogs.js\"></script>\n+\n </body>\n </html>\n"
                },
                {
                    "date": 1763864425030,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,97 +1,40 @@\n <!DOCTYPE html>\n <html lang=\"en\">\n <head>\n-    <meta charset=\"UTF-8\" />\n-    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n-    <title>Access Logs</title>\n-\n-    <style>\n-        body {\n-            font-family: Arial, sans-serif;\n-            padding: 20px;\n-            background: #f5f6f8;\n-        }\n-\n-        h1 {\n-            margin-bottom: 20px;\n-            color: #1f2937;\n-        }\n-\n-        .filter-box {\n-            margin-bottom: 15px;\n-        }\n-\n-        input[type=\"date\"] {\n-            padding: 8px;\n-            margin-right: 10px;\n-        }\n-\n-        button {\n-            padding: 8px 16px;\n-            background: #2563eb;\n-            color: white;\n-            border: none;\n-            cursor: pointer;\n-        }\n-\n-        button:hover {\n-            background: #1e40af;\n-        }\n-\n-        table {\n-            width: 100%;\n-            border-collapse: collapse;\n-            background: white;\n-            margin-top: 15px;\n-            box-shadow: 0 0 10px rgba(0,0,0,0.1);\n-        }\n-\n-        th {\n-            background: #2563eb;\n-            color: white;\n-            padding: 10px;\n-        }\n-\n-        td {\n-            padding: 10px;\n-            border-bottom: 1px solid #e5e7eb;\n-        }\n-\n-        tr:hover {\n-            background: #eef2ff;\n-        }\n-    </style>\n+<meta charset=\"UTF-8\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<title>Access Logs</title>\n+<style>\n+  body { font-family: Arial, sans-serif; padding: 20px; }\n+  table { border-collapse: collapse; width: 100%; }\n+  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n+  th { background-color: #f2f2f2; }\n+  pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }\n+</style>\n </head>\n-\n <body>\n \n-    <h1>Access Logs</h1>\n+<h1>Access Logs</h1>\n+<table id=\"logsTable\">\n+  <thead>\n+    <tr>\n+      <th>Id</th>\n+      <th>Timestamp</th>\n+      <th>User</th>\n+      <th>Action</th>\n+      <th>Resource</th>\n+      <th>IP</th>\n+      <th>User Agent</th>\n+      <th>Referrer</th>\n+      <th>Metadata</th>\n+      <th>Log Type</th>\n+    </tr>\n+  </thead>\n+  <tbody>\n+    <!-- Logs will appear here -->\n+  </tbody>\n+</table>\n \n-    <div class=\"filter-box\">\n-        <input type=\"date\" id=\"fromDate\" />\n-        <input type=\"date\" id=\"toDate\" />\n-        <button id=\"filterBtn\">Filter</button>\n-    </div>\n-\n-    <table>\n-        <thead>\n-            <tr>\n-                <th>#</th>\n-                <th>Timestamp</th>\n-                <th>User ID</th>\n-                <th>Action</th>\n-                <th>Resource</th>\n-                <th>IP Address</th>\n-                <th>User Agent</th>\n-                <th>Type</th>\n-            </tr>\n-        </thead>\n-        <tbody id=\"logsTableBody\">\n-            <!-- Rows load from accesslogs.js -->\n-        </tbody>\n-    </table>\n-\n-    <script src=\"js/accesslogs.js\"></script>\n-\n+<script type=\"module\" src=\"js/accesslogs.js\"></script>\n </body>\n </html>\n"
                },
                {
                    "date": 1763889886068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,40 +1,58 @@\n <!DOCTYPE html>\n <html lang=\"en\">\n <head>\n-<meta charset=\"UTF-8\">\n-<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n-<title>Access Logs</title>\n-<style>\n-  body { font-family: Arial, sans-serif; padding: 20px; }\n-  table { border-collapse: collapse; width: 100%; }\n-  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n-  th { background-color: #f2f2f2; }\n-  pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }\n-</style>\n+  <meta charset=\"UTF-8\">\n+  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+  <title>Admin Dashboard | Access Logs</title>\n+  <script src=\"https://cdn.tailwindcss.com\"></script>\n+  <style>\n+    .custom-scrollbar::-webkit-scrollbar { width: 8px; }\n+    .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 4px; }\n+    .custom-scrollbar::-webkit-scrollbar-track { background: #f3f4f6; }\n+  </style>\n </head>\n-<body>\n+<body class=\"bg-gray-100 font-sans min-h-screen\">\n \n-<h1>Access Logs</h1>\n-<table id=\"logsTable\">\n-  <thead>\n-    <tr>\n-      <th>Id</th>\n-      <th>Timestamp</th>\n-      <th>User</th>\n-      <th>Action</th>\n-      <th>Resource</th>\n-      <th>IP</th>\n-      <th>User Agent</th>\n-      <th>Referrer</th>\n-      <th>Metadata</th>\n-      <th>Log Type</th>\n-    </tr>\n-  </thead>\n-  <tbody>\n-    <!-- Logs will appear here -->\n-  </tbody>\n-</table>\n+  <header class=\"bg-blue-600 text-white p-4 flex justify-between items-center shadow-lg sticky top-0 z-10\">\n+    <h1 class=\"text-2xl font-bold\">Admin Dashboard | Access Logs</h1>\n+    <button id=\"logoutBtn\" class=\"bg-red-500 px-4 py-2 rounded-lg hover:bg-red-600 text-sm font-semibold shadow-md\">Logout</button>\n+  </header>\n \n-<script type=\"module\" src=\"js/accesslogs.js\"></script>\n+  <main class=\"p-6\">\n+    <section id=\"accessLogs\" class=\"p-4 bg-white rounded-lg shadow-lg\">\n+      <h2 class=\"text-xl font-bold mb-4\">Access Logs</h2>\n+\n+      <div class=\"overflow-x-auto mb-4\">\n+        <table id=\"accessLogsTable\" class=\"min-w-full border rounded-lg shadow custom-scrollbar\">\n+          <thead>\n+            <tr class=\"bg-gray-700 text-white\">\n+              <th class=\"p-3 border-r border-gray-600\">Timestamp</th>\n+              <th class=\"p-3 border-r border-gray-600\">User/Visitor ID</th>\n+              <th class=\"p-3 border-r border-gray-600\">Action</th>\n+              <th class=\"p-3\">Log Type</th>\n+            </tr>\n+          </thead>\n+          <tbody id=\"logsTableBody\">\n+            <!-- Data will be filled by JS -->\n+          </tbody>\n+        </table>\n+      </div>\n+    </section>\n+  </main>\n+\n+  <!-- Access Logs JS -->\n+  <script type=\"module\" src=\"/js/accesslogs.js\"></script>\n+  <script>\n+    // Ensure table populates when page loads\n+    document.addEventListener('DOMContentLoaded', () => {\n+      if (typeof loadaccesslogs === 'function') loadaccesslogs();\n+\n+      // Logout\n+      document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\n+        localStorage.removeItem(\"accessToken\");\n+        window.location.href = \"/login.html\";\n+      });\n+    });\n+  </script>\n </body>\n </html>\n"
                }
            ],
            "date": 1763846441145,
            "name": "Commit-0",
            "content": "// backend/routes/accessLogsRoutes.js\nimport { Router } from \"express\";\nimport { dbPool } from \"../server.js\";\nimport { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n\nconst router = Router();\n\n// GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\nrouter.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\n    try {\n        const { from, to } = req.query;\n        let query = `SELECT TOP (1000)\n            [Id],\n            [TimestampUtc],\n            [UserId],\n            [Action],\n            [Resource],\n            [IpAddress],\n            [UserAgent],\n            [Referrer],\n            [Metadata],\n            [LogType]\n        FROM [EstateAccessManagementSystem].[dbo].[accesslogs]`;\n        \n        if (from && to) {\n            query += \" WHERE CAST(TimestampUtc AS DATE) BETWEEN @from AND @to\";\n        }\n        query += \" ORDER BY TimestampUtc DESC\";\n\n        const pool = await dbPool;\n        const request = pool.request();\n        if (from && to) {\n            request.input(\"from\", \"Date\", from);\n            request.input(\"to\", \"Date\", to);\n        }\n\n        const result = await request.query(query);\n        res.json(result.recordset);\n    } catch (err) {\n        console.error(\"Access logs error:\", err);\n        res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\n    }\n});\n\nexport default router;\n"
        }
    ]
}