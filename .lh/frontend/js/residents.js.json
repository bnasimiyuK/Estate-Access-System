{
    "sourceFile": "frontend/js/residents.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1763967067016,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763967334124,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,107 +1,132 @@\n console.log(\"üèòÔ∏è residents.js loaded\");\n \n-// Import validation utilities\n-import {\n-  validateNationalID,\n-  validatePhone,\n-  validateEmail,\n-  validateRequired,\n-  showFormError,\n-  clearFormError\n-} from \"./validation.js\";\n-\n+// Load residents on page load\n document.addEventListener(\"DOMContentLoaded\", async () => {\n   await loadResidents();\n   setupSyncButton();\n });\n \n-// ==========================\n+// ========================================================\n // LOAD RESIDENTS\n-// ==========================\n+// ========================================================\n async function loadResidents() {\n   const token = localStorage.getItem(\"token\"); // JWT token\n   if (!token) return alert(\"Please log in first.\");\n \n   try {\n     const payload = JSON.parse(atob(token.split(\".\")[1]));\n     const role = payload.role.toLowerCase();\n \n-    // Choose API endpoint based on role\n-    const API_URL = role === \"admin\"\n-      ? \"http://localhost:4050/api/residents/all\"\n-      : \"http://localhost:4050/api/residents/profile\";\n+    // Use admin or resident endpoint\n+    const API_URL =\n+      role === \"admin\"\n+        ? \"http://localhost:4050/api/residents/all\"\n+        : \"http://localhost:4050/api/residents/profile\";\n \n     const response = await fetch(API_URL, {\n-      headers: { \n-        \"Content-Type\": \"application/json\", \n-        Authorization: `Bearer ${token}` \n-      },\n+      headers: {\n+        \"Content-Type\": \"application/json\",\n+        Authorization: `Bearer ${token}`\n+      }\n     });\n \n     if (!response.ok) throw new Error(`HTTP ${response.status}`);\n+\n     const data = await response.json();\n     populateResidentsTable(role, data);\n+\n   } catch (err) {\n     console.error(\"‚ùå Failed to load residents:\", err);\n-    alert(\"Error loading residents data. Check console.\");\n+    alert(\"Error loading residents. Check console.\");\n   }\n }\n \n-// ==========================\n+// ========================================================\n // POPULATE DATATABLE\n-// ==========================\n+// ========================================================\n function populateResidentsTable(role, data) {\n+\n   const residents = Array.isArray(data) ? data : [data];\n \n+  // Destroy old instance\n   if ($.fn.DataTable.isDataTable(\"#residentsTable\")) {\n     $(\"#residentsTable\").DataTable().destroy();\n   }\n \n+  // Initialize DataTable\n   $(\"#residentsTable\").DataTable({\n     data: residents,\n     columns: [\n       { data: \"ResidentID\" },\n       { data: \"UserID\" },\n       { data: \"ResidentName\" },\n       { data: \"NationalID\" },\n+      { data: \"PhoneNumber\" },\n+      { data: \"Email\" },\n       { data: \"HouseNumber\" },\n       { data: \"CourtName\" },\n-      { data: \"PhoneNumber\" },\n-      { data: \"Email\" },\n       { data: \"Occupation\" },\n-      { data: \"DateJoined\", render: d => d ? new Date(d).toLocaleDateString() : \"-\" },\n-      { data: \"Status\", render: s => {\n-          const color = s === \"Approved\" ? \"green\" : s === \"Rejected\" ? \"red\" : \"yellow\";\n+      {\n+        data: \"DateJoined\",\n+        render: d => d ? new Date(d).toLocaleDateString() : \"-\"\n+      },\n+      {\n+        data: \"Status\",\n+        render: s => {\n+          const color =\n+            s === \"Approved\"\n+              ? \"green\"\n+              : s === \"Rejected\"\n+              ? \"red\"\n+              : \"yellow\";\n+\n           return `<span class=\"px-2 py-1 rounded-full bg-${color}-100 text-${color}-800 font-semibold text-xs\">${s}</span>`;\n-      }},\n+        }\n+      },\n       { data: \"RoleName\" },\n       { data: \"TotalDue\" }\n     ],\n+\n     dom: \"Brtip\",\n     buttons: [\n       \"excelHtml5\",\n       \"pdfHtml5\",\n       \"print\",\n-      { text: 'Sort by Name', action: function () { this.api().order([2, 'asc']).draw(); } },\n-      { text: 'Sort by Date Joined', action: function () { this.api().order([9, 'desc']).draw(); } }\n+      {\n+        text: 'Sort by Name',\n+        action: function () {\n+          this.api().order([2, 'asc']).draw();\n+        }\n+      },\n+      {\n+        text: 'Sort by Date Joined',\n+        action: function () {\n+          this.api().order([9, 'desc']).draw();\n+        }\n+      }\n     ],\n+\n     responsive: true,\n     pageLength: 10,\n+\n     initComplete: function () {\n+      // Enable column filtering\n       this.api().columns().every(function () {\n         const column = this;\n-        $(column.header()).find('input.column-filter').on('keyup change', function () {\n-          column.search(this.value).draw();\n-        });\n+        $(column.header())\n+          .find(\"input.column-filter\")\n+          .on(\"keyup change\", function () {\n+            column.search(this.value).draw();\n+          });\n       });\n     }\n   });\n }\n \n-// ==========================\n-// SYNC BUTTON FOR ADMINS\n-// ==========================\n+// ========================================================\n+// ADMIN ‚Äî SYNC BUTTON\n+// ========================================================\n function setupSyncButton() {\n   const token = localStorage.getItem(\"token\");\n   if (!token) return;\n \n@@ -117,13 +142,16 @@\n   btn.addEventListener(\"click\", async () => {\n     try {\n       const res = await fetch(\"http://localhost:4050/api/residents/sync\", {\n         method: \"POST\",\n-        headers: { Authorization: `Bearer ${token}` },\n+        headers: { Authorization: `Bearer ${token}` }\n       });\n+\n       const result = await res.json();\n       alert(result.message);\n+\n       await loadResidents();\n+\n     } catch (err) {\n       console.error(\"‚ùå Sync failed:\", err);\n       alert(\"Failed to sync residents.\");\n     }\n"
                },
                {
                    "date": 1763968968110,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,157 +1,125 @@\n console.log(\"üèòÔ∏è residents.js loaded\");\n \n-// Load residents on page load\n+import {\n+  validateNationalID,\n+  validatePhone,\n+  validateEmail,\n+  validateRequired,\n+  showFormError,\n+  clearFormError\n+} from \"./validation.js\";\n+\n document.addEventListener(\"DOMContentLoaded\", async () => {\n   await loadResidents();\n   setupSyncButton();\n });\n \n-// ========================================================\n-// LOAD RESIDENTS\n-// ========================================================\n async function loadResidents() {\n-  const token = localStorage.getItem(\"token\"); // JWT token\n+  const token = localStorage.getItem(\"token\");\n   if (!token) return alert(\"Please log in first.\");\n \n   try {\n     const payload = JSON.parse(atob(token.split(\".\")[1]));\n     const role = payload.role.toLowerCase();\n \n-    // Use admin or resident endpoint\n-    const API_URL =\n-      role === \"admin\"\n-        ? \"http://localhost:4050/api/residents/all\"\n-        : \"http://localhost:4050/api/residents/profile\";\n+    const API_URL = role === \"admin\"\n+      ? \"http://localhost:4050/api/residents/all\"\n+      : \"http://localhost:4050/api/residents/profile\";\n \n     const response = await fetch(API_URL, {\n-      headers: {\n-        \"Content-Type\": \"application/json\",\n-        Authorization: `Bearer ${token}`\n-      }\n+      headers: { \"Content-Type\": \"application/json\", Authorization: `Bearer ${token}` },\n     });\n \n     if (!response.ok) throw new Error(`HTTP ${response.status}`);\n-\n     const data = await response.json();\n     populateResidentsTable(role, data);\n-\n   } catch (err) {\n     console.error(\"‚ùå Failed to load residents:\", err);\n-    alert(\"Error loading residents. Check console.\");\n+    alert(\"Error loading residents data. Check console.\");\n   }\n }\n \n-// ========================================================\n-// POPULATE DATATABLE\n-// ========================================================\n function populateResidentsTable(role, data) {\n-\n   const residents = Array.isArray(data) ? data : [data];\n \n-  // Destroy old instance\n   if ($.fn.DataTable.isDataTable(\"#residentsTable\")) {\n     $(\"#residentsTable\").DataTable().destroy();\n   }\n \n-  // Initialize DataTable\n-  $(\"#residentsTable\").DataTable({\n+  const columns = [\n+    { data: \"ResidentID\", title: \"Resident ID\" },\n+    { data: \"UserID\", title: \"User ID\" },\n+    { data: \"ResidentName\", title: \"Name\" },\n+    { data: \"NationalID\", title: \"National ID\" },\n+    { data: \"PhoneNumber\", title: \"Phone\" },\n+    { data: \"Email\", title: \"Email\" },\n+    { data: \"HouseNumber\", title: \"House\" },\n+    { data: \"CourtName\", title: \"Court\" },\n+    { data: \"Occupation\", title: \"Occupation\" },\n+    { \n+      data: \"DateJoined\", \n+      title: \"Date Joined\",\n+      render: d => d ? new Date(d).toLocaleDateString() : \"-\"\n+    },\n+    { \n+      data: \"Status\", \n+      title: \"Status\",\n+      render: s => {\n+        const color = s === \"Active\" ? \"green\" : s === \"Rejected\" ? \"red\" : \"yellow\";\n+        return `<span class=\"px-2 py-1 rounded-full bg-${color}-100 text-${color}-800 font-semibold text-xs\">${s}</span>`;\n+      }\n+    },\n+    { data: \"RoleName\", title: \"Role\" },\n+    { data: \"TotalDue\", title: \"Total Due\" }\n+  ];\n+\n+  const table = $(\"#residentsTable\").DataTable({\n     data: residents,\n-    columns: [\n-      { data: \"ResidentID\" },\n-      { data: \"UserID\" },\n-      { data: \"ResidentName\" },\n-      { data: \"NationalID\" },\n-      { data: \"PhoneNumber\" },\n-      { data: \"Email\" },\n-      { data: \"HouseNumber\" },\n-      { data: \"CourtName\" },\n-      { data: \"Occupation\" },\n-      {\n-        data: \"DateJoined\",\n-        render: d => d ? new Date(d).toLocaleDateString() : \"-\"\n-      },\n-      {\n-        data: \"Status\",\n-        render: s => {\n-          const color =\n-            s === \"Approved\"\n-              ? \"green\"\n-              : s === \"Rejected\"\n-              ? \"red\"\n-              : \"yellow\";\n-\n-          return `<span class=\"px-2 py-1 rounded-full bg-${color}-100 text-${color}-800 font-semibold text-xs\">${s}</span>`;\n-        }\n-      },\n-      { data: \"RoleName\" },\n-      { data: \"TotalDue\" }\n-    ],\n-\n+    columns: columns,\n     dom: \"Brtip\",\n     buttons: [\n       \"excelHtml5\",\n       \"pdfHtml5\",\n       \"print\",\n-      {\n-        text: 'Sort by Name',\n-        action: function () {\n-          this.api().order([2, 'asc']).draw();\n-        }\n-      },\n-      {\n-        text: 'Sort by Date Joined',\n-        action: function () {\n-          this.api().order([9, 'desc']).draw();\n-        }\n-      }\n+      { text: 'Sort by Name', action: function () { this.api().order([2, 'asc']).draw(); } },\n+      { text: 'Sort by Date Joined', action: function () { this.api().order([9, 'desc']).draw(); } }\n     ],\n-\n     responsive: true,\n     pageLength: 10,\n-\n     initComplete: function () {\n-      // Enable column filtering\n       this.api().columns().every(function () {\n         const column = this;\n-        $(column.header())\n-          .find(\"input.column-filter\")\n-          .on(\"keyup change\", function () {\n-            column.search(this.value).draw();\n-          });\n+        $(column.header()).find('input.column-filter').on('keyup change', function () {\n+          column.search(this.value).draw();\n+        });\n       });\n     }\n   });\n }\n \n-// ========================================================\n-// ADMIN ‚Äî SYNC BUTTON\n-// ========================================================\n function setupSyncButton() {\n   const token = localStorage.getItem(\"token\");\n   if (!token) return;\n \n   const payload = JSON.parse(atob(token.split(\".\")[1]));\n   const role = payload.role.toLowerCase();\n   const btn = document.getElementById(\"syncResidentsBtn\");\n \n-  if (role !== \"admin\") {\n-    btn.style.display = \"none\";\n+  if (!btn || role !== \"admin\") {\n+    if (btn) btn.style.display = \"none\";\n     return;\n   }\n \n   btn.addEventListener(\"click\", async () => {\n     try {\n       const res = await fetch(\"http://localhost:4050/api/residents/sync\", {\n         method: \"POST\",\n-        headers: { Authorization: `Bearer ${token}` }\n+        headers: { Authorization: `Bearer ${token}` },\n       });\n-\n       const result = await res.json();\n       alert(result.message);\n-\n       await loadResidents();\n-\n     } catch (err) {\n       console.error(\"‚ùå Sync failed:\", err);\n       alert(\"Failed to sync residents.\");\n     }\n"
                },
                {
                    "date": 1763969789124,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,20 +1,16 @@\n console.log(\"üèòÔ∏è residents.js loaded\");\n \n-import {\n-  validateNationalID,\n-  validatePhone,\n-  validateEmail,\n-  validateRequired,\n-  showFormError,\n-  clearFormError\n-} from \"./validation.js\";\n+// -------------------- Backend API URL --------------------\n+const API_BASE = \"http://localhost:4050/api\";\n \n+// -------------------- On DOM Load --------------------\n document.addEventListener(\"DOMContentLoaded\", async () => {\n   await loadResidents();\n   setupSyncButton();\n });\n \n+// -------------------- Load Residents --------------------\n async function loadResidents() {\n   const token = localStorage.getItem(\"token\");\n   if (!token) return alert(\"Please log in first.\");\n \n@@ -22,24 +18,26 @@\n     const payload = JSON.parse(atob(token.split(\".\")[1]));\n     const role = payload.role.toLowerCase();\n \n     const API_URL = role === \"admin\"\n-      ? \"http://localhost:4050/api/residents/all\"\n-      : \"http://localhost:4050/api/residents/profile\";\n+      ? `${API_BASE}/residents/all`\n+      : `${API_BASE}/residents/profile`;\n \n-    const response = await fetch(API_URL, {\n+    const res = await fetch(API_URL, {\n       headers: { \"Content-Type\": \"application/json\", Authorization: `Bearer ${token}` },\n     });\n+    if (!res.ok) throw new Error(`HTTP ${res.status}`);\n \n-    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n-    const data = await response.json();\n+    const data = await res.json();\n     populateResidentsTable(role, data);\n+\n   } catch (err) {\n     console.error(\"‚ùå Failed to load residents:\", err);\n     alert(\"Error loading residents data. Check console.\");\n   }\n }\n \n+// -------------------- Populate DataTable --------------------\n function populateResidentsTable(role, data) {\n   const residents = Array.isArray(data) ? data : [data];\n \n   if ($.fn.DataTable.isDataTable(\"#residentsTable\")) {\n@@ -96,8 +94,9 @@\n     }\n   });\n }\n \n+// -------------------- Sync Button for Admin --------------------\n function setupSyncButton() {\n   const token = localStorage.getItem(\"token\");\n   if (!token) return;\n \n@@ -111,14 +110,14 @@\n   }\n \n   btn.addEventListener(\"click\", async () => {\n     try {\n-      const res = await fetch(\"http://localhost:4050/api/residents/sync\", {\n+      const res = await fetch(`${API_BASE}/residents/sync`, {\n         method: \"POST\",\n         headers: { Authorization: `Bearer ${token}` },\n       });\n       const result = await res.json();\n-      alert(result.message);\n+      alert(result.message || \"Residents synced successfully\");\n       await loadResidents();\n     } catch (err) {\n       console.error(\"‚ùå Sync failed:\", err);\n       alert(\"Failed to sync residents.\");\n"
                },
                {
                    "date": 1763975832312,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -123,4 +123,60 @@\n       alert(\"Failed to sync residents.\");\n     }\n   });\n }\n+// --------------------------\n+// Residents Dashboard JS\n+// --------------------------\n+const sidebarButtons = document.querySelectorAll('.sidebarBtn');\n+const mainContent = document.getElementById('dynamic-section-content');\n+\n+sidebarButtons.forEach(btn => {\n+  btn.addEventListener('click', async () => {\n+    const url = btn.dataset.target;\n+    if (!url) return;\n+\n+    // Highlight selected button\n+    sidebarButtons.forEach(b => b.classList.remove('bg-blue-600', 'shadow-inner'));\n+    btn.classList.add('bg-blue-600', 'shadow-inner');\n+\n+    // Load content dynamically\n+    mainContent.innerHTML = '<p>Loading...</p>';\n+    try {\n+      const res = await fetch(url);\n+      const html = await res.text();\n+      mainContent.innerHTML = html;\n+    } catch (err) {\n+      mainContent.innerHTML = `<p class=\"text-red-600\">Failed to load: ${err.message}</p>`;\n+    }\n+  });\n+});\n+\n+// Logout\n+document.getElementById('logoutBtn')?.addEventListener('click', () => {\n+  localStorage.removeItem('accessToken');\n+  window.location.href = '/login.html';\n+});\n+\n+// --------------------------\n+// Placeholder: Populate summary cards (fetch from API)\n+// --------------------------\n+async function loadResidentDashboard() {\n+  try {\n+    // Simulated fetch\n+    const data = {\n+      paymentStatus: 'Paid',\n+      activeVisitorPasses: 3,\n+      lastAccessAttempts: 7,\n+      residentAlerts: 1\n+    };\n+    document.getElementById('paymentStatusCard').textContent = data.paymentStatus;\n+    document.getElementById('activeVisitorPasses').textContent = data.activeVisitorPasses;\n+    document.getElementById('lastAccessAttempts').textContent = data.lastAccessAttempts;\n+    document.getElementById('residentAlerts').textContent = data.residentAlerts;\n+  } catch (err) {\n+    console.error('Error loading dashboard:', err);\n+  }\n+}\n+\n+// Initial load\n+loadResidentDashboard();\n\\ No newline at end of file\n"
                }
            ],
            "date": 1763967067016,
            "name": "Commit-0",
            "content": "console.log(\"üèòÔ∏è residents.js loaded\");\n\n// Import validation utilities\nimport {\n  validateNationalID,\n  validatePhone,\n  validateEmail,\n  validateRequired,\n  showFormError,\n  clearFormError\n} from \"./validation.js\";\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  await loadResidents();\n  setupSyncButton();\n});\n\n// ==========================\n// LOAD RESIDENTS\n// ==========================\nasync function loadResidents() {\n  const token = localStorage.getItem(\"token\"); // JWT token\n  if (!token) return alert(\"Please log in first.\");\n\n  try {\n    const payload = JSON.parse(atob(token.split(\".\")[1]));\n    const role = payload.role.toLowerCase();\n\n    // Choose API endpoint based on role\n    const API_URL = role === \"admin\"\n      ? \"http://localhost:4050/api/residents/all\"\n      : \"http://localhost:4050/api/residents/profile\";\n\n    const response = await fetch(API_URL, {\n      headers: { \n        \"Content-Type\": \"application/json\", \n        Authorization: `Bearer ${token}` \n      },\n    });\n\n    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n    const data = await response.json();\n    populateResidentsTable(role, data);\n  } catch (err) {\n    console.error(\"‚ùå Failed to load residents:\", err);\n    alert(\"Error loading residents data. Check console.\");\n  }\n}\n\n// ==========================\n// POPULATE DATATABLE\n// ==========================\nfunction populateResidentsTable(role, data) {\n  const residents = Array.isArray(data) ? data : [data];\n\n  if ($.fn.DataTable.isDataTable(\"#residentsTable\")) {\n    $(\"#residentsTable\").DataTable().destroy();\n  }\n\n  $(\"#residentsTable\").DataTable({\n    data: residents,\n    columns: [\n      { data: \"ResidentID\" },\n      { data: \"UserID\" },\n      { data: \"ResidentName\" },\n      { data: \"NationalID\" },\n      { data: \"HouseNumber\" },\n      { data: \"CourtName\" },\n      { data: \"PhoneNumber\" },\n      { data: \"Email\" },\n      { data: \"Occupation\" },\n      { data: \"DateJoined\", render: d => d ? new Date(d).toLocaleDateString() : \"-\" },\n      { data: \"Status\", render: s => {\n          const color = s === \"Approved\" ? \"green\" : s === \"Rejected\" ? \"red\" : \"yellow\";\n          return `<span class=\"px-2 py-1 rounded-full bg-${color}-100 text-${color}-800 font-semibold text-xs\">${s}</span>`;\n      }},\n      { data: \"RoleName\" },\n      { data: \"TotalDue\" }\n    ],\n    dom: \"Brtip\",\n    buttons: [\n      \"excelHtml5\",\n      \"pdfHtml5\",\n      \"print\",\n      { text: 'Sort by Name', action: function () { this.api().order([2, 'asc']).draw(); } },\n      { text: 'Sort by Date Joined', action: function () { this.api().order([9, 'desc']).draw(); } }\n    ],\n    responsive: true,\n    pageLength: 10,\n    initComplete: function () {\n      this.api().columns().every(function () {\n        const column = this;\n        $(column.header()).find('input.column-filter').on('keyup change', function () {\n          column.search(this.value).draw();\n        });\n      });\n    }\n  });\n}\n\n// ==========================\n// SYNC BUTTON FOR ADMINS\n// ==========================\nfunction setupSyncButton() {\n  const token = localStorage.getItem(\"token\");\n  if (!token) return;\n\n  const payload = JSON.parse(atob(token.split(\".\")[1]));\n  const role = payload.role.toLowerCase();\n  const btn = document.getElementById(\"syncResidentsBtn\");\n\n  if (role !== \"admin\") {\n    btn.style.display = \"none\";\n    return;\n  }\n\n  btn.addEventListener(\"click\", async () => {\n    try {\n      const res = await fetch(\"http://localhost:4050/api/residents/sync\", {\n        method: \"POST\",\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      const result = await res.json();\n      alert(result.message);\n      await loadResidents();\n    } catch (err) {\n      console.error(\"‚ùå Sync failed:\", err);\n      alert(\"Failed to sync residents.\");\n    }\n  });\n}\n"
        }
    ]
}