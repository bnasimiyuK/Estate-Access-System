{
    "sourceFile": "frontend/js/securitydashboard.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 23,
            "patches": [
                {
                    "date": 1763863320945,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763863530219,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,94 +1,97 @@\n+// ========================\r\n+// GLOBAL SETTINGS\r\n+// ========================\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"token\");\r\n \r\n-// ----------------------------\r\n+// ========================\r\n // TAB SWITCHING\r\n-// ----------------------------\r\n+// ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n   const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n   const tabContents = document.querySelectorAll(\".tabContent\");\r\n \r\n   tabButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", () => {\r\n-      const target = btn.dataset.tab;\r\n-      tabContents.forEach(tc => tc.classList.add(\"hidden\"));\r\n-      document.getElementById(target).classList.remove(\"hidden\");\r\n+      tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n+      document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n     });\r\n   });\r\n \r\n+  // Load default tab content\r\n   loadAccessLogs();\r\n   loadVisitorRequests();\r\n   loadCharts();\r\n });\r\n \r\n-// ----------------------------\r\n-// BACKEND: LOAD ACCESS LOGS\r\n-// ----------------------------\r\n+\r\n+// ========================\r\n+// LOAD ACCESS LOGS (BACKEND)\r\n+// ========================\r\n async function loadAccessLogs() {\r\n   try {\r\n     const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n       headers: { \"Authorization\": `Bearer ${token}` }\r\n     });\r\n \r\n-    if (!response.ok) throw new Error(\"Unable to fetch logs\");\r\n+    if (!response.ok) throw new Error(\"Failed to fetch access logs\");\r\n \r\n     const logs = await response.json();\r\n     renderAccessLogs(logs);\r\n \r\n   } catch (err) {\r\n-    console.error(\"Access Logs Error:\", err);\r\n+    console.error(\"Access Log Error:\", err);\r\n   }\r\n }\r\n \r\n-function renderAccessLogs(list) {\r\n+function renderAccessLogs(logs) {\r\n   const tbody = document.getElementById(\"logsTableBody\");\r\n   tbody.innerHTML = \"\";\r\n \r\n-  list.forEach((log, i) => {\r\n+  logs.forEach((log, index) => {\r\n     const tr = document.createElement(\"tr\");\r\n+\r\n     tr.innerHTML = `\r\n-      <td class=\"p-2 border\">${i + 1}</td>\r\n-      <td class=\"p-2 border\">${log.timestamp}</td>\r\n-      <td class=\"p-2 border\">${log.userId ?? \"â€”\"}</td>\r\n+      <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+      <td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n       <td class=\"p-2 border\">${log.action}</td>\r\n-      <td class=\"p-2 border\">${log.resource}</td>\r\n-      <td class=\"p-2 border\">${log.ipAddress}</td>\r\n-      <td class=\"p-2 border\">${log.userAgent}</td>\r\n       <td class=\"p-2 border\">${log.logType}</td>\r\n     `;\r\n+\r\n     tbody.appendChild(tr);\r\n   });\r\n }\r\n \r\n-// ----------------------------\r\n-// BACKEND: VISITOR REQUESTS\r\n-// ----------------------------\r\n+\r\n+// ========================\r\n+// LOAD VISITOR REQUESTS (BACKEND)\r\n+// ========================\r\n async function loadVisitorRequests() {\r\n   try {\r\n-    const resp = await fetch(`${API_HOST}/api/visitors/pending`, {\r\n+    const response = await fetch(`${API_HOST}/api/visitors/pending`, {\r\n       headers: { \"Authorization\": `Bearer ${token}` }\r\n     });\r\n \r\n-    const reqs = await resp.json();\r\n-    renderVisitorRequests(reqs);\r\n+    const visitors = await response.json();\r\n+    renderVisitorRequests(visitors);\r\n \r\n-  } catch (e) {\r\n-    console.log(\"Visitor Request Error:\", e);\r\n+  } catch (err) {\r\n+    console.error(\"Visitor Requests Error:\", err);\r\n   }\r\n }\r\n \r\n-function renderVisitorRequests(data) {\r\n+function renderVisitorRequests(visitors) {\r\n   const container = document.getElementById(\"visitorRequestList\");\r\n   container.innerHTML = \"\";\r\n \r\n-  data.forEach(req => {\r\n+  visitors.forEach(req => {\r\n     const div = document.createElement(\"div\");\r\n     div.className =\r\n       \"p-2 border rounded flex justify-between items-center bg-white\";\r\n \r\n     div.innerHTML = `\r\n-      <span>${req.visitorName} (ID: ${req.visitorId}) â†’ Resident: ${req.residentId}</span>\r\n+      <span>${req.visitorName} (ID: ${req.visitorId}) â†’ Resident ${req.residentId}</span>\r\n       <div>\r\n         <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n         <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n       </div>\r\n@@ -97,9 +100,9 @@\n     // Approve\r\n     div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n       await fetch(`${API_HOST}/api/visitors/approve/${req.visitorId}`, {\r\n         method: \"POST\",\r\n-        headers: { \"Authorization\": `Bearer ${token}` },\r\n+        headers: { \"Authorization\": `Bearer ${token}` }\r\n       });\r\n \r\n       loadVisitorRequests();\r\n       loadAccessLogs();\r\n@@ -108,9 +111,9 @@\n     // Reject\r\n     div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n       await fetch(`${API_HOST}/api/visitors/reject/${req.visitorId}`, {\r\n         method: \"POST\",\r\n-        headers: { \"Authorization\": `Bearer ${token}` },\r\n+        headers: { \"Authorization\": `Bearer ${token}` }\r\n       });\r\n \r\n       loadVisitorRequests();\r\n       loadAccessLogs();\r\n@@ -119,24 +122,52 @@\n     container.appendChild(div);\r\n   });\r\n }\r\n \r\n-// ----------------------------\r\n+\r\n+// ========================\r\n+// MANUAL GATE CONTROL\r\n+// ========================\r\n+document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n+  const residentId = document.getElementById(\"gateResidentId\").value;\r\n+  const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n+\r\n+  const target = visitorId || residentId;\r\n+\r\n+  document.getElementById(\"gateStatus\").innerText =\r\n+    `Gate manually opened for ${target}`;\r\n+\r\n+  await fetch(`${API_HOST}/api/access/manual-open`, {\r\n+    method: \"POST\",\r\n+    headers: {\r\n+      \"Content-Type\": \"application/json\",\r\n+      \"Authorization\": `Bearer ${token}`\r\n+    },\r\n+    body: JSON.stringify({ residentId, visitorId })\r\n+  });\r\n+\r\n+  loadAccessLogs();\r\n+});\r\n+\r\n+\r\n+// ========================\r\n // CHARTS\r\n-// ----------------------------\r\n+// ========================\r\n function loadCharts() {\r\n-  new Chart(document.getElementById(\"dailyAccessChart\"), {\r\n+  const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n+  new Chart(dailyCtx, {\r\n     type: \"bar\",\r\n     data: {\r\n       labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-      datasets: [{ label: \"Access Attempts\", data: [5, 7, 3, 8, 6, 4, 2] }]\r\n+      datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n     }\r\n   });\r\n \r\n-  new Chart(document.getElementById(\"monthlyAccessChart\"), {\r\n+  const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n+  new Chart(monthlyCtx, {\r\n     type: \"line\",\r\n     data: {\r\n       labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-      datasets: [{ label: \"Access Attempts\", data: [120,130,110,150,160,170,165,140,120,155,160,170] }]\r\n+      datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n     }\r\n   });\r\n }\r\n"
                },
                {
                    "date": 1763866025480,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -170,4 +170,14 @@\n       datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n     }\r\n   });\r\n }\r\n+async function loadAccessLogs() {\r\n+  try {\r\n+    const response = await fetch(\"http://localhost:4050/api/accesslogs\"); // backend URL\r\n+    if (!response.ok) throw new Error(\"Failed to fetch access logs\");\r\n+    const logs = await response.json();\r\n+    console.log(logs);\r\n+  } catch (error) {\r\n+    console.error(\"Access Log Error:\", error);\r\n+  }\r\n+}\r\n"
                },
                {
                    "date": 1763866122604,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -180,4 +180,16 @@\n   } catch (error) {\r\n     console.error(\"Access Log Error:\", error);\r\n   }\r\n }\r\n+async function loadVisitorRequests() {\r\n+  try {\r\n+    const response = await fetch(\"http://localhost:4050/api/visitor/requests\");\r\n+    if (!response.ok) {\r\n+      throw new Error(`HTTP error! Status: ${response.status}`);\r\n+    }\r\n+    const data = await response.json();\r\n+    console.log(data); // should log JSON array\r\n+  } catch (error) {\r\n+    console.error(\"Visitor Requests Error:\", error);\r\n+  }\r\n+}\r\n"
                },
                {
                    "date": 1763868001058,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,8 @@\n   loadVisitorRequests();\r\n   loadCharts();\r\n });\r\n \r\n-\r\n // ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n async function loadAccessLogs() {\r\n@@ -33,10 +32,9 @@\n     const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n       headers: { \"Authorization\": `Bearer ${token}` }\r\n     });\r\n \r\n-    if (!response.ok) throw new Error(\"Failed to fetch access logs\");\r\n-\r\n+    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n     const logs = await response.json();\r\n     renderAccessLogs(logs);\r\n \r\n   } catch (err) {\r\n@@ -47,9 +45,9 @@\n function renderAccessLogs(logs) {\r\n   const tbody = document.getElementById(\"logsTableBody\");\r\n   tbody.innerHTML = \"\";\r\n \r\n-  logs.forEach((log, index) => {\r\n+  logs.forEach(log => {\r\n     const tr = document.createElement(\"tr\");\r\n \r\n     tr.innerHTML = `\r\n       <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n@@ -61,18 +59,21 @@\n     tbody.appendChild(tr);\r\n   });\r\n }\r\n \r\n-\r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n   try {\r\n-    const response = await fetch(`${API_HOST}/api/visitors/pending`, {\r\n-      headers: { \"Authorization\": `Bearer ${token}` }\r\n+    const response = await fetch(`${API_HOST}/api/visitors/requests`, {\r\n+      method: \"GET\",\r\n+      headers: {\r\n+        \"Authorization\": `Bearer ${token}`\r\n+      }\r\n     });\r\n \r\n+    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n     const visitors = await response.json();\r\n     renderVisitorRequests(visitors);\r\n \r\n   } catch (err) {\r\n@@ -85,58 +86,52 @@\n   container.innerHTML = \"\";\r\n \r\n   visitors.forEach(req => {\r\n     const div = document.createElement(\"div\");\r\n-    div.className =\r\n-      \"p-2 border rounded flex justify-between items-center bg-white\";\r\n+    div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n \r\n     div.innerHTML = `\r\n-      <span>${req.visitorName} (ID: ${req.visitorId}) â†’ Resident ${req.residentId}</span>\r\n+      <span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n       <div>\r\n         <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n         <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n       </div>\r\n     `;\r\n \r\n     // Approve\r\n     div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n-      await fetch(`${API_HOST}/api/visitors/approve/${req.visitorId}`, {\r\n-        method: \"POST\",\r\n+      await fetch(`${API_HOST}/api/visitors/${req.VisitorID}/approve`, {\r\n+        method: \"PUT\",\r\n         headers: { \"Authorization\": `Bearer ${token}` }\r\n       });\r\n-\r\n       loadVisitorRequests();\r\n       loadAccessLogs();\r\n     });\r\n \r\n     // Reject\r\n     div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n-      await fetch(`${API_HOST}/api/visitors/reject/${req.visitorId}`, {\r\n-        method: \"POST\",\r\n+      await fetch(`${API_HOST}/api/visitors/${req.VisitorID}/reject`, {\r\n+        method: \"PUT\",\r\n         headers: { \"Authorization\": `Bearer ${token}` }\r\n       });\r\n-\r\n       loadVisitorRequests();\r\n       loadAccessLogs();\r\n     });\r\n \r\n     container.appendChild(div);\r\n   });\r\n }\r\n \r\n-\r\n // ========================\r\n // MANUAL GATE CONTROL\r\n // ========================\r\n document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n   const residentId = document.getElementById(\"gateResidentId\").value;\r\n   const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n \r\n   const target = visitorId || residentId;\r\n+  document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n \r\n-  document.getElementById(\"gateStatus\").innerText =\r\n-    `Gate manually opened for ${target}`;\r\n-\r\n   await fetch(`${API_HOST}/api/access/manual-open`, {\r\n     method: \"POST\",\r\n     headers: {\r\n       \"Content-Type\": \"application/json\",\r\n@@ -147,9 +142,8 @@\n \r\n   loadAccessLogs();\r\n });\r\n \r\n-\r\n // ========================\r\n // CHARTS\r\n // ========================\r\n function loadCharts() {\r\n@@ -170,26 +164,4 @@\n       datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n     }\r\n   });\r\n }\r\n-async function loadAccessLogs() {\r\n-  try {\r\n-    const response = await fetch(\"http://localhost:4050/api/accesslogs\"); // backend URL\r\n-    if (!response.ok) throw new Error(\"Failed to fetch access logs\");\r\n-    const logs = await response.json();\r\n-    console.log(logs);\r\n-  } catch (error) {\r\n-    console.error(\"Access Log Error:\", error);\r\n-  }\r\n-}\r\n-async function loadVisitorRequests() {\r\n-  try {\r\n-    const response = await fetch(\"http://localhost:4050/api/visitor/requests\");\r\n-    if (!response.ok) {\r\n-      throw new Error(`HTTP error! Status: ${response.status}`);\r\n-    }\r\n-    const data = await response.json();\r\n-    console.log(data); // should log JSON array\r\n-  } catch (error) {\r\n-    console.error(\"Visitor Requests Error:\", error);\r\n-  }\r\n-}\r\n"
                },
                {
                    "date": 1763868824019,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,32 +18,32 @@\n     });\r\n   });\r\n \r\n   // Load default tab content\r\n-  loadAccessLogs();\r\n+  loadaccessLogs();\r\n   loadVisitorRequests();\r\n   loadCharts();\r\n });\r\n \r\n // ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n-async function loadAccessLogs() {\r\n+async function loadaccesslogs() {\r\n   try {\r\n     const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n       headers: { \"Authorization\": `Bearer ${token}` }\r\n     });\r\n \r\n     if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n     const logs = await response.json();\r\n-    renderAccessLogs(logs);\r\n+    renderaccesslogs(logs);\r\n \r\n   } catch (err) {\r\n     console.error(\"Access Log Error:\", err);\r\n   }\r\n }\r\n \r\n-function renderAccessLogs(logs) {\r\n+function renderaccesslogs(logs) {\r\n   const tbody = document.getElementById(\"logsTableBody\");\r\n   tbody.innerHTML = \"\";\r\n \r\n   logs.forEach(log => {\r\n@@ -103,9 +103,9 @@\n         method: \"PUT\",\r\n         headers: { \"Authorization\": `Bearer ${token}` }\r\n       });\r\n       loadVisitorRequests();\r\n-      loadAccessLogs();\r\n+      loadaccesslogs();\r\n     });\r\n \r\n     // Reject\r\n     div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n@@ -113,9 +113,9 @@\n         method: \"PUT\",\r\n         headers: { \"Authorization\": `Bearer ${token}` }\r\n       });\r\n       loadVisitorRequests();\r\n-      loadAccessLogs();\r\n+      loadaccessLogs();\r\n     });\r\n \r\n     container.appendChild(div);\r\n   });\r\n@@ -139,9 +139,9 @@\n     },\r\n     body: JSON.stringify({ residentId, visitorId })\r\n   });\r\n \r\n-  loadAccessLogs();\r\n+  loadaccesslogs();\r\n });\r\n \r\n // ========================\r\n // CHARTS\r\n"
                },
                {
                    "date": 1763868914167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n     });\r\n   });\r\n \r\n   // Load default tab content\r\n-  loadaccessLogs();\r\n+  loadaccesslogs();\r\n   loadVisitorRequests();\r\n   loadCharts();\r\n });\r\n \r\n"
                },
                {
                    "date": 1763869152205,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,32 +18,33 @@\n     });\r\n   });\r\n \r\n   // Load default tab content\r\n-  loadaccesslogs();\r\n+  loadAccessLogs();\r\n   loadVisitorRequests();\r\n   loadCharts();\r\n });\r\n \r\n // ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n-async function loadaccesslogs() {\r\n+async function loadAccessLogs() {\r\n   try {\r\n     const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n       headers: { \"Authorization\": `Bearer ${token}` }\r\n     });\r\n \r\n     if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+\r\n     const logs = await response.json();\r\n-    renderaccesslogs(logs);\r\n+    renderAccessLogs(logs);\r\n \r\n   } catch (err) {\r\n     console.error(\"Access Log Error:\", err);\r\n   }\r\n }\r\n \r\n-function renderaccesslogs(logs) {\r\n+function renderAccessLogs(logs) {\r\n   const tbody = document.getElementById(\"logsTableBody\");\r\n   tbody.innerHTML = \"\";\r\n \r\n   logs.forEach(log => {\r\n@@ -65,15 +66,13 @@\n // ========================\r\n async function loadVisitorRequests() {\r\n   try {\r\n     const response = await fetch(`${API_HOST}/api/visitors/requests`, {\r\n-      method: \"GET\",\r\n-      headers: {\r\n-        \"Authorization\": `Bearer ${token}`\r\n-      }\r\n+      headers: { \"Authorization\": `Bearer ${token}` }\r\n     });\r\n \r\n     if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+\r\n     const visitors = await response.json();\r\n     renderVisitorRequests(visitors);\r\n \r\n   } catch (err) {\r\n@@ -98,24 +97,34 @@\n     `;\r\n \r\n     // Approve\r\n     div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n-      await fetch(`${API_HOST}/api/visitors/${req.VisitorID}/approve`, {\r\n-        method: \"PUT\",\r\n-        headers: { \"Authorization\": `Bearer ${token}` }\r\n-      });\r\n-      loadVisitorRequests();\r\n-      loadaccesslogs();\r\n+      try {\r\n+        const res = await fetch(`${API_HOST}/api/visitors/${req.VisitorID}/approve`, {\r\n+          method: \"PUT\",\r\n+          headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n+        loadVisitorRequests();\r\n+        loadAccessLogs();\r\n+      } catch (err) {\r\n+        console.error(\"Approve Error:\", err);\r\n+      }\r\n     });\r\n \r\n     // Reject\r\n     div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n-      await fetch(`${API_HOST}/api/visitors/${req.VisitorID}/reject`, {\r\n-        method: \"PUT\",\r\n-        headers: { \"Authorization\": `Bearer ${token}` }\r\n-      });\r\n-      loadVisitorRequests();\r\n-      loadaccessLogs();\r\n+      try {\r\n+        const res = await fetch(`${API_HOST}/api/visitors/${req.VisitorID}/reject`, {\r\n+          method: \"PUT\",\r\n+          headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n+        loadVisitorRequests();\r\n+        loadAccessLogs();\r\n+      } catch (err) {\r\n+        console.error(\"Reject Error:\", err);\r\n+      }\r\n     });\r\n \r\n     container.appendChild(div);\r\n   });\r\n@@ -130,18 +139,22 @@\n \r\n   const target = visitorId || residentId;\r\n   document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n \r\n-  await fetch(`${API_HOST}/api/access/manual-open`, {\r\n-    method: \"POST\",\r\n-    headers: {\r\n-      \"Content-Type\": \"application/json\",\r\n-      \"Authorization\": `Bearer ${token}`\r\n-    },\r\n-    body: JSON.stringify({ residentId, visitorId })\r\n-  });\r\n-\r\n-  loadaccesslogs();\r\n+  try {\r\n+    const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n+      method: \"POST\",\r\n+      headers: {\r\n+        \"Content-Type\": \"application/json\",\r\n+        \"Authorization\": `Bearer ${token}`\r\n+      },\r\n+      body: JSON.stringify({ residentId, visitorId })\r\n+    });\r\n+    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+    loadAccessLogs();\r\n+  } catch (err) {\r\n+    console.error(\"Manual Gate Error:\", err);\r\n+  }\r\n });\r\n \r\n // ========================\r\n // CHARTS\r\n"
                },
                {
                    "date": 1763869450287,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,174 +7,178 @@\n // ========================\r\n // TAB SWITCHING\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n-  const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n-  const tabContents = document.querySelectorAll(\".tabContent\");\r\n+Â  const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n+Â  const tabContents = document.querySelectorAll(\".tabContent\");\r\n \r\n-  tabButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", () => {\r\n-      tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n-      document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n-    });\r\n-  });\r\n+Â  tabButtons.forEach(btn => {\r\n+Â  Â  btn.addEventListener(\"click\", () => {\r\n+Â  Â  Â  tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n+Â  Â  Â  document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n+Â  Â  });\r\n+Â  });\r\n \r\n-  // Load default tab content\r\n-  loadAccessLogs();\r\n-  loadVisitorRequests();\r\n-  loadCharts();\r\n+Â  // Load default tab content\r\n+Â  loadAccessLogs();\r\n+Â  loadVisitorRequests();\r\n+Â  loadCharts();\r\n });\r\n \r\n // ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n async function loadAccessLogs() {\r\n-  try {\r\n-    const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n-      headers: { \"Authorization\": `Bearer ${token}` }\r\n-    });\r\n+Â  try {\r\n+Â  Â  // NOTE: This path is assumed to be correct now that /routes/accesslogsRoutes.js has been fixed\r\n+Â  Â  const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n+Â  Â  Â  headers: { \"Authorization\": `Bearer ${token}` }\r\n+Â  Â  });\r\n \r\n-    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+Â  Â  if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n-    const logs = await response.json();\r\n-    renderAccessLogs(logs);\r\n+Â  Â  const logs = await response.json();\r\n+Â  Â  renderAccessLogs(logs);\r\n \r\n-  } catch (err) {\r\n-    console.error(\"Access Log Error:\", err);\r\n-  }\r\n+Â  } catch (err) {\r\n+Â  Â  console.error(\"Access Log Error:\", err);\r\n+Â  }\r\n }\r\n \r\n function renderAccessLogs(logs) {\r\n-  const tbody = document.getElementById(\"logsTableBody\");\r\n-  tbody.innerHTML = \"\";\r\n+Â  const tbody = document.getElementById(\"logsTableBody\");\r\n+Â  tbody.innerHTML = \"\";\r\n \r\n-  logs.forEach(log => {\r\n-    const tr = document.createElement(\"tr\");\r\n+Â  logs.forEach(log => {\r\n+Â  Â  const tr = document.createElement(\"tr\");\r\n \r\n-    tr.innerHTML = `\r\n-      <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-      <td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n-      <td class=\"p-2 border\">${log.action}</td>\r\n-      <td class=\"p-2 border\">${log.logType}</td>\r\n-    `;\r\n+Â  Â  tr.innerHTML = `\r\n+Â  Â  Â  <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+Â  Â  Â  <td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n+Â  Â  Â  <td class=\"p-2 border\">${log.action}</td>\r\n+Â  Â  Â  <td class=\"p-2 border\">${log.logType}</td>\r\n+Â  Â  `;\r\n \r\n-    tbody.appendChild(tr);\r\n-  });\r\n+Â  Â  tbody.appendChild(tr);\r\n+Â  });\r\n }\r\n \r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n-  try {\r\n-    const response = await fetch(`${API_HOST}/api/visitors/requests`, {\r\n-      headers: { \"Authorization\": `Bearer ${token}` }\r\n-    });\r\n+Â  try {\r\n+Â  Â  // ðŸŸ¢ FIX 1: Corrected path from /api/visitors/requests to /api/visitorsaccess/requests\r\n+Â  Â  const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n+Â  Â  Â  headers: { \"Authorization\": `Bearer ${token}` }\r\n+Â  Â  });\r\n \r\n-    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+Â  Â  if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n-    const visitors = await response.json();\r\n-    renderVisitorRequests(visitors);\r\n+Â  Â  const visitors = await response.json();\r\n+Â  Â  renderVisitorRequests(visitors);\r\n \r\n-  } catch (err) {\r\n-    console.error(\"Visitor Requests Error:\", err);\r\n-  }\r\n+Â  } catch (err) {\r\n+Â  Â  console.error(\"Visitor Requests Error:\", err);\r\n+Â  }\r\n }\r\n \r\n function renderVisitorRequests(visitors) {\r\n-  const container = document.getElementById(\"visitorRequestList\");\r\n-  container.innerHTML = \"\";\r\n+Â  const container = document.getElementById(\"visitorRequestList\");\r\n+Â  container.innerHTML = \"\";\r\n \r\n-  visitors.forEach(req => {\r\n-    const div = document.createElement(\"div\");\r\n-    div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n+Â  visitors.forEach(req => {\r\n+Â  Â  const div = document.createElement(\"div\");\r\n+Â  Â  div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n \r\n-    div.innerHTML = `\r\n-      <span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n-      <div>\r\n-        <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n-        <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n-      </div>\r\n-    `;\r\n+Â  Â  div.innerHTML = `\r\n+Â  Â  Â  <span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n+Â  Â  Â  <div>\r\n+Â  Â  Â  Â  <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n+Â  Â  Â  Â  <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n+Â  Â  Â  </div>\r\n+Â  Â  `;\r\n \r\n-    // Approve\r\n-    div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n-      try {\r\n-        const res = await fetch(`${API_HOST}/api/visitors/${req.VisitorID}/approve`, {\r\n-          method: \"PUT\",\r\n-          headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n-        loadVisitorRequests();\r\n-        loadAccessLogs();\r\n-      } catch (err) {\r\n-        console.error(\"Approve Error:\", err);\r\n-      }\r\n-    });\r\n+Â  Â  // Approve\r\n+Â  Â  div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n+Â  Â  Â  try {\r\n+Â  Â  Â  Â  // ðŸŸ¢ FIX 2: Corrected path from /api/visitors/ to /api/visitorsaccess/\r\n+Â  Â  Â  Â  const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/approve`, {\r\n+Â  Â  Â  Â  Â  method: \"PUT\",\r\n+Â  Â  Â  Â  Â  headers: { \"Authorization\": `Bearer ${token}` }\r\n+Â  Â  Â  Â  });\r\n+Â  Â  Â  Â  if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n+Â  Â  Â  Â  loadVisitorRequests();\r\n+Â  Â  Â  Â  loadAccessLogs();\r\n+Â  Â  Â  } catch (err) {\r\n+Â  Â  Â  Â  console.error(\"Approve Error:\", err);\r\n+Â  Â  Â  }\r\n+Â  Â  });\r\n \r\n-    // Reject\r\n-    div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n-      try {\r\n-        const res = await fetch(`${API_HOST}/api/visitors/${req.VisitorID}/reject`, {\r\n-          method: \"PUT\",\r\n-          headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n-        loadVisitorRequests();\r\n-        loadAccessLogs();\r\n-      } catch (err) {\r\n-        console.error(\"Reject Error:\", err);\r\n-      }\r\n-    });\r\n+Â  Â  // Reject\r\n+Â  Â  div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n+Â  Â  Â  try {\r\n+Â  Â  Â  Â  // ðŸŸ¢ FIX 3: Corrected path from /api/visitors/ to /api/visitorsaccess/\r\n+Â  Â  Â  Â  const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/reject`, {\r\n+Â  Â  Â  Â  Â  method: \"PUT\",\r\n+Â  Â  Â  Â  Â  headers: { \"Authorization\": `Bearer ${token}` }\r\n+Â  Â  Â  Â  });\r\n+Â  Â  Â  Â  if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n+Â  Â  Â  Â  loadVisitorRequests();\r\n+Â  Â  Â  Â  loadAccessLogs();\r\n+Â  Â  Â  } catch (err) {\r\n+Â  Â  Â  Â  console.error(\"Reject Error:\", err);\r\n+Â  Â  Â  }\r\n+Â  Â  });\r\n \r\n-    container.appendChild(div);\r\n-  });\r\n+Â  Â  container.appendChild(div);\r\n+Â  });\r\n }\r\n \r\n // ========================\r\n // MANUAL GATE CONTROL\r\n // ========================\r\n document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n-  const residentId = document.getElementById(\"gateResidentId\").value;\r\n-  const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n+Â  const residentId = document.getElementById(\"gateResidentId\").value;\r\n+Â  const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n \r\n-  const target = visitorId || residentId;\r\n-  document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n+Â  const target = visitorId || residentId;\r\n+Â  document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n \r\n-  try {\r\n-    const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n-      method: \"POST\",\r\n-      headers: {\r\n-        \"Content-Type\": \"application/json\",\r\n-        \"Authorization\": `Bearer ${token}`\r\n-      },\r\n-      body: JSON.stringify({ residentId, visitorId })\r\n-    });\r\n-    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n-    loadAccessLogs();\r\n-  } catch (err) {\r\n-    console.error(\"Manual Gate Error:\", err);\r\n-  }\r\n+Â  try {\r\n+Â  Â  const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n+Â  Â  Â  method: \"POST\",\r\n+Â  Â  Â  headers: {\r\n+Â  Â  Â  Â  \"Content-Type\": \"application/json\",\r\n+Â  Â  Â  Â  \"Authorization\": `Bearer ${token}`\r\n+Â  Â  Â  },\r\n+Â  Â  Â  body: JSON.stringify({ residentId, visitorId })\r\n+Â  Â  });\r\n+Â  Â  if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+Â  Â  loadAccessLogs();\r\n+Â  } catch (err) {\r\n+Â  Â  console.error(\"Manual Gate Error:\", err);\r\n+Â  }\r\n });\r\n \r\n // ========================\r\n // CHARTS\r\n // ========================\r\n function loadCharts() {\r\n-  const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n-  new Chart(dailyCtx, {\r\n-    type: \"bar\",\r\n-    data: {\r\n-      labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-      datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n-    }\r\n-  });\r\n+Â  const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n+Â  new Chart(dailyCtx, {\r\n+Â  Â  type: \"bar\",\r\n+Â  Â  data: {\r\n+Â  Â  Â  labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n+Â  Â  Â  datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n+Â  Â  }\r\n+Â  });\r\n \r\n-  const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n-  new Chart(monthlyCtx, {\r\n-    type: \"line\",\r\n-    data: {\r\n-      labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-      datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n-    }\r\n-  });\r\n-}\r\n+Â  const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n+Â  new Chart(monthlyCtx, {\r\n+Â  Â  type: \"line\",\r\n+Â  Â  data: {\r\n+Â  Â  Â  labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n+Â  Â  Â  datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n+Â  Â  }\r\n+Â  });\r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763869489857,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,178 +7,178 @@\n // ========================\r\n // TAB SWITCHING\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n-Â  const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n-Â  const tabContents = document.querySelectorAll(\".tabContent\");\r\n+const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n+const tabContents = document.querySelectorAll(\".tabContent\");\r\n \r\n-Â  tabButtons.forEach(btn => {\r\n-Â  Â  btn.addEventListener(\"click\", () => {\r\n-Â  Â  Â  tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n-Â  Â  Â  document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n-Â  Â  });\r\n-Â  });\r\n+tabButtons.forEach(btn => {\r\n+btn.addEventListener(\"click\", () => {\r\n+tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n+document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n+});\r\n+});\r\n \r\n-Â  // Load default tab content\r\n-Â  loadAccessLogs();\r\n-Â  loadVisitorRequests();\r\n-Â  loadCharts();\r\n+// Load default tab content\r\n+loadAccessLogs();\r\n+loadVisitorRequests();\r\n+loadCharts();\r\n });\r\n \r\n // ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n async function loadAccessLogs() {\r\n-Â  try {\r\n-Â  Â  // NOTE: This path is assumed to be correct now that /routes/accesslogsRoutes.js has been fixed\r\n-Â  Â  const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n-Â  Â  Â  headers: { \"Authorization\": `Bearer ${token}` }\r\n-Â  Â  });\r\n+try {\r\n+// NOTE: This path is assumed to be correct now that /routes/accesslogsRoutes.js has been fixed\r\n+const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n+headers: { \"Authorization\": `Bearer ${token}` }\r\n+});\r\n \r\n-Â  Â  if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n-Â  Â  const logs = await response.json();\r\n-Â  Â  renderAccessLogs(logs);\r\n+const logs = await response.json();\r\n+renderAccessLogs(logs);\r\n \r\n-Â  } catch (err) {\r\n-Â  Â  console.error(\"Access Log Error:\", err);\r\n-Â  }\r\n+} catch (err) {\r\n+console.error(\"Access Log Error:\", err);\r\n }\r\n+}\r\n \r\n function renderAccessLogs(logs) {\r\n-Â  const tbody = document.getElementById(\"logsTableBody\");\r\n-Â  tbody.innerHTML = \"\";\r\n+const tbody = document.getElementById(\"logsTableBody\");\r\n+tbody.innerHTML = \"\";\r\n \r\n-Â  logs.forEach(log => {\r\n-Â  Â  const tr = document.createElement(\"tr\");\r\n+logs.forEach(log => {\r\n+const tr = document.createElement(\"tr\");\r\n \r\n-Â  Â  tr.innerHTML = `\r\n-Â  Â  Â  <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-Â  Â  Â  <td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n-Â  Â  Â  <td class=\"p-2 border\">${log.action}</td>\r\n-Â  Â  Â  <td class=\"p-2 border\">${log.logType}</td>\r\n-Â  Â  `;\r\n+tr.innerHTML = `\r\n+<td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+<td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n+<td class=\"p-2 border\">${log.action}</td>\r\n+<td class=\"p-2 border\">${log.logType}</td>\r\n+`;\r\n \r\n-Â  Â  tbody.appendChild(tr);\r\n-Â  });\r\n+tbody.appendChild(tr);\r\n+});\r\n }\r\n \r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n-Â  try {\r\n-Â  Â  // ðŸŸ¢ FIX 1: Corrected path from /api/visitors/requests to /api/visitorsaccess/requests\r\n-Â  Â  const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n-Â  Â  Â  headers: { \"Authorization\": `Bearer ${token}` }\r\n-Â  Â  });\r\n+try {\r\n+// ðŸŸ¢ FIX 1: Corrected path from /api/visitors/requests to /api/visitorsaccess/requests\r\n+const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n+headers: { \"Authorization\": `Bearer ${token}` }\r\n+});\r\n \r\n-Â  Â  if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n-Â  Â  const visitors = await response.json();\r\n-Â  Â  renderVisitorRequests(visitors);\r\n+const visitors = await response.json();\r\n+renderVisitorRequests(visitors);\r\n \r\n-Â  } catch (err) {\r\n-Â  Â  console.error(\"Visitor Requests Error:\", err);\r\n-Â  }\r\n+} catch (err) {\r\n+console.error(\"Visitor Requests Error:\", err);\r\n }\r\n+}\r\n \r\n function renderVisitorRequests(visitors) {\r\n-Â  const container = document.getElementById(\"visitorRequestList\");\r\n-Â  container.innerHTML = \"\";\r\n+const container = document.getElementById(\"visitorRequestList\");\r\n+container.innerHTML = \"\";\r\n \r\n-Â  visitors.forEach(req => {\r\n-Â  Â  const div = document.createElement(\"div\");\r\n-Â  Â  div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n+visitors.forEach(req => {\r\n+const div = document.createElement(\"div\");\r\n+div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n \r\n-Â  Â  div.innerHTML = `\r\n-Â  Â  Â  <span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n-Â  Â  Â  <div>\r\n-Â  Â  Â  Â  <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n-Â  Â  Â  Â  <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n-Â  Â  Â  </div>\r\n-Â  Â  `;\r\n+div.innerHTML = `\r\n+<span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n+<div>\r\n+<button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n+<button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n+</div>\r\n+`;\r\n \r\n-Â  Â  // Approve\r\n-Â  Â  div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n-Â  Â  Â  try {\r\n-Â  Â  Â  Â  // ðŸŸ¢ FIX 2: Corrected path from /api/visitors/ to /api/visitorsaccess/\r\n-Â  Â  Â  Â  const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/approve`, {\r\n-Â  Â  Â  Â  Â  method: \"PUT\",\r\n-Â  Â  Â  Â  Â  headers: { \"Authorization\": `Bearer ${token}` }\r\n-Â  Â  Â  Â  });\r\n-Â  Â  Â  Â  if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n-Â  Â  Â  Â  loadVisitorRequests();\r\n-Â  Â  Â  Â  loadAccessLogs();\r\n-Â  Â  Â  } catch (err) {\r\n-Â  Â  Â  Â  console.error(\"Approve Error:\", err);\r\n-Â  Â  Â  }\r\n-Â  Â  });\r\n+// Approve\r\n+div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n+try {\r\n+// ðŸŸ¢ FIX 2: Corrected path from /api/visitors/ to /api/visitorsaccess/\r\n+const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/approve`, {\r\n+method: \"PUT\",\r\n+headers: { \"Authorization\": `Bearer ${token}` }\r\n+});\r\n+if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n+loadVisitorRequests();\r\n+loadAccessLogs();\r\n+} catch (err) {\r\n+console.error(\"Approve Error:\", err);\r\n+}\r\n+});\r\n \r\n-Â  Â  // Reject\r\n-Â  Â  div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n-Â  Â  Â  try {\r\n-Â  Â  Â  Â  // ðŸŸ¢ FIX 3: Corrected path from /api/visitors/ to /api/visitorsaccess/\r\n-Â  Â  Â  Â  const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/reject`, {\r\n-Â  Â  Â  Â  Â  method: \"PUT\",\r\n-Â  Â  Â  Â  Â  headers: { \"Authorization\": `Bearer ${token}` }\r\n-Â  Â  Â  Â  });\r\n-Â  Â  Â  Â  if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n-Â  Â  Â  Â  loadVisitorRequests();\r\n-Â  Â  Â  Â  loadAccessLogs();\r\n-Â  Â  Â  } catch (err) {\r\n-Â  Â  Â  Â  console.error(\"Reject Error:\", err);\r\n-Â  Â  Â  }\r\n-Â  Â  });\r\n+// Reject\r\n+div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n+try {\r\n+// ðŸŸ¢ FIX 3: Corrected path from /api/visitors/ to /api/visitorsaccess/\r\n+const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/reject`, {\r\n+method: \"PUT\",\r\n+headers: { \"Authorization\": `Bearer ${token}` }\r\n+});\r\n+if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n+loadVisitorRequests();\r\n+loadAccessLogs();\r\n+} catch (err) {\r\n+console.error(\"Reject Error:\", err);\r\n+}\r\n+});\r\n \r\n-Â  Â  container.appendChild(div);\r\n-Â  });\r\n+container.appendChild(div);\r\n+});\r\n }\r\n \r\n // ========================\r\n // MANUAL GATE CONTROL\r\n // ========================\r\n document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n-Â  const residentId = document.getElementById(\"gateResidentId\").value;\r\n-Â  const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n+const residentId = document.getElementById(\"gateResidentId\").value;\r\n+const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n \r\n-Â  const target = visitorId || residentId;\r\n-Â  document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n+const target = visitorId || residentId;\r\n+document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n \r\n-Â  try {\r\n-Â  Â  const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n-Â  Â  Â  method: \"POST\",\r\n-Â  Â  Â  headers: {\r\n-Â  Â  Â  Â  \"Content-Type\": \"application/json\",\r\n-Â  Â  Â  Â  \"Authorization\": `Bearer ${token}`\r\n-Â  Â  Â  },\r\n-Â  Â  Â  body: JSON.stringify({ residentId, visitorId })\r\n-Â  Â  });\r\n-Â  Â  if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n-Â  Â  loadAccessLogs();\r\n-Â  } catch (err) {\r\n-Â  Â  console.error(\"Manual Gate Error:\", err);\r\n-Â  }\r\n+try {\r\n+const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n+method: \"POST\",\r\n+headers: {\r\n+\"Content-Type\": \"application/json\",\r\n+\"Authorization\": `Bearer ${token}`\r\n+},\r\n+body: JSON.stringify({ residentId, visitorId })\r\n });\r\n+if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+loadAccessLogs();\r\n+} catch (err) {\r\n+console.error(\"Manual Gate Error:\", err);\r\n+}\r\n+});\r\n \r\n // ========================\r\n // CHARTS\r\n // ========================\r\n function loadCharts() {\r\n-Â  const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n-Â  new Chart(dailyCtx, {\r\n-Â  Â  type: \"bar\",\r\n-Â  Â  data: {\r\n-Â  Â  Â  labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-Â  Â  Â  datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n-Â  Â  }\r\n-Â  });\r\n+const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n+new Chart(dailyCtx, {\r\n+type: \"bar\",\r\n+data: {\r\n+labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n+datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n+}\r\n+});\r\n \r\n-Â  const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n-Â  new Chart(monthlyCtx, {\r\n-Â  Â  type: \"line\",\r\n-Â  Â  data: {\r\n-Â  Â  Â  labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-Â  Â  Â  datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n-Â  Â  }\r\n-Â  });\r\n+const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n+new Chart(monthlyCtx, {\r\n+type: \"line\",\r\n+data: {\r\n+labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n+datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n+}\r\n+});\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763869747699,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,178 +7,176 @@\n // ========================\r\n // TAB SWITCHING\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n-const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n-const tabContents = document.querySelectorAll(\".tabContent\");\r\n+    const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n+    const tabContents = document.querySelectorAll(\".tabContent\");\r\n \r\n-tabButtons.forEach(btn => {\r\n-btn.addEventListener(\"click\", () => {\r\n-tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n-document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n-});\r\n-});\r\n+    tabButtons.forEach(btn => {\r\n+        btn.addEventListener(\"click\", () => {\r\n+            tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n+            document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n+        });\r\n+    });\r\n \r\n-// Load default tab content\r\n-loadAccessLogs();\r\n-loadVisitorRequests();\r\n-loadCharts();\r\n+    // Load default tab content\r\n+    loadaccesslogs(); // ðŸŸ¢ Updated function call\r\n+    loadVisitorRequests();\r\n+    loadCharts();\r\n });\r\n \r\n // ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n-async function loadAccessLogs() {\r\n-try {\r\n-// NOTE: This path is assumed to be correct now that /routes/accesslogsRoutes.js has been fixed\r\n-const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n-headers: { \"Authorization\": `Bearer ${token}` }\r\n-});\r\n+async function loadaccesslogs() { // ðŸŸ¢ Updated function name\r\n+    try {\r\n+        // Endpoint uses the corrected lowercase base path /api/accesslogs/logs\r\n+        const response = await fetch(`${API_HOST}/api/accesslogs/logs`, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n \r\n-if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n-const logs = await response.json();\r\n-renderAccessLogs(logs);\r\n+        const logs = await response.json();\r\n+        renderaccesslogs(logs); // ðŸŸ¢ Updated function call\r\n \r\n-} catch (err) {\r\n-console.error(\"Access Log Error:\", err);\r\n+    } catch (err) {\r\n+        console.error(\"Access Log Error:\", err);\r\n+    }\r\n }\r\n-}\r\n \r\n-function renderAccessLogs(logs) {\r\n-const tbody = document.getElementById(\"logsTableBody\");\r\n-tbody.innerHTML = \"\";\r\n+function renderaccesslogs(logs) { // ðŸŸ¢ Updated function name\r\n+    const tbody = document.getElementById(\"logsTableBody\");\r\n+    tbody.innerHTML = \"\";\r\n \r\n-logs.forEach(log => {\r\n-const tr = document.createElement(\"tr\");\r\n+    logs.forEach(log => {\r\n+        const tr = document.createElement(\"tr\");\r\n \r\n-tr.innerHTML = `\r\n-<td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-<td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n-<td class=\"p-2 border\">${log.action}</td>\r\n-<td class=\"p-2 border\">${log.logType}</td>\r\n-`;\r\n+        tr.innerHTML = `\r\n+            <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+            <td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n+            <td class=\"p-2 border\">${log.action}</td>\r\n+            <td class=\"p-2 border\">${log.logType}</td>\r\n+        `;\r\n \r\n-tbody.appendChild(tr);\r\n-});\r\n+        tbody.appendChild(tr);\r\n+    });\r\n }\r\n \r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n-try {\r\n-// ðŸŸ¢ FIX 1: Corrected path from /api/visitors/requests to /api/visitorsaccess/requests\r\n-const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n-headers: { \"Authorization\": `Bearer ${token}` }\r\n-});\r\n+    try {\r\n+        // Path corrected in previous step: /api/visitorsaccess/requests\r\n+        const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n \r\n-if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n-const visitors = await response.json();\r\n-renderVisitorRequests(visitors);\r\n+        const visitors = await response.json();\r\n+        renderVisitorRequests(visitors);\r\n \r\n-} catch (err) {\r\n-console.error(\"Visitor Requests Error:\", err);\r\n+    } catch (err) {\r\n+        console.error(\"Visitor Requests Error:\", err);\r\n+    }\r\n }\r\n-}\r\n \r\n function renderVisitorRequests(visitors) {\r\n-const container = document.getElementById(\"visitorRequestList\");\r\n-container.innerHTML = \"\";\r\n+    const container = document.getElementById(\"visitorRequestList\");\r\n+    container.innerHTML = \"\";\r\n \r\n-visitors.forEach(req => {\r\n-const div = document.createElement(\"div\");\r\n-div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n+    visitors.forEach(req => {\r\n+        const div = document.createElement(\"div\");\r\n+        div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n \r\n-div.innerHTML = `\r\n-<span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n-<div>\r\n-<button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n-<button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n-</div>\r\n-`;\r\n+        div.innerHTML = `\r\n+            <span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n+            <div>\r\n+                <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n+                <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n+            </div>\r\n+        `;\r\n \r\n-// Approve\r\n-div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n-try {\r\n-// ðŸŸ¢ FIX 2: Corrected path from /api/visitors/ to /api/visitorsaccess/\r\n-const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/approve`, {\r\n-method: \"PUT\",\r\n-headers: { \"Authorization\": `Bearer ${token}` }\r\n-});\r\n-if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n-loadVisitorRequests();\r\n-loadAccessLogs();\r\n-} catch (err) {\r\n-console.error(\"Approve Error:\", err);\r\n-}\r\n-});\r\n+        // Approve\r\n+        div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n+            try {\r\n+                const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/approve`, {\r\n+                    method: \"PUT\",\r\n+                    headers: { \"Authorization\": `Bearer ${token}` }\r\n+                });\r\n+                if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n+                loadVisitorRequests();\r\n+                loadaccesslogs(); // ðŸŸ¢ Updated function call\r\n+            } catch (err) {\r\n+                console.error(\"Approve Error:\", err);\r\n+            }\r\n+        });\r\n \r\n-// Reject\r\n-div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n-try {\r\n-// ðŸŸ¢ FIX 3: Corrected path from /api/visitors/ to /api/visitorsaccess/\r\n-const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/reject`, {\r\n-method: \"PUT\",\r\n-headers: { \"Authorization\": `Bearer ${token}` }\r\n-});\r\n-if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n-loadVisitorRequests();\r\n-loadAccessLogs();\r\n-} catch (err) {\r\n-console.error(\"Reject Error:\", err);\r\n-}\r\n-});\r\n+        // Reject\r\n+        div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n+            try {\r\n+                const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/reject`, {\r\n+                    method: \"PUT\",\r\n+                    headers: { \"Authorization\": `Bearer ${token}` }\r\n+                });\r\n+                if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n+                loadVisitorRequests();\r\n+                loadaccesslogs(); // ðŸŸ¢ Updated function call\r\n+            } catch (err) {\r\n+                console.error(\"Reject Error:\", err);\r\n+            }\r\n+        });\r\n \r\n-container.appendChild(div);\r\n-});\r\n+        container.appendChild(div);\r\n+    });\r\n }\r\n \r\n // ========================\r\n // MANUAL GATE CONTROL\r\n // ========================\r\n document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n-const residentId = document.getElementById(\"gateResidentId\").value;\r\n-const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n+    const residentId = document.getElementById(\"gateResidentId\").value;\r\n+    const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n \r\n-const target = visitorId || residentId;\r\n-document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n+    const target = visitorId || residentId;\r\n+    document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n \r\n-try {\r\n-const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n-method: \"POST\",\r\n-headers: {\r\n-\"Content-Type\": \"application/json\",\r\n-\"Authorization\": `Bearer ${token}`\r\n-},\r\n-body: JSON.stringify({ residentId, visitorId })\r\n+    try {\r\n+        const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n+            method: \"POST\",\r\n+            headers: {\r\n+                \"Content-Type\": \"application/json\",\r\n+                \"Authorization\": `Bearer ${token}`\r\n+            },\r\n+            body: JSON.stringify({ residentId, visitorId })\r\n+        });\r\n+        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+        loadaccesslogs(); // ðŸŸ¢ Updated function call\r\n+    } catch (err) {\r\n+        console.error(\"Manual Gate Error:\", err);\r\n+    }\r\n });\r\n-if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n-loadAccessLogs();\r\n-} catch (err) {\r\n-console.error(\"Manual Gate Error:\", err);\r\n-}\r\n-});\r\n \r\n // ========================\r\n // CHARTS\r\n // ========================\r\n function loadCharts() {\r\n-const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n-new Chart(dailyCtx, {\r\n-type: \"bar\",\r\n-data: {\r\n-labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n-}\r\n-});\r\n+    const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n+    new Chart(dailyCtx, {\r\n+        type: \"bar\",\r\n+        data: {\r\n+            labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n+            datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n+        }\r\n+    });\r\n \r\n-const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n-new Chart(monthlyCtx, {\r\n-type: \"line\",\r\n-data: {\r\n-labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n-}\r\n-});\r\n+    const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n+    new Chart(monthlyCtx, {\r\n+        type: \"line\",\r\n+        data: {\r\n+            labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n+            datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n+        }\r\n+    });\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763870049859,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,16 +36,16 @@\n \r\n         if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n         const logs = await response.json();\r\n-        renderaccesslogs(logs); // ðŸŸ¢ Updated function call\r\n+        getaccesslogs(logs); // ðŸŸ¢ Updated function call\r\n \r\n     } catch (err) {\r\n         console.error(\"Access Log Error:\", err);\r\n     }\r\n }\r\n \r\n-function renderaccesslogs(logs) { // ðŸŸ¢ Updated function name\r\n+function getaccesslogs(logs) { // ðŸŸ¢ Updated function name\r\n     const tbody = document.getElementById(\"logsTableBody\");\r\n     tbody.innerHTML = \"\";\r\n \r\n     logs.forEach(log => {\r\n"
                },
                {
                    "date": 1763870271587,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,45 +18,46 @@\n         });\r\n     });\r\n \r\n     // Load default tab content\r\n-    loadaccesslogs(); // ðŸŸ¢ Updated function call\r\n+    loadaccesslogs();\r\n     loadVisitorRequests();\r\n     loadCharts();\r\n });\r\n \r\n // ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n-async function loadaccesslogs() { // ðŸŸ¢ Updated function name\r\n+async function loadaccesslogs() {\r\n     try {\r\n-        // Endpoint uses the corrected lowercase base path /api/accesslogs/logs\r\n+        // Fetch data from the corrected endpoint /api/accesslogs/logs\r\n         const response = await fetch(`${API_HOST}/api/accesslogs/logs`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n         const logs = await response.json();\r\n-        getaccesslogs(logs); // ðŸŸ¢ Updated function call\r\n+        renderaccesslogs(logs); // ðŸŸ¢ CORRECTED: Calling the rendering function\r\n \r\n     } catch (err) {\r\n         console.error(\"Access Log Error:\", err);\r\n     }\r\n }\r\n \r\n-function getaccesslogs(logs) { // ðŸŸ¢ Updated function name\r\n+// ðŸŸ¢ CORRECTED: Renaming the function back to renderaccesslogs for clarity.\r\n+function renderaccesslogs(logs) { \r\n     const tbody = document.getElementById(\"logsTableBody\");\r\n     tbody.innerHTML = \"\";\r\n \r\n     logs.forEach(log => {\r\n         const tr = document.createElement(\"tr\");\r\n \r\n         tr.innerHTML = `\r\n-            <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-            <td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n-            <td class=\"p-2 border\">${log.action}</td>\r\n-            <td class=\"p-2 border\">${log.logType}</td>\r\n+            <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n+            <td class=\"p-2 border\">${log.UserId || \"â€”\"}</td>\r\n+            <td class=\"p-2 border\">${log.Action}</td>\r\n+            <td class=\"p-2 border\">${log.LogType}</td>\r\n         `;\r\n \r\n         tbody.appendChild(tr);\r\n     });\r\n@@ -106,9 +107,9 @@\n                     headers: { \"Authorization\": `Bearer ${token}` }\r\n                 });\r\n                 if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n                 loadVisitorRequests();\r\n-                loadaccesslogs(); // ðŸŸ¢ Updated function call\r\n+                loadaccesslogs();\r\n             } catch (err) {\r\n                 console.error(\"Approve Error:\", err);\r\n             }\r\n         });\r\n@@ -121,9 +122,9 @@\n                     headers: { \"Authorization\": `Bearer ${token}` }\r\n                 });\r\n                 if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n                 loadVisitorRequests();\r\n-                loadaccesslogs(); // ðŸŸ¢ Updated function call\r\n+                loadaccesslogs();\r\n             } catch (err) {\r\n                 console.error(\"Reject Error:\", err);\r\n             }\r\n         });\r\n@@ -151,9 +152,9 @@\n             },\r\n             body: JSON.stringify({ residentId, visitorId })\r\n         });\r\n         if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n-        loadaccesslogs(); // ðŸŸ¢ Updated function call\r\n+        loadaccesslogs();\r\n     } catch (err) {\r\n         console.error(\"Manual Gate Error:\", err);\r\n     }\r\n });\r\n"
                },
                {
                    "date": 1763874302660,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,11 @@\n // ========================\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"token\");\r\n \r\n+// Global variable to store the currently rendered logs for export and filtering\r\n+let currentAccessLogs = [];\r\n+\r\n // ========================\r\n // TAB SWITCHING\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n@@ -21,55 +24,220 @@\n     // Load default tab content\r\n     loadaccesslogs();\r\n     loadVisitorRequests();\r\n     loadCharts();\r\n+    \r\n+    // Setup Export Button Listeners (Assuming buttons with these IDs exist in HTML)\r\n+    document.getElementById(\"exportCsvBtn\")?.addEventListener(\"click\", () => exportTableToCSV(currentAccessLogs, 'access_logs'));\r\n+    document.getElementById(\"exportExcelBtn\")?.addEventListener(\"click\", () => exportTableToExcel(currentAccessLogs, 'access_logs'));\r\n });\r\n \r\n // ========================\r\n+// EXPORT FUNCTIONS\r\n+// ========================\r\n+\r\n+/**\r\n+ * Converts a data array to a CSV string and downloads it.\r\n+ * @param {Array<Object>} data The data array to export.\r\n+ * @param {string} filename The desired filename (without extension).\r\n+ */\r\n+function exportTableToCSV(data, filename) {\r\n+    if (data.length === 0) {\r\n+        alert(\"No data to export.\");\r\n+        return;\r\n+    }\r\n+\r\n+    // 1. Get headers (column names) from the first object\r\n+    const headers = Object.keys(data[0]);\r\n+    let csv = headers.join(',') + '\\n';\r\n+\r\n+    // 2. Add rows\r\n+    data.forEach(row => {\r\n+        const values = headers.map(header => {\r\n+            let value = row[header];\r\n+            // Format timestamp for readability\r\n+            if (header === 'timestamp') {\r\n+                value = new Date(value).toLocaleString();\r\n+            }\r\n+            // Handle null/undefined values and escape double quotes\r\n+            return `\"${(value === null || value === undefined ? \"\" : value).toString().replace(/\"/g, '\"\"')}\"`;\r\n+        });\r\n+        csv += values.join(',') + '\\n';\r\n+    });\r\n+\r\n+    // 3. Create a blob and download link\r\n+    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n+    const link = document.createElement(\"a\");\r\n+    if (link.download !== undefined) {\r\n+        const url = URL.createObjectURL(blob);\r\n+        link.setAttribute(\"href\", url);\r\n+        link.setAttribute(\"download\", `${filename}_${new Date().toISOString().slice(0, 10)}.csv`);\r\n+        link.style.visibility = 'hidden';\r\n+        document.body.appendChild(link);\r\n+        link.click();\r\n+        document.body.removeChild(link);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Converts a data array to an HTML table string for Excel download.\r\n+ * Note: This is a common way to simulate Excel export in pure JS.\r\n+ * @param {Array<Object>} data The data array to export.\r\n+ * @param {string} filename The desired filename (without extension).\r\n+ */\r\n+function exportTableToExcel(data, filename) {\r\n+    if (data.length === 0) {\r\n+        alert(\"No data to export.\");\r\n+        return;\r\n+    }\r\n+\r\n+    const headers = Object.keys(data[0]);\r\n+    \r\n+    // Start building the HTML table structure\r\n+    let tableHTML = '<table><thead><tr>';\r\n+\r\n+    // Headers\r\n+    headers.forEach(header => {\r\n+        tableHTML += `<th>${header}</th>`;\r\n+    });\r\n+    tableHTML += '</tr></thead><tbody>';\r\n+\r\n+    // Rows\r\n+    data.forEach(row => {\r\n+        tableHTML += '<tr>';\r\n+        headers.forEach(header => {\r\n+            let value = row[header];\r\n+            if (header === 'timestamp') {\r\n+                value = new Date(value).toLocaleString();\r\n+            }\r\n+            // Clean up and add value\r\n+            tableHTML += `<td>${value === null || value === undefined ? \"\" : value}</td>`;\r\n+        });\r\n+        tableHTML += '</tr>';\r\n+    });\r\n+\r\n+    tableHTML += '</tbody></table>';\r\n+\r\n+    const uri = 'data:application/vnd.ms-excel;base64,';\r\n+    const template = '<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head></head><body>{table}</body></html>';\r\n+    \r\n+    const base64 = s => window.btoa(unescape(encodeURIComponent(s)));\r\n+    const format = (s, c) => s.replace(/{(\\w+)}/g, (m, p) => c[p]);\r\n+    \r\n+    const ctx = { worksheet: filename || 'Worksheet', table: tableHTML };\r\n+\r\n+    const link = document.createElement(\"a\");\r\n+    link.href = uri + base64(format(template, ctx));\r\n+    link.download = `${filename}_${new Date().toISOString().slice(0, 10)}.xls`;\r\n+    document.body.appendChild(link);\r\n+    link.click();\r\n+    document.body.removeChild(link);\r\n+}\r\n+\r\n+\r\n+// ========================\r\n+// FILTERING FUNCTIONS\r\n+// ========================\r\n+\r\n+/**\r\n+ * Sets up event listeners on the filter inputs in the table header.\r\n+ */\r\n+function setupTableFilters() {\r\n+    const filterInputs = document.querySelectorAll(\"#logsTableHeader input.filterInput\");\r\n+    filterInputs.forEach(input => {\r\n+        // Clear previous listeners to prevent duplicates on re-render\r\n+        input.removeEventListener('input', filterTable);\r\n+        input.addEventListener('input', filterTable);\r\n+    });\r\n+}\r\n+\r\n+/**\r\n+ * Filters the rendered table rows based on the current input values in the header.\r\n+ */\r\n+function filterTable() {\r\n+    const table = document.getElementById(\"accessLogsTable\");\r\n+    const tr = table.getElementsByTagName(\"tr\");\r\n+\r\n+    // Get all current filter values\r\n+    const filters = {};\r\n+    const ths = document.querySelectorAll(\"#logsTableHeader th\");\r\n+    ths.forEach((th, index) => {\r\n+        const input = th.querySelector('input.filterInput');\r\n+        if (input && input.value.trim() !== '') {\r\n+            filters[index] = input.value.trim().toLowerCase();\r\n+        }\r\n+    });\r\n+\r\n+    // Loop through all table rows (skipping the header row at index 0 and filter row at index 1)\r\n+    for (let i = 2; i < tr.length; i++) {\r\n+        let displayRow = true;\r\n+        const tds = tr[i].getElementsByTagName(\"td\");\r\n+\r\n+        for (const colIndex in filters) {\r\n+            const cellValue = tds[colIndex]?.textContent || tds[colIndex]?.innerText || '';\r\n+            \r\n+            // Check if the cell value contains the filter text\r\n+            if (!cellValue.toLowerCase().includes(filters[colIndex])) {\r\n+                displayRow = false;\r\n+                break; // No need to check other filters for this row\r\n+            }\r\n+        }\r\n+\r\n+        // Show or hide the row\r\n+        tr[i].style.display = displayRow ? \"\" : \"none\";\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n async function loadaccesslogs() {\r\n     try {\r\n-        // Fetch data from the corrected endpoint /api/accesslogs/logs\r\n         const response = await fetch(`${API_HOST}/api/accesslogs/logs`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n         const logs = await response.json();\r\n-        renderaccesslogs(logs); // ðŸŸ¢ CORRECTED: Calling the rendering function\r\n+        // Store the raw data for export\r\n+        currentAccessLogs = logs; \r\n+        renderaccesslogs(logs);\r\n \r\n     } catch (err) {\r\n         console.error(\"Access Log Error:\", err);\r\n     }\r\n }\r\n \r\n-// ðŸŸ¢ CORRECTED: Renaming the function back to renderaccesslogs for clarity.\r\n-function renderaccesslogs(logs) { \r\n+function renderaccesslogs(logs) {\r\n     const tbody = document.getElementById(\"logsTableBody\");\r\n     tbody.innerHTML = \"\";\r\n \r\n     logs.forEach(log => {\r\n         const tr = document.createElement(\"tr\");\r\n \r\n+        // The structure must match the filtering logic's expected column index:\r\n+        // 0: timestamp, 1: userId, 2: action, 3: logType\r\n         tr.innerHTML = `\r\n-            <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n-            <td class=\"p-2 border\">${log.UserId || \"â€”\"}</td>\r\n-            <td class=\"p-2 border\">${log.Action}</td>\r\n-            <td class=\"p-2 border\">${log.LogType}</td>\r\n+            <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+            <td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n+            <td class=\"p-2 border\">${log.action}</td>\r\n+            <td class=\"p-2 border\">${log.logType}</td>\r\n         `;\r\n \r\n         tbody.appendChild(tr);\r\n     });\r\n+    \r\n+    // IMPORTANT: Set up the filters after the table has been rendered\r\n+    setupTableFilters(); \r\n }\r\n \r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n     try {\r\n-        // Path corrected in previous step: /api/visitorsaccess/requests\r\n         const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n@@ -135,9 +303,9 @@\n \r\n // ========================\r\n // MANUAL GATE CONTROL\r\n // ========================\r\n-document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n+document.getElementById(\"openGateBtn\")?.addEventListener(\"click\", async () => {\r\n     const residentId = document.getElementById(\"gateResidentId\").value;\r\n     const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n \r\n     const target = visitorId || residentId;\r\n@@ -162,22 +330,26 @@\n // ========================\r\n // CHARTS\r\n // ========================\r\n function loadCharts() {\r\n-    const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n-    new Chart(dailyCtx, {\r\n-        type: \"bar\",\r\n-        data: {\r\n-            labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-            datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n-        }\r\n-    });\r\n+    const dailyCtx = document.getElementById(\"dailyAccessChart\")?.getContext(\"2d\");\r\n+    if (dailyCtx) {\r\n+        new Chart(dailyCtx, {\r\n+            type: \"bar\",\r\n+            data: {\r\n+                labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n+                datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n+            }\r\n+        });\r\n+    }\r\n \r\n-    const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n-    new Chart(monthlyCtx, {\r\n-        type: \"line\",\r\n-        data: {\r\n-            labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-            datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n-        }\r\n-    });\r\n+    const monthlyCtx = document.getElementById(\"monthlyAccessChart\")?.getContext(\"2d\");\r\n+    if (monthlyCtx) {\r\n+        new Chart(monthlyCtx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n+                datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n+            }\r\n+        });\r\n+    }\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763874462493,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,11 +3,8 @@\n // ========================\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"token\");\r\n \r\n-// Global variable to store the currently rendered logs for export and filtering\r\n-let currentAccessLogs = [];\r\n-\r\n // ========================\r\n // TAB SWITCHING\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n@@ -24,220 +21,55 @@\n     // Load default tab content\r\n     loadaccesslogs();\r\n     loadVisitorRequests();\r\n     loadCharts();\r\n-    \r\n-    // Setup Export Button Listeners (Assuming buttons with these IDs exist in HTML)\r\n-    document.getElementById(\"exportCsvBtn\")?.addEventListener(\"click\", () => exportTableToCSV(currentAccessLogs, 'access_logs'));\r\n-    document.getElementById(\"exportExcelBtn\")?.addEventListener(\"click\", () => exportTableToExcel(currentAccessLogs, 'access_logs'));\r\n });\r\n \r\n // ========================\r\n-// EXPORT FUNCTIONS\r\n-// ========================\r\n-\r\n-/**\r\n- * Converts a data array to a CSV string and downloads it.\r\n- * @param {Array<Object>} data The data array to export.\r\n- * @param {string} filename The desired filename (without extension).\r\n- */\r\n-function exportTableToCSV(data, filename) {\r\n-    if (data.length === 0) {\r\n-        alert(\"No data to export.\");\r\n-        return;\r\n-    }\r\n-\r\n-    // 1. Get headers (column names) from the first object\r\n-    const headers = Object.keys(data[0]);\r\n-    let csv = headers.join(',') + '\\n';\r\n-\r\n-    // 2. Add rows\r\n-    data.forEach(row => {\r\n-        const values = headers.map(header => {\r\n-            let value = row[header];\r\n-            // Format timestamp for readability\r\n-            if (header === 'timestamp') {\r\n-                value = new Date(value).toLocaleString();\r\n-            }\r\n-            // Handle null/undefined values and escape double quotes\r\n-            return `\"${(value === null || value === undefined ? \"\" : value).toString().replace(/\"/g, '\"\"')}\"`;\r\n-        });\r\n-        csv += values.join(',') + '\\n';\r\n-    });\r\n-\r\n-    // 3. Create a blob and download link\r\n-    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n-    const link = document.createElement(\"a\");\r\n-    if (link.download !== undefined) {\r\n-        const url = URL.createObjectURL(blob);\r\n-        link.setAttribute(\"href\", url);\r\n-        link.setAttribute(\"download\", `${filename}_${new Date().toISOString().slice(0, 10)}.csv`);\r\n-        link.style.visibility = 'hidden';\r\n-        document.body.appendChild(link);\r\n-        link.click();\r\n-        document.body.removeChild(link);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Converts a data array to an HTML table string for Excel download.\r\n- * Note: This is a common way to simulate Excel export in pure JS.\r\n- * @param {Array<Object>} data The data array to export.\r\n- * @param {string} filename The desired filename (without extension).\r\n- */\r\n-function exportTableToExcel(data, filename) {\r\n-    if (data.length === 0) {\r\n-        alert(\"No data to export.\");\r\n-        return;\r\n-    }\r\n-\r\n-    const headers = Object.keys(data[0]);\r\n-    \r\n-    // Start building the HTML table structure\r\n-    let tableHTML = '<table><thead><tr>';\r\n-\r\n-    // Headers\r\n-    headers.forEach(header => {\r\n-        tableHTML += `<th>${header}</th>`;\r\n-    });\r\n-    tableHTML += '</tr></thead><tbody>';\r\n-\r\n-    // Rows\r\n-    data.forEach(row => {\r\n-        tableHTML += '<tr>';\r\n-        headers.forEach(header => {\r\n-            let value = row[header];\r\n-            if (header === 'timestamp') {\r\n-                value = new Date(value).toLocaleString();\r\n-            }\r\n-            // Clean up and add value\r\n-            tableHTML += `<td>${value === null || value === undefined ? \"\" : value}</td>`;\r\n-        });\r\n-        tableHTML += '</tr>';\r\n-    });\r\n-\r\n-    tableHTML += '</tbody></table>';\r\n-\r\n-    const uri = 'data:application/vnd.ms-excel;base64,';\r\n-    const template = '<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head></head><body>{table}</body></html>';\r\n-    \r\n-    const base64 = s => window.btoa(unescape(encodeURIComponent(s)));\r\n-    const format = (s, c) => s.replace(/{(\\w+)}/g, (m, p) => c[p]);\r\n-    \r\n-    const ctx = { worksheet: filename || 'Worksheet', table: tableHTML };\r\n-\r\n-    const link = document.createElement(\"a\");\r\n-    link.href = uri + base64(format(template, ctx));\r\n-    link.download = `${filename}_${new Date().toISOString().slice(0, 10)}.xls`;\r\n-    document.body.appendChild(link);\r\n-    link.click();\r\n-    document.body.removeChild(link);\r\n-}\r\n-\r\n-\r\n-// ========================\r\n-// FILTERING FUNCTIONS\r\n-// ========================\r\n-\r\n-/**\r\n- * Sets up event listeners on the filter inputs in the table header.\r\n- */\r\n-function setupTableFilters() {\r\n-    const filterInputs = document.querySelectorAll(\"#logsTableHeader input.filterInput\");\r\n-    filterInputs.forEach(input => {\r\n-        // Clear previous listeners to prevent duplicates on re-render\r\n-        input.removeEventListener('input', filterTable);\r\n-        input.addEventListener('input', filterTable);\r\n-    });\r\n-}\r\n-\r\n-/**\r\n- * Filters the rendered table rows based on the current input values in the header.\r\n- */\r\n-function filterTable() {\r\n-    const table = document.getElementById(\"accessLogsTable\");\r\n-    const tr = table.getElementsByTagName(\"tr\");\r\n-\r\n-    // Get all current filter values\r\n-    const filters = {};\r\n-    const ths = document.querySelectorAll(\"#logsTableHeader th\");\r\n-    ths.forEach((th, index) => {\r\n-        const input = th.querySelector('input.filterInput');\r\n-        if (input && input.value.trim() !== '') {\r\n-            filters[index] = input.value.trim().toLowerCase();\r\n-        }\r\n-    });\r\n-\r\n-    // Loop through all table rows (skipping the header row at index 0 and filter row at index 1)\r\n-    for (let i = 2; i < tr.length; i++) {\r\n-        let displayRow = true;\r\n-        const tds = tr[i].getElementsByTagName(\"td\");\r\n-\r\n-        for (const colIndex in filters) {\r\n-            const cellValue = tds[colIndex]?.textContent || tds[colIndex]?.innerText || '';\r\n-            \r\n-            // Check if the cell value contains the filter text\r\n-            if (!cellValue.toLowerCase().includes(filters[colIndex])) {\r\n-                displayRow = false;\r\n-                break; // No need to check other filters for this row\r\n-            }\r\n-        }\r\n-\r\n-        // Show or hide the row\r\n-        tr[i].style.display = displayRow ? \"\" : \"none\";\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n async function loadaccesslogs() {\r\n     try {\r\n+        // Fetch data from the corrected endpoint /api/accesslogs/logs\r\n         const response = await fetch(`${API_HOST}/api/accesslogs/logs`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n         const logs = await response.json();\r\n-        // Store the raw data for export\r\n-        currentAccessLogs = logs; \r\n-        renderaccesslogs(logs);\r\n+        renderaccesslogs(logs); // ðŸŸ¢ CORRECTED: Calling the rendering function\r\n \r\n     } catch (err) {\r\n         console.error(\"Access Log Error:\", err);\r\n     }\r\n }\r\n \r\n-function renderaccesslogs(logs) {\r\n+// ðŸŸ¢ CORRECTED: Renaming the function back to renderaccesslogs for clarity.\r\n+function renderaccesslogs(logs) { \r\n     const tbody = document.getElementById(\"logsTableBody\");\r\n     tbody.innerHTML = \"\";\r\n \r\n     logs.forEach(log => {\r\n         const tr = document.createElement(\"tr\");\r\n \r\n-        // The structure must match the filtering logic's expected column index:\r\n-        // 0: timestamp, 1: userId, 2: action, 3: logType\r\n         tr.innerHTML = `\r\n-            <td class=\"p-2 border\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-            <td class=\"p-2 border\">${log.userId || \"â€”\"}</td>\r\n-            <td class=\"p-2 border\">${log.action}</td>\r\n-            <td class=\"p-2 border\">${log.logType}</td>\r\n+            <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n+            <td class=\"p-2 border\">${log.UserId || \"â€”\"}</td>\r\n+            <td class=\"p-2 border\">${log.Action}</td>\r\n+            <td class=\"p-2 border\">${log.LogType}</td>\r\n         `;\r\n \r\n         tbody.appendChild(tr);\r\n     });\r\n-    \r\n-    // IMPORTANT: Set up the filters after the table has been rendered\r\n-    setupTableFilters(); \r\n }\r\n \r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n     try {\r\n+        // Path corrected in previous step: /api/visitorsaccess/requests\r\n         const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n@@ -303,9 +135,9 @@\n \r\n // ========================\r\n // MANUAL GATE CONTROL\r\n // ========================\r\n-document.getElementById(\"openGateBtn\")?.addEventListener(\"click\", async () => {\r\n+document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n     const residentId = document.getElementById(\"gateResidentId\").value;\r\n     const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n \r\n     const target = visitorId || residentId;\r\n@@ -330,26 +162,22 @@\n // ========================\r\n // CHARTS\r\n // ========================\r\n function loadCharts() {\r\n-    const dailyCtx = document.getElementById(\"dailyAccessChart\")?.getContext(\"2d\");\r\n-    if (dailyCtx) {\r\n-        new Chart(dailyCtx, {\r\n-            type: \"bar\",\r\n-            data: {\r\n-                labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-                datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n-            }\r\n-        });\r\n-    }\r\n+    const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n+    new Chart(dailyCtx, {\r\n+        type: \"bar\",\r\n+        data: {\r\n+            labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n+            datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n+        }\r\n+    });\r\n \r\n-    const monthlyCtx = document.getElementById(\"monthlyAccessChart\")?.getContext(\"2d\");\r\n-    if (monthlyCtx) {\r\n-        new Chart(monthlyCtx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-                datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n-            }\r\n-        });\r\n-    }\r\n+    const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n+    new Chart(monthlyCtx, {\r\n+        type: \"line\",\r\n+        data: {\r\n+            labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n+            datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n+        }\r\n+    });\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763874589899,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,11 @@\n // ========================\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"token\");\r\n \r\n+// Global variable to store the currently rendered logs for export and filtering\r\n+let currentAccessLogs = [];\r\n+\r\n // ========================\r\n // TAB SWITCHING\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n@@ -12,64 +15,290 @@\n     const tabContents = document.querySelectorAll(\".tabContent\");\r\n \r\n     tabButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", () => {\r\n+            // Hide all tab contents\r\n             tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n+            // Show the selected tab content\r\n             document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n+\r\n+            // Special logic for Access Logs to ensure filtering is set up correctly\r\n+            if (btn.dataset.tab === 'accessLogs' && currentAccessLogs.length > 0) {\r\n+                // If data is already loaded, ensure filters are active\r\n+                setupTableFilters();\r\n+            }\r\n         });\r\n     });\r\n \r\n-    // Load default tab content\r\n+    // Initialize default tab content (Access Logs)\r\n     loadaccesslogs();\r\n     loadVisitorRequests();\r\n     loadCharts();\r\n+    \r\n+    // Setup Export Button Listeners (using optional chaining for resilience)\r\n+    document.getElementById(\"exportCsvBtn\")?.addEventListener(\"click\", () => exportTableToCSV(currentAccessLogs, 'access_logs'));\r\n+    document.getElementById(\"exportExcelBtn\")?.addEventListener(\"click\", () => exportTableToExcel(currentAccessLogs, 'access_logs'));\r\n });\r\n \r\n // ========================\r\n+// EXPORT FUNCTIONS\r\n+// ========================\r\n+\r\n+/**\r\n+ * Converts a data array to a CSV string and triggers download.\r\n+ * @param {Array<Object>} data The data array to export.\r\n+ * @param {string} filename The desired filename (without extension).\r\n+ */\r\n+function exportTableToCSV(data, filename) {\r\n+    if (data.length === 0) {\r\n+        // Use a message box instead of alert()\r\n+        console.warn(\"Export attempted with no data.\");\r\n+        // In a real app, you would show a custom modal/notification here.\r\n+        return;\r\n+    }\r\n+\r\n+    // Define the headers based on the rendered columns\r\n+    const headers = [\"timestamp\", \"userId\", \"action\", \"logType\"]; \r\n+    let csv = headers.map(h => {\r\n+        // Simple human-readable header mapping for export file\r\n+        if (h === 'userId') return 'User/Visitor ID';\r\n+        if (h === 'logType') return 'Log Type';\r\n+        return h.charAt(0).toUpperCase() + h.slice(1);\r\n+    }).join(',') + '\\n';\r\n+\r\n+    // Add rows\r\n+    data.forEach(row => {\r\n+        const values = headers.map(header => {\r\n+            let value = row[header];\r\n+            // Format timestamp for readability\r\n+            if (header === 'timestamp') {\r\n+                // Ensure the value can be converted to a date before formatting\r\n+                value = value ? new Date(value).toLocaleString() : 'N/A';\r\n+            }\r\n+            // Handle null/undefined values and escape double quotes\r\n+            return `\"${(value === null || value === undefined ? \"\" : value).toString().replace(/\"/g, '\"\"')}\"`;\r\n+        });\r\n+        csv += values.join(',') + '\\n';\r\n+    });\r\n+\r\n+    // Create a blob and trigger download\r\n+    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n+    const link = document.createElement(\"a\");\r\n+    if (link.download !== undefined) {\r\n+        const url = URL.createObjectURL(blob);\r\n+        link.setAttribute(\"href\", url);\r\n+        link.setAttribute(\"download\", `${filename}_${new Date().toISOString().slice(0, 10)}.csv`);\r\n+        link.style.visibility = 'hidden';\r\n+        document.body.appendChild(link);\r\n+        link.click();\r\n+        document.body.removeChild(link);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Converts a data array to an HTML table string for Excel (XLS) download simulation.\r\n+ * @param {Array<Object>} data The data array to export.\r\n+ * @param {string} filename The desired filename (without extension).\r\n+ */\r\n+function exportTableToExcel(data, filename) {\r\n+    if (data.length === 0) {\r\n+        console.warn(\"Export attempted with no data.\");\r\n+        return;\r\n+    }\r\n+\r\n+    // Define the keys to export and their display names\r\n+    const exportKeys = [\"timestamp\", \"userId\", \"action\", \"logType\"];\r\n+    const displayHeaders = [\"Timestamp\", \"User/Visitor ID\", \"Action\", \"Log Type\"];\r\n+    \r\n+    // Start building the HTML table structure\r\n+    let tableHTML = '<table><thead><tr>';\r\n+\r\n+    // Headers\r\n+    displayHeaders.forEach(header => {\r\n+        tableHTML += `<th>${header}</th>`;\r\n+    });\r\n+    tableHTML += '</tr></thead><tbody>';\r\n+\r\n+    // Rows\r\n+    data.forEach(row => {\r\n+        tableHTML += '<tr>';\r\n+        exportKeys.forEach(key => {\r\n+            let value = row[key];\r\n+            if (key === 'timestamp') {\r\n+                value = value ? new Date(value).toLocaleString() : 'N/A';\r\n+            }\r\n+            // Clean up and add value\r\n+            tableHTML += `<td>${value === null || value === undefined ? \"\" : value}</td>`;\r\n+        });\r\n+        tableHTML += '</tr>';\r\n+    });\r\n+\r\n+    tableHTML += '</tbody></table>';\r\n+\r\n+    // Boilerplate for Excel download using base64 encoding of HTML\r\n+    const uri = 'data:application/vnd.ms-excel;base64,';\r\n+    const template = '<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body>{table}</body></html>';\r\n+    \r\n+    const base64 = s => window.btoa(unescape(encodeURIComponent(s)));\r\n+    const format = (s, c) => s.replace(/{(\\w+)}/g, (m, p) => c[p]);\r\n+    \r\n+    const ctx = { worksheet: filename || 'Worksheet', table: tableHTML };\r\n+\r\n+    const link = document.createElement(\"a\");\r\n+    link.href = uri + base64(format(template, ctx));\r\n+    link.download = `${filename}_${new Date().toISOString().slice(0, 10)}.xls`;\r\n+    document.body.appendChild(link);\r\n+    link.click();\r\n+    document.body.removeChild(link);\r\n+}\r\n+\r\n+\r\n+// ========================\r\n+// FILTERING FUNCTIONS\r\n+// ========================\r\n+\r\n+/**\r\n+ * Sets up event listeners on the filter inputs in the table header.\r\n+ */\r\n+function setupTableFilters() {\r\n+    // Select inputs that are direct children of th elements under #logsTableHeader\r\n+    const filterInputs = document.querySelectorAll(\"#accessLogsTable thead tr:nth-child(2) input.filterInput\");\r\n+    \r\n+    // Clear the table display of any previous filters when setting up new listeners\r\n+    const tbody = document.getElementById(\"logsTableBody\");\r\n+    if (tbody) {\r\n+        tbody.querySelectorAll('tr').forEach(row => row.style.display = \"\");\r\n+    }\r\n+\r\n+    filterInputs.forEach(input => {\r\n+        // Clear previous listeners to prevent duplicates on re-render\r\n+        input.removeEventListener('input', filterTable);\r\n+        input.addEventListener('input', filterTable);\r\n+    });\r\n+}\r\n+\r\n+/**\r\n+ * Filters the rendered table rows based on the current input values in the header.\r\n+ */\r\n+function filterTable() {\r\n+    const table = document.getElementById(\"accessLogsTable\");\r\n+    // Get all rows in the table body\r\n+    const tr = table.querySelector(\"#logsTableBody\").getElementsByTagName(\"tr\");\r\n+\r\n+    // Get all current filter values (from the second <tr> in the <thead>)\r\n+    const filterRow = table.querySelector(\"thead tr:nth-child(2)\");\r\n+    if (!filterRow) return;\r\n+\r\n+    const filterInputs = filterRow.querySelectorAll('input.filterInput');\r\n+    \r\n+    const filters = {};\r\n+    filterInputs.forEach((input, index) => {\r\n+        if (input.value.trim() !== '') {\r\n+            // Store filter value by column index\r\n+            filters[index] = input.value.trim().toLowerCase();\r\n+        }\r\n+    });\r\n+\r\n+    // Loop through all table rows in the tbody\r\n+    for (let i = 0; i < tr.length; i++) {\r\n+        let displayRow = true;\r\n+        const tds = tr[i].getElementsByTagName(\"td\");\r\n+\r\n+        for (const colIndexStr in filters) {\r\n+            const colIndex = parseInt(colIndexStr);\r\n+            if (tds[colIndex]) {\r\n+                const cellValue = tds[colIndex].textContent || tds[colIndex].innerText || '';\r\n+                \r\n+                // Check if the cell value contains the filter text\r\n+                if (!cellValue.toLowerCase().includes(filters[colIndex])) {\r\n+                    displayRow = false;\r\n+                    break; // No need to check other filters for this row\r\n+                }\r\n+            }\r\n+        }\r\n+\r\n+        // Show or hide the row\r\n+        tr[i].style.display = displayRow ? \"\" : \"none\";\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n async function loadaccesslogs() {\r\n     try {\r\n-        // Fetch data from the corrected endpoint /api/accesslogs/logs\r\n         const response = await fetch(`${API_HOST}/api/accesslogs/logs`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n-        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+        if (!response.ok) {\r\n+            const errorBody = await response.text();\r\n+            console.error(`API Error: Status ${response.status}`, errorBody);\r\n+            throw new Error(`Failed to fetch access logs. Status: ${response.status}`);\r\n+        }\r\n \r\n         const logs = await response.json();\r\n-        renderaccesslogs(logs); // ðŸŸ¢ CORRECTED: Calling the rendering function\r\n+        \r\n+        if (!Array.isArray(logs)) {\r\n+             console.error(\"Invalid data format: API response is not an array.\", logs);\r\n+             throw new Error(\"Invalid data format received from API.\");\r\n+        }\r\n \r\n+        // Store the raw data for export\r\n+        currentAccessLogs = logs; \r\n+        renderaccesslogs(logs);\r\n+\r\n     } catch (err) {\r\n-        console.error(\"Access Log Error:\", err);\r\n+        console.error(\"Access Log Load Error:\", err.message);\r\n+        const tbody = document.getElementById(\"logsTableBody\");\r\n+        if (tbody) {\r\n+            tbody.innerHTML = `<tr><td colspan=\"4\" class=\"p-4 text-center text-red-600 font-semibold\">Error loading logs: ${err.message}</td></tr>`;\r\n+        }\r\n     }\r\n }\r\n \r\n-// ðŸŸ¢ CORRECTED: Renaming the function back to renderaccesslogs for clarity.\r\n-function renderaccesslogs(logs) { \r\n+function renderaccesslogs(logs) {\r\n     const tbody = document.getElementById(\"logsTableBody\");\r\n+    if (!tbody) return;\r\n     tbody.innerHTML = \"\";\r\n \r\n-    logs.forEach(log => {\r\n+    logs.forEach((log, index) => {\r\n+        // Crucial data validation: check if required fields exist\r\n+        if (!log || !log.timestamp || !log.action || !log.logType) {\r\n+            console.warn(`Skipping invalid log entry at index ${index}. Missing required fields.`, log);\r\n+            return; // Skip this log entry\r\n+        }\r\n+\r\n         const tr = document.createElement(\"tr\");\r\n+        tr.className = 'hover:bg-gray-50 transition duration-100';\r\n \r\n+        const timestampValue = log.timestamp ? new Date(log.timestamp).toLocaleString() : 'N/A';\r\n+        \r\n+        // Column Index order: 0: timestamp, 1: userId, 2: action, 3: logType\r\n         tr.innerHTML = `\r\n-            <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n-            <td class=\"p-2 border\">${log.UserId || \"â€”\"}</td>\r\n-            <td class=\"p-2 border\">${log.Action}</td>\r\n-            <td class=\"p-2 border\">${log.LogType}</td>\r\n+            <td class=\"p-3 border-r border-b text-sm\">${timestampValue}</td>\r\n+            <td class=\"p-3 border-r border-b text-sm\">${log.userId || \"â€”\"}</td>\r\n+            <td class=\"p-3 border-r border-b text-sm\">${log.action}</td>\r\n+            <td class=\"p-3 border-b text-sm\">${log.logType}</td>\r\n         `;\r\n \r\n         tbody.appendChild(tr);\r\n     });\r\n+    \r\n+    if (logs.length === 0) {\r\n+        tbody.innerHTML = `<tr><td colspan=\"4\" class=\"p-4 text-center text-gray-500\">No access logs found.</td></tr>`;\r\n+    }\r\n+\r\n+    // IMPORTANT: Set up the filters after the table has been rendered\r\n+    setupTableFilters(); \r\n }\r\n \r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n     try {\r\n-        // Path corrected in previous step: /api/visitorsaccess/requests\r\n         const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n@@ -84,19 +313,25 @@\n }\r\n \r\n function renderVisitorRequests(visitors) {\r\n     const container = document.getElementById(\"visitorRequestList\");\r\n+    if (!container) return;\r\n     container.innerHTML = \"\";\r\n \r\n+    if (visitors.length === 0) {\r\n+        container.innerHTML = `<p class=\"text-gray-500 p-4 border rounded-lg bg-white\">No pending visitor approval requests.</p>`;\r\n+        return;\r\n+    }\r\n+\r\n     visitors.forEach(req => {\r\n         const div = document.createElement(\"div\");\r\n-        div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n+        div.className = \"p-3 border rounded-lg flex justify-between items-center bg-white shadow-md\";\r\n \r\n         div.innerHTML = `\r\n-            <span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n+            <span class=\"text-gray-700\">${req.VisitorName} (ID: <span class=\"font-mono text-sm text-green-700\">${req.VisitorID}</span>) â†’ Resident <span class=\"font-mono text-sm text-blue-700\">${req.ResidentID}</span></span>\r\n             <div>\r\n-                <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n-                <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n+                <button class=\"approveBtn bg-green-600 text-white px-3 py-1 rounded-full hover:bg-green-700 transition duration-150 ease-in-out shadow-md\">Approve</button>\r\n+                <button class=\"rejectBtn bg-red-600 text-white px-3 py-1 rounded-full hover:bg-red-700 transition duration-150 ease-in-out shadow-md ml-2\">Reject</button>\r\n             </div>\r\n         `;\r\n \r\n         // Approve\r\n@@ -135,14 +370,21 @@\n \r\n // ========================\r\n // MANUAL GATE CONTROL\r\n // ========================\r\n-document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n-    const residentId = document.getElementById(\"gateResidentId\").value;\r\n-    const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n+document.getElementById(\"openGateBtn\")?.addEventListener(\"click\", async () => {\r\n+    const residentIdInput = document.getElementById(\"gateResidentId\");\r\n+    const visitorIdInput = document.getElementById(\"gateVisitorId\");\r\n+    const gateStatusDiv = document.getElementById(\"gateStatus\");\r\n+    \r\n+    if (!residentIdInput || !visitorIdInput || !gateStatusDiv) return;\r\n \r\n+    const residentId = residentIdInput.value;\r\n+    const visitorId = visitorIdInput.value;\r\n+\r\n     const target = visitorId || residentId;\r\n-    document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n+    gateStatusDiv.className = \"mt-4 text-yellow-700 font-semibold\";\r\n+    gateStatusDiv.innerText = `Gate manually opened for ${target}`;\r\n \r\n     try {\r\n         const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n             method: \"POST\",\r\n@@ -152,32 +394,55 @@\n             },\r\n             body: JSON.stringify({ residentId, visitorId })\r\n         });\r\n         if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n+        \r\n+        gateStatusDiv.className = \"mt-4 text-green-700 font-bold\";\r\n+        gateStatusDiv.innerText = `SUCCESS: Gate opened for ${target}. Log recorded.`;\r\n         loadaccesslogs();\r\n     } catch (err) {\r\n+        gateStatusDiv.className = \"mt-4 text-red-600 font-bold\";\r\n+        gateStatusDiv.innerText = `ERROR: Failed to open gate for ${target}. See console for details.`;\r\n         console.error(\"Manual Gate Error:\", err);\r\n     }\r\n });\r\n \r\n // ========================\r\n // CHARTS\r\n // ========================\r\n function loadCharts() {\r\n-    const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n-    new Chart(dailyCtx, {\r\n-        type: \"bar\",\r\n-        data: {\r\n-            labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-            datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n-        }\r\n-    });\r\n+    const dailyCtx = document.getElementById(\"dailyAccessChart\")?.getContext(\"2d\");\r\n+    if (dailyCtx) {\r\n+        new Chart(dailyCtx, {\r\n+            type: \"bar\",\r\n+            data: {\r\n+                labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n+                datasets: [{ \r\n+                    label: \"Daily Access Count\", \r\n+                    data: [5, 7, 3, 6, 8, 4, 2],\r\n+                    backgroundColor: 'rgba(54, 162, 235, 0.6)',\r\n+                    borderColor: 'rgba(54, 162, 235, 1)',\r\n+                    borderWidth: 1 \r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+    }\r\n \r\n-    const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n-    new Chart(monthlyCtx, {\r\n-        type: \"line\",\r\n-        data: {\r\n-            labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-            datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n-        }\r\n-    });\r\n+    const monthlyCtx = document.getElementById(\"monthlyAccessChart\")?.getContext(\"2d\");\r\n+    if (monthlyCtx) {\r\n+        new Chart(monthlyCtx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n+                datasets: [{ \r\n+                    label: \"Monthly Access Count\", \r\n+                    data: [120,140,110,150,165,180,190,160,140,150,170,180],\r\n+                    borderColor: 'rgba(75, 192, 192, 1)',\r\n+                    tension: 0.1,\r\n+                    fill: false\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+    }\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763875382514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,11 +3,8 @@\n // ========================\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"token\");\r\n \r\n-// Global variable to store the currently rendered logs for export and filtering\r\n-let currentAccessLogs = [];\r\n-\r\n // ========================\r\n // TAB SWITCHING\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n@@ -15,290 +12,64 @@\n     const tabContents = document.querySelectorAll(\".tabContent\");\r\n \r\n     tabButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", () => {\r\n-            // Hide all tab contents\r\n             tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n-            // Show the selected tab content\r\n             document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n-\r\n-            // Special logic for Access Logs to ensure filtering is set up correctly\r\n-            if (btn.dataset.tab === 'accessLogs' && currentAccessLogs.length > 0) {\r\n-                // If data is already loaded, ensure filters are active\r\n-                setupTableFilters();\r\n-            }\r\n         });\r\n     });\r\n \r\n-    // Initialize default tab content (Access Logs)\r\n+    // Load default tab content\r\n     loadaccesslogs();\r\n     loadVisitorRequests();\r\n     loadCharts();\r\n-    \r\n-    // Setup Export Button Listeners (using optional chaining for resilience)\r\n-    document.getElementById(\"exportCsvBtn\")?.addEventListener(\"click\", () => exportTableToCSV(currentAccessLogs, 'access_logs'));\r\n-    document.getElementById(\"exportExcelBtn\")?.addEventListener(\"click\", () => exportTableToExcel(currentAccessLogs, 'access_logs'));\r\n });\r\n \r\n // ========================\r\n-// EXPORT FUNCTIONS\r\n-// ========================\r\n-\r\n-/**\r\n- * Converts a data array to a CSV string and triggers download.\r\n- * @param {Array<Object>} data The data array to export.\r\n- * @param {string} filename The desired filename (without extension).\r\n- */\r\n-function exportTableToCSV(data, filename) {\r\n-    if (data.length === 0) {\r\n-        // Use a message box instead of alert()\r\n-        console.warn(\"Export attempted with no data.\");\r\n-        // In a real app, you would show a custom modal/notification here.\r\n-        return;\r\n-    }\r\n-\r\n-    // Define the headers based on the rendered columns\r\n-    const headers = [\"timestamp\", \"userId\", \"action\", \"logType\"]; \r\n-    let csv = headers.map(h => {\r\n-        // Simple human-readable header mapping for export file\r\n-        if (h === 'userId') return 'User/Visitor ID';\r\n-        if (h === 'logType') return 'Log Type';\r\n-        return h.charAt(0).toUpperCase() + h.slice(1);\r\n-    }).join(',') + '\\n';\r\n-\r\n-    // Add rows\r\n-    data.forEach(row => {\r\n-        const values = headers.map(header => {\r\n-            let value = row[header];\r\n-            // Format timestamp for readability\r\n-            if (header === 'timestamp') {\r\n-                // Ensure the value can be converted to a date before formatting\r\n-                value = value ? new Date(value).toLocaleString() : 'N/A';\r\n-            }\r\n-            // Handle null/undefined values and escape double quotes\r\n-            return `\"${(value === null || value === undefined ? \"\" : value).toString().replace(/\"/g, '\"\"')}\"`;\r\n-        });\r\n-        csv += values.join(',') + '\\n';\r\n-    });\r\n-\r\n-    // Create a blob and trigger download\r\n-    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n-    const link = document.createElement(\"a\");\r\n-    if (link.download !== undefined) {\r\n-        const url = URL.createObjectURL(blob);\r\n-        link.setAttribute(\"href\", url);\r\n-        link.setAttribute(\"download\", `${filename}_${new Date().toISOString().slice(0, 10)}.csv`);\r\n-        link.style.visibility = 'hidden';\r\n-        document.body.appendChild(link);\r\n-        link.click();\r\n-        document.body.removeChild(link);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Converts a data array to an HTML table string for Excel (XLS) download simulation.\r\n- * @param {Array<Object>} data The data array to export.\r\n- * @param {string} filename The desired filename (without extension).\r\n- */\r\n-function exportTableToExcel(data, filename) {\r\n-    if (data.length === 0) {\r\n-        console.warn(\"Export attempted with no data.\");\r\n-        return;\r\n-    }\r\n-\r\n-    // Define the keys to export and their display names\r\n-    const exportKeys = [\"timestamp\", \"userId\", \"action\", \"logType\"];\r\n-    const displayHeaders = [\"Timestamp\", \"User/Visitor ID\", \"Action\", \"Log Type\"];\r\n-    \r\n-    // Start building the HTML table structure\r\n-    let tableHTML = '<table><thead><tr>';\r\n-\r\n-    // Headers\r\n-    displayHeaders.forEach(header => {\r\n-        tableHTML += `<th>${header}</th>`;\r\n-    });\r\n-    tableHTML += '</tr></thead><tbody>';\r\n-\r\n-    // Rows\r\n-    data.forEach(row => {\r\n-        tableHTML += '<tr>';\r\n-        exportKeys.forEach(key => {\r\n-            let value = row[key];\r\n-            if (key === 'timestamp') {\r\n-                value = value ? new Date(value).toLocaleString() : 'N/A';\r\n-            }\r\n-            // Clean up and add value\r\n-            tableHTML += `<td>${value === null || value === undefined ? \"\" : value}</td>`;\r\n-        });\r\n-        tableHTML += '</tr>';\r\n-    });\r\n-\r\n-    tableHTML += '</tbody></table>';\r\n-\r\n-    // Boilerplate for Excel download using base64 encoding of HTML\r\n-    const uri = 'data:application/vnd.ms-excel;base64,';\r\n-    const template = '<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body>{table}</body></html>';\r\n-    \r\n-    const base64 = s => window.btoa(unescape(encodeURIComponent(s)));\r\n-    const format = (s, c) => s.replace(/{(\\w+)}/g, (m, p) => c[p]);\r\n-    \r\n-    const ctx = { worksheet: filename || 'Worksheet', table: tableHTML };\r\n-\r\n-    const link = document.createElement(\"a\");\r\n-    link.href = uri + base64(format(template, ctx));\r\n-    link.download = `${filename}_${new Date().toISOString().slice(0, 10)}.xls`;\r\n-    document.body.appendChild(link);\r\n-    link.click();\r\n-    document.body.removeChild(link);\r\n-}\r\n-\r\n-\r\n-// ========================\r\n-// FILTERING FUNCTIONS\r\n-// ========================\r\n-\r\n-/**\r\n- * Sets up event listeners on the filter inputs in the table header.\r\n- */\r\n-function setupTableFilters() {\r\n-    // Select inputs that are direct children of th elements under #logsTableHeader\r\n-    const filterInputs = document.querySelectorAll(\"#accessLogsTable thead tr:nth-child(2) input.filterInput\");\r\n-    \r\n-    // Clear the table display of any previous filters when setting up new listeners\r\n-    const tbody = document.getElementById(\"logsTableBody\");\r\n-    if (tbody) {\r\n-        tbody.querySelectorAll('tr').forEach(row => row.style.display = \"\");\r\n-    }\r\n-\r\n-    filterInputs.forEach(input => {\r\n-        // Clear previous listeners to prevent duplicates on re-render\r\n-        input.removeEventListener('input', filterTable);\r\n-        input.addEventListener('input', filterTable);\r\n-    });\r\n-}\r\n-\r\n-/**\r\n- * Filters the rendered table rows based on the current input values in the header.\r\n- */\r\n-function filterTable() {\r\n-    const table = document.getElementById(\"accessLogsTable\");\r\n-    // Get all rows in the table body\r\n-    const tr = table.querySelector(\"#logsTableBody\").getElementsByTagName(\"tr\");\r\n-\r\n-    // Get all current filter values (from the second <tr> in the <thead>)\r\n-    const filterRow = table.querySelector(\"thead tr:nth-child(2)\");\r\n-    if (!filterRow) return;\r\n-\r\n-    const filterInputs = filterRow.querySelectorAll('input.filterInput');\r\n-    \r\n-    const filters = {};\r\n-    filterInputs.forEach((input, index) => {\r\n-        if (input.value.trim() !== '') {\r\n-            // Store filter value by column index\r\n-            filters[index] = input.value.trim().toLowerCase();\r\n-        }\r\n-    });\r\n-\r\n-    // Loop through all table rows in the tbody\r\n-    for (let i = 0; i < tr.length; i++) {\r\n-        let displayRow = true;\r\n-        const tds = tr[i].getElementsByTagName(\"td\");\r\n-\r\n-        for (const colIndexStr in filters) {\r\n-            const colIndex = parseInt(colIndexStr);\r\n-            if (tds[colIndex]) {\r\n-                const cellValue = tds[colIndex].textContent || tds[colIndex].innerText || '';\r\n-                \r\n-                // Check if the cell value contains the filter text\r\n-                if (!cellValue.toLowerCase().includes(filters[colIndex])) {\r\n-                    displayRow = false;\r\n-                    break; // No need to check other filters for this row\r\n-                }\r\n-            }\r\n-        }\r\n-\r\n-        // Show or hide the row\r\n-        tr[i].style.display = displayRow ? \"\" : \"none\";\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ========================\r\n // LOAD ACCESS LOGS (BACKEND)\r\n // ========================\r\n async function loadaccesslogs() {\r\n     try {\r\n+        // Fetch data from the corrected endpoint /api/accesslogs/logs\r\n         const response = await fetch(`${API_HOST}/api/accesslogs/logs`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n-        if (!response.ok) {\r\n-            const errorBody = await response.text();\r\n-            console.error(`API Error: Status ${response.status}`, errorBody);\r\n-            throw new Error(`Failed to fetch access logs. Status: ${response.status}`);\r\n-        }\r\n+        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n         const logs = await response.json();\r\n-        \r\n-        if (!Array.isArray(logs)) {\r\n-             console.error(\"Invalid data format: API response is not an array.\", logs);\r\n-             throw new Error(\"Invalid data format received from API.\");\r\n-        }\r\n+        renderaccesslogs(logs); // ðŸŸ¢ CORRECTED: Calling the rendering function\r\n \r\n-        // Store the raw data for export\r\n-        currentAccessLogs = logs; \r\n-        renderaccesslogs(logs);\r\n-\r\n     } catch (err) {\r\n-        console.error(\"Access Log Load Error:\", err.message);\r\n-        const tbody = document.getElementById(\"logsTableBody\");\r\n-        if (tbody) {\r\n-            tbody.innerHTML = `<tr><td colspan=\"4\" class=\"p-4 text-center text-red-600 font-semibold\">Error loading logs: ${err.message}</td></tr>`;\r\n-        }\r\n+        console.error(\"Access Log Error:\", err);\r\n     }\r\n }\r\n \r\n-function renderaccesslogs(logs) {\r\n+// ðŸŸ¢ CORRECTED: Renaming the function back to renderaccesslogs for clarity.\r\n+function renderaccesslogs(logs) { \r\n     const tbody = document.getElementById(\"logsTableBody\");\r\n-    if (!tbody) return;\r\n     tbody.innerHTML = \"\";\r\n \r\n-    logs.forEach((log, index) => {\r\n-        // Crucial data validation: check if required fields exist\r\n-        if (!log || !log.timestamp || !log.action || !log.logType) {\r\n-            console.warn(`Skipping invalid log entry at index ${index}. Missing required fields.`, log);\r\n-            return; // Skip this log entry\r\n-        }\r\n-\r\n+    logs.forEach(log => {\r\n         const tr = document.createElement(\"tr\");\r\n-        tr.className = 'hover:bg-gray-50 transition duration-100';\r\n \r\n-        const timestampValue = log.timestamp ? new Date(log.timestamp).toLocaleString() : 'N/A';\r\n-        \r\n-        // Column Index order: 0: timestamp, 1: userId, 2: action, 3: logType\r\n         tr.innerHTML = `\r\n-            <td class=\"p-3 border-r border-b text-sm\">${timestampValue}</td>\r\n-            <td class=\"p-3 border-r border-b text-sm\">${log.userId || \"â€”\"}</td>\r\n-            <td class=\"p-3 border-r border-b text-sm\">${log.action}</td>\r\n-            <td class=\"p-3 border-b text-sm\">${log.logType}</td>\r\n+            <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n+            <td class=\"p-2 border\">${log.UserId || \"â€”\"}</td>\r\n+            <td class=\"p-2 border\">${log.Action}</td>\r\n+            <td class=\"p-2 border\">${log.LogType}</td>\r\n         `;\r\n \r\n         tbody.appendChild(tr);\r\n     });\r\n-    \r\n-    if (logs.length === 0) {\r\n-        tbody.innerHTML = `<tr><td colspan=\"4\" class=\"p-4 text-center text-gray-500\">No access logs found.</td></tr>`;\r\n-    }\r\n-\r\n-    // IMPORTANT: Set up the filters after the table has been rendered\r\n-    setupTableFilters(); \r\n }\r\n \r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n     try {\r\n+        // Path corrected in previous step: /api/visitorsaccess/requests\r\n         const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n@@ -313,25 +84,19 @@\n }\r\n \r\n function renderVisitorRequests(visitors) {\r\n     const container = document.getElementById(\"visitorRequestList\");\r\n-    if (!container) return;\r\n     container.innerHTML = \"\";\r\n \r\n-    if (visitors.length === 0) {\r\n-        container.innerHTML = `<p class=\"text-gray-500 p-4 border rounded-lg bg-white\">No pending visitor approval requests.</p>`;\r\n-        return;\r\n-    }\r\n-\r\n     visitors.forEach(req => {\r\n         const div = document.createElement(\"div\");\r\n-        div.className = \"p-3 border rounded-lg flex justify-between items-center bg-white shadow-md\";\r\n+        div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n \r\n         div.innerHTML = `\r\n-            <span class=\"text-gray-700\">${req.VisitorName} (ID: <span class=\"font-mono text-sm text-green-700\">${req.VisitorID}</span>) â†’ Resident <span class=\"font-mono text-sm text-blue-700\">${req.ResidentID}</span></span>\r\n+            <span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n             <div>\r\n-                <button class=\"approveBtn bg-green-600 text-white px-3 py-1 rounded-full hover:bg-green-700 transition duration-150 ease-in-out shadow-md\">Approve</button>\r\n-                <button class=\"rejectBtn bg-red-600 text-white px-3 py-1 rounded-full hover:bg-red-700 transition duration-150 ease-in-out shadow-md ml-2\">Reject</button>\r\n+                <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n+                <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n             </div>\r\n         `;\r\n \r\n         // Approve\r\n@@ -370,21 +135,14 @@\n \r\n // ========================\r\n // MANUAL GATE CONTROL\r\n // ========================\r\n-document.getElementById(\"openGateBtn\")?.addEventListener(\"click\", async () => {\r\n-    const residentIdInput = document.getElementById(\"gateResidentId\");\r\n-    const visitorIdInput = document.getElementById(\"gateVisitorId\");\r\n-    const gateStatusDiv = document.getElementById(\"gateStatus\");\r\n-    \r\n-    if (!residentIdInput || !visitorIdInput || !gateStatusDiv) return;\r\n+document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n+    const residentId = document.getElementById(\"gateResidentId\").value;\r\n+    const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n \r\n-    const residentId = residentIdInput.value;\r\n-    const visitorId = visitorIdInput.value;\r\n-\r\n     const target = visitorId || residentId;\r\n-    gateStatusDiv.className = \"mt-4 text-yellow-700 font-semibold\";\r\n-    gateStatusDiv.innerText = `Gate manually opened for ${target}`;\r\n+    document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n \r\n     try {\r\n         const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n             method: \"POST\",\r\n@@ -394,55 +152,32 @@\n             },\r\n             body: JSON.stringify({ residentId, visitorId })\r\n         });\r\n         if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n-        \r\n-        gateStatusDiv.className = \"mt-4 text-green-700 font-bold\";\r\n-        gateStatusDiv.innerText = `SUCCESS: Gate opened for ${target}. Log recorded.`;\r\n         loadaccesslogs();\r\n     } catch (err) {\r\n-        gateStatusDiv.className = \"mt-4 text-red-600 font-bold\";\r\n-        gateStatusDiv.innerText = `ERROR: Failed to open gate for ${target}. See console for details.`;\r\n         console.error(\"Manual Gate Error:\", err);\r\n     }\r\n });\r\n \r\n // ========================\r\n // CHARTS\r\n // ========================\r\n function loadCharts() {\r\n-    const dailyCtx = document.getElementById(\"dailyAccessChart\")?.getContext(\"2d\");\r\n-    if (dailyCtx) {\r\n-        new Chart(dailyCtx, {\r\n-            type: \"bar\",\r\n-            data: {\r\n-                labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-                datasets: [{ \r\n-                    label: \"Daily Access Count\", \r\n-                    data: [5, 7, 3, 6, 8, 4, 2],\r\n-                    backgroundColor: 'rgba(54, 162, 235, 0.6)',\r\n-                    borderColor: 'rgba(54, 162, 235, 1)',\r\n-                    borderWidth: 1 \r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n-    }\r\n+    const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n+    new Chart(dailyCtx, {\r\n+        type: \"bar\",\r\n+        data: {\r\n+            labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n+            datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n+        }\r\n+    });\r\n \r\n-    const monthlyCtx = document.getElementById(\"monthlyAccessChart\")?.getContext(\"2d\");\r\n-    if (monthlyCtx) {\r\n-        new Chart(monthlyCtx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-                datasets: [{ \r\n-                    label: \"Monthly Access Count\", \r\n-                    data: [120,140,110,150,165,180,190,160,140,150,170,180],\r\n-                    borderColor: 'rgba(75, 192, 192, 1)',\r\n-                    tension: 0.1,\r\n-                    fill: false\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n-    }\r\n+    const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n+    new Chart(monthlyCtx, {\r\n+        type: \"line\",\r\n+        data: {\r\n+            labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n+            datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n+        }\r\n+    });\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763875773345,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,11 @@\n // ========================\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"token\");\r\n \r\n+// Store the currently loaded logs for export and local filtering purposes\r\n+let currentAccessLogs = [];\r\n+\r\n // ========================\r\n // TAB SWITCHING\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n@@ -21,12 +24,24 @@\n     // Load default tab content\r\n     loadaccesslogs();\r\n     loadVisitorRequests();\r\n     loadCharts();\r\n+    \r\n+    // ðŸ”‘ NEW: Attach event listeners for Export and Filter inputs\r\n+    document.getElementById(\"exportCsvBtn\").addEventListener(\"click\", exportToCsv);\r\n+    document.getElementById(\"exportExcelBtn\").addEventListener(\"click\", exportToExcel);\r\n+\r\n+    // Attach filter event listeners to the new inputs\r\n+    const filterInputs = document.querySelectorAll('.filterInput');\r\n+    filterInputs.forEach(input => {\r\n+        // Use an array index to identify which column the input belongs to\r\n+        input.dataset.columnIndex = Array.from(input.parentNode.parentNode.children).indexOf(input.parentNode);\r\n+        input.addEventListener('keyup', applyInlineFilters);\r\n+    });\r\n });\r\n \r\n // ========================\r\n-// LOAD ACCESS LOGS (BACKEND)\r\n+// ACCESS LOGS FUNCTIONALITY\r\n // ========================\r\n async function loadaccesslogs() {\r\n     try {\r\n         // Fetch data from the corrected endpoint /api/accesslogs/logs\r\n@@ -36,17 +51,17 @@\n \r\n         if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n \r\n         const logs = await response.json();\r\n-        renderaccesslogs(logs); // ðŸŸ¢ CORRECTED: Calling the rendering function\r\n+        currentAccessLogs = logs; // ðŸ”‘ Store logs for export and filtering\r\n+        renderaccesslogs(logs);\r\n \r\n     } catch (err) {\r\n         console.error(\"Access Log Error:\", err);\r\n     }\r\n }\r\n \r\n-// ðŸŸ¢ CORRECTED: Renaming the function back to renderaccesslogs for clarity.\r\n-function renderaccesslogs(logs) { \r\n+function renderaccesslogs(logs) {\r\n     const tbody = document.getElementById(\"logsTableBody\");\r\n     tbody.innerHTML = \"\";\r\n \r\n     logs.forEach(log => {\r\n@@ -62,8 +77,89 @@\n         tbody.appendChild(tr);\r\n     });\r\n }\r\n \r\n+// ðŸ”‘ NEW: Function to apply inline filters locally\r\n+function applyInlineFilters() {\r\n+    const filterInputs = document.querySelectorAll('.filterInput');\r\n+    const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());\r\n+\r\n+    const filteredLogs = currentAccessLogs.filter(log => {\r\n+        // Prepare log values for comparison (order matches the table columns)\r\n+        const logValues = [\r\n+            new Date(log.TimestampUtc).toLocaleString().toLowerCase(),\r\n+            (log.UserId || 'â€”').toLowerCase(),\r\n+            log.Action.toLowerCase(),\r\n+            log.LogType.toLowerCase(),\r\n+        ];\r\n+\r\n+        // Check if all filter values are present in their respective log columns\r\n+        return filters.every((filterValue, index) => {\r\n+            return !filterValue || logValues[index].includes(filterValue);\r\n+        });\r\n+    });\r\n+\r\n+    renderaccesslogs(filteredLogs);\r\n+}\r\n+\r\n+\r\n+// ðŸ”‘ NEW: Function to export logs to CSV\r\n+function exportToCsv() {\r\n+    if (currentAccessLogs.length === 0) return alert(\"No logs to export.\");\r\n+\r\n+    const headers = [\"Timestamp (UTC)\", \"User/Visitor ID\", \"Action\", \"Log Type\"];\r\n+    \r\n+    // Convert logs to CSV string\r\n+    const csvContent = [\r\n+        headers.join(','), // Header row\r\n+        ...currentAccessLogs.map(log => \r\n+            // Escape values and join by comma\r\n+            [\r\n+                `\"${new Date(log.TimestampUtc).toLocaleString().replace(/\"/g, '\"\"')}\"`,\r\n+                `\"${(log.UserId || 'â€”').replace(/\"/g, '\"\"')}\"`,\r\n+                `\"${log.Action.replace(/\"/g, '\"\"')}\"`,\r\n+                `\"${log.LogType.replace(/\"/g, '\"\"')}\"`,\r\n+            ].join(',')\r\n+        )\r\n+    ].join('\\n');\r\n+\r\n+    // Create a Blob and download link\r\n+    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n+    const link = document.createElement(\"a\");\r\n+    link.href = URL.createObjectURL(blob);\r\n+    link.download = \"access_logs.csv\";\r\n+    link.click();\r\n+}\r\n+\r\n+// ðŸ”‘ NEW: Function to export logs to Excel (simplified CSV approach for browser)\r\n+function exportToExcel() {\r\n+    if (currentAccessLogs.length === 0) return alert(\"No logs to export.\");\r\n+\r\n+    // This creates a standard CSV file with an .xls extension.\r\n+    // Excel can open this, giving the desired effect in a simplified manner.\r\n+    const headers = [\"Timestamp (UTC)\", \"User/Visitor ID\", \"Action\", \"Log Type\"];\r\n+    \r\n+    const excelContent = [\r\n+        headers.join('\\t'), // Use tab delimiter for simple Excel compatibility\r\n+        ...currentAccessLogs.map(log => \r\n+            [\r\n+                new Date(log.TimestampUtc).toLocaleString(),\r\n+                log.UserId || 'â€”',\r\n+                log.Action,\r\n+                log.LogType,\r\n+            ].join('\\t')\r\n+        )\r\n+    ].join('\\n');\r\n+\r\n+    // Use application/vnd.ms-excel to suggest opening in Excel\r\n+    const blob = new Blob([excelContent], { type: 'application/vnd.ms-excel;charset=utf-8;' });\r\n+    const link = document.createElement(\"a\");\r\n+    link.href = URL.createObjectURL(blob);\r\n+    link.download = \"access_logs.xls\"; // Using .xls for compatibility suggestion\r\n+    link.click();\r\n+}\r\n+\r\n+\r\n // ========================\r\n // LOAD VISITOR REQUESTS (BACKEND)\r\n // ========================\r\n async function loadVisitorRequests() {\r\n"
                },
                {
                    "date": 1763875883799,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n     loadaccesslogs();\r\n     loadVisitorRequests();\r\n     loadCharts();\r\n     \r\n-    // ðŸ”‘ NEW: Attach event listeners for Export and Filter inputs\r\n+    // ðŸ”‘ Attach event listeners for Export and Filter inputs\r\n     document.getElementById(\"exportCsvBtn\").addEventListener(\"click\", exportToCsv);\r\n     document.getElementById(\"exportExcelBtn\").addEventListener(\"click\", exportToExcel);\r\n \r\n     // Attach filter event listeners to the new inputs\r\n@@ -77,9 +77,9 @@\n         tbody.appendChild(tr);\r\n     });\r\n }\r\n \r\n-// ðŸ”‘ NEW: Function to apply inline filters locally\r\n+// ðŸ”‘ Function to apply inline filters locally\r\n function applyInlineFilters() {\r\n     const filterInputs = document.querySelectorAll('.filterInput');\r\n     const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());\r\n \r\n@@ -100,10 +100,12 @@\n \r\n     renderaccesslogs(filteredLogs);\r\n }\r\n \r\n+// ðŸŸ¢ FIX APPLIED: Helper function to safely convert null/undefined to string 'â€”'\r\n+const safeString = (value) => String(value ?? 'â€”');\r\n \r\n-// ðŸ”‘ NEW: Function to export logs to CSV\r\n+// ðŸ”‘ Updated Function to export logs to CSV (Fixed TypeError)\r\n function exportToCsv() {\r\n     if (currentAccessLogs.length === 0) return alert(\"No logs to export.\");\r\n \r\n     const headers = [\"Timestamp (UTC)\", \"User/Visitor ID\", \"Action\", \"Log Type\"];\r\n@@ -111,14 +113,14 @@\n     // Convert logs to CSV string\r\n     const csvContent = [\r\n         headers.join(','), // Header row\r\n         ...currentAccessLogs.map(log => \r\n-            // Escape values and join by comma\r\n+            // ðŸŸ¢ FIX: Ensure values are strings before calling .replace()\r\n             [\r\n-                `\"${new Date(log.TimestampUtc).toLocaleString().replace(/\"/g, '\"\"')}\"`,\r\n-                `\"${(log.UserId || 'â€”').replace(/\"/g, '\"\"')}\"`,\r\n-                `\"${log.Action.replace(/\"/g, '\"\"')}\"`,\r\n-                `\"${log.LogType.replace(/\"/g, '\"\"')}\"`,\r\n+                `\"${safeString(new Date(log.TimestampUtc).toLocaleString()).replace(/\"/g, '\"\"')}\"`,\r\n+                `\"${safeString(log.UserId).replace(/\"/g, '\"\"')}\"`,\r\n+                `\"${safeString(log.Action).replace(/\"/g, '\"\"')}\"`,\r\n+                `\"${safeString(log.LogType).replace(/\"/g, '\"\"')}\"`,\r\n             ].join(',')\r\n         )\r\n     ].join('\\n');\r\n \r\n@@ -129,24 +131,23 @@\n     link.download = \"access_logs.csv\";\r\n     link.click();\r\n }\r\n \r\n-// ðŸ”‘ NEW: Function to export logs to Excel (simplified CSV approach for browser)\r\n+// ðŸ”‘ Updated Function to export logs to Excel (Fixed TypeError)\r\n function exportToExcel() {\r\n     if (currentAccessLogs.length === 0) return alert(\"No logs to export.\");\r\n \r\n-    // This creates a standard CSV file with an .xls extension.\r\n-    // Excel can open this, giving the desired effect in a simplified manner.\r\n     const headers = [\"Timestamp (UTC)\", \"User/Visitor ID\", \"Action\", \"Log Type\"];\r\n     \r\n     const excelContent = [\r\n         headers.join('\\t'), // Use tab delimiter for simple Excel compatibility\r\n         ...currentAccessLogs.map(log => \r\n             [\r\n-                new Date(log.TimestampUtc).toLocaleString(),\r\n-                log.UserId || 'â€”',\r\n-                log.Action,\r\n-                log.LogType,\r\n+                // ðŸŸ¢ FIX: Ensure values are strings\r\n+                safeString(new Date(log.TimestampUtc).toLocaleString()),\r\n+                safeString(log.UserId),\r\n+                safeString(log.Action),\r\n+                safeString(log.LogType),\r\n             ].join('\\t')\r\n         )\r\n     ].join('\\n');\r\n \r\n@@ -174,8 +175,9 @@\n         const visitors = await response.json();\r\n         renderVisitorRequests(visitors);\r\n \r\n     } catch (err) {\r\n+        // ðŸ›‘ NOTE: This 403 error must be fixed on the server (check JWT validity/permissions).\r\n         console.error(\"Visitor Requests Error:\", err);\r\n     }\r\n }\r\n \r\n"
                },
                {
                    "date": 1763884805605,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -277,5 +277,48 @@\n             labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n             datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n         }\r\n     });\r\n-}\n\\ No newline at end of file\n+}\r\n+// Select all sidebar & sub-sidebar buttons\r\n+const sidebarButtons = document.querySelectorAll('.tabBtn'); // For security dashboard tabs\r\n+const subSidebarButtons = document.querySelectorAll('#visitorSubMenu .sidebarBtn'); // Adjust selector for your sub-menu\r\n+\r\n+// Function to remove active classes from all buttons\r\n+function resetActiveButtons() {\r\n+  sidebarButtons.forEach(btn => btn.classList.remove('bg-blue-600','text-white','shadow-inner'));\r\n+  subSidebarButtons.forEach(btn => btn.classList.remove('bg-blue-600','text-white','shadow-inner'));\r\n+}\r\n+\r\n+// Click handler for all sidebar buttons\r\n+sidebarButtons.forEach(btn => {\r\n+  btn.addEventListener('click', () => {\r\n+    resetActiveButtons();\r\n+    btn.classList.add('bg-blue-600','text-white','shadow-inner');\r\n+\r\n+    // Hide all tab content\r\n+    document.querySelectorAll('.tabContent').forEach(tab => tab.classList.add('hidden'));\r\n+\r\n+    // Show corresponding tab\r\n+    const tabId = btn.dataset.tab;\r\n+    if (tabId) document.getElementById(tabId).classList.remove('hidden');\r\n+  });\r\n+});\r\n+\r\n+// Click handler for sub-sidebar buttons\r\n+subSidebarButtons.forEach(btn => {\r\n+  btn.addEventListener('click', () => {\r\n+    resetActiveButtons();\r\n+    btn.classList.add('bg-blue-600','text-white','shadow-inner');\r\n+\r\n+    // Show corresponding tab content\r\n+    const tabId = btn.dataset.target; // assuming sub-buttons have data-target pointing to content\r\n+    if (tabId) {\r\n+      document.querySelectorAll('.tabContent').forEach(tab => tab.classList.add('hidden'));\r\n+      const content = document.getElementById(tabId.split('/').pop().replace('.html',''));\r\n+      if(content) content.classList.remove('hidden');\r\n+    }\r\n+\r\n+    // Keep parent submenu open\r\n+    visitorSubMenu.classList.remove('hidden');\r\n+  });\r\n+});\r\n"
                },
                {
                    "date": 1763884873248,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -278,47 +278,4 @@\n             datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n         }\r\n     });\r\n }\r\n-// Select all sidebar & sub-sidebar buttons\r\n-const sidebarButtons = document.querySelectorAll('.tabBtn'); // For security dashboard tabs\r\n-const subSidebarButtons = document.querySelectorAll('#visitorSubMenu .sidebarBtn'); // Adjust selector for your sub-menu\r\n-\r\n-// Function to remove active classes from all buttons\r\n-function resetActiveButtons() {\r\n-  sidebarButtons.forEach(btn => btn.classList.remove('bg-blue-600','text-white','shadow-inner'));\r\n-  subSidebarButtons.forEach(btn => btn.classList.remove('bg-blue-600','text-white','shadow-inner'));\r\n-}\r\n-\r\n-// Click handler for all sidebar buttons\r\n-sidebarButtons.forEach(btn => {\r\n-  btn.addEventListener('click', () => {\r\n-    resetActiveButtons();\r\n-    btn.classList.add('bg-blue-600','text-white','shadow-inner');\r\n-\r\n-    // Hide all tab content\r\n-    document.querySelectorAll('.tabContent').forEach(tab => tab.classList.add('hidden'));\r\n-\r\n-    // Show corresponding tab\r\n-    const tabId = btn.dataset.tab;\r\n-    if (tabId) document.getElementById(tabId).classList.remove('hidden');\r\n-  });\r\n-});\r\n-\r\n-// Click handler for sub-sidebar buttons\r\n-subSidebarButtons.forEach(btn => {\r\n-  btn.addEventListener('click', () => {\r\n-    resetActiveButtons();\r\n-    btn.classList.add('bg-blue-600','text-white','shadow-inner');\r\n-\r\n-    // Show corresponding tab content\r\n-    const tabId = btn.dataset.target; // assuming sub-buttons have data-target pointing to content\r\n-    if (tabId) {\r\n-      document.querySelectorAll('.tabContent').forEach(tab => tab.classList.add('hidden'));\r\n-      const content = document.getElementById(tabId.split('/').pop().replace('.html',''));\r\n-      if(content) content.classList.remove('hidden');\r\n-    }\r\n-\r\n-    // Keep parent submenu open\r\n-    visitorSubMenu.classList.remove('hidden');\r\n-  });\r\n-});\r\n"
                },
                {
                    "date": 1763961490531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,6 @@\n+// js/securitydashboard.js\r\n+\r\n // ========================\r\n // GLOBAL SETTINGS\r\n // ========================\r\n const API_HOST = \"http://localhost:4050\";\r\n@@ -7,24 +9,93 @@\n // Store the currently loaded logs for export and local filtering purposes\r\n let currentAccessLogs = [];\r\n \r\n // ========================\r\n-// TAB SWITCHING\r\n+// NEW TAB SWITCHING FUNCTIONS\r\n // ========================\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n+\r\n+// Fetches and loads the content of visitorsaccess.html\r\n+async function loadVisitorsAccessForm() {\r\n+    const targetElement = document.getElementById('visitorRequestList');\r\n+    targetElement.innerHTML = '<p class=\"text-gray-500\">Loading visitor access form...</p>';\r\n+    \r\n+    try {\r\n+        const response = await fetch('visitorsaccess.html'); // Ensure this path is correct\r\n+        if (!response.ok) {\r\n+            throw new Error(`HTTP error! status: ${response.status}`);\r\n+        }\r\n+        \r\n+        const htmlContent = await response.text();\r\n+        \r\n+        // Inject the fetched HTML content\r\n+        targetElement.innerHTML = htmlContent;\r\n+        \r\n+        // IMPORTANT NOTE: If visitorsaccess.html contains <script> tags for \r\n+        // form submission or validation, they will NOT automatically execute. \r\n+        // That logic must be moved to securitydashboard.js or manually loaded.\r\n+\r\n+    } catch (error) {\r\n+        console.error('Error loading external HTML content:', error);\r\n+        targetElement.innerHTML = `<p class=\"text-red-600\">Failed to load visitor form.</p>`;\r\n+    }\r\n+}\r\n+\r\n+// Central function to handle tab clicks\r\n+function handleTabSwitch(tabId) {\r\n     const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n     const tabContents = document.querySelectorAll(\".tabContent\");\r\n \r\n+    // Hide all tabs\r\n+    tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n+    \r\n+    // De-highlight all buttons\r\n+    tabButtons.forEach(btn => btn.classList.remove('bg-gray-700', 'text-white'));\r\n+\r\n+    // Show selected tab content and highlight button\r\n+    const selectedContent = document.getElementById(tabId);\r\n+    if (selectedContent) {\r\n+        selectedContent.classList.remove(\"hidden\");\r\n+    }\r\n+    const selectedButton = document.querySelector(`.tabBtn[data-tab=\"${tabId}\"]`);\r\n+    if (selectedButton) {\r\n+        selectedButton.classList.add('bg-gray-700', 'text-white');\r\n+    }\r\n+\r\n+    // Special loading logic for Visitor Approvals\r\n+    if (tabId === 'visitorApprovals') {\r\n+        loadVisitorsAccessForm();\r\n+    } else {\r\n+        // If switching away from the tab, load the dynamic content\r\n+        if (tabId === 'accessLogs') loadaccesslogs();\r\n+        if (tabId === 'reportsAnalysis') loadCharts();\r\n+        \r\n+        // If the Visitor Approvals tab should revert to the *approval list* when\r\n+        // switching away from the form, you would call loadVisitorRequests() here.\r\n+        // For now, we only load the data when its tab is active.\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ========================\r\n+// TAB SWITCHING (ENTRY POINT)\r\n+// ========================\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n+\r\n     tabButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", () => {\r\n-            tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n-            document.getElementById(btn.dataset.tab).classList.remove(\"hidden\");\r\n+            handleTabSwitch(btn.dataset.tab);\r\n         });\r\n     });\r\n \r\n-    // Load default tab content\r\n-    loadaccesslogs();\r\n-    loadVisitorRequests();\r\n+    // ðŸ”‘ INITIAL LOAD: Use handleTabSwitch to load the default tab\r\n+    const initialTabId = document.querySelector('.tabBtn')?.dataset.tab || 'accessLogs';\r\n+    handleTabSwitch(initialTabId);\r\n+\r\n+    // Initial load functions are now called inside handleTabSwitch, \r\n+    // but keep these if you need data loaded regardless of the active tab.\r\n+    // loadaccesslogs(); // Called by handleTabSwitch('accessLogs')\r\n+    // loadVisitorRequests(); // REMOVED: Only called when 'visitorApprovals' is active\r\n     loadCharts();\r\n     \r\n     // ðŸ”‘ Attach event listeners for Export and Filter inputs\r\n     document.getElementById(\"exportCsvBtn\").addEventListener(\"click\", exportToCsv);\r\n@@ -160,9 +231,9 @@\n }\r\n \r\n \r\n // ========================\r\n-// LOAD VISITOR REQUESTS (BACKEND)\r\n+// LOAD VISITOR REQUESTS (BACKEND) - KEPT FOR REFERENCE/MANUAL CALLS\r\n // ========================\r\n async function loadVisitorRequests() {\r\n     try {\r\n         // Path corrected in previous step: /api/visitorsaccess/requests\r\n@@ -183,8 +254,11 @@\n \r\n function renderVisitorRequests(visitors) {\r\n     const container = document.getElementById(\"visitorRequestList\");\r\n     container.innerHTML = \"\";\r\n+    \r\n+    // NOTE: This function is now superseded by loadVisitorsAccessForm, \r\n+    // unless you intend to switch back to the list view after form submission.\r\n \r\n     visitors.forEach(req => {\r\n         const div = document.createElement(\"div\");\r\n         div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n@@ -277,5 +351,5 @@\n             labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n             datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n         }\r\n     });\r\n-}\r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763961687965,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,11 @@\n \r\n // Store the currently loaded logs for export and local filtering purposes\r\n let currentAccessLogs = [];\r\n \r\n+// ðŸŸ¢ FIX APPLIED: Helper function to safely convert null/undefined to string 'â€”'\r\n+const safeString = (value) => String(value ?? 'â€”');\r\n+\r\n // ========================\r\n // NEW TAB SWITCHING FUNCTIONS\r\n // ========================\r\n \r\n@@ -38,9 +41,9 @@\n         targetElement.innerHTML = `<p class=\"text-red-600\">Failed to load visitor form.</p>`;\r\n     }\r\n }\r\n \r\n-// Central function to handle tab clicks\r\n+// Central function to handle tab clicks and load specific content\r\n function handleTabSwitch(tabId) {\r\n     const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n     const tabContents = document.querySelectorAll(\".tabContent\");\r\n \r\n@@ -59,25 +62,22 @@\n     if (selectedButton) {\r\n         selectedButton.classList.add('bg-gray-700', 'text-white');\r\n     }\r\n \r\n-    // Special loading logic for Visitor Approvals\r\n+    // Special loading logic based on the tab ID\r\n     if (tabId === 'visitorApprovals') {\r\n         loadVisitorsAccessForm();\r\n-    } else {\r\n-        // If switching away from the tab, load the dynamic content\r\n-        if (tabId === 'accessLogs') loadaccesslogs();\r\n-        if (tabId === 'reportsAnalysis') loadCharts();\r\n-        \r\n-        // If the Visitor Approvals tab should revert to the *approval list* when\r\n-        // switching away from the form, you would call loadVisitorRequests() here.\r\n-        // For now, we only load the data when its tab is active.\r\n+    } else if (tabId === 'accessLogs') {\r\n+        loadaccesslogs();\r\n+    } else if (tabId === 'reportsAnalysis') {\r\n+        loadCharts();\r\n     }\r\n+    // ManualGate doesn't need data loading on switch.\r\n }\r\n \r\n \r\n // ========================\r\n-// TAB SWITCHING (ENTRY POINT)\r\n+// TAB SWITCHING (ENTRY POINT - AMENDED)\r\n // ========================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n     const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n \r\n@@ -86,18 +86,12 @@\n             handleTabSwitch(btn.dataset.tab);\r\n         });\r\n     });\r\n \r\n-    // ðŸ”‘ INITIAL LOAD: Use handleTabSwitch to load the default tab\r\n+    // ðŸ”‘ Determine initial tab to load (default to accessLogs)\r\n     const initialTabId = document.querySelector('.tabBtn')?.dataset.tab || 'accessLogs';\r\n-    handleTabSwitch(initialTabId);\r\n+    handleTabSwitch(initialTabId); // Load the default tab, which calls the necessary load function (e.g., loadaccesslogs())\r\n \r\n-    // Initial load functions are now called inside handleTabSwitch, \r\n-    // but keep these if you need data loaded regardless of the active tab.\r\n-    // loadaccesslogs(); // Called by handleTabSwitch('accessLogs')\r\n-    // loadVisitorRequests(); // REMOVED: Only called when 'visitorApprovals' is active\r\n-    loadCharts();\r\n-    \r\n     // ðŸ”‘ Attach event listeners for Export and Filter inputs\r\n     document.getElementById(\"exportCsvBtn\").addEventListener(\"click\", exportToCsv);\r\n     document.getElementById(\"exportExcelBtn\").addEventListener(\"click\", exportToExcel);\r\n \r\n@@ -107,8 +101,11 @@\n         // Use an array index to identify which column the input belongs to\r\n         input.dataset.columnIndex = Array.from(input.parentNode.parentNode.children).indexOf(input.parentNode);\r\n         input.addEventListener('keyup', applyInlineFilters);\r\n     });\r\n+    \r\n+    // NOTE: loadaccesslogs() and loadCharts() were removed here \r\n+    // because they are now called conditionally inside handleTabSwitch(initialTabId).\r\n });\r\n \r\n // ========================\r\n // ACCESS LOGS FUNCTIONALITY\r\n@@ -171,11 +168,8 @@\n \r\n     renderaccesslogs(filteredLogs);\r\n }\r\n \r\n-// ðŸŸ¢ FIX APPLIED: Helper function to safely convert null/undefined to string 'â€”'\r\n-const safeString = (value) => String(value ?? 'â€”');\r\n-\r\n // ðŸ”‘ Updated Function to export logs to CSV (Fixed TypeError)\r\n function exportToCsv() {\r\n     if (currentAccessLogs.length === 0) return alert(\"No logs to export.\");\r\n \r\n@@ -255,10 +249,9 @@\n function renderVisitorRequests(visitors) {\r\n     const container = document.getElementById(\"visitorRequestList\");\r\n     container.innerHTML = \"\";\r\n     \r\n-    // NOTE: This function is now superseded by loadVisitorsAccessForm, \r\n-    // unless you intend to switch back to the list view after form submission.\r\n+    // NOTE: This function is superseded by loadVisitorsAccessForm when the tab is first clicked.\r\n \r\n     visitors.forEach(req => {\r\n         const div = document.createElement(\"div\");\r\n         div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n"
                },
                {
                    "date": 1763962269114,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,348 +1,66 @@\n-// js/securitydashboard.js\r\n+// ================================\r\n+// Security Dashboard Frontend JS\r\n+// ================================\r\n \r\n-// ========================\r\n-// GLOBAL SETTINGS\r\n-// ========================\r\n-const API_HOST = \"http://localhost:4050\";\r\n-const token = localStorage.getItem(\"token\");\r\n+// Grab elements\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContent = document.getElementById(\"main-content-area\");\r\n+const logoutBtn = document.getElementById(\"logoutBtn\");\r\n \r\n-// Store the currently loaded logs for export and local filtering purposes\r\n-let currentAccessLogs = [];\r\n-\r\n-// ðŸŸ¢ FIX APPLIED: Helper function to safely convert null/undefined to string 'â€”'\r\n-const safeString = (value) => String(value ?? 'â€”');\r\n-\r\n-// ========================\r\n-// NEW TAB SWITCHING FUNCTIONS\r\n-// ========================\r\n-\r\n-// Fetches and loads the content of visitorsaccess.html\r\n-async function loadVisitorsAccessForm() {\r\n-    const targetElement = document.getElementById('visitorRequestList');\r\n-    targetElement.innerHTML = '<p class=\"text-gray-500\">Loading visitor access form...</p>';\r\n-    \r\n-    try {\r\n-        const response = await fetch('visitorsaccess.html'); // Ensure this path is correct\r\n-        if (!response.ok) {\r\n-            throw new Error(`HTTP error! status: ${response.status}`);\r\n-        }\r\n-        \r\n-        const htmlContent = await response.text();\r\n-        \r\n-        // Inject the fetched HTML content\r\n-        targetElement.innerHTML = htmlContent;\r\n-        \r\n-        // IMPORTANT NOTE: If visitorsaccess.html contains <script> tags for \r\n-        // form submission or validation, they will NOT automatically execute. \r\n-        // That logic must be moved to securitydashboard.js or manually loaded.\r\n-\r\n-    } catch (error) {\r\n-        console.error('Error loading external HTML content:', error);\r\n-        targetElement.innerHTML = `<p class=\"text-red-600\">Failed to load visitor form.</p>`;\r\n-    }\r\n-}\r\n-\r\n-// Central function to handle tab clicks and load specific content\r\n-function handleTabSwitch(tabId) {\r\n-    const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n-    const tabContents = document.querySelectorAll(\".tabContent\");\r\n-\r\n-    // Hide all tabs\r\n-    tabContents.forEach(tab => tab.classList.add(\"hidden\"));\r\n-    \r\n-    // De-highlight all buttons\r\n-    tabButtons.forEach(btn => btn.classList.remove('bg-gray-700', 'text-white'));\r\n-\r\n-    // Show selected tab content and highlight button\r\n-    const selectedContent = document.getElementById(tabId);\r\n-    if (selectedContent) {\r\n-        selectedContent.classList.remove(\"hidden\");\r\n-    }\r\n-    const selectedButton = document.querySelector(`.tabBtn[data-tab=\"${tabId}\"]`);\r\n-    if (selectedButton) {\r\n-        selectedButton.classList.add('bg-gray-700', 'text-white');\r\n-    }\r\n-\r\n-    // Special loading logic based on the tab ID\r\n-    if (tabId === 'visitorApprovals') {\r\n-        loadVisitorsAccessForm();\r\n-    } else if (tabId === 'accessLogs') {\r\n-        loadaccesslogs();\r\n-    } else if (tabId === 'reportsAnalysis') {\r\n-        loadCharts();\r\n-    }\r\n-    // ManualGate doesn't need data loading on switch.\r\n-}\r\n-\r\n-\r\n-// ========================\r\n-// TAB SWITCHING (ENTRY POINT - AMENDED)\r\n-// ========================\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n-\r\n-    tabButtons.forEach(btn => {\r\n-        btn.addEventListener(\"click\", () => {\r\n-            handleTabSwitch(btn.dataset.tab);\r\n-        });\r\n-    });\r\n-\r\n-    // ðŸ”‘ Determine initial tab to load (default to accessLogs)\r\n-    const initialTabId = document.querySelector('.tabBtn')?.dataset.tab || 'accessLogs';\r\n-    handleTabSwitch(initialTabId); // Load the default tab, which calls the necessary load function (e.g., loadaccesslogs())\r\n-\r\n-    // ðŸ”‘ Attach event listeners for Export and Filter inputs\r\n-    document.getElementById(\"exportCsvBtn\").addEventListener(\"click\", exportToCsv);\r\n-    document.getElementById(\"exportExcelBtn\").addEventListener(\"click\", exportToExcel);\r\n-\r\n-    // Attach filter event listeners to the new inputs\r\n-    const filterInputs = document.querySelectorAll('.filterInput');\r\n-    filterInputs.forEach(input => {\r\n-        // Use an array index to identify which column the input belongs to\r\n-        input.dataset.columnIndex = Array.from(input.parentNode.parentNode.children).indexOf(input.parentNode);\r\n-        input.addEventListener('keyup', applyInlineFilters);\r\n-    });\r\n-    \r\n-    // NOTE: loadaccesslogs() and loadCharts() were removed here \r\n-    // because they are now called conditionally inside handleTabSwitch(initialTabId).\r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+logoutBtn?.addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    localStorage.removeItem(\"userRole\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n-// ========================\r\n-// ACCESS LOGS FUNCTIONALITY\r\n-// ========================\r\n-async function loadaccesslogs() {\r\n+// ================================\r\n+// UTILITY: Load page into main content\r\n+async function loadPage(url) {\r\n+    if (!mainContent) return;\r\n+    mainContent.innerHTML = '<div>Loading...</div>';\r\n     try {\r\n-        // Fetch data from the corrected endpoint /api/accesslogs/logs\r\n-        const response = await fetch(`${API_HOST}/api/accesslogs/logs`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load ${url}: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContent.innerHTML = html;\r\n \r\n-        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n-\r\n-        const logs = await response.json();\r\n-        currentAccessLogs = logs; // ðŸ”‘ Store logs for export and filtering\r\n-        renderaccesslogs(logs);\r\n-\r\n+        // If page has any JS initialization function, call it\r\n+        if (url.includes(\"visitoraccess.html\") && typeof initVisitorAccess === \"function\") {\r\n+            initVisitorAccess();\r\n+        }\r\n+        if (url.includes(\"accesslogs.html\") && typeof initAccessLogs === \"function\") {\r\n+            initAccessLogs();\r\n+        }\r\n+        if (url.includes(\"visitorapprovals.html\") && typeof initVisitorApprovals === \"function\") {\r\n+            initVisitorApprovals();\r\n+        }\r\n     } catch (err) {\r\n-        console.error(\"Access Log Error:\", err);\r\n+        console.error(err);\r\n+        mainContent.innerHTML = `<div class=\"text-red-600\">Error loading page: ${err.message}</div>`;\r\n     }\r\n }\r\n \r\n-function renderaccesslogs(logs) {\r\n-    const tbody = document.getElementById(\"logsTableBody\");\r\n-    tbody.innerHTML = \"\";\r\n+// ================================\r\n+// Sidebar tab click handler\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", () => {\r\n+        // Remove active class from all buttons\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        // Add active class to clicked button\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n-    logs.forEach(log => {\r\n-        const tr = document.createElement(\"tr\");\r\n-\r\n-        tr.innerHTML = `\r\n-            <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n-            <td class=\"p-2 border\">${log.UserId || \"â€”\"}</td>\r\n-            <td class=\"p-2 border\">${log.Action}</td>\r\n-            <td class=\"p-2 border\">${log.LogType}</td>\r\n-        `;\r\n-\r\n-        tbody.appendChild(tr);\r\n+        const targetUrl = btn.dataset.target;\r\n+        if (targetUrl) {\r\n+            loadPage(targetUrl);\r\n+        }\r\n     });\r\n-}\r\n+});\r\n \r\n-// ðŸ”‘ Function to apply inline filters locally\r\n-function applyInlineFilters() {\r\n-    const filterInputs = document.querySelectorAll('.filterInput');\r\n-    const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());\r\n-\r\n-    const filteredLogs = currentAccessLogs.filter(log => {\r\n-        // Prepare log values for comparison (order matches the table columns)\r\n-        const logValues = [\r\n-            new Date(log.TimestampUtc).toLocaleString().toLowerCase(),\r\n-            (log.UserId || 'â€”').toLowerCase(),\r\n-            log.Action.toLowerCase(),\r\n-            log.LogType.toLowerCase(),\r\n-        ];\r\n-\r\n-        // Check if all filter values are present in their respective log columns\r\n-        return filters.every((filterValue, index) => {\r\n-            return !filterValue || logValues[index].includes(filterValue);\r\n-        });\r\n-    });\r\n-\r\n-    renderaccesslogs(filteredLogs);\r\n-}\r\n-\r\n-// ðŸ”‘ Updated Function to export logs to CSV (Fixed TypeError)\r\n-function exportToCsv() {\r\n-    if (currentAccessLogs.length === 0) return alert(\"No logs to export.\");\r\n-\r\n-    const headers = [\"Timestamp (UTC)\", \"User/Visitor ID\", \"Action\", \"Log Type\"];\r\n-    \r\n-    // Convert logs to CSV string\r\n-    const csvContent = [\r\n-        headers.join(','), // Header row\r\n-        ...currentAccessLogs.map(log => \r\n-            // ðŸŸ¢ FIX: Ensure values are strings before calling .replace()\r\n-            [\r\n-                `\"${safeString(new Date(log.TimestampUtc).toLocaleString()).replace(/\"/g, '\"\"')}\"`,\r\n-                `\"${safeString(log.UserId).replace(/\"/g, '\"\"')}\"`,\r\n-                `\"${safeString(log.Action).replace(/\"/g, '\"\"')}\"`,\r\n-                `\"${safeString(log.LogType).replace(/\"/g, '\"\"')}\"`,\r\n-            ].join(',')\r\n-        )\r\n-    ].join('\\n');\r\n-\r\n-    // Create a Blob and download link\r\n-    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n-    const link = document.createElement(\"a\");\r\n-    link.href = URL.createObjectURL(blob);\r\n-    link.download = \"access_logs.csv\";\r\n-    link.click();\r\n-}\r\n-\r\n-// ðŸ”‘ Updated Function to export logs to Excel (Fixed TypeError)\r\n-function exportToExcel() {\r\n-    if (currentAccessLogs.length === 0) return alert(\"No logs to export.\");\r\n-\r\n-    const headers = [\"Timestamp (UTC)\", \"User/Visitor ID\", \"Action\", \"Log Type\"];\r\n-    \r\n-    const excelContent = [\r\n-        headers.join('\\t'), // Use tab delimiter for simple Excel compatibility\r\n-        ...currentAccessLogs.map(log => \r\n-            [\r\n-                // ðŸŸ¢ FIX: Ensure values are strings\r\n-                safeString(new Date(log.TimestampUtc).toLocaleString()),\r\n-                safeString(log.UserId),\r\n-                safeString(log.Action),\r\n-                safeString(log.LogType),\r\n-            ].join('\\t')\r\n-        )\r\n-    ].join('\\n');\r\n-\r\n-    // Use application/vnd.ms-excel to suggest opening in Excel\r\n-    const blob = new Blob([excelContent], { type: 'application/vnd.ms-excel;charset=utf-8;' });\r\n-    const link = document.createElement(\"a\");\r\n-    link.href = URL.createObjectURL(blob);\r\n-    link.download = \"access_logs.xls\"; // Using .xls for compatibility suggestion\r\n-    link.click();\r\n-}\r\n-\r\n-\r\n-// ========================\r\n-// LOAD VISITOR REQUESTS (BACKEND) - KEPT FOR REFERENCE/MANUAL CALLS\r\n-// ========================\r\n-async function loadVisitorRequests() {\r\n-    try {\r\n-        // Path corrected in previous step: /api/visitorsaccess/requests\r\n-        const response = await fetch(`${API_HOST}/api/visitorsaccess/requests`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-\r\n-        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n-\r\n-        const visitors = await response.json();\r\n-        renderVisitorRequests(visitors);\r\n-\r\n-    } catch (err) {\r\n-        // ðŸ›‘ NOTE: This 403 error must be fixed on the server (check JWT validity/permissions).\r\n-        console.error(\"Visitor Requests Error:\", err);\r\n-    }\r\n-}\r\n-\r\n-function renderVisitorRequests(visitors) {\r\n-    const container = document.getElementById(\"visitorRequestList\");\r\n-    container.innerHTML = \"\";\r\n-    \r\n-    // NOTE: This function is superseded by loadVisitorsAccessForm when the tab is first clicked.\r\n-\r\n-    visitors.forEach(req => {\r\n-        const div = document.createElement(\"div\");\r\n-        div.className = \"p-2 border rounded flex justify-between items-center bg-white\";\r\n-\r\n-        div.innerHTML = `\r\n-            <span>${req.VisitorName} (ID: ${req.VisitorID}) â†’ Resident ${req.ResidentID}</span>\r\n-            <div>\r\n-                <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n-                <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n-            </div>\r\n-        `;\r\n-\r\n-        // Approve\r\n-        div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n-            try {\r\n-                const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/approve`, {\r\n-                    method: \"PUT\",\r\n-                    headers: { \"Authorization\": `Bearer ${token}` }\r\n-                });\r\n-                if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n-                loadVisitorRequests();\r\n-                loadaccesslogs();\r\n-            } catch (err) {\r\n-                console.error(\"Approve Error:\", err);\r\n-            }\r\n-        });\r\n-\r\n-        // Reject\r\n-        div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n-            try {\r\n-                const res = await fetch(`${API_HOST}/api/visitorsaccess/${req.VisitorID}/reject`, {\r\n-                    method: \"PUT\",\r\n-                    headers: { \"Authorization\": `Bearer ${token}` }\r\n-                });\r\n-                if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);\r\n-                loadVisitorRequests();\r\n-                loadaccesslogs();\r\n-            } catch (err) {\r\n-                console.error(\"Reject Error:\", err);\r\n-            }\r\n-        });\r\n-\r\n-        container.appendChild(div);\r\n-    });\r\n-}\r\n-\r\n-// ========================\r\n\\ No newline at end of file\n-// MANUAL GATE CONTROL\r\n-// ========================\r\n-document.getElementById(\"openGateBtn\").addEventListener(\"click\", async () => {\r\n-    const residentId = document.getElementById(\"gateResidentId\").value;\r\n-    const visitorId = document.getElementById(\"gateVisitorId\").value;\r\n-\r\n-    const target = visitorId || residentId;\r\n-    document.getElementById(\"gateStatus\").innerText = `Gate manually opened for ${target}`;\r\n-\r\n-    try {\r\n-        const response = await fetch(`${API_HOST}/api/access/manual-open`, {\r\n-            method: \"POST\",\r\n-            headers: {\r\n-                \"Content-Type\": \"application/json\",\r\n-                \"Authorization\": `Bearer ${token}`\r\n-            },\r\n-            body: JSON.stringify({ residentId, visitorId })\r\n-        });\r\n-        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);\r\n-        loadaccesslogs();\r\n-    } catch (err) {\r\n-        console.error(\"Manual Gate Error:\", err);\r\n-    }\r\n+// ================================\r\n+// Optional: Load first tab on page load\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    const firstBtn = sidebarButtons[0];\r\n+    if (firstBtn) firstBtn.click();\r\n });\r\n-\r\n-// ========================\r\n-// CHARTS\r\n-// ========================\r\n-function loadCharts() {\r\n-    const dailyCtx = document.getElementById(\"dailyAccessChart\").getContext(\"2d\");\r\n-    new Chart(dailyCtx, {\r\n-        type: \"bar\",\r\n-        data: {\r\n-            labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n-            datasets: [{ label: \"Daily Access\", data: [5, 7, 3, 6, 8, 4, 2] }]\r\n-        }\r\n-    });\r\n-\r\n-    const monthlyCtx = document.getElementById(\"monthlyAccessChart\").getContext(\"2d\");\r\n-    new Chart(monthlyCtx, {\r\n-        type: \"line\",\r\n-        data: {\r\n-            labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n-            datasets: [{ label: \"Monthly Access\", data: [120,140,110,150,165,180,190,160,140,150,170,180] }]\r\n-        }\r\n-    });\r\n-}\n"
                }
            ],
            "date": 1763863320945,
            "name": "Commit-0",
            "content": "const API_HOST = \"http://localhost:4050\";\r\nconst token = localStorage.getItem(\"token\");\r\n\r\n// ----------------------------\r\n// TAB SWITCHING\r\n// ----------------------------\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const tabButtons = document.querySelectorAll(\".tabBtn\");\r\n  const tabContents = document.querySelectorAll(\".tabContent\");\r\n\r\n  tabButtons.forEach(btn => {\r\n    btn.addEventListener(\"click\", () => {\r\n      const target = btn.dataset.tab;\r\n      tabContents.forEach(tc => tc.classList.add(\"hidden\"));\r\n      document.getElementById(target).classList.remove(\"hidden\");\r\n    });\r\n  });\r\n\r\n  loadAccessLogs();\r\n  loadVisitorRequests();\r\n  loadCharts();\r\n});\r\n\r\n// ----------------------------\r\n// BACKEND: LOAD ACCESS LOGS\r\n// ----------------------------\r\nasync function loadAccessLogs() {\r\n  try {\r\n    const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n      headers: { \"Authorization\": `Bearer ${token}` }\r\n    });\r\n\r\n    if (!response.ok) throw new Error(\"Unable to fetch logs\");\r\n\r\n    const logs = await response.json();\r\n    renderAccessLogs(logs);\r\n\r\n  } catch (err) {\r\n    console.error(\"Access Logs Error:\", err);\r\n  }\r\n}\r\n\r\nfunction renderAccessLogs(list) {\r\n  const tbody = document.getElementById(\"logsTableBody\");\r\n  tbody.innerHTML = \"\";\r\n\r\n  list.forEach((log, i) => {\r\n    const tr = document.createElement(\"tr\");\r\n    tr.innerHTML = `\r\n      <td class=\"p-2 border\">${i + 1}</td>\r\n      <td class=\"p-2 border\">${log.timestamp}</td>\r\n      <td class=\"p-2 border\">${log.userId ?? \"â€”\"}</td>\r\n      <td class=\"p-2 border\">${log.action}</td>\r\n      <td class=\"p-2 border\">${log.resource}</td>\r\n      <td class=\"p-2 border\">${log.ipAddress}</td>\r\n      <td class=\"p-2 border\">${log.userAgent}</td>\r\n      <td class=\"p-2 border\">${log.logType}</td>\r\n    `;\r\n    tbody.appendChild(tr);\r\n  });\r\n}\r\n\r\n// ----------------------------\r\n// BACKEND: VISITOR REQUESTS\r\n// ----------------------------\r\nasync function loadVisitorRequests() {\r\n  try {\r\n    const resp = await fetch(`${API_HOST}/api/visitors/pending`, {\r\n      headers: { \"Authorization\": `Bearer ${token}` }\r\n    });\r\n\r\n    const reqs = await resp.json();\r\n    renderVisitorRequests(reqs);\r\n\r\n  } catch (e) {\r\n    console.log(\"Visitor Request Error:\", e);\r\n  }\r\n}\r\n\r\nfunction renderVisitorRequests(data) {\r\n  const container = document.getElementById(\"visitorRequestList\");\r\n  container.innerHTML = \"\";\r\n\r\n  data.forEach(req => {\r\n    const div = document.createElement(\"div\");\r\n    div.className =\r\n      \"p-2 border rounded flex justify-between items-center bg-white\";\r\n\r\n    div.innerHTML = `\r\n      <span>${req.visitorName} (ID: ${req.visitorId}) â†’ Resident: ${req.residentId}</span>\r\n      <div>\r\n        <button class=\"approveBtn bg-green-600 text-white px-2 py-1 rounded mr-2\">Approve</button>\r\n        <button class=\"rejectBtn bg-red-600 text-white px-2 py-1 rounded\">Reject</button>\r\n      </div>\r\n    `;\r\n\r\n    // Approve\r\n    div.querySelector(\".approveBtn\").addEventListener(\"click\", async () => {\r\n      await fetch(`${API_HOST}/api/visitors/approve/${req.visitorId}`, {\r\n        method: \"POST\",\r\n        headers: { \"Authorization\": `Bearer ${token}` },\r\n      });\r\n\r\n      loadVisitorRequests();\r\n      loadAccessLogs();\r\n    });\r\n\r\n    // Reject\r\n    div.querySelector(\".rejectBtn\").addEventListener(\"click\", async () => {\r\n      await fetch(`${API_HOST}/api/visitors/reject/${req.visitorId}`, {\r\n        method: \"POST\",\r\n        headers: { \"Authorization\": `Bearer ${token}` },\r\n      });\r\n\r\n      loadVisitorRequests();\r\n      loadAccessLogs();\r\n    });\r\n\r\n    container.appendChild(div);\r\n  });\r\n}\r\n\r\n// ----------------------------\r\n// CHARTS\r\n// ----------------------------\r\nfunction loadCharts() {\r\n  new Chart(document.getElementById(\"dailyAccessChart\"), {\r\n    type: \"bar\",\r\n    data: {\r\n      labels: [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"],\r\n      datasets: [{ label: \"Access Attempts\", data: [5, 7, 3, 8, 6, 4, 2] }]\r\n    }\r\n  });\r\n\r\n  new Chart(document.getElementById(\"monthlyAccessChart\"), {\r\n    type: \"line\",\r\n    data: {\r\n      labels: [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\r\n      datasets: [{ label: \"Access Attempts\", data: [120,130,110,150,160,170,165,140,120,155,160,170] }]\r\n    }\r\n  });\r\n}\r\n"
        }
    ]
}