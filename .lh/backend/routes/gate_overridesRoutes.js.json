{
    "sourceFile": "backend/routes/gate_overridesRoutes.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1763951167367,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763951659455,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,11 +1,64 @@\n-// routes/gateOverridesRoutes.js\n-import express from \"express\";\n-import { getGateOverrides } from \"../controllers/gateOverridesController.js\";\n-import { authenticateJWT } from \"../middleware/authMiddleware.js\";\n+// js/gate_overrides.js\n \n-const router = express.Router();\n+const API_HOST = \"http://localhost:4050\";\n \n-// PROTECTED ROUTE\n-router.get(\"/\", authenticateJWT, getGateOverrides);\n+const ENDPOINTS = {\n+    GATE_OVERRIDES: `${API_HOST}/api/gate-overrides`,\n+};\n \n-export default router;\n+document.addEventListener(\"DOMContentLoaded\", () => {\n+    loadGateOverrideLogs();\n+});\n+\n+async function loadGateOverrideLogs() {\n+    try {\n+        const res = await fetch(ENDPOINTS.GATE_OVERRIDES, {\n+            method: \"GET\",\n+            headers: {\n+                \"Authorization\": `Bearer ${localStorage.getItem(\"accessToken\")}`,\n+                \"Content-Type\": \"application/json\"\n+            }\n+        });\n+\n+        if (!res.ok) throw new Error(\"Failed to fetch gate override logs\");\n+\n+        const logs = await res.json();\n+        renderLogs(logs);\n+\n+    } catch (error) {\n+        console.error(\"Error loading gate override logs:\", error);\n+    }\n+}\n+\n+function formatTimestamp(ts) {\n+    const d = new Date(ts);\n+    return `${d.toLocaleDateString()} ${d.toLocaleTimeString()}`;\n+}\n+\n+function renderLogs(logs) {\n+    const tableBody = document.getElementById(\"gateOverrideTableBody\");\n+    tableBody.innerHTML = \"\";\n+\n+    if (!logs.length) {\n+        tableBody.innerHTML = `\n+            <tr>\n+                <td colspan=\"6\" class=\"text-center text-gray-500 py-4\">No gate override logs found.</td>\n+            </tr>\n+        `;\n+        return;\n+    }\n+\n+    logs.forEach(log => {\n+        const row = `\n+            <tr class=\"border-b\">\n+                <td class=\"px-4 py-2\">${log.id}</td>\n+                <td class=\"px-4 py-2\">${log.gateId}</td>\n+                <td class=\"px-4 py-2\">${log.action}</td>\n+                <td class=\"px-4 py-2\">${log.reason || \"—\"}</td>\n+                <td class=\"px-4 py-2\">${log.userId}</td>\n+                <td class=\"px-4 py-2\">${formatTimestamp(log.createdAt)}</td>\n+            </tr>\n+        `;\n+        tableBody.innerHTML += row;\n+    });\n+}\n"
                },
                {
                    "date": 1763952237992,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,64 +1,26 @@\n-// js/gate_overrides.js\n+// gateOverridesRoutes.js\n+import express from \"express\";\n+import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n+import {\n+    getGateOverrideLogs,\n+    performManualOverride\n+} from \"../controllers/gateOverrideController.js\";\n \n-const API_HOST = \"http://localhost:4050\";\n+const router = express.Router();\n \n-const ENDPOINTS = {\n-    GATE_OVERRIDES: `${API_HOST}/api/gate-overrides`,\n-};\n+// ================================\n+// GET: All gate override logs\n+// Access: JWT + Admin only\n+// Endpoint: GET /api/admin/override/logs\n+// ================================\n+router.get(\"/logs\", authenticateJWT, isAdmin, getGateOverrideLogs);\n \n-document.addEventListener(\"DOMContentLoaded\", () => {\n-    loadGateOverrideLogs();\n-});\n+// ================================\n+// POST: Perform a manual gate override\n+// Access: JWT + Admin only\n+// Endpoint: POST /api/admin/override/action\n+// Body: { gateId, action, reason, userId }\n+// ================================\n+router.post(\"/action\", authenticateJWT, isAdmin, performManualOverride);\n \n-async function loadGateOverrideLogs() {\n-    try {\n-        const res = await fetch(ENDPOINTS.GATE_OVERRIDES, {\n-            method: \"GET\",\n-            headers: {\n-                \"Authorization\": `Bearer ${localStorage.getItem(\"accessToken\")}`,\n-                \"Content-Type\": \"application/json\"\n-            }\n-        });\n-\n-        if (!res.ok) throw new Error(\"Failed to fetch gate override logs\");\n-\n-        const logs = await res.json();\n-        renderLogs(logs);\n-\n-    } catch (error) {\n-        console.error(\"Error loading gate override logs:\", error);\n-    }\n-}\n-\n-function formatTimestamp(ts) {\n-    const d = new Date(ts);\n-    return `${d.toLocaleDateString()} ${d.toLocaleTimeString()}`;\n-}\n-\n-function renderLogs(logs) {\n-    const tableBody = document.getElementById(\"gateOverrideTableBody\");\n-    tableBody.innerHTML = \"\";\n-\n-    if (!logs.length) {\n-        tableBody.innerHTML = `\n-            <tr>\n-                <td colspan=\"6\" class=\"text-center text-gray-500 py-4\">No gate override logs found.</td>\n-            </tr>\n-        `;\n-        return;\n-    }\n-\n-    logs.forEach(log => {\n-        const row = `\n-            <tr class=\"border-b\">\n-                <td class=\"px-4 py-2\">${log.id}</td>\n-                <td class=\"px-4 py-2\">${log.gateId}</td>\n-                <td class=\"px-4 py-2\">${log.action}</td>\n-                <td class=\"px-4 py-2\">${log.reason || \"—\"}</td>\n-                <td class=\"px-4 py-2\">${log.userId}</td>\n-                <td class=\"px-4 py-2\">${formatTimestamp(log.createdAt)}</td>\n-            </tr>\n-        `;\n-        tableBody.innerHTML += row;\n-    });\n-}\n+export default router;\n"
                }
            ],
            "date": 1763951167367,
            "name": "Commit-0",
            "content": "// routes/gateOverridesRoutes.js\nimport express from \"express\";\nimport { getGateOverrides } from \"../controllers/gateOverridesController.js\";\nimport { authenticateJWT } from \"../middleware/authMiddleware.js\";\n\nconst router = express.Router();\n\n// PROTECTED ROUTE\nrouter.get(\"/\", authenticateJWT, getGateOverrides);\n\nexport default router;\n"
        }
    ]
}