{
    "sourceFile": "frontend/payments.html",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 16,
            "patches": [
                {
                    "date": 1763589840006,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763589873050,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,140 +1,151 @@\n-<!-- HEADER -->\n-<div id=\"header\" class=\"bg-indigo-800 text-white p-2 flex justify-between items-center text-sm\">\n-      <h1 class=\"text-lg font-semibold\">Athi Estate Payments Dashboard</h1>\n-      <button id=\"logoutBtn\" class=\"bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-xs\">Logout</button>\n-</div>\n+<!DOCTYPE html>\n+<html lang=\"en\">\n+<head>\n+ <meta charset=\"UTF-8\" />\n+ <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n+ <title>Athi Estate | Payments</title>\n+ <script src=\"https://cdn.tailwindcss.com\"></script>\n+ <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n+</head>\n+<body class=\"bg-gray-100 text-gray-800 flex flex-col h-screen overflow-hidden\">\n \n-<!-- DASHBOARD SUMMARY -->\n-<section id=\"dashboardSummary\" class=\"p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs mb-2 w-full\"></section>\n+  <!-- HEADER -->\n+  <div id=\"header\" class=\"bg-indigo-800 text-white p-2 flex justify-between items-center text-sm\">\n+        <h1 class=\"text-lg font-semibold\">Athi Estate Payments Dashboard</h1>\n+        <button id=\"logoutBtn\" class=\"bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-xs\">Logout</button>\n+  </div>\n \n-<main class=\"flex-1 overflow-auto p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs w-full\">\n+  <!-- DASHBOARD SUMMARY -->\n+  <section id=\"dashboardSummary\" class=\"p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs mb-2 w-full\"></section>\n \n-  <!-- MAKE PAYMENT -->\n-  <section class=\"bg-white rounded-xl shadow p-2 col-span-1 flex flex-col\">\n-    <h2 class=\"text-indigo-700 font-bold mb-1 text-sm\">ðŸ’³ Make Payment</h2>\n-    <form id=\"makePaymentForm\" class=\"space-y-1 flex-1 flex flex-col justify-between\">\n-        <div id=\"residentDiv\">\n-            <label for=\"residentId\" class=\"block mb-1\">Resident ID</label>\n-            <select id=\"residentId\" required class=\"w-full border rounded px-1 py-1 text-xs\">\n-                <option value=\"\">Select Resident ID</option>\n-            </select>\n-        </div>\n-        <div>\n-            <label for=\"amount\" class=\"block mb-1\">Amount (KSh)</label>\n-            <input id=\"amount\" type=\"number\" step=\"0.01\" required class=\"w-full border rounded px-1 py-1 text-xs\"/>\n-        </div>\n-        <div>\n-            <label for=\"paymentMethod\" class=\"block mb-1\">Payment Method</label>\n-            <select id=\"paymentMethod\" required class=\"w-full border rounded px-1 py-1 text-xs\">\n-                <option value=\"\">Select</option>\n-                <option value=\"Mpesa\">Mpesa</option>\n-                <option value=\"Bank Transfer\">Bank Transfer</option>\n-                <option value=\"Cash\">Cash</option>\n-            </select>\n-        </div>\n-        <div>\n-            <label for=\"reference\" class=\"block mb-1\">Reference</label>\n-            <input id=\"reference\" type=\"text\" placeholder=\"e.g. MPESA1234\" required class=\"w-full border rounded px-1 py-1 text-xs\"/>\n-        </div>\n-        <button type=\"submit\" class=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-1 rounded text-xs mt-1\">Submit Payment</button>\n-    </form>\n-    <div id=\"msg\" class=\"text-gray-700 mt-1 text-xs\"></div>\n-  </section>\n+  <main class=\"flex-1 overflow-auto p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs w-full\">\n \n-  <!-- PAYMENT HISTORY -->\n-  <section class=\"bg-white rounded-xl shadow p-2 col-span-2 flex flex-col\">\n-    <h3 class=\"text-indigo-700 font-semibold mb-1 text-sm\">ðŸ“‹ Payment History</h3>\n-    <div class=\"flex justify-between mb-1 text-xs\">\n-        <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n-        <div class=\"space-x-1\">\n-            <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-            <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n-        </div>\n-    </div>\n-    <div class=\"overflow-auto max-h-60 border rounded\">\n-        <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n-            <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0\">\n-                <tr>\n-                    <th class=\"px-1 py-0.5 text-left\">PaymentID</th>\n-                    <th class=\"px-1 py-0.5 text-left\">ResidentID</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Amount</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Payment Date</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Status</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Reference</th>\n-                    <th class=\"px-1 py-0.5 text-left\">PaymentMethod</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Action</th>\n-                    <th class=\"px-1 py-0.5 text-left\">NationalID</th>\n-                    <th class=\"px-1 py-0.5 text-left\">serviceName</th>\n-                    <th class=\"px-1 py-0.5 text-left\">phoneNumber</th>\n-                    <th class=\"px-1 py-0.5 text-left\">VerifiedDate</th>\n-                </tr>\n-            </thead>\n-            <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-200\"></tbody>\n-        </table>\n-    </div>\n-  </section>\n+    <!-- MAKE PAYMENT -->\n+    <section class=\"bg-white rounded-xl shadow p-2 col-span-1 flex flex-col\">\n+      <h2 class=\"text-indigo-700 font-bold mb-1 text-sm\">ðŸ’³ Make Payment</h2>\n+      <form id=\"makePaymentForm\" class=\"space-y-1 flex-1 flex flex-col justify-between\">\n+          <div id=\"residentDiv\">\n+              <label for=\"residentId\" class=\"block mb-1\">Resident ID</label>\n+              <select id=\"residentId\" required class=\"w-full border rounded px-1 py-1 text-xs\">\n+                  <option value=\"\">Select Resident ID</option>\n+              </select>\n+          </div>\n+          <div>\n+              <label for=\"amount\" class=\"block mb-1\">Amount (KSh)</label>\n+              <input id=\"amount\" type=\"number\" step=\"0.01\" required class=\"w-full border rounded px-1 py-1 text-xs\"/>\n+          </div>\n+          <div>\n+              <label for=\"paymentMethod\" class=\"block mb-1\">Payment Method</label>\n+              <select id=\"paymentMethod\" required class=\"w-full border rounded px-1 py-1 text-xs\">\n+                  <option value=\"\">Select</option>\n+                  <option value=\"Mpesa\">Mpesa</option>\n+                  <option value=\"Bank Transfer\">Bank Transfer</option>\n+                  <option value=\"Cash\">Cash</option>\n+              </select>\n+          </div>\n+          <div>\n+              <label for=\"reference\" class=\"block mb-1\">Reference</label>\n+              <input id=\"reference\" type=\"text\" placeholder=\"e.g. MPESA1234\" required class=\"w-full border rounded px-1 py-1 text-xs\"/>\n+          </div>\n+          <button type=\"submit\" class=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-1 rounded text-xs mt-1\">Submit Payment</button>\n+      </form>\n+      <div id=\"msg\" class=\"text-gray-700 mt-1 text-xs\"></div>\n+    </section>\n \n-  <!-- VERIFIED PAYMENTS -->\n-  <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n-    <h3 class=\"text-green-700 font-semibold mb-1 text-sm\">âœ… Verified Payments</h3>\n-    <div class=\"flex justify-between mb-1 text-xs\">\n-        <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n-        <div class=\"space-x-1\">\n-            <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-            <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n-        </div>\n-    </div>\n-    <div class=\"overflow-auto max-h-40 border rounded\">\n-        <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n-            <thead class=\"bg-green-100 text-green-800 sticky top-0\">\n-                <tr>\n-                    <th class=\"px-1 py-0.5 text-left\">Resident</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Amount</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Reference</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Verified Date</th>\n-                </tr>\n-            </thead>\n-            <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-200\"></tbody>\n-        </table>\n-    </div>\n-  </section>\n+    <!-- PAYMENT HISTORY -->\n+    <section class=\"bg-white rounded-xl shadow p-2 col-span-2 flex flex-col\">\n+      <h3 class=\"text-indigo-700 font-semibold mb-1 text-sm\">ðŸ“‹ Payment History</h3>\n+      <div class=\"flex justify-between mb-1 text-xs\">\n+          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n+          <div class=\"space-x-1\">\n+              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n+              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+          </div>\n+      </div>\n+      <div class=\"overflow-auto max-h-60 border rounded\">\n+          <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0\">\n+                  <tr>\n+                      <th class=\"px-1 py-0.5 text-left\">PaymentID</th>\n+                      <th class=\"px-1 py-0.5 text-left\">ResidentID</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Amount</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Payment Date</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Status</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Reference</th>\n+                      <th class=\"px-1 py-0.5 text-left\">PaymentMethod</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Action</th>\n+                      <th class=\"px-1 py-0.5 text-left\">NationalID</th>\n+                      <th class=\"px-1 py-0.5 text-left\">serviceName</th>\n+                      <th class=\"px-1 py-0.5 text-left\">phoneNumber</th>\n+                      <th class=\"px-1 py-0.5 text-left\">VerifiedDate  </th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-200\"></tbody>\n+          </table>\n+      </div>\n+    </section>\n \n-  <!-- BALANCES -->\n-  <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n-    <h3 class=\"text-yellow-700 font-semibold mb-1 text-sm\">ðŸ’° Balances</h3>\n-    <div class=\"flex justify-end mb-1 text-xs space-x-1\">\n-        <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-        <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n-    </div>\n-    <div class=\"overflow-auto max-h-40 border rounded\">\n-        <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n-            <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n-                <tr>\n-                    <th class=\"px-1 py-0.5 text-left\">Resident</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Total Paid</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Total Due</th>\n-                    <th class=\"px-1 py-0.5 text-left\">Balance</th>\n-                </tr>\n-            </thead>\n-            <tbody id=\"balanceBody\" class=\"divide-y divide-gray-200\"></tbody>\n-        </table>\n-    </div>\n-  </section>\n+    <!-- VERIFIED PAYMENTS -->\n+    <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n+      <h3 class=\"text-green-700 font-semibold mb-1 text-sm\">âœ… Verified Payments</h3>\n+      <div class=\"flex justify-between mb-1 text-xs\">\n+          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n+          <div class=\"space-x-1\">\n+              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n+              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+          </div>\n+      </div>\n+      <div class=\"overflow-auto max-h-40 border rounded\">\n+          <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-green-100 text-green-800 sticky top-0\">\n+                  <tr>\n+                      <th class=\"px-1 py-0.5 text-left\">Resident</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Amount</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Reference</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Verified Date</th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-200\"></tbody>\n+          </table>\n+      </div>\n+    </section>\n \n-  <!-- MPESA PAYMENT -->\n-  <section class=\"bg-white p-4 rounded-xl shadow col-span-3\">\n-    <h2 class=\"text-indigo-700 font-bold mb-2 text-sm\">ðŸ’³ MPESA Payment</h2>\n-    <div class=\"flex flex-col space-y-2 max-w-sm\">\n-        <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g Estate Registration)\" class=\"border p-2 rounded\"/>\n-        <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount\" class=\"border p-2 rounded\"/>\n-        <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-2 rounded\"/>\n-        <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded\">Pay Now</button>\n-        <div id=\"paymentResult\" class=\"text-xs mt-1\"></div>\n-    </div>\n-  </section>\n+    <!-- BALANCES -->\n+    <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n+      <h3 class=\"text-yellow-700 font-semibold mb-1 text-sm\">ðŸ’° Balances</h3>\n+      <div class=\"flex justify-end mb-1 text-xs space-x-1\">\n+          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n+          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+      </div>\n+      <div class=\"overflow-auto max-h-40 border rounded\">\n+          <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n+                  <tr>\n+                      <th class=\"px-1 py-0.5 text-left\">Resident</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Total Paid</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Total Due</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Balance</th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-200\"></tbody>\n+          </table>\n+      </div>\n+    </section>\n \n-</main>\n+    <!-- MPESA PAYMENT -->\n+    <section class=\"bg-white p-4 rounded-xl shadow col-span-3\">\n+      <h2 class=\"text-indigo-700 font-bold mb-2 text-sm\">ðŸ’³ MPESA Payment</h2>\n+      <div class=\"flex flex-col space-y-2 max-w-sm\">\n+          <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g Estate Registration)\" class=\"border p-2 rounded\"/>\n+          <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount\" class=\"border p-2 rounded\"/>\n+          <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-2 rounded\"/>\n+          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded\">Pay Now</button>\n+          <div id=\"paymentResult\" class=\"text-xs mt-1\"></div>\n+      </div>\n+    </section>\n \n-<script src=\"js/payment.js\"></script>\n-<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n-<script src=\"https://cdn.tailwindcss.com\"></script>\n+  </main>\n+\n+  <script src=\"js/payment.js\"></script>\n+</body>\n+</html>\n"
                },
                {
                    "date": 1763621023571,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,35 +19,20 @@\n   <section id=\"dashboardSummary\" class=\"p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs mb-2 w-full\"></section>\n \n   <main class=\"flex-1 overflow-auto p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs w-full\">\n \n-    <!-- MAKE PAYMENT -->\n-    <section class=\"bg-white rounded-xl shadow p-2 col-span-1 flex flex-col\">\n-      <h2 class=\"text-indigo-700 font-bold mb-1 text-sm\">ðŸ’³ Make Payment</h2>\n-      <form id=\"makePaymentForm\" class=\"space-y-1 flex-1 flex flex-col justify-between\">\n-          <div id=\"residentDiv\">\n-              <label for=\"residentId\" class=\"block mb-1\">Resident ID</label>\n-              <select id=\"residentId\" required class=\"w-full border rounded px-1 py-1 text-xs\">\n-                  <option value=\"\">Select Resident ID</option>\n-              </select>\n-          </div>\n-          <div>\n-              <label for=\"amount\" class=\"block mb-1\">Amount (KSh)</label>\n-              <input id=\"amount\" type=\"number\" step=\"0.01\" required class=\"w-full border rounded px-1 py-1 text-xs\"/>\n-          </div>\n-          <div>\n-              <label for=\"paymentMethod\" class=\"block mb-1\">Payment Method</label>\n-              <select id=\"paymentMethod\" required class=\"w-full border rounded px-1 py-1 text-xs\">\n-                  <option value=\"\">Select</option>\n-                  <option value=\"Mpesa\">Mpesa</option>\n-                  <option value=\"Bank Transfer\">Bank Transfer</option>\n-                  <option value=\"Cash\">Cash</option>\n-              </select>\n-          </div>\n-          <div>\n-              <label for=\"reference\" class=\"block mb-1\">Reference</label>\n-              <input id=\"reference\" type=\"text\" placeholder=\"e.g. MPESA1234\" required class=\"w-full border rounded px-1 py-1 text-xs\"/>\n-          </div>\n+      <!-- MPESA PAYMENT -->\n+    <section class=\"bg-white p-4 rounded-xl shadow col-span-3\">\n+      <h2 class=\"text-indigo-700 font-bold mb-2 text-sm\">ðŸ’³ MPESA Payment</h2>\n+      <div class=\"flex flex-col space-y-2 max-w-sm\">\n+          <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g Estate Registration)\" class=\"border p-2 rounded\"/>\n+          <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount\" class=\"border p-2 rounded\"/>\n+          <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-2 rounded\"/>\n+          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded\">Pay Now</button>\n+          <div id=\"paymentResult\" class=\"text-xs mt-1\"></div>\n+      </div>\n+    </section>\n+\n           <button type=\"submit\" class=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-1 rounded text-xs mt-1\">Submit Payment</button>\n       </form>\n       <div id=\"msg\" class=\"text-gray-700 mt-1 text-xs\"></div>\n     </section>\n@@ -83,9 +68,8 @@\n               <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-200\"></tbody>\n           </table>\n       </div>\n     </section>\n-\n     <!-- VERIFIED PAYMENTS -->\n     <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n       <h3 class=\"text-green-700 font-semibold mb-1 text-sm\">âœ… Verified Payments</h3>\n       <div class=\"flex justify-between mb-1 text-xs\">\n@@ -130,22 +114,8 @@\n               <tbody id=\"balanceBody\" class=\"divide-y divide-gray-200\"></tbody>\n           </table>\n       </div>\n     </section>\n-\n-    <!-- MPESA PAYMENT -->\n-    <section class=\"bg-white p-4 rounded-xl shadow col-span-3\">\n-      <h2 class=\"text-indigo-700 font-bold mb-2 text-sm\">ðŸ’³ MPESA Payment</h2>\n-      <div class=\"flex flex-col space-y-2 max-w-sm\">\n-          <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g Estate Registration)\" class=\"border p-2 rounded\"/>\n-          <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount\" class=\"border p-2 rounded\"/>\n-          <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-2 rounded\"/>\n-          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded\">Pay Now</button>\n-          <div id=\"paymentResult\" class=\"text-xs mt-1\"></div>\n-      </div>\n-    </section>\n-\n-  </main>\n-\n+    </main>\n   <script src=\"js/payment.js\"></script>\n </body>\n </html>\n"
                },
                {
                    "date": 1763621079374,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,13 +8,8 @@\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n </head>\n <body class=\"bg-gray-100 text-gray-800 flex flex-col h-screen overflow-hidden\">\n \n-  <!-- HEADER -->\n-  <div id=\"header\" class=\"bg-indigo-800 text-white p-2 flex justify-between items-center text-sm\">\n-        <h1 class=\"text-lg font-semibold\">Athi Estate Payments Dashboard</h1>\n-        <button id=\"logoutBtn\" class=\"bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-xs\">Logout</button>\n-  </div>\n \n   <!-- DASHBOARD SUMMARY -->\n   <section id=\"dashboardSummary\" class=\"p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs mb-2 w-full\"></section>\n \n"
                },
                {
                    "date": 1763622419028,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -99,9 +99,9 @@\n       <div class=\"overflow-auto max-h-40 border rounded\">\n           <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n               <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n                   <tr>\n-                      <th class=\"px-1 py-0.5 text-left\">Resident</th>\n+                      <th class=\"px-1 py-0.5 text-left\">ResidentName</th>\n                       <th class=\"px-1 py-0.5 text-left\">Total Paid</th>\n                       <th class=\"px-1 py-0.5 text-left\">Total Due</th>\n                       <th class=\"px-1 py-0.5 text-left\">Balance</th>\n                   </tr>\n"
                },
                {
                    "date": 1763626744192,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,116 +1,124 @@\n+<!-- admin-payments.html -->\n <!DOCTYPE html>\n <html lang=\"en\">\n <head>\n- <meta charset=\"UTF-8\" />\n- <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n- <title>Athi Estate | Payments</title>\n- <script src=\"https://cdn.tailwindcss.com\"></script>\n- <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n+    <meta charset=\"UTF-8\">\n+    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+    <title>Admin Payments | Estate Access</title>\n+    <script src=\"https://cdn.tailwindcss.com\"></script>\n+    <style>\n+        body { font-family: 'Inter', sans-serif; background-color: #f4f7f9; }\n+        .data-table th, .data-table td { padding: 4px; }\n+    </style>\n </head>\n-<body class=\"bg-gray-100 text-gray-800 flex flex-col h-screen overflow-hidden\">\n+<body class=\"flex flex-col min-h-screen\">\n+    <!-- REQUIRED SCRIPTS -->\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js\"></script>\n+    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n \n \n-  <!-- DASHBOARD SUMMARY -->\n-  <section id=\"dashboardSummary\" class=\"p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs mb-2 w-full\"></section>\n+    <!-- DASHBOARD SUMMARY (Cards at the top) -->\n+    <section id=\"dashboardSummary\" class=\"p-4 max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4 text-sm w-full\"></section>\n \n-  <main class=\"flex-1 overflow-auto p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs w-full\">\n+    <main class=\"flex-1 overflow-auto p-4 max-w-7xl mx-auto space-y-4 w-full\">\n \n-      <!-- MPESA PAYMENT -->\n-    <section class=\"bg-white p-4 rounded-xl shadow col-span-3\">\n-      <h2 class=\"text-indigo-700 font-bold mb-2 text-sm\">ðŸ’³ MPESA Payment</h2>\n-      <div class=\"flex flex-col space-y-2 max-w-sm\">\n-          <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g Estate Registration)\" class=\"border p-2 rounded\"/>\n-          <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount\" class=\"border p-2 rounded\"/>\n-          <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-2 rounded\"/>\n-          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded\">Pay Now</button>\n-          <div id=\"paymentResult\" class=\"text-xs mt-1\"></div>\n-      </div>\n-    </section>\n+        <!-- MPESA PAYMENT SECTION -->\n+        <section class=\"bg-white p-6 rounded-xl shadow-lg col-span-3\">\n+            <h2 class=\"text-indigo-700 font-extrabold mb-4 text-xl border-b pb-2\">ðŸ’³ Initiate MPESA Payment (Admin)</h2>\n+            <div class=\"flex flex-col space-y-3 max-w-md\">\n+                <input type=\"number\" id=\"residentIdInput\" placeholder=\"Resident ID\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500\"/>\n+                <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g. Monthly Dues)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500\"/>\n+                <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount (e.g. 5000.00)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500\"/>\n+                <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500\"/>\n+                <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-3 rounded-lg shadow-md transition duration-200\">Initiate Payment</button>\n+                <div id=\"paymentResult\" class=\"text-sm mt-2 p-3 rounded-lg hidden\"></div>\n+            </div>\n+        </section>\n \n-          <button type=\"submit\" class=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-1 rounded text-xs mt-1\">Submit Payment</button>\n-      </form>\n-      <div id=\"msg\" class=\"text-gray-700 mt-1 text-xs\"></div>\n-    </section>\n+        <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n+            <!-- PAYMENT HISTORY (Pending & Verified) -->\n+            <section class=\"bg-white rounded-xl shadow-lg p-4 col-span-2 flex flex-col\">\n+                <h3 class=\"text-indigo-700 font-extrabold mb-3 text-xl border-b pb-2\">ðŸ“‹ Payment History (Pending/Verified)</h3>\n+                <div class=\"flex justify-between items-center mb-3 text-sm\">\n+                    <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID/Name...\" class=\"border rounded-lg px-3 py-1.5 focus:ring-indigo-500 focus:border-indigo-500\"/>\n+                    <div class=\"space-x-2\">\n+                        <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white font-medium\">Export CSV</button>\n+                        <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white font-medium\">Export Excel</button>\n+                    </div>\n+                </div>\n+                <div class=\"overflow-x-auto border rounded-lg shadow-inner\">\n+                    <table id=\"paymentsTable\" class=\"min-w-full text-xs data-table\">\n+                        <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0\">\n+                            <tr>\n+                                <th class=\"px-3 py-2 text-left\">ID</th>\n+                                <th class=\"px-3 py-2 text-left\">Res.ID</th>\n+                                <th class=\"px-3 py-2 text-left\">Resident Name</th>\n+                                <th class=\"px-3 py-2 text-left\">Amount (KES)</th>\n+                                <th class=\"px-3 py-2 text-left\">Date</th>\n+                                <th class=\"px-3 py-2 text-left\">Status</th>\n+                                <th class=\"px-3 py-2 text-left\">Method</th>\n+                                <th class=\"px-3 py-2 text-left\">Phone</th>\n+                                <th class=\"px-3 py-2 text-left\">Action</th>\n+                            </tr>\n+                        </thead>\n+                        <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\"></tbody>\n+                    </table>\n+                </div>\n+            </section>\n \n-    <!-- PAYMENT HISTORY -->\n-    <section class=\"bg-white rounded-xl shadow p-2 col-span-2 flex flex-col\">\n-      <h3 class=\"text-indigo-700 font-semibold mb-1 text-sm\">ðŸ“‹ Payment History</h3>\n-      <div class=\"flex justify-between mb-1 text-xs\">\n-          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n-          <div class=\"space-x-1\">\n-              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n-          </div>\n-      </div>\n-      <div class=\"overflow-auto max-h-60 border rounded\">\n-          <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0\">\n-                  <tr>\n-                      <th class=\"px-1 py-0.5 text-left\">PaymentID</th>\n-                      <th class=\"px-1 py-0.5 text-left\">ResidentID</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Amount</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Payment Date</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Status</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Reference</th>\n-                      <th class=\"px-1 py-0.5 text-left\">PaymentMethod</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Action</th>\n-                      <th class=\"px-1 py-0.5 text-left\">NationalID</th>\n-                      <th class=\"px-1 py-0.5 text-left\">serviceName</th>\n-                      <th class=\"px-1 py-0.5 text-left\">phoneNumber</th>\n-                      <th class=\"px-1 py-0.5 text-left\">VerifiedDate  </th>\n-                  </tr>\n-              </thead>\n-              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-200\"></tbody>\n-          </table>\n-      </div>\n-    </section>\n-    <!-- VERIFIED PAYMENTS -->\n-    <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n-      <h3 class=\"text-green-700 font-semibold mb-1 text-sm\">âœ… Verified Payments</h3>\n-      <div class=\"flex justify-between mb-1 text-xs\">\n-          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n-          <div class=\"space-x-1\">\n-              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n-          </div>\n-      </div>\n-      <div class=\"overflow-auto max-h-40 border rounded\">\n-          <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-green-100 text-green-800 sticky top-0\">\n-                  <tr>\n-                      <th class=\"px-1 py-0.5 text-left\">Resident</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Amount</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Reference</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Verified Date</th>\n-                  </tr>\n-              </thead>\n-              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-200\"></tbody>\n-          </table>\n-      </div>\n-    </section>\n+            <!-- BALANCES -->\n+            <section class=\"bg-white rounded-xl shadow-lg p-4 col-span-1 flex flex-col\">\n+                <h3 class=\"text-yellow-700 font-extrabold mb-3 text-xl border-b pb-2\">ðŸ’° Resident Balances</h3>\n+                <div class=\"flex justify-end mb-3 text-sm space-x-2\">\n+                    <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white font-medium\">CSV</button>\n+                    <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white font-medium\">Excel</button>\n+                </div>\n+                <div class=\"overflow-x-auto border rounded-lg shadow-inner\">\n+                    <table id=\"balanceTable\" class=\"min-w-full text-xs data-table\">\n+                        <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n+                            <tr>\n+                                <th class=\"px-3 py-2 text-left\">Res. Name</th>\n+                                <th class=\"px-3 py-2 text-left\">Paid</th>\n+                                <th class=\"px-3 py-2 text-left\">Due</th>\n+                                <th class=\"px-3 py-2 text-left\">Balance</th>\n+                            </tr>\n+                        </thead>\n+                        <tbody id=\"balanceBody\" class=\"divide-y divide-gray-100\"></tbody>\n+                    </table>\n+                </div>\n+            </section>\n+        </div>\n+        \n+        <!-- VERIFIED PAYMENTS (Separate list for clarity) -->\n+        <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col\">\n+            <h3 class=\"text-green-700 font-extrabold mb-3 text-xl border-b pb-2\">âœ… Verified Payment Log</h3>\n+            <div class=\"flex justify-between items-center mb-3 text-sm\">\n+                <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter verified by Resident ID/Name...\" class=\"border rounded-lg px-3 py-1.5 focus:ring-green-500 focus:border-green-500\"/>\n+                <div class=\"space-x-2\">\n+                    <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white font-medium\">CSV</button>\n+                    <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white font-medium\">Excel</button>\n+                </div>\n+            </div>\n+            <div class=\"overflow-x-auto max-h-96 border rounded-lg shadow-inner\">\n+                <table id=\"verifiedTable\" class=\"min-w-full text-xs data-table\">\n+                    <thead class=\"bg-green-100 text-green-800 sticky top-0\">\n+                        <tr>\n+                            <th class=\"px-3 py-2 text-left\">ID</th>\n+                            <th class=\"px-3 py-2 text-left\">Resident Name</th>\n+                            <th class=\"px-3 py-2 text-left\">Amount (KES)</th>\n+                            <th class=\"px-3 py-2 text-left\">Reference</th>\n+                            <th class=\"px-3 py-2 text-left\">Verified Date</th>\n+                            <th class=\"px-3 py-2 text-left\">Receipt No.</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-100\"></tbody>\n+                </table>\n+            </div>\n+        </section>\n \n-    <!-- BALANCES -->\n-    <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n-      <h3 class=\"text-yellow-700 font-semibold mb-1 text-sm\">ðŸ’° Balances</h3>\n-      <div class=\"flex justify-end mb-1 text-xs space-x-1\">\n-          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n-      </div>\n-      <div class=\"overflow-auto max-h-40 border rounded\">\n-          <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n-                  <tr>\n-                      <th class=\"px-1 py-0.5 text-left\">ResidentName</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Total Paid</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Total Due</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Balance</th>\n-                  </tr>\n-              </thead>\n-              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-200\"></tbody>\n-          </table>\n-      </div>\n-    </section>\n     </main>\n-  <script src=\"js/payment.js\"></script>\n+\n+    <!-- SCRIPT -->\n+    <script src=\"/js/payment.js\"></script>\n </body>\n-</html>\n+</html>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763626835534,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,124 +1,116 @@\n-<!-- admin-payments.html -->\n <!DOCTYPE html>\n <html lang=\"en\">\n <head>\n-    <meta charset=\"UTF-8\">\n-    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n-    <title>Admin Payments | Estate Access</title>\n-    <script src=\"https://cdn.tailwindcss.com\"></script>\n-    <style>\n-        body { font-family: 'Inter', sans-serif; background-color: #f4f7f9; }\n-        .data-table th, .data-table td { padding: 4px; }\n-    </style>\n+ <meta charset=\"UTF-8\" />\n+ <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n+ <title>Athi Estate | Payments</title>\n+ <script src=\"https://cdn.tailwindcss.com\"></script>\n+ <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n </head>\n-<body class=\"flex flex-col min-h-screen\">\n-    <!-- REQUIRED SCRIPTS -->\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js\"></script>\n-    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n+<body class=\"bg-gray-100 text-gray-800 flex flex-col h-screen overflow-hidden\">\n \n \n-    <!-- DASHBOARD SUMMARY (Cards at the top) -->\n-    <section id=\"dashboardSummary\" class=\"p-4 max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4 text-sm w-full\"></section>\n+  <!-- DASHBOARD SUMMARY -->\n+  <section id=\"dashboardSummary\" class=\"p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs mb-2 w-full\"></section>\n \n-    <main class=\"flex-1 overflow-auto p-4 max-w-7xl mx-auto space-y-4 w-full\">\n+  <main class=\"flex-1 overflow-auto p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs w-full\">\n \n-        <!-- MPESA PAYMENT SECTION -->\n-        <section class=\"bg-white p-6 rounded-xl shadow-lg col-span-3\">\n-            <h2 class=\"text-indigo-700 font-extrabold mb-4 text-xl border-b pb-2\">ðŸ’³ Initiate MPESA Payment (Admin)</h2>\n-            <div class=\"flex flex-col space-y-3 max-w-md\">\n-                <input type=\"number\" id=\"residentIdInput\" placeholder=\"Resident ID\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500\"/>\n-                <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g. Monthly Dues)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500\"/>\n-                <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount (e.g. 5000.00)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500\"/>\n-                <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500\"/>\n-                <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-3 rounded-lg shadow-md transition duration-200\">Initiate Payment</button>\n-                <div id=\"paymentResult\" class=\"text-sm mt-2 p-3 rounded-lg hidden\"></div>\n-            </div>\n-        </section>\n+      <!-- MPESA PAYMENT -->\n+    <section class=\"bg-white p-4 rounded-xl shadow col-span-3\">\n+      <h2 class=\"text-indigo-700 font-bold mb-2 text-sm\">ðŸ’³ MPESA Payment</h2>\n+      <div class=\"flex flex-col space-y-2 max-w-sm\">\n+          <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g Estate Registration)\" class=\"border p-2 rounded\"/>\n+          <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount\" class=\"border p-2 rounded\"/>\n+          <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-2 rounded\"/>\n+          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded\">Pay Now</button>\n+          <div id=\"paymentResult\" class=\"text-xs mt-1\"></div>\n+      </div>\n+    </section>\n \n-        <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n-            <!-- PAYMENT HISTORY (Pending & Verified) -->\n-            <section class=\"bg-white rounded-xl shadow-lg p-4 col-span-2 flex flex-col\">\n-                <h3 class=\"text-indigo-700 font-extrabold mb-3 text-xl border-b pb-2\">ðŸ“‹ Payment History (Pending/Verified)</h3>\n-                <div class=\"flex justify-between items-center mb-3 text-sm\">\n-                    <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID/Name...\" class=\"border rounded-lg px-3 py-1.5 focus:ring-indigo-500 focus:border-indigo-500\"/>\n-                    <div class=\"space-x-2\">\n-                        <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white font-medium\">Export CSV</button>\n-                        <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white font-medium\">Export Excel</button>\n-                    </div>\n-                </div>\n-                <div class=\"overflow-x-auto border rounded-lg shadow-inner\">\n-                    <table id=\"paymentsTable\" class=\"min-w-full text-xs data-table\">\n-                        <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0\">\n-                            <tr>\n-                                <th class=\"px-3 py-2 text-left\">ID</th>\n-                                <th class=\"px-3 py-2 text-left\">Res.ID</th>\n-                                <th class=\"px-3 py-2 text-left\">Resident Name</th>\n-                                <th class=\"px-3 py-2 text-left\">Amount (KES)</th>\n-                                <th class=\"px-3 py-2 text-left\">Date</th>\n-                                <th class=\"px-3 py-2 text-left\">Status</th>\n-                                <th class=\"px-3 py-2 text-left\">Method</th>\n-                                <th class=\"px-3 py-2 text-left\">Phone</th>\n-                                <th class=\"px-3 py-2 text-left\">Action</th>\n-                            </tr>\n-                        </thead>\n-                        <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\"></tbody>\n-                    </table>\n-                </div>\n-            </section>\n+          <button type=\"submit\" class=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-1 rounded text-xs mt-1\">Submit Payment</button>\n+      </form>\n+      <div id=\"msg\" class=\"text-gray-700 mt-1 text-xs\"></div>\n+    </section>\n \n-            <!-- BALANCES -->\n-            <section class=\"bg-white rounded-xl shadow-lg p-4 col-span-1 flex flex-col\">\n-                <h3 class=\"text-yellow-700 font-extrabold mb-3 text-xl border-b pb-2\">ðŸ’° Resident Balances</h3>\n-                <div class=\"flex justify-end mb-3 text-sm space-x-2\">\n-                    <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white font-medium\">CSV</button>\n-                    <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white font-medium\">Excel</button>\n-                </div>\n-                <div class=\"overflow-x-auto border rounded-lg shadow-inner\">\n-                    <table id=\"balanceTable\" class=\"min-w-full text-xs data-table\">\n-                        <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n-                            <tr>\n-                                <th class=\"px-3 py-2 text-left\">Res. Name</th>\n-                                <th class=\"px-3 py-2 text-left\">Paid</th>\n-                                <th class=\"px-3 py-2 text-left\">Due</th>\n-                                <th class=\"px-3 py-2 text-left\">Balance</th>\n-                            </tr>\n-                        </thead>\n-                        <tbody id=\"balanceBody\" class=\"divide-y divide-gray-100\"></tbody>\n-                    </table>\n-                </div>\n-            </section>\n-        </div>\n-        \n-        <!-- VERIFIED PAYMENTS (Separate list for clarity) -->\n-        <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col\">\n-            <h3 class=\"text-green-700 font-extrabold mb-3 text-xl border-b pb-2\">âœ… Verified Payment Log</h3>\n-            <div class=\"flex justify-between items-center mb-3 text-sm\">\n-                <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter verified by Resident ID/Name...\" class=\"border rounded-lg px-3 py-1.5 focus:ring-green-500 focus:border-green-500\"/>\n-                <div class=\"space-x-2\">\n-                    <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white font-medium\">CSV</button>\n-                    <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white font-medium\">Excel</button>\n-                </div>\n\\ No newline at end of file\n-            </div>\n-            <div class=\"overflow-x-auto max-h-96 border rounded-lg shadow-inner\">\n-                <table id=\"verifiedTable\" class=\"min-w-full text-xs data-table\">\n-                    <thead class=\"bg-green-100 text-green-800 sticky top-0\">\n-                        <tr>\n-                            <th class=\"px-3 py-2 text-left\">ID</th>\n-                            <th class=\"px-3 py-2 text-left\">Resident Name</th>\n-                            <th class=\"px-3 py-2 text-left\">Amount (KES)</th>\n-                            <th class=\"px-3 py-2 text-left\">Reference</th>\n-                            <th class=\"px-3 py-2 text-left\">Verified Date</th>\n-                            <th class=\"px-3 py-2 text-left\">Receipt No.</th>\n-                        </tr>\n-                    </thead>\n-                    <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-100\"></tbody>\n-                </table>\n-            </div>\n-        </section>\n+    <!-- PAYMENT HISTORY -->\n+    <section class=\"bg-white rounded-xl shadow p-2 col-span-2 flex flex-col\">\n+      <h3 class=\"text-indigo-700 font-semibold mb-1 text-sm\">ðŸ“‹ Payment History</h3>\n+      <div class=\"flex justify-between mb-1 text-xs\">\n+          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n+          <div class=\"space-x-1\">\n+              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n+              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+          </div>\n+      </div>\n+      <div class=\"overflow-auto max-h-60 border rounded\">\n+          <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0\">\n+                  <tr>\n+                      <th class=\"px-1 py-0.5 text-left\">PaymentID</th>\n+                      <th class=\"px-1 py-0.5 text-left\">ResidentID</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Amount</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Payment Date</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Status</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Reference</th>\n+                      <th class=\"px-1 py-0.5 text-left\">PaymentMethod</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Action</th>\n+                      <th class=\"px-1 py-0.5 text-left\">NationalID</th>\n+                      <th class=\"px-1 py-0.5 text-left\">serviceName</th>\n+                      <th class=\"px-1 py-0.5 text-left\">phoneNumber</th>\n+                      <th class=\"px-1 py-0.5 text-left\">VerifiedDate  </th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-200\"></tbody>\n+          </table>\n+      </div>\n+    </section>\n+    <!-- VERIFIED PAYMENTS -->\n+    <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n+      <h3 class=\"text-green-700 font-semibold mb-1 text-sm\">âœ… Verified Payments</h3>\n+      <div class=\"flex justify-between mb-1 text-xs\">\n+          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n+          <div class=\"space-x-1\">\n+              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n+              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+          </div>\n+      </div>\n+      <div class=\"overflow-auto max-h-40 border rounded\">\n+          <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-green-100 text-green-800 sticky top-0\">\n+                  <tr>\n+                      <th class=\"px-1 py-0.5 text-left\">Resident Name</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Amount</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Reference</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Verified Date</th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-200\"></tbody>\n+          </table>\n+      </div>\n+    </section>\n \n+    <!-- BALANCES -->\n+    <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n+      <h3 class=\"text-yellow-700 font-semibold mb-1 text-sm\">ðŸ’° Balances</h3>\n+      <div class=\"flex justify-end mb-1 text-xs space-x-1\">\n+          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n+          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+      </div>\n+      <div class=\"overflow-auto max-h-40 border rounded\">\n+          <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n+                  <tr>\n+                      <th class=\"px-1 py-0.5 text-left\">Resident Name</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Total Paid</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Total Due</th>\n+                      <th class=\"px-1 py-0.5 text-left\">Balance</th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-200\"></tbody>\n+          </table>\n+      </div>\n+    </section>\n     </main>\n-\n-    <!-- SCRIPT -->\n-    <script src=\"/js/payment.js\"></script>\n+  <script src=\"js/payment.js\"></script>\n </body>\n-</html>\n+</html>\n"
                },
                {
                    "date": 1763627826461,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,113 +4,534 @@\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>Athi Estate | Payments</title>\n  <script src=\"https://cdn.tailwindcss.com\"></script>\n+ <!-- Inter Font -->\n+ <style>\n+    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n+    body {\n+        font-family: 'Inter', sans-serif;\n+    }\n+ </style>\n+ <!-- XLSX for Excel/CSV export -->\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n </head>\n-<body class=\"bg-gray-100 text-gray-800 flex flex-col h-screen overflow-hidden\">\n+<body class=\"bg-gray-50 text-gray-800 flex flex-col h-screen\">\n \n+  <header class=\"bg-white shadow-md p-4 sticky top-0 z-10\">\n+      <div class=\"max-w-7xl mx-auto flex justify-between items-center\">\n+          <h1 class=\"text-xl font-bold text-indigo-700\">Athi Estate Payments</h1>\n+          <div id=\"userInfo\" class=\"text-xs text-gray-500\">Loading User...</div>\n+      </div>\n+  </header>\n \n   <!-- DASHBOARD SUMMARY -->\n-  <section id=\"dashboardSummary\" class=\"p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs mb-2 w-full\"></section>\n+  <section id=\"dashboardSummary\" class=\"p-4 pt-2 max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-3 gap-4 text-xs w-full\"></section>\n \n-  <main class=\"flex-1 overflow-auto p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs w-full\">\n+  <main class=\"flex-1 overflow-y-auto p-4 max-w-7xl mx-auto w-full space-y-4\">\n \n-      <!-- MPESA PAYMENT -->\n-    <section class=\"bg-white p-4 rounded-xl shadow col-span-3\">\n-      <h2 class=\"text-indigo-700 font-bold mb-2 text-sm\">ðŸ’³ MPESA Payment</h2>\n-      <div class=\"flex flex-col space-y-2 max-w-sm\">\n-          <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g Estate Registration)\" class=\"border p-2 rounded\"/>\n-          <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount\" class=\"border p-2 rounded\"/>\n-          <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-2 rounded\"/>\n-          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded\">Pay Now</button>\n-          <div id=\"paymentResult\" class=\"text-xs mt-1\"></div>\n+      <!-- MPESA PAYMENT SIMULATION / FORM -->\n+    <section class=\"bg-white p-6 rounded-xl shadow-lg border border-indigo-100\">\n+      <h2 class=\"text-indigo-700 font-bold mb-4 text-lg\">ðŸ’³ Initiate MPESA Payment</h2>\n+      <div class=\"flex flex-col space-y-3 max-w-sm\">\n+          <input type=\"text\" id=\"residentIdInput\" placeholder=\"Resident ID (e.g., RES001)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <input type=\"text\" id=\"serviceNameInput\" placeholder=\"Service Name (e.g., Monthly Dues)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <input type=\"number\" id=\"paymentAmountInput\" placeholder=\"Amount (Ksh)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <input type=\"text\" id=\"phoneNumberInput\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]\">\n+              <span id=\"payBtnText\">Simulate Payment</span>\n+          </button>\n+          <div id=\"paymentResult\" class=\"text-xs mt-2 p-2 rounded-lg text-center hidden\"></div>\n       </div>\n     </section>\n \n-          <button type=\"submit\" class=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-1 rounded text-xs mt-1\">Submit Payment</button>\n-      </form>\n-      <div id=\"msg\" class=\"text-gray-700 mt-1 text-xs\"></div>\n-    </section>\n-\n     <!-- PAYMENT HISTORY -->\n-    <section class=\"bg-white rounded-xl shadow p-2 col-span-2 flex flex-col\">\n-      <h3 class=\"text-indigo-700 font-semibold mb-1 text-sm\">ðŸ“‹ Payment History</h3>\n-      <div class=\"flex justify-between mb-1 text-xs\">\n-          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n-          <div class=\"space-x-1\">\n-              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-indigo-100\">\n+      <h3 class=\"text-indigo-700 font-semibold mb-3 text-lg\">ðŸ“‹ Full Payment History</h3>\n+      <div class=\"flex justify-between items-center mb-3 text-sm\">\n+          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID, Status, or Ref\" class=\"border rounded-lg px-3 py-1.5 focus:ring-indigo-500 focus:border-indigo-500 transition w-1/3\"/>\n+          <div class=\"space-x-2\">\n+              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n           </div>\n       </div>\n-      <div class=\"overflow-auto max-h-60 border rounded\">\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[300px] border border-gray-200 rounded-lg\">\n           <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0\">\n+              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0 shadow-sm\">\n                   <tr>\n-                      <th class=\"px-1 py-0.5 text-left\">PaymentID</th>\n-                      <th class=\"px-1 py-0.5 text-left\">ResidentID</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Amount</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Payment Date</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Status</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Reference</th>\n-                      <th class=\"px-1 py-0.5 text-left\">PaymentMethod</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Action</th>\n-                      <th class=\"px-1 py-0.5 text-left\">NationalID</th>\n-                      <th class=\"px-1 py-0.5 text-left\">serviceName</th>\n-                      <th class=\"px-1 py-0.5 text-left\">phoneNumber</th>\n-                      <th class=\"px-1 py-0.5 text-left\">VerifiedDate  </th>\n+                      <th class=\"px-3 py-2 text-left w-16\">ID</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Date</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Status</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Method</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Action</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">NationalID</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Service Name</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Phone</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-200\"></tbody>\n+              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\">\n+                  <tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">Loading payments...</td></tr>\n+              </tbody>\n           </table>\n       </div>\n     </section>\n-    <!-- VERIFIED PAYMENTS -->\n-    <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n-      <h3 class=\"text-green-700 font-semibold mb-1 text-sm\">âœ… Verified Payments</h3>\n-      <div class=\"flex justify-between mb-1 text-xs\">\n-          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n-          <div class=\"space-x-1\">\n-              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+\n+    <!-- VERIFIED PAYMENTS (Simplified View) -->\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-green-100\">\n+      <h3 class=\"text-green-700 font-semibold mb-3 text-lg\">âœ… Verified Transactions</h3>\n+      <div class=\"flex justify-between items-center mb-3 text-sm\">\n+          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded-lg px-3 py-1.5 focus:ring-green-500 focus:border-green-500 transition w-1/3\"/>\n+          <div class=\"space-x-2\">\n+              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n           </div>\n       </div>\n-      <div class=\"overflow-auto max-h-40 border rounded\">\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n           <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-green-100 text-green-800 sticky top-0\">\n+              <thead class=\"bg-green-100 text-green-800 sticky top-0 shadow-sm\">\n                   <tr>\n-                      <th class=\"px-1 py-0.5 text-left\">Resident Name</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Amount</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Reference</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Verified Date</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-200\"></tbody>\n+              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-100\"></tbody>\n           </table>\n       </div>\n     </section>\n \n-    <!-- BALANCES -->\n-    <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n-      <h3 class=\"text-yellow-700 font-semibold mb-1 text-sm\">ðŸ’° Balances</h3>\n-      <div class=\"flex justify-end mb-1 text-xs space-x-1\">\n-          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n-          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n+    <!-- BALANCES (Grouped by Resident) -->\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-yellow-100\">\n+      <h3 class=\"text-yellow-700 font-semibold mb-3 text-lg\">ðŸ’° Resident Balances Summary</h3>\n+      <div class=\"flex justify-end mb-3 text-sm space-x-2\">\n+          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n       </div>\n-      <div class=\"overflow-auto max-h-40 border rounded\">\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n           <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n+              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0 shadow-sm\">\n                   <tr>\n-                      <th class=\"px-1 py-0.5 text-left\">Resident Name</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Total Paid</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Total Due</th>\n-                      <th class=\"px-1 py-0.5 text-left\">Balance</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Total Paid (Verified)</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Total Due (Simulated)</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Balance</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-200\"></tbody>\n+              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-100\"></tbody>\n           </table>\n       </div>\n     </section>\n-    </main>\n-  <script src=\"js/payment.js\"></script>\n+  </main>\n+\n+<script type=\"module\">\n+  import { initializeApp } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js\";\n+  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js\";\n+  import { getFirestore, collection, onSnapshot, addDoc, doc, setLogLevel, serverTimestamp, query, orderBy } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js\";\n+\n+  // --- GLOBAL FIREBASE/APP SETUP ---\n+  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n+  const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');\n+  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n+\n+  let db, auth, userId;\n+  let allPayments = []; // Store all fetched data globally\n+  setLogLevel('Debug');\n+\n+  // Utility to format date\n+  const formatDate = (timestamp) => {\n+      if (!timestamp || !timestamp.toDate) return 'N/A';\n+      return timestamp.toDate().toLocaleString('en-GB', {\n+          year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'\n+      });\n+  };\n+\n+  // Utility to format currency\n+  const formatCurrency = (amount) => {\n+      return new Intl.NumberFormat('en-KE', { style: 'currency', currency: 'KES' }).format(amount);\n+  };\n+\n+  // --- DATA PROCESSING & RENDERING ---\n+\n+  function calculateDashboardSummary(payments) {\n+      const totalPayments = payments.length;\n+      const verifiedPayments = payments.filter(p => p.Status === 'Verified').length;\n+      const totalVerifiedAmount = payments\n+          .filter(p => p.Status === 'Verified')\n+          .reduce((sum, p) => sum + p.Amount, 0);\n+\n+      const summaryHtml = `\n+          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n+              <p class=\"text-xs text-gray-500\">Total Transactions</p>\n+              <p class=\"text-xl font-bold text-indigo-600\">${totalPayments}</p>\n+          </div>\n+          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n+              <p class=\"text-xs text-gray-500\">Verified Payments</p>\n+              <p class=\"text-xl font-bold text-green-600\">${verifiedPayments}</p>\n+          </div>\n+          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n+              <p class=\"text-xs text-gray-500\">Total Verified Amount</p>\n+              <p class=\"text-xl font-bold text-indigo-600\">${formatCurrency(totalVerifiedAmount)}</p>\n+          </div>\n+      `;\n+      document.getElementById('dashboardSummary').innerHTML = summaryHtml;\n+  }\n+\n+  function calculateBalances(payments) {\n+      const balances = {};\n+      const requiredDue = {}; // Simple simulation: what they attempted to pay is their \"due\"\n+      const verifiedOnly = payments.filter(p => p.Status === 'Verified');\n+\n+      verifiedOnly.forEach(p => {\n+          const id = p.ResidentID;\n+          if (!balances[id]) {\n+              balances[id] = { totalPaid: 0, totalDue: 0, ResidentID: id };\n+          }\n+          balances[id].totalPaid += p.Amount;\n+      });\n+\n+      // Simple due simulation: sum of all attempted payment amounts\n+      payments.forEach(p => {\n+          const id = p.ResidentID;\n+          if (!balances[id]) {\n+              balances[id] = { totalPaid: 0, totalDue: 0, ResidentID: id };\n+          }\n+          balances[id].totalDue += p.Amount;\n+      });\n+\n+      // Render Balances Table\n+      const balanceBody = document.getElementById('balanceBody');\n+      balanceBody.innerHTML = '';\n+      const balanceArray = Object.values(balances);\n+\n+      // Sort by ResidentID for better display\n+      balanceArray.sort((a, b) => a.ResidentID.localeCompare(b.ResidentID));\n+\n+      balanceArray.forEach(b => {\n+          const balance = b.totalPaid - b.totalDue;\n+          const balanceClass = balance >= 0 ? 'text-green-600' : 'text-red-600 font-bold';\n+          const row = `\n+              <tr class=\"hover:bg-gray-50\">\n+                  <td class=\"px-3 py-2\">${b.ResidentID}</td>\n+                  <td class=\"px-3 py-2 text-right\">${formatCurrency(b.totalPaid)}</td>\n+                  <td class=\"px-3 py-2 text-right\">${formatCurrency(b.totalDue)}</td>\n+                  <td class=\"px-3 py-2 text-right ${balanceClass}\">${formatCurrency(balance)}</td>\n+              </tr>\n+          `;\n+          balanceBody.insertAdjacentHTML('beforeend', row);\n+      });\n+      return balanceArray;\n+  }\n+\n+  function renderPaymentsTable(data, tableId) {\n+      const body = document.getElementById(tableId);\n+      body.innerHTML = '';\n+      if (data.length === 0) {\n+          body.innerHTML = '<tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">No payments found.</td></tr>';\n+          return;\n+      }\n+\n+      data.forEach(p => {\n+          const statusClass = p.Status === 'Verified' ? 'bg-green-100 text-green-800' :\n+                             p.Status === 'Pending' ? 'bg-yellow-100 text-yellow-800' :\n+                             'bg-red-100 text-red-800';\n+\n+          const row = `\n+              <tr class=\"hover:bg-gray-50\">\n+                  <td class=\"px-3 py-1.5\">${p.PaymentID.substring(0, 8)}...</td>\n+                  <td class=\"px-3 py-1.5 font-medium\">${p.ResidentID}</td>\n+                  <td class=\"px-3 py-1.5 text-right\">${formatCurrency(p.Amount)}</td>\n+                  <td class=\"px-3 py-1.5\">${formatDate(p.PaymentDate)}</td>\n+                  <td class=\"px-3 py-1.5\"><span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}\">${p.Status}</span></td>\n+                  <td class=\"px-3 py-1.5\">${p.Reference}</td>\n+                  <td class=\"px-3 py-1.5\">${p.PaymentMethod}</td>\n+                  <td class=\"px-3 py-1.5\">${p.Action || 'View'}</td>\n+                  <td class=\"px-3 py-1.5\">${p.NationalID || 'N/A'}</td>\n+                  <td class=\"px-3 py-1.5\">${p.ServiceName || 'General'}</td>\n+                  <td class=\"px-3 py-1.5\">${p.PhoneNumber || 'N/A'}</td>\n+                  <td class=\"px-3 py-1.5\">${p.VerifiedDate ? formatDate(p.VerifiedDate) : 'Pending'}</td>\n+              </tr>\n+          `;\n+          body.insertAdjacentHTML('beforeend', row);\n+      });\n+  }\n+\n+  function renderVerifiedTable(data) {\n+      const body = document.getElementById('verifiedBody');\n+      body.innerHTML = '';\n+      const verified = data.filter(p => p.Status === 'Verified');\n+\n+      if (verified.length === 0) {\n+          body.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No verified payments found.</td></tr>';\n+          return;\n+      }\n+\n+      verified.forEach(p => {\n+          const row = `\n+              <tr class=\"hover:bg-gray-50\">\n+                  <td class=\"px-3 py-1.5 font-medium\">${p.ResidentID}</td>\n+                  <td class=\"px-3 py-1.5 text-right\">${formatCurrency(p.Amount)}</td>\n+                  <td class=\"px-3 py-1.5\">${p.Reference}</td>\n+                  <td class=\"px-3 py-1.5\">${formatDate(p.VerifiedDate)}</td>\n+              </tr>\n+          `;\n+          body.insertAdjacentHTML('beforeend', row);\n+      });\n+      return verified;\n+  }\n+\n+  // --- FIREBASE INTERACTION ---\n+\n+  async function initFirebase() {\n+      try {\n+          const app = initializeApp(firebaseConfig);\n+          db = getFirestore(app);\n+          auth = getAuth(app);\n+\n+          // Sign in using custom token or anonymously\n+          if (initialAuthToken) {\n+              await signInWithCustomToken(auth, initialAuthToken);\n+          } else {\n+              await signInAnonymously(auth);\n+          }\n+\n+          onAuthStateChanged(auth, (user) => {\n+              if (user) {\n+                  userId = user.uid;\n+                  document.getElementById('userInfo').textContent = `User ID: ${userId}`;\n+                  startRealtimeListener();\n+              } else {\n+                  console.error(\"User not authenticated.\");\n+                  document.getElementById('userInfo').textContent = 'Authentication Failed';\n+              }\n+          });\n+      } catch (error) {\n+          console.error(\"Error initializing Firebase:\", error);\n+          document.getElementById('userInfo').textContent = `Init Error: ${error.message}`;\n+      }\n+  }\n+\n+  function startRealtimeListener() {\n+      if (!db) return;\n+\n+      const paymentsCollectionPath = `/artifacts/${appId}/public/data/payments`;\n+      const q = collection(db, paymentsCollectionPath);\n+\n+      // Listen for real-time updates\n+      onSnapshot(q, (snapshot) => {\n+          allPayments = snapshot.docs.map(doc => ({\n+              id: doc.id,\n+              ...doc.data()\n+          }));\n+\n+          // Sort by PaymentDate descending\n+          allPayments.sort((a, b) => (b.PaymentDate?.toMillis() || 0) - (a.PaymentDate?.toMillis() || 0));\n+\n+          // Process and render data\n+          updateAllViews(allPayments);\n+      }, (error) => {\n+          console.error(\"Error listening to payments collection:\", error);\n+      });\n+  }\n+\n+  function updateAllViews(data) {\n+      // 1. Dashboard Summary\n+      calculateDashboardSummary(data);\n+\n+      // 2. Full Payment History Table (Default display, unfiltered)\n+      renderPaymentsTable(data, 'paymentsBody');\n+\n+      // 3. Verified Payments Table (Default display, unfiltered)\n+      renderVerifiedTable(data);\n+\n+      // 4. Balances Table\n+      calculateBalances(data);\n+  }\n+\n+\n+  async function addPayment(residentId, serviceName, amount, phoneNumber) {\n+      if (!db || !userId) {\n+          console.error(\"Database not initialized or user not logged in.\");\n+          return { success: false, message: \"System error: Database not ready.\" };\n+      }\n+\n+      const paymentsCollectionPath = `/artifacts/${appId}/public/data/payments`;\n+\n+      // Simple logic to simulate verification/status based on amount\n+      const isVerified = amount > 1000; // Large payments auto-verified for simulation\n+      const status = isVerified ? 'Verified' : 'Pending';\n+      const reference = 'MPESA' + Math.random().toString(36).substring(2, 10).toUpperCase();\n+\n+      const newPayment = {\n+          PaymentID: crypto.randomUUID(),\n+          ResidentID: residentId.toUpperCase().trim(),\n+          Amount: parseFloat(amount),\n+          PaymentDate: serverTimestamp(),\n+          Status: status,\n+          Reference: reference,\n+          PaymentMethod: 'MPESA',\n+          Action: 'Initial Payment',\n+          NationalID: '', // Placeholder\n+          ServiceName: serviceName,\n+          PhoneNumber: phoneNumber,\n+          VerifiedDate: isVerified ? serverTimestamp() : null\n+      };\n+\n+      try {\n+          await addDoc(collection(db, paymentsCollectionPath), newPayment);\n+          return {\n+              success: true,\n+              message: `Payment of ${formatCurrency(amount)} for ${residentId} initiated. Status: ${status}. Ref: ${reference}.`\n+          };\n+      } catch (e) {\n+          console.error(\"Error adding document: \", e);\n+          return { success: false, message: `Error processing payment: ${e.message}` };\n+      }\n+  }\n+\n+  // --- UI/EVENT HANDLERS ---\n+\n+  document.addEventListener('DOMContentLoaded', () => {\n+      initFirebase();\n+\n+      const payBtn = document.getElementById('payBtn');\n+      const payBtnText = document.getElementById('payBtnText');\n+      const paymentResult = document.getElementById('paymentResult');\n+\n+      payBtn.addEventListener('click', async () => {\n+          const residentId = document.getElementById('residentIdInput').value;\n+          const serviceName = document.getElementById('serviceNameInput').value;\n+          const amount = document.getElementById('paymentAmountInput').value;\n+          const phoneNumber = document.getElementById('phoneNumberInput').value;\n+\n+          if (!residentId || !serviceName || !amount || !phoneNumber) {\n+              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n+              paymentResult.textContent = 'Please fill in all fields.';\n+              return;\n+          }\n+\n+          if (isNaN(parseFloat(amount)) || parseFloat(amount) <= 0) {\n+              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n+              paymentResult.textContent = 'Amount must be a valid positive number.';\n+              return;\n+          }\n+\n+          // Disable button and show loading\n+          payBtn.disabled = true;\n+          payBtnText.textContent = 'Processing...';\n+          paymentResult.textContent = '';\n+          paymentResult.classList.add('hidden');\n+\n+          const result = await addPayment(residentId, serviceName, amount, phoneNumber);\n+\n+          // Re-enable button\n+          payBtn.disabled = false;\n+          payBtnText.textContent = 'Simulate Payment';\n+\n+          // Show result\n+          if (result.success) {\n+              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-green-700 bg-green-100 block';\n+          } else {\n+              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n+          }\n+          paymentResult.textContent = result.message;\n+\n+          // Clear form fields\n+          document.getElementById('residentIdInput').value = '';\n+          document.getElementById('serviceNameInput').value = '';\n+          document.getElementById('paymentAmountInput').value = '';\n+          document.getElementById('phoneNumberInput').value = '';\n+      });\n+\n+      // --- FILTERING ---\n+      document.getElementById('filterInput').addEventListener('input', (e) => {\n+          const filterTerm = e.target.value.toLowerCase();\n+          const filteredData = allPayments.filter(p =>\n+              p.ResidentID.toLowerCase().includes(filterTerm) ||\n+              p.Status.toLowerCase().includes(filterTerm) ||\n+              p.Reference.toLowerCase().includes(filterTerm)\n+          );\n+          renderPaymentsTable(filteredData, 'paymentsBody');\n+      });\n+\n+      document.getElementById('verifiedFilterInput').addEventListener('input', (e) => {\n+          const filterTerm = e.target.value.toLowerCase();\n+          const verified = allPayments.filter(p => p.Status === 'Verified');\n+          const filteredData = verified.filter(p =>\n+              p.ResidentID.toLowerCase().includes(filterTerm)\n+          );\n+          renderVerifiedTable(filteredData);\n+      });\n+\n+\n+      // --- EXPORT LOGIC ---\n+\n+      function exportTable(data, filename) {\n+          const ws = XLSX.utils.json_to_sheet(data);\n+          const wb = XLSX.utils.book_new();\n+          XLSX.utils.book_append_sheet(wb, ws, \"Data\");\n+          XLSX.writeFile(wb, filename);\n+      }\n+\n+      function cleanDataForExport(data) {\n+          return data.map(p => ({\n+              PaymentID: p.PaymentID,\n+              ResidentID: p.ResidentID,\n+              Amount: p.Amount,\n+              PaymentDate: formatDate(p.PaymentDate),\n+              Status: p.Status,\n+              Reference: p.Reference,\n+              PaymentMethod: p.PaymentMethod,\n+              Action: p.Action,\n+              NationalID: p.NationalID,\n+              ServiceName: p.ServiceName,\n+              PhoneNumber: p.PhoneNumber,\n+              VerifiedDate: p.VerifiedDate ? formatDate(p.VerifiedDate) : 'N/A'\n+          }));\n+      }\n+\n+      // Full History Export\n+      document.getElementById('exportExcel').addEventListener('click', () => {\n+          exportTable(cleanDataForExport(allPayments), 'Athi_Payment_History.xlsx');\n+      });\n+      document.getElementById('exportCsv').addEventListener('click', () => {\n+          exportTable(cleanDataForExport(allPayments), 'Athi_Payment_History.csv');\n+      });\n+\n+      // Verified Payments Export\n+      document.getElementById('exportVerifiedExcel').addEventListener('click', () => {\n+          const verified = allPayments.filter(p => p.Status === 'Verified');\n+          exportTable(cleanDataForExport(verified), 'Athi_Verified_Payments.xlsx');\n+      });\n+      document.getElementById('exportVerifiedCsv').addEventListener('click', () => {\n+          const verified = allPayments.filter(p => p.Status === 'Verified');\n+          exportTable(cleanDataForExport(verified), 'Athi_Verified_Payments.csv');\n+      });\n+\n+      // Balances Export\n+      document.getElementById('exportBalancesExcel').addEventListener('click', () => {\n+          const balances = calculateBalances(allPayments); // Recalculate balances\n+          exportTable(balances.map(b => ({\n+              ResidentID: b.ResidentID,\n+              TotalPaid: b.totalPaid,\n+              TotalDue: b.totalDue,\n+              Balance: b.totalPaid - b.totalDue\n+          })), 'Athi_Resident_Balances.xlsx');\n+      });\n+      document.getElementById('exportBalancesCsv').addEventListener('click', () => {\n+          const balances = calculateBalances(allPayments);\n+          exportTable(balances.map(b => ({\n+              ResidentID: b.ResidentID,\n+              TotalPaid: b.totalPaid,\n+              TotalDue: b.totalDue,\n+              Balance: b.totalPaid - b.totalDue\n+          })), 'Athi_Resident_Balances.csv');\n+      });\n+  });\n+\n+</script>\n </body>\n-</html>\n+</html>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763628105458,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,577 @@\n+<!DOCTYPE html>\n+<html lang=\"en\">\n+<head>\n+ <meta charset=\"UTF-8\" />\n+ <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n+ <title>Athi Estate | Payments</title>\n+ <script src=\"https://cdn.tailwindcss.com\"></script>\n+ <!-- Inter Font -->\n+ <style>\n+    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n+    body {\n+        font-family: 'Inter', sans-serif;\n+    }\n+ </style>\n+ <!-- XLSX for Excel/CSV export -->\n+ <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n+</head>\n+<body class=\"bg-gray-50 text-gray-800 flex flex-col h-screen\">\n+\n+  <header class=\"bg-white shadow-md p-4 sticky top-0 z-10\">\n+      <div class=\"max-w-7xl mx-auto flex justify-between items-center\">\n+          <h1 class=\"text-xl font-bold text-indigo-700\">Athi Estate Payments</h1>\n+          <div id=\"userInfo\" class=\"text-xs text-gray-500\">Loading User...</div>\n+      </div>\n+  </header>\n+\n+  <!-- DASHBOARD SUMMARY -->\n+  <section id=\"dashboardSummary\" class=\"p-4 pt-2 max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-3 gap-4 text-xs w-full\"></section>\n+\n+  <main class=\"flex-1 overflow-y-auto p-4 max-w-7xl mx-auto w-full space-y-4\">\n+\n+      <!-- MPESA PAYMENT SIMULATION / FORM -->\n+    <section class=\"bg-white p-6 rounded-xl shadow-lg border border-indigo-100\">\n+      <h2 class=\"text-indigo-700 font-bold mb-4 text-lg\">ðŸ’³ Initiate MPESA Payment</h2>\n+      <div class=\"flex flex-col space-y-3 max-w-sm\">\n+          <!-- UPDATED: Replaced input with a select dropdown for existing Resident IDs -->\n+          <select id=\"residentIdSelect\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\">\n+              <option value=\"\" disabled selected>Select Resident ID (or enter new)</option>\n+          </select>\n+          <input type=\"text\" id=\"serviceNameInput\" placeholder=\"Service Name (e.g., Monthly Dues)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <input type=\"number\" id=\"paymentAmountInput\" placeholder=\"Amount (Ksh)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <input type=\"text\" id=\"phoneNumberInput\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]\">\n+              <span id=\"payBtnText\">Simulate Payment</span>\n+          </button>\n+          <div id=\"paymentResult\" class=\"text-xs mt-2 p-2 rounded-lg text-center hidden\"></div>\n+      </div>\n+    </section>\n+\n+    <!-- PAYMENT HISTORY -->\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-indigo-100\">\n+      <h3 class=\"text-indigo-700 font-semibold mb-3 text-lg\">ðŸ“‹ Full Payment History</h3>\n+      <div class=\"flex justify-between items-center mb-3 text-sm\">\n+          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID, Status, or Ref\" class=\"border rounded-lg px-3 py-1.5 focus:ring-indigo-500 focus:border-indigo-500 transition w-1/3\"/>\n+          <div class=\"space-x-2\">\n+              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n+          </div>\n+      </div>\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[300px] border border-gray-200 rounded-lg\">\n+          <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0 shadow-sm\">\n+                  <tr>\n+                      <th class=\"px-3 py-2 text-left w-16\">ID</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Date</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Status</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Method</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Action</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">NationalID</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Service Name</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Phone</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\">\n+                  <tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">Loading payments...</td></tr>\n+              </tbody>\n+          </table>\n+      </div>\n+    </section>\n+\n+    <!-- VERIFIED PAYMENTS (Simplified View) -->\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-green-100\">\n+      <h3 class=\"text-green-700 font-semibold mb-3 text-lg\">âœ… Verified Transactions</h3>\n+      <div class=\"flex justify-between items-center mb-3 text-sm\">\n+          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded-lg px-3 py-1.5 focus:ring-green-500 focus:border-green-500 transition w-1/3\"/>\n+          <div class=\"space-x-2\">\n+              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n+          </div>\n+      </div>\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n+          <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-green-100 text-green-800 sticky top-0 shadow-sm\">\n+                  <tr>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-100\"></tbody>\n+          </table>\n+      </div>\n+    </section>\n+\n+    <!-- BALANCES (Grouped by Resident) -->\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-yellow-100\">\n+      <h3 class=\"text-yellow-700 font-semibold mb-3 text-lg\">ðŸ’° Resident Balances Summary</h3>\n+      <div class=\"flex justify-end mb-3 text-sm space-x-2\">\n+          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n+      </div>\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n+          <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0 shadow-sm\">\n+                  <tr>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Total Paid (Verified)</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Total Due (Simulated)</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Balance</th>\n+                  </tr>\n+              </thead>\n+              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-100\"></tbody>\n+          </table>\n+      </div>\n+    </section>\n+  </main>\n+\n+<script type=\"module\">\n+  import { initializeApp } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js\";\n+  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js\";\n+  import { getFirestore, collection, onSnapshot, addDoc, doc, setLogLevel, serverTimestamp, query, orderBy } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js\";\n+\n+  // --- GLOBAL FIREBASE/APP SETUP ---\n+  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n+  const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');\n+  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n+\n+  let db, auth, userId;\n+  let allPayments = []; // Store all fetched data globally\n+  setLogLevel('Debug');\n+\n+  // Utility to format date\n+  const formatDate = (timestamp) => {\n+      if (!timestamp || !timestamp.toDate) return 'N/A';\n+      return timestamp.toDate().toLocaleString('en-GB', {\n+          year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'\n+      });\n+  };\n+\n+  // Utility to format currency\n+  const formatCurrency = (amount) => {\n+      return new Intl.NumberFormat('en-KE', { style: 'currency', currency: 'KES' }).format(amount);\n+  };\n+\n+  // --- DATA PROCESSING & RENDERING ---\n+\n+  // NEW FUNCTION: Populates the Resident ID select dropdown\n+  function populateResidentSelect(payments) {\n+      const residentIds = new Set();\n+      // Extract unique Resident IDs from all payments\n+      payments.forEach(p => {\n+          if (p.ResidentID) {\n+              residentIds.add(p.ResidentID.toUpperCase().trim());\n+          }\n+      });\n+\n+      const selectElement = document.getElementById('residentIdSelect');\n+      if (!selectElement) return;\n+\n+      // Preserve the current selected value\n+      const currentSelection = selectElement.value;\n+\n+      // Clear existing options, but keep the disabled placeholder\n+      selectElement.innerHTML = '<option value=\"\" disabled selected>Select Resident ID (or enter new)</option>';\n+\n+      const sortedIds = Array.from(residentIds).sort();\n+\n+      // Add options for each unique ID\n+      sortedIds.forEach(id => {\n+          const option = document.createElement('option');\n+          option.value = id;\n+          option.textContent = id;\n+          if (id === currentSelection) {\n+              option.selected = true;\n+          }\n+          selectElement.appendChild(option);\n+      });\n+  }\n+\n+  function calculateDashboardSummary(payments) {\n+      const totalPayments = payments.length;\n+      const verifiedPayments = payments.filter(p => p.Status === 'Verified').length;\n+      const totalVerifiedAmount = payments\n+          .filter(p => p.Status === 'Verified')\n+          .reduce((sum, p) => sum + p.Amount, 0);\n+\n+      const summaryHtml = `\n+          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n+              <p class=\"text-xs text-gray-500\">Total Transactions</p>\n+              <p class=\"text-xl font-bold text-indigo-600\">${totalPayments}</p>\n+          </div>\n+          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n+              <p class=\"text-xs text-gray-500\">Verified Payments</p>\n+              <p class=\"text-xl font-bold text-green-600\">${verifiedPayments}</p>\n+          </div>\n+          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n+              <p class=\"text-xs text-gray-500\">Total Verified Amount</p>\n+              <p class=\"text-xl font-bold text-indigo-600\">${formatCurrency(totalVerifiedAmount)}</p>\n+          </div>\n+      `;\n+      document.getElementById('dashboardSummary').innerHTML = summaryHtml;\n+  }\n+\n+  function calculateBalances(payments) {\n+      const balances = {};\n+      const requiredDue = {}; // Simple simulation: what they attempted to pay is their \"due\"\n+      const verifiedOnly = payments.filter(p => p.Status === 'Verified');\n+\n+      verifiedOnly.forEach(p => {\n+          const id = p.ResidentID;\n+          if (!balances[id]) {\n+              balances[id] = { totalPaid: 0, totalDue: 0, ResidentID: id };\n+          }\n+          balances[id].totalPaid += p.Amount;\n+      });\n+\n+      // Simple due simulation: sum of all attempted payment amounts\n+      payments.forEach(p => {\n+          const id = p.ResidentID;\n+          if (!balances[id]) {\n+              balances[id] = { totalPaid: 0, totalDue: 0, ResidentID: id };\n+          }\n+          balances[id].totalDue += p.Amount;\n+      });\n+\n+      // Render Balances Table\n+      const balanceBody = document.getElementById('balanceBody');\n+      balanceBody.innerHTML = '';\n+      const balanceArray = Object.values(balances);\n+\n+      // Sort by ResidentID for better display\n+      balanceArray.sort((a, b) => a.ResidentID.localeCompare(b.ResidentID));\n+\n+      balanceArray.forEach(b => {\n+          const balance = b.totalPaid - b.totalDue;\n+          const balanceClass = balance >= 0 ? 'text-green-600' : 'text-red-600 font-bold';\n+          const row = `\n+              <tr class=\"hover:bg-gray-50\">\n+                  <td class=\"px-3 py-2\">${b.ResidentID}</td>\n+                  <td class=\"px-3 py-2 text-right\">${formatCurrency(b.totalPaid)}</td>\n+                  <td class=\"px-3 py-2 text-right\">${formatCurrency(b.totalDue)}</td>\n+                  <td class=\"px-3 py-2 text-right ${balanceClass}\">${formatCurrency(balance)}</td>\n+              </tr>\n+          `;\n+          balanceBody.insertAdjacentHTML('beforeend', row);\n+      });\n+      return balanceArray;\n+  }\n+\n+  function renderPaymentsTable(data, tableId) {\n+      const body = document.getElementById(tableId);\n+      body.innerHTML = '';\n+      if (data.length === 0) {\n+          body.innerHTML = '<tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">No payments found.</td></tr>';\n+          return;\n+      }\n+\n+      data.forEach(p => {\n+          const statusClass = p.Status === 'Verified' ? 'bg-green-100 text-green-800' :\n+                             p.Status === 'Pending' ? 'bg-yellow-100 text-yellow-800' :\n+                             'bg-red-100 text-red-800';\n+\n+          const row = `\n+              <tr class=\"hover:bg-gray-50\">\n+                  <td class=\"px-3 py-1.5\">${p.PaymentID.substring(0, 8)}...</td>\n+                  <td class=\"px-3 py-1.5 font-medium\">${p.ResidentID}</td>\n+                  <td class=\"px-3 py-1.5 text-right\">${formatCurrency(p.Amount)}</td>\n+                  <td class=\"px-3 py-1.5\">${formatDate(p.PaymentDate)}</td>\n+                  <td class=\"px-3 py-1.5\"><span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}\">${p.Status}</span></td>\n+                  <td class=\"px-3 py-1.5\">${p.Reference}</td>\n+                  <td class=\"px-3 py-1.5\">${p.PaymentMethod}</td>\n+                  <td class=\"px-3 py-1.5\">${p.Action || 'View'}</td>\n+                  <td class=\"px-3 py-1.5\">${p.NationalID || 'N/A'}</td>\n+                  <td class=\"px-3 py-1.5\">${p.ServiceName || 'General'}</td>\n+                  <td class=\"px-3 py-1.5\">${p.PhoneNumber || 'N/A'}</td>\n+                  <td class=\"px-3 py-1.5\">${p.VerifiedDate ? formatDate(p.VerifiedDate) : 'Pending'}</td>\n+              </tr>\n+          `;\n+          body.insertAdjacentHTML('beforeend', row);\n+      });\n+  }\n+\n+  function renderVerifiedTable(data) {\n+      const body = document.getElementById('verifiedBody');\n+      body.innerHTML = '';\n+      const verified = data.filter(p => p.Status === 'Verified');\n+\n+      if (verified.length === 0) {\n+          body.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No verified payments found.</td></tr>';\n+          return;\n+      }\n+\n+      verified.forEach(p => {\n+          const row = `\n+              <tr class=\"hover:bg-gray-50\">\n+                  <td class=\"px-3 py-1.5 font-medium\">${p.ResidentID}</td>\n+                  <td class=\"px-3 py-1.5 text-right\">${formatCurrency(p.Amount)}</td>\n+                  <td class=\"px-3 py-1.5\">${p.Reference}</td>\n+                  <td class=\"px-3 py-1.5\">${formatDate(p.VerifiedDate)}</td>\n+              </tr>\n+          `;\n+          body.insertAdjacentHTML('beforeend', row);\n+      });\n+      return verified;\n+  }\n+\n+  // --- FIREBASE INTERACTION ---\n+\n+  async function initFirebase() {\n+      try {\n+          const app = initializeApp(firebaseConfig);\n+          db = getFirestore(app);\n+          auth = getAuth(app);\n+\n+          // Sign in using custom token or anonymously\n+          if (initialAuthToken) {\n+              await signInWithCustomToken(auth, initialAuthToken);\n+          } else {\n+              await signInAnonymously(auth);\n+          }\n+\n+          onAuthStateChanged(auth, (user) => {\n+              if (user) {\n+                  userId = user.uid;\n+                  document.getElementById('userInfo').textContent = `User ID: ${userId}`;\n+                  startRealtimeListener();\n+              } else {\n+                  console.error(\"User not authenticated.\");\n+                  document.getElementById('userInfo').textContent = 'Authentication Failed';\n+              }\n+          });\n+      } catch (error) {\n+          console.error(\"Error initializing Firebase:\", error);\n+          document.getElementById('userInfo').textContent = `Init Error: ${error.message}`;\n+      }\n+  }\n+\n+  function startRealtimeListener() {\n+      if (!db) return;\n+\n+      const paymentsCollectionPath = `/artifacts/${appId}/public/data/payments`;\n+      const q = collection(db, paymentsCollectionPath);\n+\n+      // Listen for real-time updates\n+      onSnapshot(q, (snapshot) => {\n+          allPayments = snapshot.docs.map(doc => ({\n+              id: doc.id,\n+              ...doc.data()\n+          }));\n+\n+          // Sort by PaymentDate descending\n+          allPayments.sort((a, b) => (b.PaymentDate?.toMillis() || 0) - (a.PaymentDate?.toMillis() || 0));\n+\n+          // Process and render data\n+          updateAllViews(allPayments);\n+      }, (error) => {\n+          console.error(\"Error listening to payments collection:\", error);\n+      });\n+  }\n+\n+  function updateAllViews(data) {\n+      // 1. Dashboard Summary\n+      calculateDashboardSummary(data);\n+\n+      // 2. Populate the Resident ID Select Dropdown\n+      populateResidentSelect(data);\n+\n+      // 3. Full Payment History Table (Default display, unfiltered)\n+      renderPaymentsTable(data, 'paymentsBody');\n+\n+      // 4. Verified Payments Table (Default display, unfiltered)\n+      renderVerifiedTable(data);\n+\n+      // 5. Balances Table\n+      calculateBalances(data);\n+  }\n+\n+\n+  async function addPayment(residentId, serviceName, amount, phoneNumber) {\n+      if (!db || !userId) {\n+          console.error(\"Database not initialized or user not logged in.\");\n+          return { success: false, message: \"System error: Database not ready.\" };\n+      }\n+\n+      const paymentsCollectionPath = `/artifacts/${appId}/public/data/payments`;\n+\n+      // Simple logic to simulate verification/status based on amount\n+      const isVerified = amount > 1000; // Large payments auto-verified for simulation\n+      const status = isVerified ? 'Verified' : 'Pending';\n+      const reference = 'MPESA' + Math.random().toString(36).substring(2, 10).toUpperCase();\n+\n+      const newPayment = {\n+          PaymentID: crypto.randomUUID(),\n+          ResidentID: residentId.toUpperCase().trim(),\n+          Amount: parseFloat(amount),\n+          PaymentDate: serverTimestamp(),\n+          Status: status,\n+          Reference: reference,\n+          PaymentMethod: 'MPESA',\n+          Action: 'Initial Payment',\n+          NationalID: '', // Placeholder\n+          ServiceName: serviceName,\n+          PhoneNumber: phoneNumber,\n+          VerifiedDate: isVerified ? serverTimestamp() : null\n+      };\n+\n+      try {\n+          await addDoc(collection(db, paymentsCollectionPath), newPayment);\n+          return {\n+              success: true,\n+              message: `Payment of ${formatCurrency(amount)} for ${residentId} initiated. Status: ${status}. Ref: ${reference}.`\n+          };\n+      } catch (e) {\n+          console.error(\"Error adding document: \", e);\n+          return { success: false, message: `Error processing payment: ${e.message}` };\n+      }\n+  }\n+\n+  // --- UI/EVENT HANDLERS ---\n+\n+  document.addEventListener('DOMContentLoaded', () => {\n+      initFirebase();\n+\n+      const payBtn = document.getElementById('payBtn');\n+      const payBtnText = document.getElementById('payBtnText');\n+      const paymentResult = document.getElementById('paymentResult');\n+\n+      payBtn.addEventListener('click', async () => {\n+          // MODIFIED: Read value from select dropdown\n+          const residentId = document.getElementById('residentIdSelect').value;\n+          const serviceName = document.getElementById('serviceNameInput').value;\n+          const amount = document.getElementById('paymentAmountInput').value;\n+          const phoneNumber = document.getElementById('phoneNumberInput').value;\n+\n+          if (!residentId || !serviceName || !amount || !phoneNumber) {\n+              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n+              paymentResult.textContent = 'Please fill in all fields.';\n+              return;\n+          }\n+\n+          if (isNaN(parseFloat(amount)) || parseFloat(amount) <= 0) {\n+              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n+              paymentResult.textContent = 'Amount must be a valid positive number.';\n+              return;\n+          }\n+\n+          // Disable button and show loading\n+          payBtn.disabled = true;\n+          payBtnText.textContent = 'Processing...';\n+          paymentResult.textContent = '';\n+          paymentResult.classList.add('hidden');\n+\n+          const result = await addPayment(residentId, serviceName, amount, phoneNumber);\n+\n+          // Re-enable button\n+          payBtn.disabled = false;\n+          payBtnText.textContent = 'Simulate Payment';\n+\n+          // Show result\n+          if (result.success) {\n+              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-green-700 bg-green-100 block';\n+          } else {\n+              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n+          }\n+          paymentResult.textContent = result.message;\n+\n+          // Clear form fields, reset select to default\n+          document.getElementById('residentIdSelect').value = '';\n+          document.getElementById('serviceNameInput').value = '';\n+          document.getElementById('paymentAmountInput').value = '';\n+          document.getElementById('phoneNumberInput').value = '';\n+      });\n+\n+      // --- FILTERING ---\n+      document.getElementById('filterInput').addEventListener('input', (e) => {\n+          const filterTerm = e.target.value.toLowerCase();\n+          const filteredData = allPayments.filter(p =>\n+              p.ResidentID.toLowerCase().includes(filterTerm) ||\n+              p.Status.toLowerCase().includes(filterTerm) ||\n+              p.Reference.toLowerCase().includes(filterTerm)\n+          );\n+          renderPaymentsTable(filteredData, 'paymentsBody');\n+      });\n+\n+      document.getElementById('verifiedFilterInput').addEventListener('input', (e) => {\n+          const filterTerm = e.target.value.toLowerCase();\n+          const verified = allPayments.filter(p => p.Status === 'Verified');\n+          const filteredData = verified.filter(p =>\n+              p.ResidentID.toLowerCase().includes(filterTerm)\n+          );\n+          renderVerifiedTable(filteredData);\n+      });\n+\n+\n+      // --- EXPORT LOGIC ---\n+\n+      function exportTable(data, filename) {\n+          const ws = XLSX.utils.json_to_sheet(data);\n+          const wb = XLSX.utils.book_new();\n+          XLSX.utils.book_append_sheet(wb, ws, \"Data\");\n+          XLSX.writeFile(wb, filename);\n+      }\n+\n+      function cleanDataForExport(data) {\n+          return data.map(p => ({\n+              PaymentID: p.PaymentID,\n+              ResidentID: p.ResidentID,\n+              Amount: p.Amount,\n+              PaymentDate: formatDate(p.PaymentDate),\n+              Status: p.Status,\n+              Reference: p.Reference,\n+              PaymentMethod: p.PaymentMethod,\n+              Action: p.Action,\n+              NationalID: p.NationalID,\n+              ServiceName: p.ServiceName,\n+              PhoneNumber: p.PhoneNumber,\n+              VerifiedDate: p.VerifiedDate ? formatDate(p.VerifiedDate) : 'N/A'\n+          }));\n+      }\n+\n+      // Full History Export\n+      document.getElementById('exportExcel').addEventListener('click', () => {\n+          exportTable(cleanDataForExport(allPayments), 'Athi_Payment_History.xlsx');\n+      });\n+      document.getElementById('exportCsv').addEventListener('click', () => {\n+          exportTable(cleanDataForExport(allPayments), 'Athi_Payment_History.csv');\n+      });\n+\n+      // Verified Payments Export\n+      document.getElementById('exportVerifiedExcel').addEventListener('click', () => {\n+          const verified = allPayments.filter(p => p.Status === 'Verified');\n+          exportTable(cleanDataForExport(verified), 'Athi_Verified_Payments.xlsx');\n+      });\n+      document.getElementById('exportVerifiedCsv').addEventListener('click', () => {\n+          const verified = allPayments.filter(p => p.Status === 'Verified');\n+          exportTable(cleanDataForExport(verified), 'Athi_Verified_Payments.csv');\n+      });\n+\n+      // Balances Export\n+      document.getElementById('exportBalancesExcel').addEventListener('click', () => {\n+          const balances = calculateBalances(allPayments); // Recalculate balances\n+          exportTable(balances.map(b => ({\n+              ResidentID: b.ResidentID,\n+              TotalPaid: b.totalPaid,\n+              TotalDue: b.totalDue,\n+              Balance: b.totalPaid - b.totalDue\n+          })), 'Athi_Resident_Balances.xlsx');\n+      });\n+      document.getElementById('exportBalancesCsv').addEventListener('click', () => {\n+          const balances = calculateBalances(allPayments);\n+          exportTable(balances.map(b => ({\n+              ResidentID: b.ResidentID,\n+              TotalPaid: b.totalPaid,\n+              TotalDue: b.totalDue,\n+              Balance: b.totalPaid - b.totalDue\n+          })), 'Athi_Resident_Balances.csv');\n+      });\n+  });\n+\n+</script>\n+</body>\n+</html>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763628282321,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -129,986 +129,7 @@\n       </div>\n     </section>\n   </main>\n \n-<script type=\"module\">\n-  import { initializeApp } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js\";\n-  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js\";\n-  import { getFirestore, collection, onSnapshot, addDoc, doc, setLogLevel, serverTimestamp, query, orderBy } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js\";\n-\n-  // --- GLOBAL FIREBASE/APP SETUP ---\n-  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n-  const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');\n-  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n-\n-  let db, auth, userId;\n-  let allPayments = []; // Store all fetched data globally\n-  setLogLevel('Debug');\n-\n-  // Utility to format date\n-  const formatDate = (timestamp) => {\n-      if (!timestamp || !timestamp.toDate) return 'N/A';\n-      return timestamp.toDate().toLocaleString('en-GB', {\n-          year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'\n-      });\n-  };\n-\n-  // Utility to format currency\n-  const formatCurrency = (amount) => {\n-      return new Intl.NumberFormat('en-KE', { style: 'currency', currency: 'KES' }).format(amount);\n-  };\n-\n-  // --- DATA PROCESSING & RENDERING ---\n-\n-  // NEW FUNCTION: Populates the Resident ID select dropdown\n-  function populateResidentSelect(payments) {\n-      const residentIds = new Set();\n-      // Extract unique Resident IDs from all payments\n-      payments.forEach(p => {\n-          if (p.ResidentID) {\n-              residentIds.add(p.ResidentID.toUpperCase().trim());\n-          }\n-      });\n-\n-      const selectElement = document.getElementById('residentIdSelect');\n-      if (!selectElement) return;\n-\n-      // Preserve the current selected value\n-      const currentSelection = selectElement.value;\n-\n-      // Clear existing options, but keep the disabled placeholder\n-      selectElement.innerHTML = '<option value=\"\" disabled selected>Select Resident ID (or enter new)</option>';\n-\n-      const sortedIds = Array.from(residentIds).sort();\n-\n-      // Add options for each unique ID\n-      sortedIds.forEach(id => {\n-          const option = document.createElement('option');\n-          option.value = id;\n-          option.textContent = id;\n-          if (id === currentSelection) {\n-              option.selected = true;\n-          }\n-          selectElement.appendChild(option);\n-      });\n-  }\n-\n-  function calculateDashboardSummary(payments) {\n-      const totalPayments = payments.length;\n-      const verifiedPayments = payments.filter(p => p.Status === 'Verified').length;\n-      const totalVerifiedAmount = payments\n-          .filter(p => p.Status === 'Verified')\n-          .reduce((sum, p) => sum + p.Amount, 0);\n-\n-      const summaryHtml = `\n-          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n-              <p class=\"text-xs text-gray-500\">Total Transactions</p>\n-              <p class=\"text-xl font-bold text-indigo-600\">${totalPayments}</p>\n-          </div>\n-          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n-              <p class=\"text-xs text-gray-500\">Verified Payments</p>\n-              <p class=\"text-xl font-bold text-green-600\">${verifiedPayments}</p>\n-          </div>\n-          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n-              <p class=\"text-xs text-gray-500\">Total Verified Amount</p>\n-              <p class=\"text-xl font-bold text-indigo-600\">${formatCurrency(totalVerifiedAmount)}</p>\n-          </div>\n-      `;\n-      document.getElementById('dashboardSummary').innerHTML = summaryHtml;\n-  }\n-\n-  function calculateBalances(payments) {\n-      const balances = {};\n-      const requiredDue = {}; // Simple simulation: what they attempted to pay is their \"due\"\n-      const verifiedOnly = payments.filter(p => p.Status === 'Verified');\n-\n-      verifiedOnly.forEach(p => {\n-          const id = p.ResidentID;\n-          if (!balances[id]) {\n-              balances[id] = { totalPaid: 0, totalDue: 0, ResidentID: id };\n-          }\n-          balances[id].totalPaid += p.Amount;\n-      });\n-\n-      // Simple due simulation: sum of all attempted payment amounts\n-      payments.forEach(p => {\n-          const id = p.ResidentID;\n-          if (!balances[id]) {\n-              balances[id] = { totalPaid: 0, totalDue: 0, ResidentID: id };\n-          }\n-          balances[id].totalDue += p.Amount;\n-      });\n-\n-      // Render Balances Table\n-      const balanceBody = document.getElementById('balanceBody');\n-      balanceBody.innerHTML = '';\n-      const balanceArray = Object.values(balances);\n-\n-      // Sort by ResidentID for better display\n-      balanceArray.sort((a, b) => a.ResidentID.localeCompare(b.ResidentID));\n-\n-      balanceArray.forEach(b => {\n-          const balance = b.totalPaid - b.totalDue;\n-          const balanceClass = balance >= 0 ? 'text-green-600' : 'text-red-600 font-bold';\n-          const row = `\n-              <tr class=\"hover:bg-gray-50\">\n-                  <td class=\"px-3 py-2\">${b.ResidentID}</td>\n-                  <td class=\"px-3 py-2 text-right\">${formatCurrency(b.totalPaid)}</td>\n-                  <td class=\"px-3 py-2 text-right\">${formatCurrency(b.totalDue)}</td>\n-                  <td class=\"px-3 py-2 text-right ${balanceClass}\">${formatCurrency(balance)}</td>\n-              </tr>\n-          `;\n-          balanceBody.insertAdjacentHTML('beforeend', row);\n-      });\n-      return balanceArray;\n-  }\n-\n-  function renderPaymentsTable(data, tableId) {\n-      const body = document.getElementById(tableId);\n-      body.innerHTML = '';\n-      if (data.length === 0) {\n-          body.innerHTML = '<tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">No payments found.</td></tr>';\n-          return;\n-      }\n-\n-      data.forEach(p => {\n-          const statusClass = p.Status === 'Verified' ? 'bg-green-100 text-green-800' :\n-                             p.Status === 'Pending' ? 'bg-yellow-100 text-yellow-800' :\n-                             'bg-red-100 text-red-800';\n-\n-          const row = `\n-              <tr class=\"hover:bg-gray-50\">\n-                  <td class=\"px-3 py-1.5\">${p.PaymentID.substring(0, 8)}...</td>\n-                  <td class=\"px-3 py-1.5 font-medium\">${p.ResidentID}</td>\n-                  <td class=\"px-3 py-1.5 text-right\">${formatCurrency(p.Amount)}</td>\n-                  <td class=\"px-3 py-1.5\">${formatDate(p.PaymentDate)}</td>\n-                  <td class=\"px-3 py-1.5\"><span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}\">${p.Status}</span></td>\n-                  <td class=\"px-3 py-1.5\">${p.Reference}</td>\n-                  <td class=\"px-3 py-1.5\">${p.PaymentMethod}</td>\n-                  <td class=\"px-3 py-1.5\">${p.Action || 'View'}</td>\n-                  <td class=\"px-3 py-1.5\">${p.NationalID || 'N/A'}</td>\n-                  <td class=\"px-3 py-1.5\">${p.ServiceName || 'General'}</td>\n-                  <td class=\"px-3 py-1.5\">${p.PhoneNumber || 'N/A'}</td>\n-                  <td class=\"px-3 py-1.5\">${p.VerifiedDate ? formatDate(p.VerifiedDate) : 'Pending'}</td>\n-              </tr>\n-          `;\n-          body.insertAdjacentHTML('beforeend', row);\n-      });\n-  }\n-\n-  function renderVerifiedTable(data) {\n-      const body = document.getElementById('verifiedBody');\n-      body.innerHTML = '';\n-      const verified = data.filter(p => p.Status === 'Verified');\n-\n-      if (verified.length === 0) {\n-          body.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No verified payments found.</td></tr>';\n-          return;\n-      }\n-\n-      verified.forEach(p => {\n-          const row = `\n-              <tr class=\"hover:bg-gray-50\">\n-                  <td class=\"px-3 py-1.5 font-medium\">${p.ResidentID}</td>\n-                  <td class=\"px-3 py-1.5 text-right\">${formatCurrency(p.Amount)}</td>\n-                  <td class=\"px-3 py-1.5\">${p.Reference}</td>\n-                  <td class=\"px-3 py-1.5\">${formatDate(p.VerifiedDate)}</td>\n-              </tr>\n-          `;\n-          body.insertAdjacentHTML('beforeend', row);\n-      });\n-      return verified;\n-  }\n-\n-  // --- FIREBASE INTERACTION ---\n-\n-  async function initFirebase() {\n-      try {\n-          const app = initializeApp(firebaseConfig);\n-          db = getFirestore(app);\n-          auth = getAuth(app);\n-\n-          // Sign in using custom token or anonymously\n-          if (initialAuthToken) {\n-              await signInWithCustomToken(auth, initialAuthToken);\n-          } else {\n-              await signInAnonymously(auth);\n-          }\n-\n-          onAuthStateChanged(auth, (user) => {\n-              if (user) {\n-                  userId = user.uid;\n-                  document.getElementById('userInfo').textContent = `User ID: ${userId}`;\n-                  startRealtimeListener();\n-              } else {\n-                  console.error(\"User not authenticated.\");\n-                  document.getElementById('userInfo').textContent = 'Authentication Failed';\n-              }\n-          });\n-      } catch (error) {\n-          console.error(\"Error initializing Firebase:\", error);\n-          document.getElementById('userInfo').textContent = `Init Error: ${error.message}`;\n-      }\n-  }\n-\n-  function startRealtimeListener() {\n-      if (!db) return;\n-\n-      const paymentsCollectionPath = `/artifacts/${appId}/public/data/payments`;\n-      const q = collection(db, paymentsCollectionPath);\n-\n-      // Listen for real-time updates\n-      onSnapshot(q, (snapshot) => {\n-          allPayments = snapshot.docs.map(doc => ({\n-              id: doc.id,\n-              ...doc.data()\n-          }));\n-\n-          // Sort by PaymentDate descending\n-          allPayments.sort((a, b) => (b.PaymentDate?.toMillis() || 0) - (a.PaymentDate?.toMillis() || 0));\n-\n-          // Process and render data\n-          updateAllViews(allPayments);\n-      }, (error) => {\n-          console.error(\"Error listening to payments collection:\", error);\n-      });\n-  }\n-\n-  function updateAllViews(data) {\n-      // 1. Dashboard Summary\n-      calculateDashboardSummary(data);\n-\n-      // 2. Populate the Resident ID Select Dropdown\n-      populateResidentSelect(data);\n-\n-      // 3. Full Payment History Table (Default display, unfiltered)\n-      renderPaymentsTable(data, 'paymentsBody');\n-\n-      // 4. Verified Payments Table (Default display, unfiltered)\n-      renderVerifiedTable(data);\n-\n-      // 5. Balances Table\n-      calculateBalances(data);\n-  }\n-\n-\n-  async function addPayment(residentId, serviceName, amount, phoneNumber) {\n-      if (!db || !userId) {\n-          console.error(\"Database not initialized or user not logged in.\");\n-          return { success: false, message: \"System error: Database not ready.\" };\n-      }\n-\n-      const paymentsCollectionPath = `/artifacts/${appId}/public/data/payments`;\n-\n-      // Simple logic to simulate verification/status based on amount\n-      const isVerified = amount > 1000; // Large payments auto-verified for simulation\n-      const status = isVerified ? 'Verified' : 'Pending';\n-      const reference = 'MPESA' + Math.random().toString(36).substring(2, 10).toUpperCase();\n-\n-      const newPayment = {\n-          PaymentID: crypto.randomUUID(),\n-          ResidentID: residentId.toUpperCase().trim(),\n-          Amount: parseFloat(amount),\n-          PaymentDate: serverTimestamp(),\n-          Status: status,\n-          Reference: reference,\n-          PaymentMethod: 'MPESA',\n-          Action: 'Initial Payment',\n-          NationalID: '', // Placeholder\n-          ServiceName: serviceName,\n-          PhoneNumber: phoneNumber,\n-          VerifiedDate: isVerified ? serverTimestamp() : null\n-      };\n-\n-      try {\n-          await addDoc(collection(db, paymentsCollectionPath), newPayment);\n-          return {\n-              success: true,\n-              message: `Payment of ${formatCurrency(amount)} for ${residentId} initiated. Status: ${status}. Ref: ${reference}.`\n-          };\n-      } catch (e) {\n-          console.error(\"Error adding document: \", e);\n-          return { success: false, message: `Error processing payment: ${e.message}` };\n-      }\n-  }\n-\n-  // --- UI/EVENT HANDLERS ---\n-\n-  document.addEventListener('DOMContentLoaded', () => {\n-      initFirebase();\n-\n-      const payBtn = document.getElementById('payBtn');\n-      const payBtnText = document.getElementById('payBtnText');\n-      const paymentResult = document.getElementById('paymentResult');\n-\n-      payBtn.addEventListener('click', async () => {\n-          // MODIFIED: Read value from select dropdown\n-          const residentId = document.getElementById('residentIdSelect').value;\n-          const serviceName = document.getElementById('serviceNameInput').value;\n-          const amount = document.getElementById('paymentAmountInput').value;\n-          const phoneNumber = document.getElementById('phoneNumberInput').value;\n-\n-          if (!residentId || !serviceName || !amount || !phoneNumber) {\n-              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n-              paymentResult.textContent = 'Please fill in all fields.';\n-              return;\n-          }\n-\n-          if (isNaN(parseFloat(amount)) || parseFloat(amount) <= 0) {\n-              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n-              paymentResult.textContent = 'Amount must be a valid positive number.';\n-              return;\n-          }\n-\n-          // Disable button and show loading\n-          payBtn.disabled = true;\n-          payBtnText.textContent = 'Processing...';\n-          paymentResult.textContent = '';\n-          paymentResult.classList.add('hidden');\n-\n-          const result = await addPayment(residentId, serviceName, amount, phoneNumber);\n-\n-          // Re-enable button\n-          payBtn.disabled = false;\n-          payBtnText.textContent = 'Simulate Payment';\n-\n-          // Show result\n-          if (result.success) {\n-              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-green-700 bg-green-100 block';\n-          } else {\n-              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n-          }\n-          paymentResult.textContent = result.message;\n-\n-          // Clear form fields, reset select to default\n-          document.getElementById('residentIdSelect').value = '';\n-          document.getElementById('serviceNameInput').value = '';\n-          document.getElementById('paymentAmountInput').value = '';\n-          document.getElementById('phoneNumberInput').value = '';\n-      });\n-\n-      // --- FILTERING ---\n-      document.getElementById('filterInput').addEventListener('input', (e) => {\n-          const filterTerm = e.target.value.toLowerCase();\n-          const filteredData = allPayments.filter(p =>\n-              p.ResidentID.toLowerCase().includes(filterTerm) ||\n-              p.Status.toLowerCase().includes(filterTerm) ||\n-              p.Reference.toLowerCase().includes(filterTerm)\n-          );\n-          renderPaymentsTable(filteredData, 'paymentsBody');\n-      });\n-\n-      document.getElementById('verifiedFilterInput').addEventListener('input', (e) => {\n-          const filterTerm = e.target.value.toLowerCase();\n-          const verified = allPayments.filter(p => p.Status === 'Verified');\n-          const filteredData = verified.filter(p =>\n-              p.ResidentID.toLowerCase().includes(filterTerm)\n-          );\n-          renderVerifiedTable(filteredData);\n-      });\n-\n-\n-      // --- EXPORT LOGIC ---\n-\n-      function exportTable(data, filename) {\n-          const ws = XLSX.utils.json_to_sheet(data);\n-          const wb = XLSX.utils.book_new();\n-          XLSX.utils.book_append_sheet(wb, ws, \"Data\");\n-          XLSX.writeFile(wb, filename);\n-      }\n-\n-      function cleanDataForExport(data) {\n-          return data.map(p => ({\n-              PaymentID: p.PaymentID,\n-              ResidentID: p.ResidentID,\n-              Amount: p.Amount,\n-              PaymentDate: formatDate(p.PaymentDate),\n-              Status: p.Status,\n-              Reference: p.Reference,\n-              PaymentMethod: p.PaymentMethod,\n-              Action: p.Action,\n-              NationalID: p.NationalID,\n-              ServiceName: p.ServiceName,\n-              PhoneNumber: p.PhoneNumber,\n-              VerifiedDate: p.VerifiedDate ? formatDate(p.VerifiedDate) : 'N/A'\n-          }));\n-      }\n-\n-      // Full History Export\n-      document.getElementById('exportExcel').addEventListener('click', () => {\n-          exportTable(cleanDataForExport(allPayments), 'Athi_Payment_History.xlsx');\n-      });\n-      document.getElementById('exportCsv').addEventListener('click', () => {\n-          exportTable(cleanDataForExport(allPayments), 'Athi_Payment_History.csv');\n-      });\n-\n-      // Verified Payments Export\n-      document.getElementById('exportVerifiedExcel').addEventListener('click', () => {\n-          const verified = allPayments.filter(p => p.Status === 'Verified');\n-          exportTable(cleanDataForExport(verified), 'Athi_Verified_Payments.xlsx');\n-      });\n-      document.getElementById('exportVerifiedCsv').addEventListener('click', () => {\n-          const verified = allPayments.filter(p => p.Status === 'Verified');\n-          exportTable(cleanDataForExport(verified), 'Athi_Verified_Payments.csv');\n-      });\n-\n-      // Balances Export\n-      document.getElementById('exportBalancesExcel').addEventListener('click', () => {\n-          const balances = calculateBalances(allPayments); // Recalculate balances\n-          exportTable(balances.map(b => ({\n-              ResidentID: b.ResidentID,\n-              TotalPaid: b.totalPaid,\n-              TotalDue: b.totalDue,\n-              Balance: b.totalPaid - b.totalDue\n-          })), 'Athi_Resident_Balances.xlsx');\n-      });\n-      document.getElementById('exportBalancesCsv').addEventListener('click', () => {\n-          const balances = calculateBalances(allPayments);\n-          exportTable(balances.map(b => ({\n-              ResidentID: b.ResidentID,\n-              TotalPaid: b.totalPaid,\n-              TotalDue: b.totalDue,\n-              Balance: b.totalPaid - b.totalDue\n-          })), 'Athi_Resident_Balances.csv');\n-      });\n-  });\n-\n-</script>\n+<script type=\"module\" src=\"js/payment.js\"></script>\n </body>\n-</html>\n-<!DOCTYPE html>\n-<html lang=\"en\">\n-<head>\n- <meta charset=\"UTF-8\" />\n- <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n- <title>Athi Estate | Payments</title>\n- <script src=\"https://cdn.tailwindcss.com\"></script>\n- <!-- Inter Font -->\n- <style>\n-    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n-    body {\n-        font-family: 'Inter', sans-serif;\n-    }\n- </style>\n- <!-- XLSX for Excel/CSV export -->\n- <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n-</head>\n-<body class=\"bg-gray-50 text-gray-800 flex flex-col h-screen\">\n-\n-  <header class=\"bg-white shadow-md p-4 sticky top-0 z-10\">\n-      <div class=\"max-w-7xl mx-auto flex justify-between items-center\">\n-          <h1 class=\"text-xl font-bold text-indigo-700\">Athi Estate Payments</h1>\n-          <div id=\"userInfo\" class=\"text-xs text-gray-500\">Loading User...</div>\n-      </div>\n-  </header>\n-\n-  <!-- DASHBOARD SUMMARY -->\n-  <section id=\"dashboardSummary\" class=\"p-4 pt-2 max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-3 gap-4 text-xs w-full\"></section>\n-\n-  <main class=\"flex-1 overflow-y-auto p-4 max-w-7xl mx-auto w-full space-y-4\">\n-\n-      <!-- MPESA PAYMENT SIMULATION / FORM -->\n-    <section class=\"bg-white p-6 rounded-xl shadow-lg border border-indigo-100\">\n-      <h2 class=\"text-indigo-700 font-bold mb-4 text-lg\">ðŸ’³ Initiate MPESA Payment</h2>\n-      <div class=\"flex flex-col space-y-3 max-w-sm\">\n-          <input type=\"text\" id=\"residentIdInput\" placeholder=\"Resident ID (e.g., RES001)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n-          <input type=\"text\" id=\"serviceNameInput\" placeholder=\"Service Name (e.g., Monthly Dues)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n-          <input type=\"number\" id=\"paymentAmountInput\" placeholder=\"Amount (Ksh)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n-          <input type=\"text\" id=\"phoneNumberInput\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n-          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]\">\n-              <span id=\"payBtnText\">Simulate Payment</span>\n-          </button>\n-          <div id=\"paymentResult\" class=\"text-xs mt-2 p-2 rounded-lg text-center hidden\"></div>\n-      </div>\n-    </section>\n-\n-    <!-- PAYMENT HISTORY -->\n-    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-indigo-100\">\n-      <h3 class=\"text-indigo-700 font-semibold mb-3 text-lg\">ðŸ“‹ Full Payment History</h3>\n-      <div class=\"flex justify-between items-center mb-3 text-sm\">\n-          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID, Status, or Ref\" class=\"border rounded-lg px-3 py-1.5 focus:ring-indigo-500 focus:border-indigo-500 transition w-1/3\"/>\n-          <div class=\"space-x-2\">\n-              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n-              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n-          </div>\n-      </div>\n-      <div class=\"overflow-x-auto overflow-y-auto max-h-[300px] border border-gray-200 rounded-lg\">\n-          <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0 shadow-sm\">\n-                  <tr>\n-                      <th class=\"px-3 py-2 text-left w-16\">ID</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n-                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Date</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Status</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Method</th>\n-                      <th class=\"px-3 py-2 text-left w-16\">Action</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">NationalID</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Service Name</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Phone</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n-                  </tr>\n-              </thead>\n-              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\">\n-                  <tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">Loading payments...</td></tr>\n-              </tbody>\n-          </table>\n-      </div>\n-    </section>\n-\n-    <!-- VERIFIED PAYMENTS (Simplified View) -->\n-    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-green-100\">\n-      <h3 class=\"text-green-700 font-semibold mb-3 text-lg\">âœ… Verified Transactions</h3>\n-      <div class=\"flex justify-between items-center mb-3 text-sm\">\n-          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded-lg px-3 py-1.5 focus:ring-green-500 focus:border-green-500 transition w-1/3\"/>\n-          <div class=\"space-x-2\">\n-              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n-              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n-          </div>\n-      </div>\n-      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n-          <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-green-100 text-green-800 sticky top-0 shadow-sm\">\n-                  <tr>\n-                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n-                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n-                  </tr>\n-              </thead>\n-              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-100\"></tbody>\n-          </table>\n-      </div>\n-    </section>\n-\n-    <!-- BALANCES (Grouped by Resident) -->\n-    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-yellow-100\">\n-      <h3 class=\"text-yellow-700 font-semibold mb-3 text-lg\">ðŸ’° Resident Balances Summary</h3>\n-      <div class=\"flex justify-end mb-3 text-sm space-x-2\">\n-          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n-          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n-      </div>\n-      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n-          <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0 shadow-sm\">\n-                  <tr>\n-                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Total Paid (Verified)</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Total Due (Simulated)</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Balance</th>\n-                  </tr>\n-              </thead>\n-              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-100\"></tbody>\n-          </table>\n-      </div>\n-    </section>\n-  </main>\n-\n-<script type=\"module\">\n-  import { initializeApp } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js\";\n-  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js\";\n-  import { getFirestore, collection, onSnapshot, addDoc, doc, setLogLevel, serverTimestamp, query, orderBy } from \"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js\";\n-\n-  // --- GLOBAL FIREBASE/APP SETUP ---\n-  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n-  const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');\n-  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\n-\n-  let db, auth, userId;\n-  let allPayments = []; // Store all fetched data globally\n-  setLogLevel('Debug');\n-\n-  // Utility to format date\n-  const formatDate = (timestamp) => {\n-      if (!timestamp || !timestamp.toDate) return 'N/A';\n-      return timestamp.toDate().toLocaleString('en-GB', {\n-          year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'\n-      });\n-  };\n-\n-  // Utility to format currency\n-  const formatCurrency = (amount) => {\n-      return new Intl.NumberFormat('en-KE', { style: 'currency', currency: 'KES' }).format(amount);\n-  };\n-\n-  // --- DATA PROCESSING & RENDERING ---\n-\n-  function calculateDashboardSummary(payments) {\n-      const totalPayments = payments.length;\n-      const verifiedPayments = payments.filter(p => p.Status === 'Verified').length;\n-      const totalVerifiedAmount = payments\n-          .filter(p => p.Status === 'Verified')\n-          .reduce((sum, p) => sum + p.Amount, 0);\n-\n-      const summaryHtml = `\n-          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n-              <p class=\"text-xs text-gray-500\">Total Transactions</p>\n-              <p class=\"text-xl font-bold text-indigo-600\">${totalPayments}</p>\n-          </div>\n-          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n-              <p class=\"text-xs text-gray-500\">Verified Payments</p>\n-              <p class=\"text-xl font-bold text-green-600\">${verifiedPayments}</p>\n-          </div>\n-          <div class=\"bg-white p-4 rounded-xl shadow-md border border-gray-200\">\n-              <p class=\"text-xs text-gray-500\">Total Verified Amount</p>\n-              <p class=\"text-xl font-bold text-indigo-600\">${formatCurrency(totalVerifiedAmount)}</p>\n-          </div>\n-      `;\n-      document.getElementById('dashboardSummary').innerHTML = summaryHtml;\n-  }\n-\n-  function calculateBalances(payments) {\n-      const balances = {};\n-      const requiredDue = {}; // Simple simulation: what they attempted to pay is their \"due\"\n-      const verifiedOnly = payments.filter(p => p.Status === 'Verified');\n-\n-      verifiedOnly.forEach(p => {\n-          const id = p.ResidentID;\n-          if (!balances[id]) {\n-              balances[id] = { totalPaid: 0, totalDue: 0, ResidentID: id };\n-          }\n-          balances[id].totalPaid += p.Amount;\n-      });\n-\n-      // Simple due simulation: sum of all attempted payment amounts\n-      payments.forEach(p => {\n-          const id = p.ResidentID;\n-          if (!balances[id]) {\n-              balances[id] = { totalPaid: 0, totalDue: 0, ResidentID: id };\n-          }\n-          balances[id].totalDue += p.Amount;\n-      });\n-\n-      // Render Balances Table\n-      const balanceBody = document.getElementById('balanceBody');\n-      balanceBody.innerHTML = '';\n-      const balanceArray = Object.values(balances);\n-\n-      // Sort by ResidentID for better display\n-      balanceArray.sort((a, b) => a.ResidentID.localeCompare(b.ResidentID));\n-\n-      balanceArray.forEach(b => {\n-          const balance = b.totalPaid - b.totalDue;\n-          const balanceClass = balance >= 0 ? 'text-green-600' : 'text-red-600 font-bold';\n-          const row = `\n-              <tr class=\"hover:bg-gray-50\">\n-                  <td class=\"px-3 py-2\">${b.ResidentID}</td>\n-                  <td class=\"px-3 py-2 text-right\">${formatCurrency(b.totalPaid)}</td>\n-                  <td class=\"px-3 py-2 text-right\">${formatCurrency(b.totalDue)}</td>\n-                  <td class=\"px-3 py-2 text-right ${balanceClass}\">${formatCurrency(balance)}</td>\n-              </tr>\n-          `;\n-          balanceBody.insertAdjacentHTML('beforeend', row);\n-      });\n-      return balanceArray;\n-  }\n-\n-  function renderPaymentsTable(data, tableId) {\n-      const body = document.getElementById(tableId);\n-      body.innerHTML = '';\n-      if (data.length === 0) {\n-          body.innerHTML = '<tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">No payments found.</td></tr>';\n-          return;\n-      }\n-\n-      data.forEach(p => {\n-          const statusClass = p.Status === 'Verified' ? 'bg-green-100 text-green-800' :\n-                             p.Status === 'Pending' ? 'bg-yellow-100 text-yellow-800' :\n-                             'bg-red-100 text-red-800';\n-\n-          const row = `\n-              <tr class=\"hover:bg-gray-50\">\n-                  <td class=\"px-3 py-1.5\">${p.PaymentID.substring(0, 8)}...</td>\n-                  <td class=\"px-3 py-1.5 font-medium\">${p.ResidentID}</td>\n-                  <td class=\"px-3 py-1.5 text-right\">${formatCurrency(p.Amount)}</td>\n-                  <td class=\"px-3 py-1.5\">${formatDate(p.PaymentDate)}</td>\n-                  <td class=\"px-3 py-1.5\"><span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}\">${p.Status}</span></td>\n-                  <td class=\"px-3 py-1.5\">${p.Reference}</td>\n-                  <td class=\"px-3 py-1.5\">${p.PaymentMethod}</td>\n-                  <td class=\"px-3 py-1.5\">${p.Action || 'View'}</td>\n-                  <td class=\"px-3 py-1.5\">${p.NationalID || 'N/A'}</td>\n-                  <td class=\"px-3 py-1.5\">${p.ServiceName || 'General'}</td>\n-                  <td class=\"px-3 py-1.5\">${p.PhoneNumber || 'N/A'}</td>\n-                  <td class=\"px-3 py-1.5\">${p.VerifiedDate ? formatDate(p.VerifiedDate) : 'Pending'}</td>\n-              </tr>\n-          `;\n-          body.insertAdjacentHTML('beforeend', row);\n-      });\n-  }\n-\n-  function renderVerifiedTable(data) {\n-      const body = document.getElementById('verifiedBody');\n-      body.innerHTML = '';\n-      const verified = data.filter(p => p.Status === 'Verified');\n-\n-      if (verified.length === 0) {\n-          body.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No verified payments found.</td></tr>';\n-          return;\n-      }\n-\n-      verified.forEach(p => {\n-          const row = `\n-              <tr class=\"hover:bg-gray-50\">\n-                  <td class=\"px-3 py-1.5 font-medium\">${p.ResidentID}</td>\n-                  <td class=\"px-3 py-1.5 text-right\">${formatCurrency(p.Amount)}</td>\n-                  <td class=\"px-3 py-1.5\">${p.Reference}</td>\n-                  <td class=\"px-3 py-1.5\">${formatDate(p.VerifiedDate)}</td>\n-              </tr>\n-          `;\n-          body.insertAdjacentHTML('beforeend', row);\n-      });\n-      return verified;\n-  }\n-\n-  // --- FIREBASE INTERACTION ---\n-\n-  async function initFirebase() {\n-      try {\n-          const app = initializeApp(firebaseConfig);\n-          db = getFirestore(app);\n-          auth = getAuth(app);\n-\n-          // Sign in using custom token or anonymously\n-          if (initialAuthToken) {\n-              await signInWithCustomToken(auth, initialAuthToken);\n-          } else {\n-              await signInAnonymously(auth);\n-          }\n-\n-          onAuthStateChanged(auth, (user) => {\n-              if (user) {\n-                  userId = user.uid;\n-                  document.getElementById('userInfo').textContent = `User ID: ${userId}`;\n-                  startRealtimeListener();\n-              } else {\n-                  console.error(\"User not authenticated.\");\n-                  document.getElementById('userInfo').textContent = 'Authentication Failed';\n-              }\n-          });\n-      } catch (error) {\n-          console.error(\"Error initializing Firebase:\", error);\n-          document.getElementById('userInfo').textContent = `Init Error: ${error.message}`;\n-      }\n-  }\n-\n-  function startRealtimeListener() {\n-      if (!db) return;\n-\n-      const paymentsCollectionPath = `/artifacts/${appId}/public/data/payments`;\n-      const q = collection(db, paymentsCollectionPath);\n-\n-      // Listen for real-time updates\n-      onSnapshot(q, (snapshot) => {\n-          allPayments = snapshot.docs.map(doc => ({\n-              id: doc.id,\n-              ...doc.data()\n-          }));\n-\n-          // Sort by PaymentDate descending\n-          allPayments.sort((a, b) => (b.PaymentDate?.toMillis() || 0) - (a.PaymentDate?.toMillis() || 0));\n-\n-          // Process and render data\n-          updateAllViews(allPayments);\n-      }, (error) => {\n-          console.error(\"Error listening to payments collection:\", error);\n-      });\n-  }\n-\n-  function updateAllViews(data) {\n-      // 1. Dashboard Summary\n-      calculateDashboardSummary(data);\n-\n-      // 2. Full Payment History Table (Default display, unfiltered)\n-      renderPaymentsTable(data, 'paymentsBody');\n-\n-      // 3. Verified Payments Table (Default display, unfiltered)\n-      renderVerifiedTable(data);\n-\n-      // 4. Balances Table\n-      calculateBalances(data);\n-  }\n-\n-\n-  async function addPayment(residentId, serviceName, amount, phoneNumber) {\n-      if (!db || !userId) {\n-          console.error(\"Database not initialized or user not logged in.\");\n-          return { success: false, message: \"System error: Database not ready.\" };\n-      }\n-\n-      const paymentsCollectionPath = `/artifacts/${appId}/public/data/payments`;\n-\n-      // Simple logic to simulate verification/status based on amount\n-      const isVerified = amount > 1000; // Large payments auto-verified for simulation\n-      const status = isVerified ? 'Verified' : 'Pending';\n-      const reference = 'MPESA' + Math.random().toString(36).substring(2, 10).toUpperCase();\n-\n-      const newPayment = {\n-          PaymentID: crypto.randomUUID(),\n-          ResidentID: residentId.toUpperCase().trim(),\n-          Amount: parseFloat(amount),\n-          PaymentDate: serverTimestamp(),\n-          Status: status,\n-          Reference: reference,\n-          PaymentMethod: 'MPESA',\n-          Action: 'Initial Payment',\n-          NationalID: '', // Placeholder\n-          ServiceName: serviceName,\n-          PhoneNumber: phoneNumber,\n-          VerifiedDate: isVerified ? serverTimestamp() : null\n-      };\n-\n-      try {\n-          await addDoc(collection(db, paymentsCollectionPath), newPayment);\n-          return {\n-              success: true,\n-              message: `Payment of ${formatCurrency(amount)} for ${residentId} initiated. Status: ${status}. Ref: ${reference}.`\n-          };\n-      } catch (e) {\n-          console.error(\"Error adding document: \", e);\n-          return { success: false, message: `Error processing payment: ${e.message}` };\n-      }\n-  }\n-\n-  // --- UI/EVENT HANDLERS ---\n-\n-  document.addEventListener('DOMContentLoaded', () => {\n-      initFirebase();\n-\n-      const payBtn = document.getElementById('payBtn');\n-      const payBtnText = document.getElementById('payBtnText');\n-      const paymentResult = document.getElementById('paymentResult');\n-\n-      payBtn.addEventListener('click', async () => {\n-          const residentId = document.getElementById('residentIdInput').value;\n-          const serviceName = document.getElementById('serviceNameInput').value;\n-          const amount = document.getElementById('paymentAmountInput').value;\n-          const phoneNumber = document.getElementById('phoneNumberInput').value;\n-\n-          if (!residentId || !serviceName || !amount || !phoneNumber) {\n-              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n-              paymentResult.textContent = 'Please fill in all fields.';\n-              return;\n-          }\n-\n-          if (isNaN(parseFloat(amount)) || parseFloat(amount) <= 0) {\n-              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n-              paymentResult.textContent = 'Amount must be a valid positive number.';\n-              return;\n-          }\n-\n-          // Disable button and show loading\n-          payBtn.disabled = true;\n-          payBtnText.textContent = 'Processing...';\n-          paymentResult.textContent = '';\n-          paymentResult.classList.add('hidden');\n-\n-          const result = await addPayment(residentId, serviceName, amount, phoneNumber);\n-\n-          // Re-enable button\n-          payBtn.disabled = false;\n-          payBtnText.textContent = 'Simulate Payment';\n-\n-          // Show result\n-          if (result.success) {\n-              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-green-700 bg-green-100 block';\n-          } else {\n-              paymentResult.className = 'text-xs mt-2 p-2 rounded-lg text-red-700 bg-red-100 block';\n-          }\n-          paymentResult.textContent = result.message;\n-\n-          // Clear form fields\n-          document.getElementById('residentIdInput').value = '';\n-          document.getElementById('serviceNameInput').value = '';\n-          document.getElementById('paymentAmountInput').value = '';\n-          document.getElementById('phoneNumberInput').value = '';\n-      });\n-\n-      // --- FILTERING ---\n-      document.getElementById('filterInput').addEventListener('input', (e) => {\n-          const filterTerm = e.target.value.toLowerCase();\n-          const filteredData = allPayments.filter(p =>\n-              p.ResidentID.toLowerCase().includes(filterTerm) ||\n-              p.Status.toLowerCase().includes(filterTerm) ||\n-              p.Reference.toLowerCase().includes(filterTerm)\n-          );\n-          renderPaymentsTable(filteredData, 'paymentsBody');\n-      });\n-\n-      document.getElementById('verifiedFilterInput').addEventListener('input', (e) => {\n-          const filterTerm = e.target.value.toLowerCase();\n-          const verified = allPayments.filter(p => p.Status === 'Verified');\n-          const filteredData = verified.filter(p =>\n-              p.ResidentID.toLowerCase().includes(filterTerm)\n-          );\n-          renderVerifiedTable(filteredData);\n-      });\n-\n-\n-      // --- EXPORT LOGIC ---\n-\n-      function exportTable(data, filename) {\n-          const ws = XLSX.utils.json_to_sheet(data);\n-          const wb = XLSX.utils.book_new();\n-          XLSX.utils.book_append_sheet(wb, ws, \"Data\");\n-          XLSX.writeFile(wb, filename);\n-      }\n-\n-      function cleanDataForExport(data) {\n-          return data.map(p => ({\n-              PaymentID: p.PaymentID,\n-              ResidentID: p.ResidentID,\n-              Amount: p.Amount,\n-              PaymentDate: formatDate(p.PaymentDate),\n-              Status: p.Status,\n-              Reference: p.Reference,\n-              PaymentMethod: p.PaymentMethod,\n-              Action: p.Action,\n-              NationalID: p.NationalID,\n-              ServiceName: p.ServiceName,\n-              PhoneNumber: p.PhoneNumber,\n-              VerifiedDate: p.VerifiedDate ? formatDate(p.VerifiedDate) : 'N/A'\n-          }));\n-      }\n-\n-      // Full History Export\n-      document.getElementById('exportExcel').addEventListener('click', () => {\n-          exportTable(cleanDataForExport(allPayments), 'Athi_Payment_History.xlsx');\n-      });\n-      document.getElementById('exportCsv').addEventListener('click', () => {\n-          exportTable(cleanDataForExport(allPayments), 'Athi_Payment_History.csv');\n-      });\n-\n-      // Verified Payments Export\n-      document.getElementById('exportVerifiedExcel').addEventListener('click', () => {\n-          const verified = allPayments.filter(p => p.Status === 'Verified');\n-          exportTable(cleanDataForExport(verified), 'Athi_Verified_Payments.xlsx');\n-      });\n-      document.getElementById('exportVerifiedCsv').addEventListener('click', () => {\n-          const verified = allPayments.filter(p => p.Status === 'Verified');\n-          exportTable(cleanDataForExport(verified), 'Athi_Verified_Payments.csv');\n-      });\n-\n-      // Balances Export\n-      document.getElementById('exportBalancesExcel').addEventListener('click', () => {\n-          const balances = calculateBalances(allPayments); // Recalculate balances\n-          exportTable(balances.map(b => ({\n-              ResidentID: b.ResidentID,\n-              TotalPaid: b.totalPaid,\n-              TotalDue: b.totalDue,\n-              Balance: b.totalPaid - b.totalDue\n-          })), 'Athi_Resident_Balances.xlsx');\n-      });\n-      document.getElementById('exportBalancesCsv').addEventListener('click', () => {\n-          const balances = calculateBalances(allPayments);\n-          exportTable(balances.map(b => ({\n-              ResidentID: b.ResidentID,\n-              TotalPaid: b.totalPaid,\n-              TotalDue: b.totalDue,\n-              Balance: b.totalPaid - b.totalDue\n-          })), 'Athi_Resident_Balances.csv');\n-      });\n-  });\n-\n-</script>\n-</body>\n </html>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763631824961,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,135 +1,135 @@\n <!DOCTYPE html>\n <html lang=\"en\">\n <head>\n- <meta charset=\"UTF-8\" />\n- <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n- <title>Athi Estate | Payments</title>\n- <script src=\"https://cdn.tailwindcss.com\"></script>\n- <!-- Inter Font -->\n- <style>\n-    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n-    body {\n-        font-family: 'Inter', sans-serif;\n-    }\n- </style>\n- <!-- XLSX for Excel/CSV export -->\n- <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n+  <meta charset=\"UTF-8\" />\n+  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n+  <title>Athi Estate | Payments</title>\n+\n+  <!-- Link external CSS file (html.css) -->\n+  <link rel=\"stylesheet\" href=\"css/html.css\" />\n+\n+  <!-- XLSX for Excel/CSV export -->\n+  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n </head>\n-<body class=\"bg-gray-50 text-gray-800 flex flex-col h-screen\">\n+<body>\n \n-  <header class=\"bg-white shadow-md p-4 sticky top-0 z-10\">\n-      <div class=\"max-w-7xl mx-auto flex justify-between items-center\">\n-          <h1 class=\"text-xl font-bold text-indigo-700\">Athi Estate Payments</h1>\n-          <div id=\"userInfo\" class=\"text-xs text-gray-500\">Loading User...</div>\n+  <!-- HEADER -->\n+  <header>\n+      <div class=\"header-container\">\n+          <h1>Athi Estate Payments</h1>\n+          <div id=\"userInfo\">Loading User...</div>\n       </div>\n   </header>\n \n   <!-- DASHBOARD SUMMARY -->\n-  <section id=\"dashboardSummary\" class=\"p-4 pt-2 max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-3 gap-4 text-xs w-full\"></section>\n+  <section id=\"dashboardSummary\"></section>\n \n-  <main class=\"flex-1 overflow-y-auto p-4 max-w-7xl mx-auto w-full space-y-4\">\n+  <main>\n \n-      <!-- MPESA PAYMENT SIMULATION / FORM -->\n-    <section class=\"bg-white p-6 rounded-xl shadow-lg border border-indigo-100\">\n-      <h2 class=\"text-indigo-700 font-bold mb-4 text-lg\">ðŸ’³ Initiate MPESA Payment</h2>\n-      <div class=\"flex flex-col space-y-3 max-w-sm\">\n-          <!-- UPDATED: Replaced input with a select dropdown for existing Resident IDs -->\n-          <select id=\"residentIdSelect\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\">\n+    <!-- MPESA PAYMENT FORM -->\n+    <section>\n+      <h2>ðŸ’³ Initiate MPESA Payment</h2>\n+      <div class=\"form-container\">\n+          <select id=\"residentIdSelect\">\n               <option value=\"\" disabled selected>Select Resident ID (or enter new)</option>\n           </select>\n-          <input type=\"text\" id=\"serviceNameInput\" placeholder=\"Service Name (e.g., Monthly Dues)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n-          <input type=\"number\" id=\"paymentAmountInput\" placeholder=\"Amount (Ksh)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n-          <input type=\"text\" id=\"phoneNumberInput\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n-          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]\">\n+          <input type=\"text\" id=\"serviceNameInput\" placeholder=\"Service Name (e.g., Monthly Dues)\" />\n+          <input type=\"number\" id=\"paymentAmountInput\" placeholder=\"Amount (Ksh)\" />\n+          <input type=\"text\" id=\"phoneNumberInput\" placeholder=\"Phone (2547XXXXXXXX)\" />\n+          <button id=\"payBtn\">\n               <span id=\"payBtnText\">Simulate Payment</span>\n           </button>\n-          <div id=\"paymentResult\" class=\"text-xs mt-2 p-2 rounded-lg text-center hidden\"></div>\n+          <div id=\"paymentResult\" class=\"hidden\"></div>\n       </div>\n     </section>\n \n     <!-- PAYMENT HISTORY -->\n-    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-indigo-100\">\n-      <h3 class=\"text-indigo-700 font-semibold mb-3 text-lg\">ðŸ“‹ Full Payment History</h3>\n-      <div class=\"flex justify-between items-center mb-3 text-sm\">\n-          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID, Status, or Ref\" class=\"border rounded-lg px-3 py-1.5 focus:ring-indigo-500 focus:border-indigo-500 transition w-1/3\"/>\n-          <div class=\"space-x-2\">\n-              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n-              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n+    <section>\n+      <h3>ðŸ“‹ Full Payment History</h3>\n+      <div class=\"table-controls\">\n+          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID, Status, or Ref\" />\n+          <div>\n+              <button id=\"exportCsv\">Export CSV</button>\n+              <button id=\"exportExcel\">Export Excel</button>\n           </div>\n       </div>\n-      <div class=\"overflow-x-auto overflow-y-auto max-h-[300px] border border-gray-200 rounded-lg\">\n-          <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0 shadow-sm\">\n+      <div class=\"table-wrapper\">\n+          <table id=\"paymentsTable\">\n+              <thead>\n                   <tr>\n-                      <th class=\"px-3 py-2 text-left w-16\">ID</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n-                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Date</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Status</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Method</th>\n-                      <th class=\"px-3 py-2 text-left w-16\">Action</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">NationalID</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Service Name</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Phone</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n+                      <th>ID</th>\n+                      <th>ResidentID</th>\n+                      <th>Amount</th>\n+                      <th>Date</th>\n+                      <th>Status</th>\n+                      <th>Reference</th>\n+                      <th>Method</th>\n+                      <th>Action</th>\n+                      <th>NationalID</th>\n+                      <th>Service Name</th>\n+                      <th>Phone</th>\n+                      <th>Verified Date</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\">\n-                  <tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">Loading payments...</td></tr>\n+              <tbody id=\"paymentsBody\">\n+                  <tr><td colspan=\"12\">Loading payments...</td></tr>\n               </tbody>\n           </table>\n       </div>\n     </section>\n \n\\ No newline at end of file\n-    <!-- VERIFIED PAYMENTS (Simplified View) -->\n-    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-green-100\">\n-      <h3 class=\"text-green-700 font-semibold mb-3 text-lg\">âœ… Verified Transactions</h3>\n-      <div class=\"flex justify-between items-center mb-3 text-sm\">\n-          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded-lg px-3 py-1.5 focus:ring-green-500 focus:border-green-500 transition w-1/3\"/>\n-          <div class=\"space-x-2\">\n-              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n-              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n+    <!-- VERIFIED PAYMENTS -->\n+    <section>\n+      <h3>âœ… Verified Transactions</h3>\n+      <div class=\"table-controls\">\n+          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" />\n+          <div>\n+              <button id=\"exportVerifiedCsv\">Export CSV</button>\n+              <button id=\"exportVerifiedExcel\">Export Excel</button>\n           </div>\n       </div>\n-      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n-          <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-green-100 text-green-800 sticky top-0 shadow-sm\">\n+      <div class=\"table-wrapper\">\n+          <table id=\"verifiedTable\">\n+              <thead>\n                   <tr>\n-                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n-                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n+                      <th>ResidentID</th>\n+                      <th>Amount</th>\n+                      <th>Reference</th>\n+                      <th>Verified Date</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-100\"></tbody>\n+              <tbody id=\"verifiedBody\"></tbody>\n           </table>\n       </div>\n     </section>\n \n-    <!-- BALANCES (Grouped by Resident) -->\n-    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-yellow-100\">\n-      <h3 class=\"text-yellow-700 font-semibold mb-3 text-lg\">ðŸ’° Resident Balances Summary</h3>\n-      <div class=\"flex justify-end mb-3 text-sm space-x-2\">\n-          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n-          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n+    <!-- BALANCES -->\n+    <section>\n+      <h3>ðŸ’° Resident Balances Summary</h3>\n+      <div class=\"table-controls\">\n+          <div></div>\n+          <div>\n+              <button id=\"exportBalancesCsv\">Export CSV</button>\n+              <button id=\"exportBalancesExcel\">Export Excel</button>\n+          </div>\n       </div>\n-      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n-          <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n-              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0 shadow-sm\">\n+      <div class=\"table-wrapper\">\n+          <table id=\"balanceTable\">\n+              <thead>\n                   <tr>\n-                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Total Paid (Verified)</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Total Due (Simulated)</th>\n-                      <th class=\"px-3 py-2 text-left w-20\">Balance</th>\n+                      <th>ResidentID</th>\n+                      <th>Total Paid (Verified)</th>\n+                      <th>Total Due (Simulated)</th>\n+                      <th>Balance</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-100\"></tbody>\n+              <tbody id=\"balanceBody\"></tbody>\n           </table>\n       </div>\n     </section>\n+\n   </main>\n \n <script type=\"module\" src=\"js/payment.js\"></script>\n </body>\n-</html>\n+</html>\n"
                },
                {
                    "date": 1763631961403,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,134 +1,134 @@\n <!DOCTYPE html>\n <html lang=\"en\">\n <head>\n-  <meta charset=\"UTF-8\" />\n-  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n-  <title>Athi Estate | Payments</title>\n-\n-  <!-- Link external CSS file (html.css) -->\n-  <link rel=\"stylesheet\" href=\"css/html.css\" />\n-\n-  <!-- XLSX for Excel/CSV export -->\n-  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n+ <meta charset=\"UTF-8\" />\n+ <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n+ <title>Athi Estate | Payments</title>\n+ <script src=\"https://cdn.tailwindcss.com\"></script>\n+ <!-- Inter Font -->\n+ <style>\n+    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n+    body {\n+        font-family: 'Inter', sans-serif;\n+    }\n+ </style>\n+ <!-- XLSX for Excel/CSV export -->\n+ <script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n </head>\n-<body>\n+<body class=\"bg-gray-50 text-gray-800 flex flex-col h-screen\">\n \n-  <!-- HEADER -->\n-  <header>\n-      <div class=\"header-container\">\n-          <h1>Athi Estate Payments</h1>\n-          <div id=\"userInfo\">Loading User...</div>\n+  <header class=\"bg-white shadow-md p-4 sticky top-0 z-10\">\n+      <div class=\"max-w-7xl mx-auto flex justify-between items-center\">\n+          <h1 class=\"text-xl font-bold text-indigo-700\">Athi Estate Payments</h1>\n+          <div id=\"userInfo\" class=\"text-xs text-gray-500\">Loading User...</div>\n       </div>\n   </header>\n \n   <!-- DASHBOARD SUMMARY -->\n-  <section id=\"dashboardSummary\"></section>\n+  <section id=\"dashboardSummary\" class=\"p-4 pt-2 max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-3 gap-4 text-xs w-full\"></section>\n \n-  <main>\n+  <main class=\"flex-1 overflow-y-auto p-4 max-w-7xl mx-auto w-full space-y-4\">\n \n-    <!-- MPESA PAYMENT FORM -->\n-    <section>\n-      <h2>ðŸ’³ Initiate MPESA Payment</h2>\n-      <div class=\"form-container\">\n-          <select id=\"residentIdSelect\">\n+      <!-- MPESA PAYMENT SIMULATION / FORM -->\n+    <section class=\"bg-white p-6 rounded-xl shadow-lg border border-indigo-100\">\n+      <h2 class=\"text-indigo-700 font-bold mb-4 text-lg\">ðŸ’³ Initiate MPESA Payment</h2>\n+      <div class=\"flex flex-col space-y-3 max-w-sm\">\n+          <!-- UPDATED: Replaced input with a select dropdown for existing Resident IDs -->\n+          <select id=\"residentIdSelect\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\">\n               <option value=\"\" disabled selected>Select Resident ID (or enter new)</option>\n           </select>\n-          <input type=\"text\" id=\"serviceNameInput\" placeholder=\"Service Name (e.g., Monthly Dues)\" />\n-          <input type=\"number\" id=\"paymentAmountInput\" placeholder=\"Amount (Ksh)\" />\n-          <input type=\"text\" id=\"phoneNumberInput\" placeholder=\"Phone (2547XXXXXXXX)\" />\n-          <button id=\"payBtn\">\n+          <input type=\"text\" id=\"serviceNameInput\" placeholder=\"Service Name (e.g., Monthly Dues)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <input type=\"number\" id=\"paymentAmountInput\" placeholder=\"Amount (Ksh)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <input type=\"text\" id=\"phoneNumberInput\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-3 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition\"/>\n+          <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]\">\n               <span id=\"payBtnText\">Simulate Payment</span>\n           </button>\n-          <div id=\"paymentResult\" class=\"hidden\"></div>\n+          <div id=\"paymentResult\" class=\"text-xs mt-2 p-2 rounded-lg text-center hidden\"></div>\n       </div>\n     </section>\n \n     <!-- PAYMENT HISTORY -->\n-    <section>\n-      <h3>ðŸ“‹ Full Payment History</h3>\n-      <div class=\"table-controls\">\n-          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID, Status, or Ref\" />\n-          <div>\n-              <button id=\"exportCsv\">Export CSV</button>\n-              <button id=\"exportExcel\">Export Excel</button>\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-indigo-100\">\n+      <h3 class=\"text-indigo-700 font-semibold mb-3 text-lg\">ðŸ“‹ Full Payment History</h3>\n+      <div class=\"flex justify-between items-center mb-3 text-sm\">\n+          <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID, Status, or Ref\" class=\"border rounded-lg px-3 py-1.5 focus:ring-indigo-500 focus:border-indigo-500 transition w-1/3\"/>\n+          <div class=\"space-x-2\">\n+              <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+              <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n           </div>\n       </div>\n-      <div class=\"table-wrapper\">\n-          <table id=\"paymentsTable\">\n-              <thead>\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[300px] border border-gray-200 rounded-lg\">\n+          <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0 shadow-sm\">\n                   <tr>\n-                      <th>ID</th>\n-                      <th>ResidentID</th>\n-                      <th>Amount</th>\n-                      <th>Date</th>\n-                      <th>Status</th>\n-                      <th>Reference</th>\n-                      <th>Method</th>\n-                      <th>Action</th>\n-                      <th>NationalID</th>\n-                      <th>Service Name</th>\n-                      <th>Phone</th>\n-                      <th>Verified Date</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">ID</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Date</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Status</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Method</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Action</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">NationalID</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Service Name</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Phone</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"paymentsBody\">\n-                  <tr><td colspan=\"12\">Loading payments...</td></tr>\n+              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\">\n+                  <tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">Loading payments...</td></tr>\n               </tbody>\n           </table>\n       </div>\n     </section>\n \n-    <!-- VERIFIED PAYMENTS -->\n-    <section>\n-      <h3>âœ… Verified Transactions</h3>\n-      <div class=\"table-controls\">\n-          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" />\n-          <div>\n-              <button id=\"exportVerifiedCsv\">Export CSV</button>\n-              <button id=\"exportVerifiedExcel\">Export Excel</button>\n+    <!-- VERIFIED PAYMENTS (Simplified View) -->\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-green-100\">\n+      <h3 class=\"text-green-700 font-semibold mb-3 text-lg\">âœ… Verified Transactions</h3>\n+      <div class=\"flex justify-between items-center mb-3 text-sm\">\n+          <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded-lg px-3 py-1.5 focus:ring-green-500 focus:border-green-500 transition w-1/3\"/>\n+          <div class=\"space-x-2\">\n+              <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+              <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n           </div>\n       </div>\n-      <div class=\"table-wrapper\">\n-          <table id=\"verifiedTable\">\n-              <thead>\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n+          <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-green-100 text-green-800 sticky top-0 shadow-sm\">\n                   <tr>\n-                      <th>ResidentID</th>\n-                      <th>Amount</th>\n-                      <th>Reference</th>\n-                      <th>Verified Date</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"verifiedBody\"></tbody>\n+              <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-100\"></tbody>\n           </table>\n       </div>\n     </section>\n \n-    <!-- BALANCES -->\n-    <section>\n-      <h3>ðŸ’° Resident Balances Summary</h3>\n-      <div class=\"table-controls\">\n-          <div></div>\n-          <div>\n-              <button id=\"exportBalancesCsv\">Export CSV</button>\n-              <button id=\"exportBalancesExcel\">Export Excel</button>\n-          </div>\n+    <!-- BALANCES (Grouped by Resident) -->\n+    <section class=\"bg-white rounded-xl shadow-lg p-4 flex flex-col border border-yellow-100\">\n+      <h3 class=\"text-yellow-700 font-semibold mb-3 text-lg\">ðŸ’° Resident Balances Summary</h3>\n+      <div class=\"flex justify-end mb-3 text-sm space-x-2\">\n+          <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export CSV</button>\n+          <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-white text-sm font-medium transition shadow-sm\">Export Excel</button>\n       </div>\n-      <div class=\"table-wrapper\">\n-          <table id=\"balanceTable\">\n-              <thead>\n+      <div class=\"overflow-x-auto overflow-y-auto max-h-[250px] border border-gray-200 rounded-lg\">\n+          <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n+              <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0 shadow-sm\">\n                   <tr>\n-                      <th>ResidentID</th>\n-                      <th>Total Paid (Verified)</th>\n-                      <th>Total Due (Simulated)</th>\n-                      <th>Balance</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Total Paid (Verified)</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Total Due (Simulated)</th>\n+                      <th class=\"px-3 py-2 text-left w-20\">Balance</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"balanceBody\"></tbody>\n+              <tbody id=\"balanceBody\" class=\"divide-y divide-gray-100\"></tbody>\n           </table>\n       </div>\n     </section>\n-\n   </main>\n \n <script type=\"module\" src=\"js/payment.js\"></script>\n </body>\n"
                },
                {
                    "date": 1763635352337,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,9 +66,9 @@\n                       <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n                       <th class=\"px-3 py-2 text-left w-24\">Date</th>\n                       <th class=\"px-3 py-2 text-left w-20\">Status</th>\n                       <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Method</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">PaymentMethod</th>\n                       <th class=\"px-3 py-2 text-left w-16\">Action</th>\n                       <th class=\"px-3 py-2 text-left w-20\">NationalID</th>\n                       <th class=\"px-3 py-2 text-left w-24\">Service Name</th>\n                       <th class=\"px-3 py-2 text-left w-24\">Phone</th>\n"
                },
                {
                    "date": 1763635375524,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,11 +69,11 @@\n                       <th class=\"px-3 py-2 text-left w-20\">Reference</th>\n                       <th class=\"px-3 py-2 text-left w-24\">PaymentMethod</th>\n                       <th class=\"px-3 py-2 text-left w-16\">Action</th>\n                       <th class=\"px-3 py-2 text-left w-20\">NationalID</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Service Name</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">ServiceName</th>\n                       <th class=\"px-3 py-2 text-left w-24\">Phone</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Verified Date</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">VerifiedDate</th>\n                   </tr>\n               </thead>\n               <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\">\n                   <tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">Loading payments...</td></tr>\n"
                },
                {
                    "date": 1763635432563,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -60,9 +60,9 @@\n       <div class=\"overflow-x-auto overflow-y-auto max-h-[300px] border border-gray-200 rounded-lg\">\n           <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n               <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0 shadow-sm\">\n                   <tr>\n-                      <th class=\"px-3 py-2 text-left w-16\">ID</th>\n+                      <th class=\"px-3 py-2 text-left w-16\">PaymentID</th>\n                       <th class=\"px-3 py-2 text-left w-20\">ResidentID</th>\n                       <th class=\"px-3 py-2 text-left w-16\">Amount</th>\n                       <th class=\"px-3 py-2 text-left w-24\">Date</th>\n                       <th class=\"px-3 py-2 text-left w-20\">Status</th>\n@@ -70,9 +70,9 @@\n                       <th class=\"px-3 py-2 text-left w-24\">PaymentMethod</th>\n                       <th class=\"px-3 py-2 text-left w-16\">Action</th>\n                       <th class=\"px-3 py-2 text-left w-20\">NationalID</th>\n                       <th class=\"px-3 py-2 text-left w-24\">ServiceName</th>\n-                      <th class=\"px-3 py-2 text-left w-24\">Phone</th>\n+                      <th class=\"px-3 py-2 text-left w-24\">PhoneNumber</th>\n                       <th class=\"px-3 py-2 text-left w-24\">VerifiedDate</th>\n                   </tr>\n               </thead>\n               <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\">\n"
                },
                {
                    "date": 1763635540203,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n \n   <header class=\"bg-white shadow-md p-4 sticky top-0 z-10\">\n       <div class=\"max-w-7xl mx-auto flex justify-between items-center\">\n           <h1 class=\"text-xl font-bold text-indigo-700\">Athi Estate Payments</h1>\n-          <div id=\"userInfo\" class=\"text-xs text-gray-500\">Loading User...</div>\n+                         \n       </div>\n   </header>\n \n   <!-- DASHBOARD SUMMARY -->\n"
                },
                {
                    "date": 1763635651810,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,9 @@\n </head>\n <body class=\"bg-gray-50 text-gray-800 flex flex-col h-screen\">\n \n   <header class=\"bg-white shadow-md p-4 sticky top-0 z-10\">\n-      <div class=\"max-w-7xl mx-auto flex justify-between items-center\">\n+      <div class=\"max-w-7xl mx-auto flex justify-center items-center\">\n           <h1 class=\"text-xl font-bold text-indigo-700\">Athi Estate Payments</h1>\n                          \n       </div>\n   </header>\n@@ -74,11 +74,9 @@\n                       <th class=\"px-3 py-2 text-left w-24\">PhoneNumber</th>\n                       <th class=\"px-3 py-2 text-left w-24\">VerifiedDate</th>\n                   </tr>\n               </thead>\n-              <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-100\">\n-                  <tr><td colspan=\"12\" class=\"text-center py-4 text-gray-500\">Loading payments...</td></tr>\n-              </tbody>\n+              \n           </table>\n       </div>\n     </section>\n \n"
                }
            ],
            "date": 1763589840006,
            "name": "Commit-0",
            "content": "<!-- HEADER -->\n<div id=\"header\" class=\"bg-indigo-800 text-white p-2 flex justify-between items-center text-sm\">\n      <h1 class=\"text-lg font-semibold\">Athi Estate Payments Dashboard</h1>\n      <button id=\"logoutBtn\" class=\"bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-xs\">Logout</button>\n</div>\n\n<!-- DASHBOARD SUMMARY -->\n<section id=\"dashboardSummary\" class=\"p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs mb-2 w-full\"></section>\n\n<main class=\"flex-1 overflow-auto p-2 max-w-7xl mx-auto grid grid-cols-3 gap-2 text-xs w-full\">\n\n  <!-- MAKE PAYMENT -->\n  <section class=\"bg-white rounded-xl shadow p-2 col-span-1 flex flex-col\">\n    <h2 class=\"text-indigo-700 font-bold mb-1 text-sm\">ðŸ’³ Make Payment</h2>\n    <form id=\"makePaymentForm\" class=\"space-y-1 flex-1 flex flex-col justify-between\">\n        <div id=\"residentDiv\">\n            <label for=\"residentId\" class=\"block mb-1\">Resident ID</label>\n            <select id=\"residentId\" required class=\"w-full border rounded px-1 py-1 text-xs\">\n                <option value=\"\">Select Resident ID</option>\n            </select>\n        </div>\n        <div>\n            <label for=\"amount\" class=\"block mb-1\">Amount (KSh)</label>\n            <input id=\"amount\" type=\"number\" step=\"0.01\" required class=\"w-full border rounded px-1 py-1 text-xs\"/>\n        </div>\n        <div>\n            <label for=\"paymentMethod\" class=\"block mb-1\">Payment Method</label>\n            <select id=\"paymentMethod\" required class=\"w-full border rounded px-1 py-1 text-xs\">\n                <option value=\"\">Select</option>\n                <option value=\"Mpesa\">Mpesa</option>\n                <option value=\"Bank Transfer\">Bank Transfer</option>\n                <option value=\"Cash\">Cash</option>\n            </select>\n        </div>\n        <div>\n            <label for=\"reference\" class=\"block mb-1\">Reference</label>\n            <input id=\"reference\" type=\"text\" placeholder=\"e.g. MPESA1234\" required class=\"w-full border rounded px-1 py-1 text-xs\"/>\n        </div>\n        <button type=\"submit\" class=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-1 rounded text-xs mt-1\">Submit Payment</button>\n    </form>\n    <div id=\"msg\" class=\"text-gray-700 mt-1 text-xs\"></div>\n  </section>\n\n  <!-- PAYMENT HISTORY -->\n  <section class=\"bg-white rounded-xl shadow p-2 col-span-2 flex flex-col\">\n    <h3 class=\"text-indigo-700 font-semibold mb-1 text-sm\">ðŸ“‹ Payment History</h3>\n    <div class=\"flex justify-between mb-1 text-xs\">\n        <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n        <div class=\"space-x-1\">\n            <button id=\"exportCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n            <button id=\"exportExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n        </div>\n    </div>\n    <div class=\"overflow-auto max-h-60 border rounded\">\n        <table id=\"paymentsTable\" class=\"min-w-full text-xs\">\n            <thead class=\"bg-indigo-100 text-indigo-800 sticky top-0\">\n                <tr>\n                    <th class=\"px-1 py-0.5 text-left\">PaymentID</th>\n                    <th class=\"px-1 py-0.5 text-left\">ResidentID</th>\n                    <th class=\"px-1 py-0.5 text-left\">Amount</th>\n                    <th class=\"px-1 py-0.5 text-left\">Payment Date</th>\n                    <th class=\"px-1 py-0.5 text-left\">Status</th>\n                    <th class=\"px-1 py-0.5 text-left\">Reference</th>\n                    <th class=\"px-1 py-0.5 text-left\">PaymentMethod</th>\n                    <th class=\"px-1 py-0.5 text-left\">Action</th>\n                    <th class=\"px-1 py-0.5 text-left\">NationalID</th>\n                    <th class=\"px-1 py-0.5 text-left\">serviceName</th>\n                    <th class=\"px-1 py-0.5 text-left\">phoneNumber</th>\n                    <th class=\"px-1 py-0.5 text-left\">VerifiedDate</th>\n                </tr>\n            </thead>\n            <tbody id=\"paymentsBody\" class=\"divide-y divide-gray-200\"></tbody>\n        </table>\n    </div>\n  </section>\n\n  <!-- VERIFIED PAYMENTS -->\n  <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n    <h3 class=\"text-green-700 font-semibold mb-1 text-sm\">âœ… Verified Payments</h3>\n    <div class=\"flex justify-between mb-1 text-xs\">\n        <input type=\"text\" id=\"verifiedFilterInput\" placeholder=\"Filter by Resident ID\" class=\"border rounded px-1 py-1\"/>\n        <div class=\"space-x-1\">\n            <button id=\"exportVerifiedCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n            <button id=\"exportVerifiedExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n        </div>\n    </div>\n    <div class=\"overflow-auto max-h-40 border rounded\">\n        <table id=\"verifiedTable\" class=\"min-w-full text-xs\">\n            <thead class=\"bg-green-100 text-green-800 sticky top-0\">\n                <tr>\n                    <th class=\"px-1 py-0.5 text-left\">Resident</th>\n                    <th class=\"px-1 py-0.5 text-left\">Amount</th>\n                    <th class=\"px-1 py-0.5 text-left\">Reference</th>\n                    <th class=\"px-1 py-0.5 text-left\">Verified Date</th>\n                </tr>\n            </thead>\n            <tbody id=\"verifiedBody\" class=\"divide-y divide-gray-200\"></tbody>\n        </table>\n    </div>\n  </section>\n\n  <!-- BALANCES -->\n  <section class=\"bg-white rounded-xl shadow p-2 col-span-3 flex flex-col\">\n    <h3 class=\"text-yellow-700 font-semibold mb-1 text-sm\">ðŸ’° Balances</h3>\n    <div class=\"flex justify-end mb-1 text-xs space-x-1\">\n        <button id=\"exportBalancesCsv\" class=\"bg-green-500 hover:bg-green-600 px-2 py-0.5 rounded text-white\">CSV</button>\n        <button id=\"exportBalancesExcel\" class=\"bg-blue-500 hover:bg-blue-600 px-2 py-0.5 rounded text-white\">Excel</button>\n    </div>\n    <div class=\"overflow-auto max-h-40 border rounded\">\n        <table id=\"balanceTable\" class=\"min-w-full text-xs\">\n            <thead class=\"bg-yellow-100 text-yellow-800 sticky top-0\">\n                <tr>\n                    <th class=\"px-1 py-0.5 text-left\">Resident</th>\n                    <th class=\"px-1 py-0.5 text-left\">Total Paid</th>\n                    <th class=\"px-1 py-0.5 text-left\">Total Due</th>\n                    <th class=\"px-1 py-0.5 text-left\">Balance</th>\n                </tr>\n            </thead>\n            <tbody id=\"balanceBody\" class=\"divide-y divide-gray-200\"></tbody>\n        </table>\n    </div>\n  </section>\n\n  <!-- MPESA PAYMENT -->\n  <section class=\"bg-white p-4 rounded-xl shadow col-span-3\">\n    <h2 class=\"text-indigo-700 font-bold mb-2 text-sm\">ðŸ’³ MPESA Payment</h2>\n    <div class=\"flex flex-col space-y-2 max-w-sm\">\n        <input type=\"text\" id=\"serviceName\" placeholder=\"Service Name (e.g Estate Registration)\" class=\"border p-2 rounded\"/>\n        <input type=\"number\" id=\"paymentAmount\" placeholder=\"Amount\" class=\"border p-2 rounded\"/>\n        <input type=\"text\" id=\"phoneNumber\" placeholder=\"Phone (2547XXXXXXXX)\" class=\"border p-2 rounded\"/>\n        <button id=\"payBtn\" class=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded\">Pay Now</button>\n        <div id=\"paymentResult\" class=\"text-xs mt-1\"></div>\n    </div>\n  </section>\n\n</main>\n\n<script src=\"js/payment.js\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"></script>\n<script src=\"https://cdn.tailwindcss.com\"></script>\n"
        }
    ]
}