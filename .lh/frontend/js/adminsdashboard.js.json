{
    "sourceFile": "frontend/js/adminsdashboard.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 30,
            "patches": [
                {
                    "date": 1763638300168,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763639253854,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -220,4 +220,35 @@\n     } catch (err) {\r\n         console.error(\"Error loading membership requests:\", err);\r\n     }\r\n }\r\n+async function loadMembershipRecords() {\r\n+    try {\r\n+        const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const members = await res.json();\r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        if (members.length === 0) {\r\n+            container.innerHTML = \"<p class='text-gray-500 text-center'>No membership records found.</p>\";\r\n+            return;\r\n+        }\r\n+        let html = `<ul class=\"space-y-2\">`;\r\n+        members.forEach(m => {\r\n+            if (m.Status === \"Approved\") {\r\n+                html += `<li class=\"bg-white shadow-md rounded-lg p-4 flex justify-between items-center\">\r\n+                            <div>\r\n+                                <p class=\"font-semibold\">${m.ResidentName}</p>\r\n+                                <p class=\"text-sm text-gray-500\">${m.NationalID} | ${m.HouseNumber} - ${m.CourtName}</p>\r\n+                            </div>\r\n+                          </li>`;\r\n+            }\r\n+        });\r\n+        html += `</ul>`;\r\n+        container.innerHTML = html;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading membership records:\", err);\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1763639427681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -251,4 +251,22 @@\n     } catch (err) {\r\n         console.error(\"Error loading membership records:\", err);\r\n     }\r\n }\r\n+\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n+        const page = btn.dataset.target;\r\n+        if (!page) return;\r\n+\r\n+        await loadPageIntoMainContent(page);\r\n+\r\n+        // Trigger data load for each page\r\n+        if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n+        if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n+        if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+        if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n+    });\r\n+});\r\n"
                },
                {
                    "date": 1763639527780,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,40 +18,45 @@\n async function loadPageIntoMainContent(url) {\r\n     try {\r\n         const res = await fetch(url);\r\n         if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+\r\n         const html = await res.text();\r\n         mainContentArea.innerHTML = html;\r\n \r\n-        // For subsequent (non-initial) dashboard loads (via button click), \r\n-        // we call the functions directly after innerHTML.\r\n+        // If dashboard loaded into main content\r\n         if (url.includes(\"dashboardoverview.html\")) {\r\n-            // NOTE: We don't need setTimeout here for subsequent clicks, \r\n-            // as the initial load issue is bypassed.\r\n-            await loadDashboardSummary(); \r\n+            await loadDashboardSummary();\r\n             await loadAccessChart();\r\n         }\r\n     } catch (err) {\r\n         console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+        mainContentArea.innerHTML =\r\n+            `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n     }\r\n }\r\n \r\n+// Sidebar routing\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n         sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n         btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n         const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n+        if (!page) return;\r\n+\r\n+        await loadPageIntoMainContent(page);\r\n+\r\n+        // Trigger dynamic page data loads\r\n+        if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n+        if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n+        if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+        if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n     });\r\n });\r\n \r\n-// *** REMOVED: loadPageIntoMainContent(\"sections/dashboardoverview.html\"); ***\r\n-// The initial page load is handled by the index.html content itself.\r\n-\r\n // ================================\r\n-// VISITOR MANAGEMENT TOGGLE\r\n+// VISITOR MANAGEMENT DROPDOWN\r\n // ================================\r\n const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n const visitorArrow = document.getElementById(\"visitorArrow\");\r\n@@ -68,11 +73,9 @@\n     const element = document.getElementById(id);\r\n     if (element) {\r\n         element.textContent = value + suffix;\r\n     } else {\r\n-        // This warning should now only appear if an ID is misspelled \r\n-        // or a sidebar page is missing the element.\r\n-        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n+        console.warn(`Element with ID '${id}' not found.`);\r\n     }\r\n };\r\n \r\n // ================================\r\n@@ -82,9 +85,11 @@\n     try {\r\n         const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n+\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n         const data = await res.json();\r\n \r\n         safeUpdate(\"totalResidents\", data.residents || 0);\r\n         safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n@@ -103,15 +108,18 @@\n     try {\r\n         const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n+\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n         const data = await res.json();\r\n \r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n+        const canvas = document.getElementById(\"accessChart\");\r\n+        if (!canvas) return;\r\n \r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n+        const ctx = canvas.getContext(\"2d\");\r\n+\r\n         new Chart(ctx, {\r\n             type: \"line\",\r\n             data: {\r\n                 labels: data.days || [],\r\n@@ -119,10 +127,10 @@\n                     label: \"Access Attempts\",\r\n                     data: data.counts || [],\r\n                     borderWidth: 2,\r\n                     tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    borderColor: \"#2563eb\",\r\n+                    backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n                     fill: true\r\n                 }]\r\n             },\r\n             options: { responsive: true, maintainAspectRatio: false }\r\n@@ -133,74 +141,80 @@\n     }\r\n }\r\n \r\n // ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n+// INITIAL DASHBOARD LOAD\r\n // ================================\r\n-/**\r\n- * Run this function once on initial page load.\r\n- * Since the Dashboard Overview content is ALREADY present in index.html, \r\n- * we can call the data functions directly without a wrapper or delay.\r\n- */\r\n (async function initializeDashboard() {\r\n     await loadDashboardSummary();\r\n     await loadAccessChart();\r\n })();\r\n+\r\n+// ================================\r\n+// MEMBERSHIP REQUESTS\r\n+// ================================\r\n async function loadMembershipRequests() {\r\n     try {\r\n         const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n         const requests = await res.json();\r\n-\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         if (requests.length === 0) {\r\n             container.innerHTML = \"<p class='text-gray-500 text-center'>No membership requests found.</p>\";\r\n             return;\r\n         }\r\n \r\n-        let html = `<table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                        <thead class=\"bg-gray-200\">\r\n-                            <tr>\r\n-                                <th class=\"py-2 px-4\">Name</th>\r\n-                                <th class=\"py-2 px-4\">National ID</th>\r\n-                                <th class=\"py-2 px-4\">Phone</th>\r\n-                                <th class=\"py-2 px-4\">Email</th>\r\n-                                <th class=\"py-2 px-4\">House</th>\r\n-                                <th class=\"py-2 px-4\">Court</th>\r\n-                                <th class=\"py-2 px-4\">Status</th>\r\n-                                <th class=\"py-2 px-4\">Requested At</th>\r\n-                                <th class=\"py-2 px-4\">Actions</th>\r\n-                            </tr>\r\n-                        </thead>\r\n-                        <tbody>`;\r\n+        let html = `\r\n+            <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                <thead class=\"bg-gray-200\">\r\n+                    <tr>\r\n+                        <th class=\"py-2 px-4\">Name</th>\r\n+                        <th class=\"py-2 px-4\">National ID</th>\r\n+                        <th class=\"py-2 px-4\">Phone</th>\r\n+                        <th class=\"py-2 px-4\">Email</th>\r\n+                        <th class=\"py-2 px-4\">House</th>\r\n+                        <th class=\"py-2 px-4\">Court</th>\r\n+                        <th class=\"py-2 px-4\">Status</th>\r\n+                        <th class=\"py-2 px-4\">Requested At</th>\r\n+                        <th class=\"py-2 px-4\">Actions</th>\r\n+                    </tr>\r\n+                </thead>\r\n+                <tbody>\r\n+        `;\r\n \r\n         requests.forEach(r => {\r\n-            html += `<tr class=\"border-b\">\r\n-                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n-                        <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n-                        <td class=\"py-2 px-4\">${r.Email}</td>\r\n-                        <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n-                        <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.Status}</td>\r\n-                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                        <td class=\"py-2 px-4\">\r\n-                            ${r.Status === \"Pending\" ? `<button class=\"approve-btn bg-green-500 px-2 py-1 text-white rounded\" data-id=\"${r.RequestID}\">Approve</button>` : \"\"}\r\n-                        </td>\r\n-                     </tr>`;\r\n+            html += `\r\n+                <tr class=\"border-b\">\r\n+                    <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n+                    <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n+                    <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n+                    <td class=\"py-2 px-4\">${r.Email}</td>\r\n+                    <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n+                    <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n+                    <td class=\"py-2 px-4\">${r.Status}</td>\r\n+                    <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n+                    <td class=\"py-2 px-4\">\r\n+                        ${r.Status === \"Pending\"\r\n+                            ? `<button class=\"approve-btn bg-green-500 px-2 py-1 text-white rounded\" data-id=\"${r.RequestID}\">Approve</button>`\r\n+                            : \"\"\r\n+                        }\r\n+                    </td>\r\n+                </tr>`;\r\n         });\r\n \r\n         html += `</tbody></table>`;\r\n         container.innerHTML = html;\r\n \r\n-        // Add click handlers for approve buttons\r\n+        // Approve buttons\r\n         document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n-            btn.addEventListener(\"click\", async (e) => {\r\n+            btn.addEventListener(\"click\", async () => {\r\n                 const requestId = btn.dataset.id;\r\n+\r\n                 try {\r\n                     const resp = await fetch(\"http://localhost:4050/api/admin/approveResident\", {\r\n                         method: \"POST\",\r\n                         headers: {\r\n@@ -208,10 +222,12 @@\n                             \"Authorization\": `Bearer ${token}`\r\n                         },\r\n                         body: JSON.stringify({ requestId })\r\n                     });\r\n+\r\n                     if (!resp.ok) throw new Error(\"Failed to approve\");\r\n-                    btn.parentElement.textContent = \"Approved ✅\";\r\n+\r\n+                    btn.parentElement.textContent = \"Approved ✔️\";\r\n                 } catch (err) {\r\n                     alert(\"Error approving request: \" + err.message);\r\n                 }\r\n             });\r\n@@ -220,53 +236,46 @@\n     } catch (err) {\r\n         console.error(\"Error loading membership requests:\", err);\r\n     }\r\n }\r\n+\r\n+// ================================\r\n+// MEMBERSHIP RECORDS\r\n+// ================================\r\n async function loadMembershipRecords() {\r\n     try {\r\n         const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n+\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n         const members = await res.json();\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n+\r\n         if (members.length === 0) {\r\n             container.innerHTML = \"<p class='text-gray-500 text-center'>No membership records found.</p>\";\r\n             return;\r\n         }\r\n+\r\n         let html = `<ul class=\"space-y-2\">`;\r\n+\r\n         members.forEach(m => {\r\n             if (m.Status === \"Approved\") {\r\n-                html += `<li class=\"bg-white shadow-md rounded-lg p-4 flex justify-between items-center\">\r\n-                            <div>\r\n-                                <p class=\"font-semibold\">${m.ResidentName}</p>\r\n-                                <p class=\"text-sm text-gray-500\">${m.NationalID} | ${m.HouseNumber} - ${m.CourtName}</p>\r\n-                            </div>\r\n-                          </li>`;\r\n+                html += `\r\n+                    <li class=\"bg-white shadow-md rounded-lg p-4 flex justify-between\">\r\n+                        <div>\r\n+                            <p class=\"font-semibold\">${m.ResidentName}</p>\r\n+                            <p class=\"text-gray-500 text-sm\">${m.NationalID} | ${m.HouseNumber} - ${m.CourtName}</p>\r\n+                        </div>\r\n+                    </li>`;\r\n             }\r\n         });\r\n-        html += `</ul>`;\r\n+\r\n+        html += \"</ul>\";\r\n         container.innerHTML = html;\r\n \r\n     } catch (err) {\r\n         console.error(\"Error loading membership records:\", err);\r\n     }\r\n }\r\n-\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (!page) return;\r\n-\r\n-        await loadPageIntoMainContent(page);\r\n-\r\n-        // Trigger data load for each page\r\n-        if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n-        if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n-        if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-        if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n-    });\r\n-});\r\n"
                },
                {
                    "date": 1763640427520,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,11 +1,21 @@\n+// =======================================================\r\n+// FIREBASE CONFIG (Required setup, even if not fully used)\r\n+// =======================================================\r\n+// This ensures the environment is recognized, though current storage is localStorage/API.\r\n+const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n+const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n+// const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\r\n+// You would use these variables if switching to Firestore/Firebase Auth.\r\n+\r\n+\r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n const token = localStorage.getItem(\"accessToken\");\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n     window.location.href = \"/login.html\";\r\n });\r\n \r\n@@ -14,17 +24,21 @@\n // ================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+/**\r\n+ * Fetches and loads HTML content into the main content area.\r\n+ * @param {string} url The URL of the page to load.\r\n+ */\r\n async function loadPageIntoMainContent(url) {\r\n     try {\r\n         const res = await fetch(url);\r\n         if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n \r\n         const html = await res.text();\r\n         mainContentArea.innerHTML = html;\r\n \r\n-        // If dashboard loaded into main content\r\n+        // If dashboard loaded into main content, trigger its data loads\r\n         if (url.includes(\"dashboardoverview.html\")) {\r\n             await loadDashboardSummary();\r\n             await loadAccessChart();\r\n         }\r\n@@ -37,39 +51,53 @@\n \r\n // Sidebar routing\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n+        // Update active state for sidebar buttons\r\n         sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n         btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n         const page = btn.dataset.target;\r\n         if (!page) return;\r\n \r\n         await loadPageIntoMainContent(page);\r\n \r\n-        // Trigger dynamic page data loads\r\n+        // Trigger dynamic page data loads after content is inserted\r\n         if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n         if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n         if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n         if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n+        \r\n+        // Note: loadVisitorsList and loadPaymentRecords are placeholders \r\n+        // as their functions were not provided, but the event listeners are preserved.\r\n     });\r\n });\r\n \r\n+// Placeholder functions for pages whose data loaders were not provided\r\n+async function loadVisitorsList() { console.log('Loading visitors list...'); }\r\n+async function loadPaymentRecords() { console.log('Loading payment records...'); }\r\n+\r\n // ================================\r\n // VISITOR MANAGEMENT DROPDOWN\r\n // ================================\r\n const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-visitorToggle.addEventListener(\"click\", () => {\r\n-    visitorSubMenu.classList.toggle(\"hidden\");\r\n-    visitorArrow.classList.toggle(\"rotate-90\");\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n });\r\n \r\n // ================================\r\n // SAFE UPDATE HELPER\r\n // ================================\r\n+/**\r\n+ * Safely updates the text content of an element by ID.\r\n+ * @param {string} id Element ID.\r\n+ * @param {string|number} value New value.\r\n+ * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n+ */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n     const element = document.getElementById(id);\r\n     if (element) {\r\n         element.textContent = value + suffix;\r\n@@ -96,9 +124,9 @@\n         safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n         safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n     } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n+        console.error(\"Error loading dashboard summary:\", err);\r\n     }\r\n }\r\n \r\n // ================================\r\n@@ -116,8 +144,14 @@\n \r\n         const canvas = document.getElementById(\"accessChart\");\r\n         if (!canvas) return;\r\n \r\n+        // Ensure Chart.js is available globally before calling new Chart\r\n+        if (typeof Chart === 'undefined') {\r\n+            console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n+            return;\r\n+        }\r\n+\r\n         const ctx = canvas.getContext(\"2d\");\r\n \r\n         new Chart(ctx, {\r\n             type: \"line\",\r\n@@ -136,18 +170,31 @@\n             options: { responsive: true, maintainAspectRatio: false }\r\n         });\r\n \r\n     } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n+        console.error(\"Error loading access chart:\", err);\r\n     }\r\n }\r\n \r\n // ================================\r\n // INITIAL DASHBOARD LOAD\r\n // ================================\r\n+// This runs on page load and assumes the dashboard HTML structure is initially present.\r\n (async function initializeDashboard() {\r\n-    await loadDashboardSummary();\r\n-    await loadAccessChart();\r\n+    // Only attempt to load if the content area is empty or specific dashboard elements exist\r\n+    if (document.getElementById(\"totalResidents\")) {\r\n+        await loadDashboardSummary();\r\n+        await loadAccessChart();\r\n+    } else {\r\n+        // If the main page structure implies dashboard is default, load it.\r\n+        // Assuming dashboardoverview.html is the default page.\r\n+        // Find the dashboard button and simulate a click to ensure the content is loaded first.\r\n+        const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n+        if(dashboardBtn) {\r\n+            dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+            await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n+        }\r\n+    }\r\n })();\r\n \r\n // ================================\r\n // MEMBERSHIP REQUESTS\r\n@@ -171,49 +218,54 @@\n         let html = `\r\n             <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n                 <thead class=\"bg-gray-200\">\r\n                     <tr>\r\n-                        <th class=\"py-2 px-4\">Name</th>\r\n-                        <th class=\"py-2 px-4\">National ID</th>\r\n-                        <th class=\"py-2 px-4\">Phone</th>\r\n-                        <th class=\"py-2 px-4\">Email</th>\r\n-                        <th class=\"py-2 px-4\">House</th>\r\n-                        <th class=\"py-2 px-4\">Court</th>\r\n-                        <th class=\"py-2 px-4\">Status</th>\r\n-                        <th class=\"py-2 px-4\">Requested At</th>\r\n-                        <th class=\"py-2 px-4\">Actions</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">National ID</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Phone</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Email</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Court</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n                     </tr>\r\n                 </thead>\r\n                 <tbody>\r\n         `;\r\n \r\n         requests.forEach(r => {\r\n+            const rowClass = r.Status === \"Approved\" ? \"bg-green-50\" : r.Status === \"Pending\" ? \"hover:bg-yellow-50\" : \"bg-red-50\";\r\n             html += `\r\n-                <tr class=\"border-b\">\r\n+                <tr class=\"border-b ${rowClass}\">\r\n                     <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n                     <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n                     <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n                     <td class=\"py-2 px-4\">${r.Email}</td>\r\n                     <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n                     <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n-                    <td class=\"py-2 px-4\">${r.Status}</td>\r\n+                    <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n                     <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                    <td class=\"py-2 px-4\">\r\n+                    <td class=\"py-2 px-4 action-cell\">\r\n                         ${r.Status === \"Pending\"\r\n-                            ? `<button class=\"approve-btn bg-green-500 px-2 py-1 text-white rounded\" data-id=\"${r.RequestID}\">Approve</button>`\r\n-                            : \"\"\r\n+                            ? `<button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>`\r\n+                            : `<span class=\"text-gray-500 text-sm\">${r.Status}</span>`\r\n                         }\r\n                     </td>\r\n                 </tr>`;\r\n         });\r\n \r\n         html += `</tbody></table>`;\r\n         container.innerHTML = html;\r\n \r\n-        // Approve buttons\r\n+        // Approve buttons event listeners\r\n         document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n             btn.addEventListener(\"click\", async () => {\r\n                 const requestId = btn.dataset.id;\r\n+                const originalText = btn.textContent;\r\n+                \r\n+                btn.disabled = true;\r\n+                btn.textContent = 'Processing...';\r\n \r\n                 try {\r\n                     const resp = await fetch(\"http://localhost:4050/api/admin/approveResident\", {\r\n                         method: \"POST\",\r\n@@ -223,19 +275,49 @@\n                         },\r\n                         body: JSON.stringify({ requestId })\r\n                     });\r\n \r\n-                    if (!resp.ok) throw new Error(\"Failed to approve\");\r\n+                    if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n \r\n-                    btn.parentElement.textContent = \"Approved ✔️\";\r\n+                    // Success handling: update the UI\r\n+                    const actionCell = btn.parentElement;\r\n+                    const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n+                    \r\n+                    if (statusCell) {\r\n+                        statusCell.textContent = 'Approved';\r\n+                        statusCell.classList.add('font-bold', 'text-green-600');\r\n+                    }\r\n+                    actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n+                    \r\n+                    // Optional: Reload the list to refresh the status of all requests\r\n+                    // await loadMembershipRequests();\r\n+\r\n                 } catch (err) {\r\n-                    alert(\"Error approving request: \" + err.message);\r\n+                    console.error(\"Error approving request:\", err.message);\r\n+                    \r\n+                    // Failure handling: revert button and show error visually (non-alert)\r\n+                    btn.disabled = false;\r\n+                    btn.textContent = 'Failed!';\r\n+                    btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n+                    btn.classList.add('bg-red-500', 'animate-pulse');\r\n+\r\n+                    // Reset after a short period\r\n+                    setTimeout(() => {\r\n+                        btn.textContent = originalText;\r\n+                        btn.classList.remove('bg-red-500', 'animate-pulse');\r\n+                        btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n+                    }, 2000);\r\n+                    \r\n                 }\r\n             });\r\n         });\r\n \r\n     } catch (err) {\r\n         console.error(\"Error loading membership requests:\", err);\r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (container) {\r\n+             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n+        }\r\n     }\r\n }\r\n \r\n // ================================\r\n@@ -252,30 +334,41 @@\n         const members = await res.json();\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n-        if (members.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No membership records found.</p>\";\r\n+        // Filter for only approved members for the records section\r\n+        const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+\r\n+        if (approvedMembers.length === 0) {\r\n+            container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n             return;\r\n         }\r\n \r\n-        let html = `<ul class=\"space-y-2\">`;\r\n+        let html = `<ul class=\"space-y-3 p-4\">`;\r\n \r\n-        members.forEach(m => {\r\n-            if (m.Status === \"Approved\") {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow-md rounded-lg p-4 flex justify-between\">\r\n-                        <div>\r\n-                            <p class=\"font-semibold\">${m.ResidentName}</p>\r\n-                            <p class=\"text-gray-500 text-sm\">${m.NationalID} | ${m.HouseNumber} - ${m.CourtName}</p>\r\n-                        </div>\r\n-                    </li>`;\r\n-            }\r\n+        approvedMembers.forEach(m => {\r\n+            html += `\r\n+                <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n+                    <div>\r\n+                        <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n+                        <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n+                        <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n+                    </div>\r\n+                    <div class=\"text-right\">\r\n+                         <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n+                            Active\r\n+                        </span>\r\n+                    </div>\r\n+                </li>`;\r\n         });\r\n \r\n         html += \"</ul>\";\r\n         container.innerHTML = html;\r\n \r\n     } catch (err) {\r\n         console.error(\"Error loading membership records:\", err);\r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (container) {\r\n+             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n+        }\r\n     }\r\n-}\r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763664935250,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,18 +1,19 @@\n // =======================================================\r\n-// FIREBASE CONFIG (Required setup, even if not fully used)\r\n+// CONFIGURATION & SETUP\r\n // =======================================================\r\n-// This ensures the environment is recognized, though current storage is localStorage/API.\r\n+// 1. Centralized API Host for all backend connections\r\n+const API_HOST = \"http://localhost:4050\"; \r\n+\r\n const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n-// const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\r\n-// You would use these variables if switching to Firestore/Firebase Auth.\r\n \r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n const token = localStorage.getItem(\"accessToken\");\r\n+// Redirects to login if no access token is found\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n@@ -36,9 +37,9 @@\n \r\n         const html = await res.text();\r\n         mainContentArea.innerHTML = html;\r\n \r\n-        // If dashboard loaded into main content, trigger its data loads\r\n+        // Trigger dashboard specific loads immediately after content is inserted\r\n         if (url.includes(\"dashboardoverview.html\")) {\r\n             await loadDashboardSummary();\r\n             await loadAccessChart();\r\n         }\r\n@@ -48,9 +49,9 @@\n             `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n     }\r\n }\r\n \r\n-// Sidebar routing\r\n+// Sidebar routing: Handles content loading and dynamic data fetching\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n         // Update active state for sidebar buttons\r\n         sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n@@ -65,18 +66,119 @@\n         if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n         if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n         if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n         if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n-        \r\n-        // Note: loadVisitorsList and loadPaymentRecords are placeholders \r\n-        // as their functions were not provided, but the event listeners are preserved.\r\n     });\r\n });\r\n \r\n-// Placeholder functions for pages whose data loaders were not provided\r\n-async function loadVisitorsList() { console.log('Loading visitors list...'); }\r\n-async function loadPaymentRecords() { console.log('Loading payment records...'); }\r\n+// ================================\r\n+// DYNAMIC CONTENT LOADERS (Now Fully Implemented)\r\n+// ================================\r\n \r\n+/**\r\n+ * Loads and displays payment records from the API.\r\n+ */\r\n+async function loadPaymentRecords() { \r\n+    console.log('Fetching payment records...'); \r\n+    const container = document.getElementById(\"dynamic-section-content\");\r\n+    if (!container) return;\r\n+    \r\n+    container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n+    \r\n+    try {\r\n+        const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        \r\n+        const payments = await res.json();\r\n+        \r\n+        if (payments.length === 0) {\r\n+            container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n+            return;\r\n+        }\r\n+\r\n+        // Basic HTML rendering for payments table\r\n+        let html = `\r\n+            <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                <thead class=\"bg-gray-200\">\r\n+                    <tr>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                    </tr>\r\n+                </thead>\r\n+                <tbody>\r\n+        `;\r\n+\r\n+        payments.forEach(p => {\r\n+            const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n+            const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n+            const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n+\r\n+            html += `\r\n+                <tr class=\"border-b hover:bg-gray-50\">\r\n+                    <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n+                    <td class=\"py-2 px-4\">${date}</td>\r\n+                    <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n+                </tr>`;\r\n+        });\r\n+\r\n+        html += `</tbody></table>`;\r\n+        container.innerHTML = html;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading payment records:\", err);\r\n+        container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n+    }\r\n+}\r\n+\r\n+\r\n+/**\r\n+ * Loads and displays visitors list data from the API.\r\n+ */\r\n+async function loadVisitorsList() { \r\n+    console.log('Fetching visitors list...'); \r\n+    const container = document.getElementById(\"dynamic-section-content\");\r\n+    if (!container) return;\r\n+\r\n+    container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n+\r\n+    try {\r\n+        const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        \r\n+        const data = await res.json();\r\n+        \r\n+        if (data.length === 0) {\r\n+            container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n+            return;\r\n+        }\r\n+\r\n+        // Example rendering for visitors (adjust fields based on actual API data)\r\n+        let html = `<ul class=\"space-y-3 p-4\">`;\r\n+        data.forEach(v => {\r\n+            html += `\r\n+                <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n+                    <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n+                    <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n+                    <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n+                </li>`;\r\n+        });\r\n+        html += \"</ul>\";\r\n+        container.innerHTML = html;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading visitors list:\", err);\r\n+        container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n+    }\r\n+}\r\n+\r\n+\r\n // ================================\r\n // VISITOR MANAGEMENT DROPDOWN\r\n // ================================\r\n const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n@@ -110,9 +212,9 @@\n // DASHBOARD SUMMARY\r\n // ================================\r\n async function loadDashboardSummary() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n+        const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n@@ -133,9 +235,9 @@\n // ACCESS CHART\r\n // ================================\r\n async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n+        const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n@@ -144,9 +246,8 @@\n \r\n         const canvas = document.getElementById(\"accessChart\");\r\n         if (!canvas) return;\r\n \r\n-        // Ensure Chart.js is available globally before calling new Chart\r\n         if (typeof Chart === 'undefined') {\r\n             console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n             return;\r\n         }\r\n@@ -177,18 +278,16 @@\n \r\n // ================================\r\n // INITIAL DASHBOARD LOAD\r\n // ================================\r\n-// This runs on page load and assumes the dashboard HTML structure is initially present.\r\n+// This runs on page load. It defaults to loading the dashboard overview.\r\n (async function initializeDashboard() {\r\n-    // Only attempt to load if the content area is empty or specific dashboard elements exist\r\n+    // If specific dashboard elements exist, load data directly\r\n     if (document.getElementById(\"totalResidents\")) {\r\n         await loadDashboardSummary();\r\n         await loadAccessChart();\r\n     } else {\r\n-        // If the main page structure implies dashboard is default, load it.\r\n-        // Assuming dashboardoverview.html is the default page.\r\n-        // Find the dashboard button and simulate a click to ensure the content is loaded first.\r\n+        // Otherwise, simulate a click on the dashboard button to load content and data\r\n         const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n         if(dashboardBtn) {\r\n             dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n             await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n@@ -200,9 +299,9 @@\n // MEMBERSHIP REQUESTS\r\n // ================================\r\n async function loadMembershipRequests() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n+        const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n@@ -266,9 +365,9 @@\n                 btn.disabled = true;\r\n                 btn.textContent = 'Processing...';\r\n \r\n                 try {\r\n-                    const resp = await fetch(\"http://localhost:4050/api/admin/approveResident\", {\r\n+                    const resp = await fetch(`${API_HOST}/api/admin/approveResident`, {\r\n                         method: \"POST\",\r\n                         headers: {\r\n                             \"Content-Type\": \"application/json\",\r\n                             \"Authorization\": `Bearer ${token}`\r\n@@ -287,15 +386,12 @@\n                         statusCell.classList.add('font-bold', 'text-green-600');\r\n                     }\r\n                     actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n                     \r\n-                    // Optional: Reload the list to refresh the status of all requests\r\n-                    // await loadMembershipRequests();\r\n-\r\n                 } catch (err) {\r\n                     console.error(\"Error approving request:\", err.message);\r\n                     \r\n-                    // Failure handling: revert button and show error visually (non-alert)\r\n+                    // Failure handling: revert button and show error visually\r\n                     btn.disabled = false;\r\n                     btn.textContent = 'Failed!';\r\n                     btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n                     btn.classList.add('bg-red-500', 'animate-pulse');\r\n@@ -324,9 +420,9 @@\n // MEMBERSHIP RECORDS\r\n // ================================\r\n async function loadMembershipRecords() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n+        const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n@@ -353,9 +449,9 @@\n                         <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n                         <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n                     </div>\r\n                     <div class=\"text-right\">\r\n-                         <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n+                       <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n                             Active\r\n                         </span>\r\n                     </div>\r\n                 </li>`;\r\n"
                },
                {
                    "date": 1763667064103,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,470 +1,488 @@\n-// =======================================================\r\n-// CONFIGURATION & SETUP\r\n-// =======================================================\r\n-// 1. Centralized API Host for all backend connections\r\n-const API_HOST = \"http://localhost:4050\"; \r\n+/**\r\n+ * Admin Dashboard Client-Side JavaScript\r\n+ * Uses Fetch API to communicate with a Node.js/Express Backend (API_HOST)\r\n+ */\r\n+(async function initializeDashboard() {\r\n+    // =======================================================\r\n+    // CONFIGURATION & INITIAL STATE\r\n+    // =======================================================\r\n+    // 1. Centralized API Host for all backend connections\r\n+    const API_HOST = \"http://localhost:4050\"; \r\n \r\n-const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n-const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n+    // Remove unused/legacy Firebase config variables\r\n+    // const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n+    // const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n \r\n+    // 2. Auth State Check & Token Retrieval\r\n+    const token = localStorage.getItem(\"accessToken\");\r\n+    \r\n+    // Redirects to login if no access token is found\r\n+    if (!token) {\r\n+        window.location.href = \"/login.html\";\r\n+        return; // Stop execution if redirecting\r\n+    }\r\n \r\n-// ================================\r\n-// AUTH & LOGOUT\r\n-// ================================\r\n-const token = localStorage.getItem(\"accessToken\");\r\n-// Redirects to login if no access token is found\r\n-if (!token) window.location.href = \"/login.html\";\r\n+    // DOM Elements\r\n+    const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+    const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n-});\r\n \r\n-// ================================\r\n-// SIDEBAR PAGE LOADING\r\n-// ================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n+    // ================================\r\n+    // UTILITIES\r\n+    // ================================\r\n \r\n-/**\r\n- * Fetches and loads HTML content into the main content area.\r\n- * @param {string} url The URL of the page to load.\r\n- */\r\n-async function loadPageIntoMainContent(url) {\r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html;\r\n-\r\n-        // Trigger dashboard specific loads immediately after content is inserted\r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary();\r\n-            await loadAccessChart();\r\n+    /**\r\n+     * Safely updates the text content of an element by ID.\r\n+     * @param {string} id Element ID.\r\n+     * @param {string|number} value New value.\r\n+     * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n+     */\r\n+    const safeUpdate = (id, value, suffix = '') => {\r\n+        const element = document.getElementById(id);\r\n+        if (element) {\r\n+            element.textContent = value + suffix;\r\n+        } else {\r\n+            // console.warn(`Element with ID '${id}' not found.`); // Keep silent for clean console\r\n         }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML =\r\n-            `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n-    }\r\n-}\r\n+    };\r\n+    \r\n+    // ================================\r\n+    // DYNAMIC CONTENT LOADERS (API INTERACTION)\r\n+    // ================================\r\n \r\n-// Sidebar routing: Handles content loading and dynamic data fetching\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        // Update active state for sidebar buttons\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+    /**\r\n+     * Loads and displays payment records from the API.\r\n+     */\r\n+    async function loadPaymentRecords() { \r\n+        console.log('Fetching payment records...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n+        \r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const payments = await res.json();\r\n+            \r\n+            if (payments.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n+                return;\r\n+            }\r\n \r\n-        const page = btn.dataset.target;\r\n-        if (!page) return;\r\n+            // Basic HTML rendering for payments table\r\n+            let html = `\r\n+                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                    <thead class=\"bg-gray-200\">\r\n+                        <tr>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                        </tr>\r\n+                    </thead>\r\n+                    <tbody>\r\n+            `;\r\n \r\n-        await loadPageIntoMainContent(page);\r\n+            payments.forEach(p => {\r\n+                const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n+                const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n+                const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n \r\n-        // Trigger dynamic page data loads after content is inserted\r\n-        if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n-        if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n-        if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-        if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n-    });\r\n-});\r\n+                html += `\r\n+                    <tr class=\"border-b hover:bg-gray-50\">\r\n+                        <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n+                        <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n+                        <td class=\"py-2 px-4\">${date}</td>\r\n+                        <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n+                    </tr>`;\r\n+            });\r\n \r\n-// ================================\r\n-// DYNAMIC CONTENT LOADERS (Now Fully Implemented)\r\n-// ================================\r\n+            html += `</tbody></table>`;\r\n+            container.innerHTML = html;\r\n \r\n-/**\r\n- * Loads and displays payment records from the API.\r\n- */\r\n-async function loadPaymentRecords() { \r\n-    console.log('Fetching payment records...'); \r\n-    const container = document.getElementById(\"dynamic-section-content\");\r\n-    if (!container) return;\r\n-    \r\n-    container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n-    \r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        \r\n-        const payments = await res.json();\r\n-        \r\n-        if (payments.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n-            return;\r\n+        } catch (err) {\r\n+            console.error(\"Error loading payment records:\", err);\r\n+            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n         }\r\n+    }\r\n \r\n-        // Basic HTML rendering for payments table\r\n-        let html = `\r\n-            <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                <thead class=\"bg-gray-200\">\r\n-                    <tr>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                    </tr>\r\n-                </thead>\r\n-                <tbody>\r\n-        `;\r\n+    /**\r\n+     * Loads and displays visitors list data from the API.\r\n+     */\r\n+    async function loadVisitorsList() { \r\n+        console.log('Fetching visitors list...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n \r\n-        payments.forEach(p => {\r\n-            const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n-            const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n-            const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n \r\n-            html += `\r\n-                <tr class=\"border-b hover:bg-gray-50\">\r\n-                    <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n-                    <td class=\"py-2 px-4\">${date}</td>\r\n-                    <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n-                </tr>`;\r\n-        });\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const data = await res.json();\r\n+            \r\n+            if (data.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n+                return;\r\n+            }\r\n \r\n-        html += `</tbody></table>`;\r\n-        container.innerHTML = html;\r\n+            // Example rendering for visitors (adjust fields based on actual API data)\r\n+            let html = `<ul class=\"space-y-3 p-4\">`;\r\n+            data.forEach(v => {\r\n+                html += `\r\n+                    <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n+                        <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n+                        <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n+                        <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n+                    </li>`;\r\n+            });\r\n+            html += \"</ul>\";\r\n+            container.innerHTML = html;\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading payment records:\", err);\r\n-        container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n+        } catch (err) {\r\n+            console.error(\"Error loading visitors list:\", err);\r\n+            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n+        }\r\n     }\r\n-}\r\n \r\n \r\n-/**\r\n- * Loads and displays visitors list data from the API.\r\n- */\r\n-async function loadVisitorsList() { \r\n-    console.log('Fetching visitors list...'); \r\n-    const container = document.getElementById(\"dynamic-section-content\");\r\n-    if (!container) return;\r\n+    /**\r\n+     * Loads and displays membership records (approved members) from the API.\r\n+     */\r\n+    async function loadMembershipRecords() {\r\n+        console.log('Fetching membership records...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n \r\n-    container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n+        try {\r\n+            // Note: This API endpoint seems to return ALL membership states.\r\n+            const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n \r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        \r\n-        const data = await res.json();\r\n-        \r\n-        if (data.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n-            return;\r\n-        }\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-        // Example rendering for visitors (adjust fields based on actual API data)\r\n-        let html = `<ul class=\"space-y-3 p-4\">`;\r\n-        data.forEach(v => {\r\n-            html += `\r\n-                <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n-                    <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n-                    <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n-                    <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n-                </li>`;\r\n-        });\r\n-        html += \"</ul>\";\r\n-        container.innerHTML = html;\r\n+            const members = await res.json();\r\n+            \r\n+            // Filter for only approved members for the records section\r\n+            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitors list:\", err);\r\n-        container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n-    }\r\n-}\r\n+            if (approvedMembers.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n+                return;\r\n+            }\r\n \r\n+            let html = `<ul class=\"space-y-3 p-4\">`;\r\n \r\n-// ================================\r\n-// VISITOR MANAGEMENT DROPDOWN\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+            approvedMembers.forEach(m => {\r\n+                html += `\r\n+                    <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n+                        <div>\r\n+                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n+                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n+                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n+                        </div>\r\n+                        <div class=\"text-right\">\r\n+                           <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n+                                Active\r\n+                           </span>\r\n+                        </div>\r\n+                    </li>`;\r\n+            });\r\n \r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n-});\r\n+            html += \"</ul>\";\r\n+            container.innerHTML = html;\r\n \r\n-// ================================\r\n-// SAFE UPDATE HELPER\r\n-// ================================\r\n-/**\r\n- * Safely updates the text content of an element by ID.\r\n- * @param {string} id Element ID.\r\n- * @param {string|number} value New value.\r\n- * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n- */\r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    } else {\r\n-        console.warn(`Element with ID '${id}' not found.`);\r\n+        } catch (err) {\r\n+            console.error(\"Error loading membership records:\", err);\r\n+            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n+        }\r\n     }\r\n-};\r\n \r\n-// ================================\r\n-// DASHBOARD SUMMARY\r\n-// ================================\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n \r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    /**\r\n+     * Loads and displays pending membership requests and handles approvals.\r\n+     */\r\n+    async function loadMembershipRequests() {\r\n+        console.log('Fetching membership requests...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n \r\n-        const data = await res.json();\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+            const requests = await res.json();\r\n+            \r\n+            // Filter for pending requests to show in this view\r\n+            const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading dashboard summary:\", err);\r\n-    }\r\n-}\r\n+            if (pendingRequests.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n+                return;\r\n+            }\r\n \r\n-// ================================\r\n-// ACCESS CHART\r\n-// ================================\r\n-async function loadAccessChart() {\r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n+            let html = `\r\n+                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                    <thead class=\"bg-gray-200\">\r\n+                        <tr>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n+                        </tr>\r\n+                    </thead>\r\n+                    <tbody>\r\n+            `;\r\n \r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            pendingRequests.forEach(r => {\r\n+                html += `\r\n+                    <tr class=\"border-b hover:bg-yellow-50\">\r\n+                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n+                        <td class=\"py-2 px-4\">${r.HouseNumber} - ${r.CourtName}</td>\r\n+                        <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n+                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n+                        <td class=\"py-2 px-4 action-cell\">\r\n+                            <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n+                        </td>\r\n+                    </tr>`;\r\n+            });\r\n \r\n-        const data = await res.json();\r\n\\ No newline at end of file\n+            html += `</tbody></table>`;\r\n+            container.innerHTML = html;\r\n \r\n-        const canvas = document.getElementById(\"accessChart\");\r\n-        if (!canvas) return;\r\n+            // Approve buttons event listeners (Binding Logic)\r\n+            document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n+                btn.addEventListener(\"click\", handleApproveClick);\r\n+            });\r\n \r\n-        if (typeof Chart === 'undefined') {\r\n-            console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n-            return;\r\n+        } catch (err) {\r\n+            console.error(\"Error loading membership requests:\", err);\r\n+            const container = document.getElementById(\"dynamic-section-content\");\r\n+            if (container) {\r\n+                 container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n+            }\r\n         }\r\n+    }\r\n \r\n-        const ctx = canvas.getContext(\"2d\");\r\n+    /**\r\n+     * Handles the click event for approving a membership request.\r\n+     * @param {Event} event \r\n+     */\r\n+    async function handleApproveClick(event) {\r\n+        const btn = event.currentTarget;\r\n+        const requestId = btn.dataset.id;\r\n+        const originalText = btn.textContent;\r\n+        \r\n+        btn.disabled = true;\r\n+        btn.textContent = 'Processing...';\r\n \r\n-        new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: \"#2563eb\",\r\n-                    backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n+        try {\r\n+            const resp = await fetch(`${API_HOST}/api/admin/approveResident`, {\r\n+                method: \"POST\",\r\n+                headers: {\r\n+                    \"Content-Type\": \"application/json\",\r\n+                    \"Authorization\": `Bearer ${token}`\r\n+                },\r\n+                body: JSON.stringify({ requestId })\r\n+            });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading access chart:\", err);\r\n-    }\r\n-}\r\n+            if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n \r\n-// ================================\r\n-// INITIAL DASHBOARD LOAD\r\n-// ================================\r\n-// This runs on page load. It defaults to loading the dashboard overview.\r\n-(async function initializeDashboard() {\r\n-    // If specific dashboard elements exist, load data directly\r\n-    if (document.getElementById(\"totalResidents\")) {\r\n-        await loadDashboardSummary();\r\n-        await loadAccessChart();\r\n-    } else {\r\n-        // Otherwise, simulate a click on the dashboard button to load content and data\r\n-        const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n-        if(dashboardBtn) {\r\n-            dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-            await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n+            // Success handling: update the UI\r\n+            const actionCell = btn.parentElement;\r\n+            const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n+            \r\n+            if (statusCell) {\r\n+                statusCell.textContent = 'Approved';\r\n+                statusCell.classList.add('font-bold', 'text-green-600');\r\n+            }\r\n+            actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n+            \r\n+        } catch (err) {\r\n+            console.error(\"Error approving request:\", err.message);\r\n+            \r\n+            // Failure handling: revert button and show error visually\r\n+            btn.disabled = false;\r\n+            btn.textContent = 'Failed!';\r\n+            btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n+            btn.classList.add('bg-red-500', 'animate-pulse');\r\n+\r\n+            // Reset after a short period\r\n+            setTimeout(() => {\r\n+                btn.textContent = originalText;\r\n+                btn.classList.remove('bg-red-500', 'animate-pulse');\r\n+                btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n+            }, 2000);\r\n+            \r\n         }\r\n     }\r\n-})();\r\n \r\n-// ================================\r\n-// MEMBERSHIP REQUESTS\r\n-// ================================\r\n-async function loadMembershipRequests() {\r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    /**\r\n+     * Loads dashboard summary metrics.\r\n+     */\r\n+    async function loadDashboardSummary() {\r\n+        console.log('Fetching dashboard summary...');\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n \r\n-        const requests = await res.json();\r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-        if (requests.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No membership requests found.</p>\";\r\n-            return;\r\n+            const data = await res.json();\r\n+\r\n+            safeUpdate(\"totalResidents\", data.residents || 0);\r\n+            safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+            safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+            safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading dashboard summary:\", err);\r\n         }\r\n+    }\r\n \r\n-        let html = `\r\n-            <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                <thead class=\"bg-gray-200\">\r\n-                    <tr>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">National ID</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Phone</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Email</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Court</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n-                    </tr>\r\n-                </thead>\r\n-                <tbody>\r\n-        `;\r\n+    /**\r\n+     * Loads data and renders the Access Chart using Chart.js.\r\n+     */\r\n+    async function loadAccessChart() {\r\n+        console.log('Fetching access chart data...');\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n \r\n-        requests.forEach(r => {\r\n-            const rowClass = r.Status === \"Approved\" ? \"bg-green-50\" : r.Status === \"Pending\" ? \"hover:bg-yellow-50\" : \"bg-red-50\";\r\n-            html += `\r\n-                <tr class=\"border-b ${rowClass}\">\r\n-                    <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n-                    <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n-                    <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n-                    <td class=\"py-2 px-4\">${r.Email}</td>\r\n-                    <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n-                    <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n-                    <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n-                    <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                    <td class=\"py-2 px-4 action-cell\">\r\n-                        ${r.Status === \"Pending\"\r\n-                            ? `<button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>`\r\n-                            : `<span class=\"text-gray-500 text-sm\">${r.Status}</span>`\r\n-                        }\r\n-                    </td>\r\n-                </tr>`;\r\n-        });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-        html += `</tbody></table>`;\r\n-        container.innerHTML = html;\r\n+            const data = await res.json();\r\n \r\n-        // Approve buttons event listeners\r\n-        document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n-            btn.addEventListener(\"click\", async () => {\r\n-                const requestId = btn.dataset.id;\r\n-                const originalText = btn.textContent;\r\n-                \r\n-                btn.disabled = true;\r\n-                btn.textContent = 'Processing...';\r\n+            const canvas = document.getElementById(\"accessChart\");\r\n+            if (!canvas) return;\r\n \r\n-                try {\r\n-                    const resp = await fetch(`${API_HOST}/api/admin/approveResident`, {\r\n-                        method: \"POST\",\r\n-                        headers: {\r\n-                            \"Content-Type\": \"application/json\",\r\n-                            \"Authorization\": `Bearer ${token}`\r\n-                        },\r\n-                        body: JSON.stringify({ requestId })\r\n-                    });\r\n+            // Check if Chart.js is available globally (must be included in HTML)\r\n+            if (typeof Chart === 'undefined') {\r\n+                console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n+                return;\r\n+            }\r\n \r\n-                    if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n+            const ctx = canvas.getContext(\"2d\");\r\n \r\n-                    // Success handling: update the UI\r\n-                    const actionCell = btn.parentElement;\r\n-                    const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n-                    \r\n-                    if (statusCell) {\r\n-                        statusCell.textContent = 'Approved';\r\n-                        statusCell.classList.add('font-bold', 'text-green-600');\r\n-                    }\r\n-                    actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n-                    \r\n-                } catch (err) {\r\n-                    console.error(\"Error approving request:\", err.message);\r\n-                    \r\n-                    // Failure handling: revert button and show error visually\r\n-                    btn.disabled = false;\r\n-                    btn.textContent = 'Failed!';\r\n-                    btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n-                    btn.classList.add('bg-red-500', 'animate-pulse');\r\n-\r\n-                    // Reset after a short period\r\n-                    setTimeout(() => {\r\n-                        btn.textContent = originalText;\r\n-                        btn.classList.remove('bg-red-500', 'animate-pulse');\r\n-                        btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n-                    }, 2000);\r\n-                    \r\n-                }\r\n+            new Chart(ctx, {\r\n+                type: \"line\",\r\n+                data: {\r\n+                    labels: data.days || [],\r\n+                    datasets: [{\r\n+                        label: \"Access Attempts\",\r\n+                        data: data.counts || [],\r\n+                        borderWidth: 2,\r\n+                        tension: 0.4,\r\n+                        borderColor: \"#2563eb\",\r\n+                        backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n+                        fill: true\r\n+                    }]\r\n+                },\r\n+                options: { responsive: true, maintainAspectRatio: false }\r\n             });\r\n-        });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading membership requests:\", err);\r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (container) {\r\n-             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n+        } catch (err) {\r\n+            console.error(\"Error loading access chart:\", err);\r\n         }\r\n     }\r\n-}\r\n \r\n-// ================================\r\n-// MEMBERSHIP RECORDS\r\n-// ================================\r\n-async function loadMembershipRecords() {\r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n \r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    // ================================\r\n+    // SIDEBAR PAGE LOADING\r\n+    // ================================\r\n \r\n-        const members = await res.json();\r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n+    /**\r\n+     * Fetches and loads HTML content into the main content area.\r\n+     * @param {string} url The URL of the page to load.\r\n+     */\r\n+    async function loadPageIntoMainContent(url) {\r\n+        try {\r\n+            const res = await fetch(url);\r\n+            if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n \r\n-        // Filter for only approved members for the records section\r\n-        const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+            const html = await res.text();\r\n+            mainContentArea.innerHTML = html;\r\n \r\n-        if (approvedMembers.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n-            return;\r\n+            // Trigger dashboard specific loads immediately after content is inserted\r\n+            if (url.includes(\"dashboardoverview.html\")) {\r\n+                await loadDashboardSummary();\r\n+                await loadAccessChart();\r\n+            }\r\n+        } catch (err) {\r\n+            console.error(\"Error loading page:\", err);\r\n+            mainContentArea.innerHTML =\r\n+                `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n         }\r\n+    }\r\n \r\n-        let html = `<ul class=\"space-y-3 p-4\">`;\r\n+    // Sidebar routing: Handles content loading and dynamic data fetching\r\n+    sidebarButtons.forEach(btn => {\r\n+        btn.addEventListener(\"click\", async () => {\r\n+            // Update active state for sidebar buttons\r\n+            sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+            btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n-        approvedMembers.forEach(m => {\r\n-            html += `\r\n-                <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n-                    <div>\r\n-                        <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n-                        <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n-                        <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n-                    </div>\r\n-                    <div class=\"text-right\">\r\n-                       <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n-                            Active\r\n-                        </span>\r\n-                    </div>\r\n-                </li>`;\r\n+            const page = btn.dataset.target;\r\n+            if (!page) return;\r\n+\r\n+            await loadPageIntoMainContent(page);\r\n+\r\n+            // Trigger dynamic page data loads after content is inserted\r\n+            if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n+            if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n+            if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+            if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n         });\r\n+    });\r\n \r\n-        html += \"</ul>\";\r\n-        container.innerHTML = html;\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading membership records:\", err);\r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (container) {\r\n-             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n-        }\r\n+    // ================================\r\n+    // EVENT LISTENERS & INITIALIZATION\r\n+    // ================================\r\n+\r\n+    // Logout Button\r\n+    document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+        localStorage.removeItem(\"accessToken\");\r\n+        window.location.href = \"/login.html\";\r\n+    });\r\n+    \r\n+    // Visitor Management Dropdown Toggle\r\n+    const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+    const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+    const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+    visitorToggle?.addEventListener(\"click\", () => {\r\n+        visitorSubMenu?.classList.toggle(\"hidden\");\r\n+        visitorArrow?.classList.toggle(\"rotate-90\");\r\n+    });\r\n+\r\n+\r\n+    // Initial Dashboard Load\r\n+    // This runs on page load. It defaults to loading the dashboard overview.\r\n+    const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n+    if (dashboardBtn) {\r\n+        dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n+    } else if (document.getElementById(\"totalResidents\")) {\r\n+        // Fallback for when content is already on the page (less common in SPA-style)\r\n+        await loadDashboardSummary();\r\n+        await loadAccessChart();\r\n     }\r\n-}\n+})();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763670476398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -219,13 +219,18 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n \r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n+            const res = await fetch(`${API_HOST}/api/membershipsrecords/all`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n+            const responseData = await res.json();\r\n+            // Assuming the backend returns an object with a 'records' property\r\n+            const members = responseData.records || []; \r\n+            \r\n+            // Filter for only approved members for the records section\r\n+            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n             const requests = await res.json();\r\n             \r\n             // Filter for pending requests to show in this view\r\n             const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n"
                },
                {
                    "date": 1763670637705,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -226,16 +226,14 @@\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n             const responseData = await res.json();\r\n             // Assuming the backend returns an object with a 'records' property\r\n             const members = responseData.records || []; \r\n-            \r\n-            // Filter for only approved members for the records section\r\n-            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n-            const requests = await res.json();\r\n-            \r\n             // Filter for pending requests to show in this view\r\n             const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n \r\n+            // Filter for only approved members for the records section\r\n+            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+            const requests = await res.json();        \r\n             if (pendingRequests.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n                 return;\r\n             }\r\n"
                },
                {
                    "date": 1763670643529,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -228,9 +228,8 @@\n             // Assuming the backend returns an object with a 'records' property\r\n             const members = responseData.records || []; \r\n             // Filter for pending requests to show in this view\r\n             const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n-\r\n             // Filter for only approved members for the records section\r\n             const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n             const requests = await res.json();        \r\n             if (pendingRequests.length === 0) {\r\n"
                },
                {
                    "date": 1763670830121,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,12 +8,8 @@\n     // =======================================================\r\n     // 1. Centralized API Host for all backend connections\r\n     const API_HOST = \"http://localhost:4050\"; \r\n \r\n-    // Remove unused/legacy Firebase config variables\r\n-    // const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n-    // const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n-\r\n     // 2. Auth State Check & Token Retrieval\r\n     const token = localStorage.getItem(\"accessToken\");\r\n     \r\n     // Redirects to login if no access token is found\r\n@@ -41,9 +37,9 @@\n         const element = document.getElementById(id);\r\n         if (element) {\r\n             element.textContent = value + suffix;\r\n         } else {\r\n-            // console.warn(`Element with ID '${id}' not found.`); // Keep silent for clean console\r\n+            // console.warn(`Element with ID '${id}' not found.`); \r\n         }\r\n     };\r\n     \r\n     // ================================\r\n@@ -163,16 +159,18 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n \r\n         try {\r\n-            // Note: This API endpoint seems to return ALL membership states.\r\n-            const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n+            // FIX 1: Standardize API Endpoint path\r\n+            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n \r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-            const members = await res.json();\r\n+            const responseData = await res.json();\r\n+            // FIX 2: Access the 'records' property, which the backend controller returns\r\n+            const members = responseData.records || []; \r\n             \r\n             // Filter for only approved members for the records section\r\n             const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n \r\n@@ -219,20 +217,21 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n \r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/membershipsrecords/all`, {\r\n+            // FIX 1: Standardize API Endpoint path\r\n+            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n             const responseData = await res.json();\r\n-            // Assuming the backend returns an object with a 'records' property\r\n-            const members = responseData.records || []; \r\n+            // FIX 2: Access the 'records' property, which the backend controller returns\r\n+            const allRecords = responseData.records || [];\r\n+            \r\n             // Filter for pending requests to show in this view\r\n-            const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n-            // Filter for only approved members for the records section\r\n-            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n-            const requests = await res.json();        \r\n+            const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n+            \r\n             if (pendingRequests.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n                 return;\r\n             }\r\n@@ -293,15 +292,16 @@\n         btn.disabled = true;\r\n         btn.textContent = 'Processing...';\r\n \r\n         try {\r\n-            const resp = await fetch(`${API_HOST}/api/admin/approveResident`, {\r\n-                method: \"POST\",\r\n+            // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n+            const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n+                method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n                 headers: {\r\n                     \"Content-Type\": \"application/json\",\r\n                     \"Authorization\": `Bearer ${token}`\r\n                 },\r\n-                body: JSON.stringify({ requestId })\r\n+                // Removed body: JSON.stringify({ requestId }) as ID is now in the URL\r\n             });\r\n \r\n             if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n \r\n"
                },
                {
                    "date": 1763672835095,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -486,5 +486,73 @@\n         // Fallback for when content is already on the page (less common in SPA-style)\r\n         await loadDashboardSummary();\r\n         await loadAccessChart();\r\n     }\r\n-})();\n\\ No newline at end of file\n+})();\r\n+// =========================================\r\n+// Debug Fetch Wrapper\r\n+// =========================================\r\n+async function debugFetch(name, url, options = {}) {\r\n+  console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n+  console.time(name);\r\n+\r\n+  try {\r\n+    const res = await fetch(url, options);\r\n+\r\n+    if (!res.ok) {\r\n+      console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n+      const text = await res.text();\r\n+      console.error(`Response text:`, text);\r\n+      console.timeEnd(name);\r\n+      return null;\r\n+    }\r\n+\r\n+    const data = await res.json();\r\n+    console.log(`✅ ${name} succeeded`, data);\r\n+    console.timeEnd(name);\r\n+    return data;\r\n+  } catch (err) {\r\n+    console.error(`❌ ${name} error:`, err);\r\n+    console.timeEnd(name);\r\n+    return null;\r\n+  }\r\n+}\r\n+\r\n+// =========================================\r\n+// Individual Fetch Functions\r\n+// =========================================\r\n+async function fetchDashboardSummary() {\r\n+  return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n+}\r\n+\r\n+async function fetchAccessChartData() {\r\n+  return await debugFetch(\"Access Chart Data\", \"/api/access/chart\");\r\n+}\r\n+\r\n+async function fetchMembershipRequests() {\r\n+  return await debugFetch(\"Membership Requests\", \"/api/memberships/requests\");\r\n+}\r\n+\r\n+async function fetchMembershipRecords() {\r\n+  return await debugFetch(\"Membership Records\", \"/api/memberships/records\");\r\n+}\r\n+\r\n+// =========================================\r\n+// Main Loader\r\n+// =========================================\r\n+async function loadAdminDashboard() {\r\n+  const [summary, chartData, requests, records] = await Promise.all([\r\n+    fetchDashboardSummary(),\r\n+    fetchAccessChartData(),\r\n+    fetchMembershipRequests(),\r\n+    fetchMembershipRecords(),\r\n+  ]);\r\n+\r\n+  // Example: populate your dashboard with data if available\r\n+  if (summary) populateDashboardSummary(summary);\r\n+  if (chartData) renderAccessChart(chartData);\r\n+  if (requests) renderMembershipRequests(requests);\r\n+  if (records) renderMembershipRecords(records);\r\n+}\r\n+\r\n+// Call on page load\r\n+loadAdminDashboard();\r\n"
                },
                {
                    "date": 1763673344126,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,558 +1,217 @@\n /**\r\n  * Admin Dashboard Client-Side JavaScript\r\n- * Uses Fetch API to communicate with a Node.js/Express Backend (API_HOST)\r\n+ * Uses Fetch API to communicate with a Node.js/Express Backend (API_BASE)\r\n  */\r\n (async function initializeDashboard() {\r\n     // =======================================================\r\n     // CONFIGURATION & INITIAL STATE\r\n     // =======================================================\r\n-    // 1. Centralized API Host for all backend connections\r\n-    const API_HOST = \"http://localhost:4050\"; \r\n-\r\n-    // 2. Auth State Check & Token Retrieval\r\n+    // Centralized API Host for all backend connections\r\n+    const API_BASE = \"http://localhost:4050\"; \r\n     const token = localStorage.getItem(\"accessToken\");\r\n     \r\n-    // Redirects to login if no access token is found\r\n     if (!token) {\r\n         window.location.href = \"/login.html\";\r\n         return; // Stop execution if redirecting\r\n     }\r\n \r\n-    // DOM Elements\r\n     const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n     const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-\r\n     // ================================\r\n     // UTILITIES\r\n     // ================================\r\n-\r\n-    /**\r\n-     * Safely updates the text content of an element by ID.\r\n-     * @param {string} id Element ID.\r\n-     * @param {string|number} value New value.\r\n-     * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n-     */\r\n     const safeUpdate = (id, value, suffix = '') => {\r\n         const element = document.getElementById(id);\r\n-        if (element) {\r\n-            element.textContent = value + suffix;\r\n-        } else {\r\n-            // console.warn(`Element with ID '${id}' not found.`); \r\n-        }\r\n+        if (element) element.textContent = value + suffix;\r\n     };\r\n-    \r\n-    // ================================\r\n-    // DYNAMIC CONTENT LOADERS (API INTERACTION)\r\n-    // ================================\r\n \r\n-    /**\r\n-     * Loads and displays payment records from the API.\r\n-     */\r\n+    // =========================================\r\n+    // Debug Fetch Wrapper\r\n+    // =========================================\r\n+    async function debugFetch(name, url, options = {}) {\r\n+        console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n+        console.time(name);\r\n+        try {\r\n+            const res = await fetch(url, { ...options, headers: { ...options.headers, \"Authorization\": `Bearer ${token}` } });\r\n+            if (!res.ok) {\r\n+                console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n+                const text = await res.text();\r\n+                console.error(`Response text:`, text);\r\n+                console.timeEnd(name);\r\n+                return null;\r\n+            }\r\n+            const data = await res.json();\r\n+            console.log(`✅ ${name} succeeded`, data);\r\n+            console.timeEnd(name);\r\n+            return data;\r\n+        } catch (err) {\r\n+            console.error(`❌ ${name} error:`, err);\r\n+            console.timeEnd(name);\r\n+            return null;\r\n+        }\r\n+    }\r\n+\r\n+    // =========================================\r\n+    // Individual Fetch Functions\r\n+    // =========================================\r\n+    async function fetchDashboardSummary() {\r\n+        return await debugFetch(\"Dashboard Summary\", `${API_BASE}/api/dashboard/summary`);\r\n+    }\r\n+\r\n+    async function fetchAccessChartData() {\r\n+        return await debugFetch(\"Access Chart Data\", `${API_BASE}/api/access/chart`);\r\n+    }\r\n+\r\n+    async function fetchMembershipRequests() {\r\n+        return await debugFetch(\"Membership Requests\", `${API_BASE}/api/memberships/requests`);\r\n+    }\r\n+\r\n+    async function fetchMembershipRecords() {\r\n+        return await debugFetch(\"Membership Records\", `${API_BASE}/api/memberships/records`);\r\n+    }\r\n+\r\n+    // =========================================\r\n+    // Main Loader\r\n+    // =========================================\r\n+    async function loadAdminDashboard() {\r\n+        const [summary, chartData, requests, records] = await Promise.all([\r\n+            fetchDashboardSummary(),\r\n+            fetchAccessChartData(),\r\n+            fetchMembershipRequests(),\r\n+            fetchMembershipRecords(),\r\n+        ]);\r\n+\r\n+        if (summary) populateDashboardSummary(summary);\r\n+        if (chartData) renderAccessChart(chartData);\r\n+        if (requests) renderMembershipRequests(requests);\r\n+        if (records) renderMembershipRecords(records);\r\n+    }\r\n+\r\n+    // =========================================\r\n+    // Other Page-Specific Loaders\r\n+    // =========================================\r\n     async function loadPaymentRecords() { \r\n-        console.log('Fetching payment records...'); \r\n+        console.log('Fetching payment records...');\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n-        \r\n+\r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n-        \r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const payments = await res.json();\r\n-            \r\n-            if (payments.length === 0) {\r\n+            const payments = await debugFetch(\"Payment Records\", `${API_BASE}/api/admin/payments`);\r\n+            if (!payments || payments.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n                 return;\r\n             }\r\n \r\n-            // Basic HTML rendering for payments table\r\n-            let html = `\r\n-                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                    <thead class=\"bg-gray-200\">\r\n-                        <tr>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                        </tr>\r\n-                    </thead>\r\n-                    <tbody>\r\n-            `;\r\n+            let html = `<table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                <thead class=\"bg-gray-200\">\r\n+                    <tr>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                    </tr>\r\n+                </thead>\r\n+                <tbody>`;\r\n \r\n             payments.forEach(p => {\r\n                 const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n                 const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n                 const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n-\r\n-                html += `\r\n-                    <tr class=\"border-b hover:bg-gray-50\">\r\n-                        <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n-                        <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n-                        <td class=\"py-2 px-4\">${date}</td>\r\n-                        <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n-                    </tr>`;\r\n+                html += `<tr class=\"border-b hover:bg-gray-50\">\r\n+                    <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n+                    <td class=\"py-2 px-4\">${date}</td>\r\n+                    <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n+                </tr>`;\r\n             });\r\n-\r\n             html += `</tbody></table>`;\r\n             container.innerHTML = html;\r\n-\r\n         } catch (err) {\r\n             console.error(\"Error loading payment records:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n-    /**\r\n-     * Loads and displays visitors list data from the API.\r\n-     */\r\n     async function loadVisitorsList() { \r\n-        console.log('Fetching visitors list...'); \r\n+        console.log('Fetching visitors list...');\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n-\r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const data = await res.json();\r\n-            \r\n-            if (data.length === 0) {\r\n+            const visitors = await debugFetch(\"Visitors List\", `${API_BASE}/api/admin/visitors`);\r\n+            if (!visitors || visitors.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n                 return;\r\n             }\r\n \r\n-            // Example rendering for visitors (adjust fields based on actual API data)\r\n             let html = `<ul class=\"space-y-3 p-4\">`;\r\n-            data.forEach(v => {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n-                        <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n-                        <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n-                        <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n-                    </li>`;\r\n+            visitors.forEach(v => {\r\n+                html += `<li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n+                    <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n+                    <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n+                    <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n+                </li>`;\r\n             });\r\n             html += \"</ul>\";\r\n             container.innerHTML = html;\r\n-\r\n         } catch (err) {\r\n             console.error(\"Error loading visitors list:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n-\r\n-    /**\r\n-     * Loads and displays membership records (approved members) from the API.\r\n-     */\r\n-    async function loadMembershipRecords() {\r\n-        console.log('Fetching membership records...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n-\r\n-        try {\r\n-            // FIX 1: Standardize API Endpoint path\r\n-            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const responseData = await res.json();\r\n-            // FIX 2: Access the 'records' property, which the backend controller returns\r\n-            const members = responseData.records || []; \r\n-            \r\n-            // Filter for only approved members for the records section\r\n-            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n-\r\n-            if (approvedMembers.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            let html = `<ul class=\"space-y-3 p-4\">`;\r\n-\r\n-            approvedMembers.forEach(m => {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n-                        <div>\r\n-                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n-                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n-                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n-                        </div>\r\n-                        <div class=\"text-right\">\r\n-                           <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n-                                Active\r\n-                           </span>\r\n-                        </div>\r\n-                    </li>`;\r\n-            });\r\n-\r\n-            html += \"</ul>\";\r\n-            container.innerHTML = html;\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading membership records:\", err);\r\n-            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * Loads and displays pending membership requests and handles approvals.\r\n-     */\r\n-    async function loadMembershipRequests() {\r\n-        console.log('Fetching membership requests...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n-\r\n-        try {\r\n-            // FIX 1: Standardize API Endpoint path\r\n-            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const responseData = await res.json();\r\n-            // FIX 2: Access the 'records' property, which the backend controller returns\r\n-            const allRecords = responseData.records || [];\r\n-            \r\n-            // Filter for pending requests to show in this view\r\n-            const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n-            \r\n-            if (pendingRequests.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            let html = `\r\n-                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                    <thead class=\"bg-gray-200\">\r\n-                        <tr>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n-                        </tr>\r\n-                    </thead>\r\n-                    <tbody>\r\n-            `;\r\n-\r\n-            pendingRequests.forEach(r => {\r\n-                html += `\r\n-                    <tr class=\"border-b hover:bg-yellow-50\">\r\n-                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.HouseNumber} - ${r.CourtName}</td>\r\n-                        <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n-                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                        <td class=\"py-2 px-4 action-cell\">\r\n-                            <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n-                        </td>\r\n-                    </tr>`;\r\n-            });\r\n-\r\n-            html += `</tbody></table>`;\r\n-            container.innerHTML = html;\r\n-\r\n-            // Approve buttons event listeners (Binding Logic)\r\n-            document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n-                btn.addEventListener(\"click\", handleApproveClick);\r\n-            });\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading membership requests:\", err);\r\n-            const container = document.getElementById(\"dynamic-section-content\");\r\n-            if (container) {\r\n-                 container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Handles the click event for approving a membership request.\r\n-     * @param {Event} event \r\n-     */\r\n-    async function handleApproveClick(event) {\r\n-        const btn = event.currentTarget;\r\n-        const requestId = btn.dataset.id;\r\n-        const originalText = btn.textContent;\r\n-        \r\n-        btn.disabled = true;\r\n-        btn.textContent = 'Processing...';\r\n-\r\n-        try {\r\n-            // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n-            const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n-                method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n-                headers: {\r\n-                    \"Content-Type\": \"application/json\",\r\n-                    \"Authorization\": `Bearer ${token}`\r\n-                },\r\n-                // Removed body: JSON.stringify({ requestId }) as ID is now in the URL\r\n-            });\r\n-\r\n-            if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n-\r\n-            // Success handling: update the UI\r\n-            const actionCell = btn.parentElement;\r\n-            const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n-            \r\n-            if (statusCell) {\r\n-                statusCell.textContent = 'Approved';\r\n-                statusCell.classList.add('font-bold', 'text-green-600');\r\n-            }\r\n-            actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n-            \r\n-        } catch (err) {\r\n-            console.error(\"Error approving request:\", err.message);\r\n-            \r\n-            // Failure handling: revert button and show error visually\r\n-            btn.disabled = false;\r\n-            btn.textContent = 'Failed!';\r\n-            btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n-            btn.classList.add('bg-red-500', 'animate-pulse');\r\n-\r\n-            // Reset after a short period\r\n-            setTimeout(() => {\r\n-                btn.textContent = originalText;\r\n-                btn.classList.remove('bg-red-500', 'animate-pulse');\r\n-                btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n-            }, 2000);\r\n-            \r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Loads dashboard summary metrics.\r\n-     */\r\n-    async function loadDashboardSummary() {\r\n-        console.log('Fetching dashboard summary...');\r\n-        try {\r\n-            const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const data = await res.json();\r\n-\r\n-            safeUpdate(\"totalResidents\", data.residents || 0);\r\n-            safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-            safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-            safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading dashboard summary:\", err);\r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Loads data and renders the Access Chart using Chart.js.\r\n-     */\r\n-    async function loadAccessChart() {\r\n-        console.log('Fetching access chart data...');\r\n-        try {\r\n-            const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const data = await res.json();\r\n-\r\n-            const canvas = document.getElementById(\"accessChart\");\r\n-            if (!canvas) return;\r\n-\r\n-            // Check if Chart.js is available globally (must be included in HTML)\r\n-            if (typeof Chart === 'undefined') {\r\n-                console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n-                return;\r\n-            }\r\n-\r\n-            const ctx = canvas.getContext(\"2d\");\r\n-\r\n-            new Chart(ctx, {\r\n-                type: \"line\",\r\n-                data: {\r\n-                    labels: data.days || [],\r\n-                    datasets: [{\r\n-                        label: \"Access Attempts\",\r\n-                        data: data.counts || [],\r\n-                        borderWidth: 2,\r\n-                        tension: 0.4,\r\n-                        borderColor: \"#2563eb\",\r\n-                        backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n-                        fill: true\r\n-                    }]\r\n-                },\r\n-                options: { responsive: true, maintainAspectRatio: false }\r\n-            });\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading access chart:\", err);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    // ================================\r\n-    // SIDEBAR PAGE LOADING\r\n-    // ================================\r\n-\r\n-    /**\r\n-     * Fetches and loads HTML content into the main content area.\r\n-     * @param {string} url The URL of the page to load.\r\n-     */\r\n+    // =========================================\r\n+    // Sidebar Page Loading\r\n+    // =========================================\r\n     async function loadPageIntoMainContent(url) {\r\n         try {\r\n             const res = await fetch(url);\r\n             if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-\r\n             const html = await res.text();\r\n             mainContentArea.innerHTML = html;\r\n \r\n-            // Trigger dashboard specific loads immediately after content is inserted\r\n+            // Trigger page-specific loaders\r\n             if (url.includes(\"dashboardoverview.html\")) {\r\n-                await loadDashboardSummary();\r\n-                await loadAccessChart();\r\n+                await loadAdminDashboard();\r\n             }\r\n+            if (url.includes(\"membership.html\")) await fetchMembershipRequests();\r\n+            if (url.includes(\"membershiprecords.html\")) await fetchMembershipRecords();\r\n+            if (url.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+            if (url.includes(\"payments.html\")) await loadPaymentRecords();\r\n         } catch (err) {\r\n             console.error(\"Error loading page:\", err);\r\n-            mainContentArea.innerHTML =\r\n-                `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+            mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n         }\r\n     }\r\n \r\n-    // Sidebar routing: Handles content loading and dynamic data fetching\r\n+    // Sidebar navigation\r\n     sidebarButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", async () => {\r\n-            // Update active state for sidebar buttons\r\n             sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n             btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n             const page = btn.dataset.target;\r\n             if (!page) return;\r\n-\r\n             await loadPageIntoMainContent(page);\r\n-\r\n-            // Trigger dynamic page data loads after content is inserted\r\n-            if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n-            if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n-            if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-            if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n         });\r\n     });\r\n \r\n-\r\n-    // ================================\r\n-    // EVENT LISTENERS & INITIALIZATION\r\n-    // ================================\r\n-\r\n-    // Logout Button\r\n+    // Logout button\r\n     document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n         localStorage.removeItem(\"accessToken\");\r\n         window.location.href = \"/login.html\";\r\n     });\r\n-    \r\n-    // Visitor Management Dropdown Toggle\r\n-    const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-    const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-    const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-    visitorToggle?.addEventListener(\"click\", () => {\r\n-        visitorSubMenu?.classList.toggle(\"hidden\");\r\n-        visitorArrow?.classList.toggle(\"rotate-90\");\r\n-    });\r\n-\r\n-\r\n-    // Initial Dashboard Load\r\n-    // This runs on page load. It defaults to loading the dashboard overview.\r\n+    // Initial dashboard load\r\n     const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n     if (dashboardBtn) {\r\n         dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n         await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n     } else if (document.getElementById(\"totalResidents\")) {\r\n-        // Fallback for when content is already on the page (less common in SPA-style)\r\n-        await loadDashboardSummary();\r\n-        await loadAccessChart();\r\n+        await loadAdminDashboard();\r\n     }\r\n+\r\n })();\r\n-// =========================================\r\n-// Debug Fetch Wrapper\r\n-// =========================================\r\n-async function debugFetch(name, url, options = {}) {\r\n-  console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n-  console.time(name);\r\n-\r\n-  try {\r\n-    const res = await fetch(url, options);\r\n-\r\n-    if (!res.ok) {\r\n-      console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n-      const text = await res.text();\r\n-      console.error(`Response text:`, text);\r\n-      console.timeEnd(name);\r\n-      return null;\r\n-    }\r\n-\r\n-    const data = await res.json();\r\n-    console.log(`✅ ${name} succeeded`, data);\r\n-    console.timeEnd(name);\r\n-    return data;\r\n-  } catch (err) {\r\n-    console.error(`❌ ${name} error:`, err);\r\n-    console.timeEnd(name);\r\n-    return null;\r\n-  }\r\n-}\r\n-\r\n-// =========================================\r\n-// Individual Fetch Functions\r\n-// =========================================\r\n-async function fetchDashboardSummary() {\r\n-  return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n-}\r\n-\r\n-async function fetchAccessChartData() {\r\n-  return await debugFetch(\"Access Chart Data\", \"/api/access/chart\");\r\n-}\r\n-\r\n-async function fetchMembershipRequests() {\r\n-  return await debugFetch(\"Membership Requests\", \"/api/memberships/requests\");\r\n-}\r\n-\r\n-async function fetchMembershipRecords() {\r\n-  return await debugFetch(\"Membership Records\", \"/api/memberships/records\");\r\n-}\r\n-\r\n-// =========================================\r\n-// Main Loader\r\n-// =========================================\r\n-async function loadAdminDashboard() {\r\n-  const [summary, chartData, requests, records] = await Promise.all([\r\n-    fetchDashboardSummary(),\r\n-    fetchAccessChartData(),\r\n-    fetchMembershipRequests(),\r\n-    fetchMembershipRecords(),\r\n-  ]);\r\n-\r\n-  // Example: populate your dashboard with data if available\r\n-  if (summary) populateDashboardSummary(summary);\r\n-  if (chartData) renderAccessChart(chartData);\r\n-  if (requests) renderMembershipRequests(requests);\r\n-  if (records) renderMembershipRecords(records);\r\n-}\r\n-\r\n-// Call on page load\r\n-loadAdminDashboard();\r\n"
                },
                {
                    "date": 1763673512690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,15 +5,14 @@\n (async function initializeDashboard() {\r\n     // =======================================================\r\n     // CONFIGURATION & INITIAL STATE\r\n     // =======================================================\r\n-    // Centralized API Host for all backend connections\r\n     const API_BASE = \"http://localhost:4050\"; \r\n     const token = localStorage.getItem(\"accessToken\");\r\n     \r\n     if (!token) {\r\n         window.location.href = \"/login.html\";\r\n-        return; // Stop execution if redirecting\r\n+        return; \r\n     }\r\n \r\n     const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n     const mainContentArea = document.getElementById(\"main-content-area\");\r\n@@ -52,24 +51,36 @@\n         }\r\n     }\r\n \r\n     // =========================================\r\n-    // Individual Fetch Functions\r\n+    // Individual Fetch Functions (Corrected URLs)\r\n     // =========================================\r\n     async function fetchDashboardSummary() {\r\n-        return await debugFetch(\"Dashboard Summary\", `${API_BASE}/api/dashboard/summary`);\r\n+        return await debugFetch(\r\n+            \"Dashboard Summary\",\r\n+            `${API_BASE}/api/residents/dashboard/summary`\r\n+        );\r\n     }\r\n \r\n     async function fetchAccessChartData() {\r\n-        return await debugFetch(\"Access Chart Data\", `${API_BASE}/api/access/chart`);\r\n+        return await debugFetch(\r\n+            \"Access Chart Data\",\r\n+            `${API_BASE}/api/residents/admin/accesschart`\r\n+        );\r\n     }\r\n \r\n     async function fetchMembershipRequests() {\r\n-        return await debugFetch(\"Membership Requests\", `${API_BASE}/api/memberships/requests`);\r\n+        return await debugFetch(\r\n+            \"Membership Requests\",\r\n+            `${API_BASE}/api/membershiprecords/all`\r\n+        );\r\n     }\r\n \r\n     async function fetchMembershipRecords() {\r\n-        return await debugFetch(\"Membership Records\", `${API_BASE}/api/memberships/records`);\r\n+        return await debugFetch(\r\n+            \"Membership Records\",\r\n+            `${API_BASE}/api/membershiprecords/all`\r\n+        );\r\n     }\r\n \r\n     // =========================================\r\n     // Main Loader\r\n@@ -88,12 +99,11 @@\n         if (records) renderMembershipRecords(records);\r\n     }\r\n \r\n     // =========================================\r\n-    // Other Page-Specific Loaders\r\n+    // Example Page Loaders (Payments / Visitors / Memberships)\r\n     // =========================================\r\n     async function loadPaymentRecords() { \r\n-        console.log('Fetching payment records...');\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n@@ -128,15 +138,13 @@\n             });\r\n             html += `</tbody></table>`;\r\n             container.innerHTML = html;\r\n         } catch (err) {\r\n-            console.error(\"Error loading payment records:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n     async function loadVisitorsList() { \r\n-        console.log('Fetching visitors list...');\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n@@ -157,9 +165,8 @@\n             });\r\n             html += \"</ul>\";\r\n             container.innerHTML = html;\r\n         } catch (err) {\r\n-            console.error(\"Error loading visitors list:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n@@ -172,35 +179,30 @@\n             if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n             const html = await res.text();\r\n             mainContentArea.innerHTML = html;\r\n \r\n-            // Trigger page-specific loaders\r\n             if (url.includes(\"dashboardoverview.html\")) {\r\n                 await loadAdminDashboard();\r\n             }\r\n             if (url.includes(\"membership.html\")) await fetchMembershipRequests();\r\n             if (url.includes(\"membershiprecords.html\")) await fetchMembershipRecords();\r\n             if (url.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n             if (url.includes(\"payments.html\")) await loadPaymentRecords();\r\n         } catch (err) {\r\n-            console.error(\"Error loading page:\", err);\r\n             mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n         }\r\n     }\r\n \r\n-    // Sidebar navigation\r\n     sidebarButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", async () => {\r\n             sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n             btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n             const page = btn.dataset.target;\r\n             if (!page) return;\r\n             await loadPageIntoMainContent(page);\r\n         });\r\n     });\r\n \r\n-    // Logout button\r\n     document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n         localStorage.removeItem(\"accessToken\");\r\n         window.location.href = \"/login.html\";\r\n     });\r\n"
                },
                {
                    "date": 1763673569834,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,219 +1,558 @@\n /**\r\n  * Admin Dashboard Client-Side JavaScript\r\n- * Uses Fetch API to communicate with a Node.js/Express Backend (API_BASE)\r\n+ * Uses Fetch API to communicate with a Node.js/Express Backend (API_HOST)\r\n  */\r\n (async function initializeDashboard() {\r\n     // =======================================================\r\n     // CONFIGURATION & INITIAL STATE\r\n     // =======================================================\r\n-    const API_BASE = \"http://localhost:4050\"; \r\n+    // 1. Centralized API Host for all backend connections\r\n+    const API_HOST = \"http://localhost:4050\"; \r\n+\r\n+    // 2. Auth State Check & Token Retrieval\r\n     const token = localStorage.getItem(\"accessToken\");\r\n     \r\n+    // Redirects to login if no access token is found\r\n     if (!token) {\r\n         window.location.href = \"/login.html\";\r\n-        return; \r\n+        return; // Stop execution if redirecting\r\n     }\r\n \r\n+    // DOM Elements\r\n     const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n     const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+\r\n     // ================================\r\n     // UTILITIES\r\n     // ================================\r\n+\r\n+    /**\r\n+     * Safely updates the text content of an element by ID.\r\n+     * @param {string} id Element ID.\r\n+     * @param {string|number} value New value.\r\n+     * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n+     */\r\n     const safeUpdate = (id, value, suffix = '') => {\r\n         const element = document.getElementById(id);\r\n-        if (element) element.textContent = value + suffix;\r\n+        if (element) {\r\n+            element.textContent = value + suffix;\r\n+        } else {\r\n+            // console.warn(`Element with ID '${id}' not found.`); \r\n+        }\r\n     };\r\n+    \r\n+    // ================================\r\n+    // DYNAMIC CONTENT LOADERS (API INTERACTION)\r\n+    // ================================\r\n \r\n-    // =========================================\r\n-    // Debug Fetch Wrapper\r\n-    // =========================================\r\n-    async function debugFetch(name, url, options = {}) {\r\n-        console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n-        console.time(name);\r\n-        try {\r\n-            const res = await fetch(url, { ...options, headers: { ...options.headers, \"Authorization\": `Bearer ${token}` } });\r\n-            if (!res.ok) {\r\n-                console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n-                const text = await res.text();\r\n-                console.error(`Response text:`, text);\r\n-                console.timeEnd(name);\r\n-                return null;\r\n-            }\r\n-            const data = await res.json();\r\n-            console.log(`✅ ${name} succeeded`, data);\r\n-            console.timeEnd(name);\r\n-            return data;\r\n-        } catch (err) {\r\n-            console.error(`❌ ${name} error:`, err);\r\n-            console.timeEnd(name);\r\n-            return null;\r\n-        }\r\n-    }\r\n-\r\n-    // =========================================\r\n-    // Individual Fetch Functions (Corrected URLs)\r\n-    // =========================================\r\n-    async function fetchDashboardSummary() {\r\n-        return await debugFetch(\r\n-            \"Dashboard Summary\",\r\n-            `${API_BASE}/api/residents/dashboard/summary`\r\n-        );\r\n-    }\r\n-\r\n-    async function fetchAccessChartData() {\r\n-        return await debugFetch(\r\n-            \"Access Chart Data\",\r\n-            `${API_BASE}/api/residents/admin/accesschart`\r\n-        );\r\n-    }\r\n-\r\n-    async function fetchMembershipRequests() {\r\n-        return await debugFetch(\r\n-            \"Membership Requests\",\r\n-            `${API_BASE}/api/membershiprecords/all`\r\n-        );\r\n-    }\r\n-\r\n-    async function fetchMembershipRecords() {\r\n-        return await debugFetch(\r\n-            \"Membership Records\",\r\n-            `${API_BASE}/api/membershiprecords/all`\r\n-        );\r\n-    }\r\n-\r\n-    // =========================================\r\n-    // Main Loader\r\n-    // =========================================\r\n-    async function loadAdminDashboard() {\r\n-        const [summary, chartData, requests, records] = await Promise.all([\r\n-            fetchDashboardSummary(),\r\n-            fetchAccessChartData(),\r\n-            fetchMembershipRequests(),\r\n-            fetchMembershipRecords(),\r\n-        ]);\r\n-\r\n-        if (summary) populateDashboardSummary(summary);\r\n-        if (chartData) renderAccessChart(chartData);\r\n-        if (requests) renderMembershipRequests(requests);\r\n-        if (records) renderMembershipRecords(records);\r\n-    }\r\n-\r\n-    // =========================================\r\n-    // Example Page Loaders (Payments / Visitors / Memberships)\r\n-    // =========================================\r\n+    /**\r\n+     * Loads and displays payment records from the API.\r\n+     */\r\n     async function loadPaymentRecords() { \r\n+        console.log('Fetching payment records...'); \r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n-\r\n+        \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n+        \r\n         try {\r\n-            const payments = await debugFetch(\"Payment Records\", `${API_BASE}/api/admin/payments`);\r\n-            if (!payments || payments.length === 0) {\r\n+            const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const payments = await res.json();\r\n+            \r\n+            if (payments.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n                 return;\r\n             }\r\n \r\n-            let html = `<table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                <thead class=\"bg-gray-200\">\r\n-                    <tr>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                    </tr>\r\n-                </thead>\r\n-                <tbody>`;\r\n+            // Basic HTML rendering for payments table\r\n+            let html = `\r\n+                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                    <thead class=\"bg-gray-200\">\r\n+                        <tr>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                        </tr>\r\n+                    </thead>\r\n+                    <tbody>\r\n+            `;\r\n \r\n             payments.forEach(p => {\r\n                 const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n                 const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n                 const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n-                html += `<tr class=\"border-b hover:bg-gray-50\">\r\n-                    <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n-                    <td class=\"py-2 px-4\">${date}</td>\r\n-                    <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n-                </tr>`;\r\n+\r\n+                html += `\r\n+                    <tr class=\"border-b hover:bg-gray-50\">\r\n+                        <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n+                        <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n+                        <td class=\"py-2 px-4\">${date}</td>\r\n+                        <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n+                    </tr>`;\r\n             });\r\n+\r\n             html += `</tbody></table>`;\r\n             container.innerHTML = html;\r\n+\r\n         } catch (err) {\r\n+            console.error(\"Error loading payment records:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n+    /**\r\n+     * Loads and displays visitors list data from the API.\r\n+     */\r\n     async function loadVisitorsList() { \r\n+        console.log('Fetching visitors list...'); \r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n+\r\n         try {\r\n-            const visitors = await debugFetch(\"Visitors List\", `${API_BASE}/api/admin/visitors`);\r\n-            if (!visitors || visitors.length === 0) {\r\n+            const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const data = await res.json();\r\n+            \r\n+            if (data.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n                 return;\r\n             }\r\n \r\n+            // Example rendering for visitors (adjust fields based on actual API data)\r\n             let html = `<ul class=\"space-y-3 p-4\">`;\r\n-            visitors.forEach(v => {\r\n-                html += `<li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n-                    <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n-                    <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n-                    <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n-                </li>`;\r\n+            data.forEach(v => {\r\n+                html += `\r\n+                    <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n+                        <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n+                        <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n+                        <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n+                    </li>`;\r\n             });\r\n             html += \"</ul>\";\r\n             container.innerHTML = html;\r\n+\r\n         } catch (err) {\r\n+            console.error(\"Error loading visitors list:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n-    // =========================================\r\n-    // Sidebar Page Loading\r\n-    // =========================================\r\n+\r\n+    /**\r\n+     * Loads and displays membership records (approved members) from the API.\r\n+     */\r\n+    async function loadMembershipRecords() {\r\n+        console.log('Fetching membership records...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n+\r\n+        try {\r\n+            // FIX 1: Standardize API Endpoint path\r\n+            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n+            const responseData = await res.json();\r\n+            // FIX 2: Access the 'records' property, which the backend controller returns\r\n+            const members = responseData.records || []; \r\n+            \r\n+            // Filter for only approved members for the records section\r\n+            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+\r\n+            if (approvedMembers.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n+                return;\r\n+            }\r\n+\r\n+            let html = `<ul class=\"space-y-3 p-4\">`;\r\n+\r\n+            approvedMembers.forEach(m => {\r\n+                html += `\r\n+                    <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n+                        <div>\r\n+                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n+                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n+                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n+                        </div>\r\n+                        <div class=\"text-right\">\r\n+                           <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n+                                Active\r\n+                           </span>\r\n+                        </div>\r\n+                    </li>`;\r\n+            });\r\n+\r\n+            html += \"</ul>\";\r\n+            container.innerHTML = html;\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading membership records:\", err);\r\n+            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * Loads and displays pending membership requests and handles approvals.\r\n+     */\r\n+    async function loadMembershipRequests() {\r\n+        console.log('Fetching membership requests...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n+\r\n+        try {\r\n+            // FIX 1: Standardize API Endpoint path\r\n+            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const responseData = await res.json();\r\n+            // FIX 2: Access the 'records' property, which the backend controller returns\r\n+            const allRecords = responseData.records || [];\r\n+            \r\n+            // Filter for pending requests to show in this view\r\n+            const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n+            \r\n+            if (pendingRequests.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n+                return;\r\n+            }\r\n+\r\n+            let html = `\r\n+                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                    <thead class=\"bg-gray-200\">\r\n+                        <tr>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n+                        </tr>\r\n+                    </thead>\r\n+                    <tbody>\r\n+            `;\r\n+\r\n+            pendingRequests.forEach(r => {\r\n+                html += `\r\n+                    <tr class=\"border-b hover:bg-yellow-50\">\r\n+                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n+                        <td class=\"py-2 px-4\">${r.HouseNumber} - ${r.CourtName}</td>\r\n+                        <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n+                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n+                        <td class=\"py-2 px-4 action-cell\">\r\n+                            <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n+                        </td>\r\n+                    </tr>`;\r\n+            });\r\n+\r\n+            html += `</tbody></table>`;\r\n+            container.innerHTML = html;\r\n+\r\n+            // Approve buttons event listeners (Binding Logic)\r\n+            document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n+                btn.addEventListener(\"click\", handleApproveClick);\r\n+            });\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading membership requests:\", err);\r\n+            const container = document.getElementById(\"dynamic-section-content\");\r\n+            if (container) {\r\n+                 container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    /**\r\n+     * Handles the click event for approving a membership request.\r\n+     * @param {Event} event \r\n+     */\r\n+    async function handleApproveClick(event) {\r\n+        const btn = event.currentTarget;\r\n+        const requestId = btn.dataset.id;\r\n+        const originalText = btn.textContent;\r\n+        \r\n+        btn.disabled = true;\r\n+        btn.textContent = 'Processing...';\r\n+\r\n+        try {\r\n+            // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n+            const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n+                method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n+                headers: {\r\n+                    \"Content-Type\": \"application/json\",\r\n+                    \"Authorization\": `Bearer ${token}`\r\n+                },\r\n+                // Removed body: JSON.stringify({ requestId }) as ID is now in the URL\r\n+            });\r\n+\r\n+            if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n+\r\n+            // Success handling: update the UI\r\n+            const actionCell = btn.parentElement;\r\n+            const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n+            \r\n+            if (statusCell) {\r\n+                statusCell.textContent = 'Approved';\r\n+                statusCell.classList.add('font-bold', 'text-green-600');\r\n+            }\r\n+            actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n+            \r\n+        } catch (err) {\r\n+            console.error(\"Error approving request:\", err.message);\r\n+            \r\n+            // Failure handling: revert button and show error visually\r\n+            btn.disabled = false;\r\n+            btn.textContent = 'Failed!';\r\n+            btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n+            btn.classList.add('bg-red-500', 'animate-pulse');\r\n+\r\n+            // Reset after a short period\r\n+            setTimeout(() => {\r\n+                btn.textContent = originalText;\r\n+                btn.classList.remove('bg-red-500', 'animate-pulse');\r\n+                btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n+            }, 2000);\r\n+            \r\n+        }\r\n+    }\r\n+\r\n+    /**\r\n+     * Loads dashboard summary metrics.\r\n+     */\r\n+    async function loadDashboardSummary() {\r\n+        console.log('Fetching dashboard summary...');\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n+            const data = await res.json();\r\n+\r\n+            safeUpdate(\"totalResidents\", data.residents || 0);\r\n+            safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+            safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+            safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading dashboard summary:\", err);\r\n+        }\r\n+    }\r\n+\r\n+    /**\r\n+     * Loads data and renders the Access Chart using Chart.js.\r\n+     */\r\n+    async function loadAccessChart() {\r\n+        console.log('Fetching access chart data...');\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n+            const data = await res.json();\r\n+\r\n+            const canvas = document.getElementById(\"accessChart\");\r\n+            if (!canvas) return;\r\n+\r\n+            // Check if Chart.js is available globally (must be included in HTML)\r\n+            if (typeof Chart === 'undefined') {\r\n+                console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n+                return;\r\n+            }\r\n+\r\n+            const ctx = canvas.getContext(\"2d\");\r\n+\r\n+            new Chart(ctx, {\r\n+                type: \"line\",\r\n+                data: {\r\n+                    labels: data.days || [],\r\n+                    datasets: [{\r\n+                        label: \"Access Attempts\",\r\n+                        data: data.counts || [],\r\n+                        borderWidth: 2,\r\n+                        tension: 0.4,\r\n+                        borderColor: \"#2563eb\",\r\n+                        backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n+                        fill: true\r\n+                    }]\r\n+                },\r\n+                options: { responsive: true, maintainAspectRatio: false }\r\n+            });\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading access chart:\", err);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    // ================================\r\n+    // SIDEBAR PAGE LOADING\r\n+    // ================================\r\n+\r\n+    /**\r\n+     * Fetches and loads HTML content into the main content area.\r\n+     * @param {string} url The URL of the page to load.\r\n+     */\r\n     async function loadPageIntoMainContent(url) {\r\n         try {\r\n             const res = await fetch(url);\r\n             if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+\r\n             const html = await res.text();\r\n             mainContentArea.innerHTML = html;\r\n \r\n+            // Trigger dashboard specific loads immediately after content is inserted\r\n             if (url.includes(\"dashboardoverview.html\")) {\r\n-                await loadAdminDashboard();\r\n+                await loadDashboardSummary();\r\n+                await loadAccessChart();\r\n             }\r\n-            if (url.includes(\"membership.html\")) await fetchMembershipRequests();\r\n-            if (url.includes(\"membershiprecords.html\")) await fetchMembershipRecords();\r\n-            if (url.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-            if (url.includes(\"payments.html\")) await loadPaymentRecords();\r\n         } catch (err) {\r\n-            mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+            console.error(\"Error loading page:\", err);\r\n+            mainContentArea.innerHTML =\r\n+                `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n         }\r\n     }\r\n \r\n+    // Sidebar routing: Handles content loading and dynamic data fetching\r\n     sidebarButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", async () => {\r\n+            // Update active state for sidebar buttons\r\n             sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n             btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n             const page = btn.dataset.target;\r\n             if (!page) return;\r\n+\r\n             await loadPageIntoMainContent(page);\r\n+\r\n+            // Trigger dynamic page data loads after content is inserted\r\n+            if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n+            if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n+            if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+            if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n         });\r\n     });\r\n \r\n+\r\n+    // ================================\r\n+    // EVENT LISTENERS & INITIALIZATION\r\n+    // ================================\r\n+\r\n+    // Logout Button\r\n     document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n         localStorage.removeItem(\"accessToken\");\r\n         window.location.href = \"/login.html\";\r\n     });\r\n+    \r\n+    // Visitor Management Dropdown Toggle\r\n+    const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+    const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+    const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-    // Initial dashboard load\r\n+    visitorToggle?.addEventListener(\"click\", () => {\r\n+        visitorSubMenu?.classList.toggle(\"hidden\");\r\n+        visitorArrow?.classList.toggle(\"rotate-90\");\r\n+    });\r\n+\r\n+\r\n+    // Initial Dashboard Load\r\n+    // This runs on page load. It defaults to loading the dashboard overview.\r\n     const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n     if (dashboardBtn) {\r\n         dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n         await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n     } else if (document.getElementById(\"totalResidents\")) {\r\n-        await loadAdminDashboard();\r\n+        // Fallback for when content is already on the page (less common in SPA-style)\r\n+        await loadDashboardSummary();\r\n+        await loadAccessChart();\r\n     }\r\n+})();\r\n+// =========================================\r\n+// Debug Fetch Wrapper\r\n+// =========================================\r\n+async function debugFetch(name, url, options = {}) {\r\n+  console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n+  console.time(name);\r\n \r\n-})();\r\n+  try {\r\n+    const res = await fetch(url, options);\r\n+\r\n+    if (!res.ok) {\r\n+      console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n+      const text = await res.text();\r\n+      console.error(`Response text:`, text);\r\n+      console.timeEnd(name);\r\n+      return null;\r\n+    }\r\n+\r\n+    const data = await res.json();\r\n+    console.log(`✅ ${name} succeeded`, data);\r\n+    console.timeEnd(name);\r\n+    return data;\r\n+  } catch (err) {\r\n+    console.error(`❌ ${name} error:`, err);\r\n+    console.timeEnd(name);\r\n+    return null;\r\n+  }\r\n+}\r\n+\r\n+// =========================================\r\n+// Individual Fetch Functions\r\n+// =========================================\r\n+async function fetchDashboardSummary() {\r\n+  return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n+}\r\n+\r\n+async function fetchAccessChartData() {\r\n+  return await debugFetch(\"Access Chart Data\", \"/api/access/chart\");\r\n+}\r\n+\r\n+async function fetchMembershipRequests() {\r\n+  return await debugFetch(\"Membership Requests\", \"/api/memberships/requests\");\r\n+}\r\n+\r\n+async function fetchMembershipRecords() {\r\n+  return await debugFetch(\"Membership Records\", \"/api/memberships/records\");\r\n+}\r\n+\r\n+// =========================================\r\n+// Main Loader\r\n+// =========================================\r\n+async function loadAdminDashboard() {\r\n+  const [summary, chartData, requests, records] = await Promise.all([\r\n+    fetchDashboardSummary(),\r\n+    fetchAccessChartData(),\r\n+    fetchMembershipRequests(),\r\n+    fetchMembershipRecords(),\r\n+  ]);\r\n+\r\n+  // Example: populate your dashboard with data if available\r\n+  if (summary) populateDashboardSummary(summary);\r\n+  if (chartData) renderAccessChart(chartData);\r\n+  if (requests) renderMembershipRequests(requests);\r\n+  if (records) renderMembershipRecords(records);\r\n+}\r\n+\r\n+// Call on page load\r\n+loadAdminDashboard();\r\n"
                },
                {
                    "date": 1763674684960,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,9 @@\n     // =======================================================\r\n     // CONFIGURATION & INITIAL STATE\r\n     // =======================================================\r\n     // 1. Centralized API Host for all backend connections\r\n+    // NOTE: This port must match the one your Node.js server is running on (4050 in this case)\r\n     const API_HOST = \"http://localhost:4050\"; \r\n \r\n     // 2. Auth State Check & Token Retrieval\r\n     const token = localStorage.getItem(\"accessToken\");\r\n@@ -56,8 +57,9 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n         \r\n         try {\r\n+            // NOTE: Assuming this route is defined elsewhere, but keeping client URL for consistency\r\n             const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n@@ -116,9 +118,11 @@\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n \r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n+            // FIX: Match the server's /api/residents/visitorsaccess route (or create a dedicated admin one)\r\n+            // Using the existing residents route as a placeholder since it returns visitor data\r\n+            const res = await fetch(`${API_HOST}/api/residents/visitorsaccess`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n             \r\n@@ -159,21 +163,19 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n \r\n         try {\r\n-            // FIX 1: Standardize API Endpoint path\r\n-            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n+            // ✅ FIX: Use the corrected Server route: /api/memberships/records\r\n+            const res = await fetch(`${API_HOST}/api/memberships/records`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n \r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-            const responseData = await res.json();\r\n-            // FIX 2: Access the 'records' property, which the backend controller returns\r\n-            const members = responseData.records || []; \r\n+            // Assuming the server's getApprovedResidents returns an array of records\r\n+            const approvedMembers = await res.json(); \r\n             \r\n-            // Filter for only approved members for the records section\r\n-            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+            // NOTE: No need to filter for \"Approved\" status if the server's /records route only returns approved ones.\r\n \r\n             if (approvedMembers.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n                 return;\r\n@@ -184,11 +186,11 @@\n             approvedMembers.forEach(m => {\r\n                 html += `\r\n                     <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n                         <div>\r\n-                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n-                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n-                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n+                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName || m.FullName}</p>\r\n+                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber || 'N/A'} - ${m.CourtName || 'N/A'}</span></p>\r\n+                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID || 'N/A'}</p>\r\n                         </div>\r\n                         <div class=\"text-right\">\r\n                            <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n                                 Active\r\n@@ -217,17 +219,16 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n \r\n         try {\r\n-            // FIX 1: Standardize API Endpoint path\r\n-            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n+            // ✅ FIX: Use the corrected Server route: /api/memberships/requests\r\n+            const res = await fetch(`${API_HOST}/api/memberships/requests`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n             \r\n-            const responseData = await res.json();\r\n-            // FIX 2: Access the 'records' property, which the backend controller returns\r\n-            const allRecords = responseData.records || [];\r\n+            // Assuming the server's getMembershipRequests returns an array of records\r\n+            const allRecords = await res.json();\r\n             \r\n             // Filter for pending requests to show in this view\r\n             const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n             \r\n@@ -252,10 +253,10 @@\n \r\n             pendingRequests.forEach(r => {\r\n                 html += `\r\n                     <tr class=\"border-b hover:bg-yellow-50\">\r\n-                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.HouseNumber} - ${r.CourtName}</td>\r\n+                        <td class=\"py-2 px-4\">${r.ResidentName || r.FullName}</td>\r\n+                        <td class=\"py-2 px-4\">${r.HouseNumber || 'N/A'} - ${r.CourtName || 'N/A'}</td>\r\n                         <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n                         <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n                         <td class=\"py-2 px-4 action-cell\">\r\n                             <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n@@ -293,8 +294,9 @@\n         btn.textContent = 'Processing...';\r\n \r\n         try {\r\n             // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n+            // Keeping the client URL as is, assuming /api/membershiprecords/approve/:id is a known route.\r\n             const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n                 method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n                 headers: {\r\n                     \"Content-Type\": \"application/json\",\r\n@@ -339,23 +341,27 @@\n      */\r\n     async function loadDashboardSummary() {\r\n         console.log('Fetching dashboard summary...');\r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n+            // ✅ FIX: Use the corrected Server route: /api/dashboard/summary\r\n+            const res = await fetch(`${API_HOST}/api/dashboard/summary`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n \r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n             const data = await res.json();\r\n \r\n-            safeUpdate(\"totalResidents\", data.residents || 0);\r\n-            safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-            safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-            safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+            // The data keys should now match your server query aliases:\r\n+            // ApprovedResidents, PendingRequests, WeeklyVisitors\r\n+            safeUpdate(\"totalResidents\", data.ApprovedResidents || 0);\r\n+            safeUpdate(\"pendingRequests\", data.PendingRequests || 0); // Changed key from pendingPayments\r\n+            safeUpdate(\"weeklyVisitors\", data.WeeklyVisitors || 0); // New key for the weekly count\r\n+            // NOTE: You will need to check your HTML IDs for the summary cards and match them here (e.g., 'totalResidents', 'pendingRequests', 'weeklyVisitors').\r\n \r\n         } catch (err) {\r\n             console.error(\"Error loading dashboard summary:\", err);\r\n+            // safeUpdate(\"totalResidents\", '---'); // Optional: Clear UI on error\r\n         }\r\n     }\r\n \r\n     /**\r\n@@ -363,15 +369,16 @@\n      */\r\n     async function loadAccessChart() {\r\n         console.log('Fetching access chart data...');\r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n+            // ✅ FIX: Use the corrected Server route: /api/access/chart\r\n+            const res = await fetch(`${API_HOST}/api/access/chart`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n \r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-            const data = await res.json();\r\n+            const rawData = await res.json();\r\n \r\n             const canvas = document.getElementById(\"accessChart\");\r\n             if (!canvas) return;\r\n \r\n@@ -382,15 +389,19 @@\n             }\r\n \r\n             const ctx = canvas.getContext(\"2d\");\r\n \r\n+            // Map data from server query (Date, TotalPasses) to Chart.js format (labels, data)\r\n+            const chartLabels = rawData.map(item => new Date(item.Date).toLocaleDateString());\r\n+            const chartCounts = rawData.map(item => item.TotalPasses);\r\n+\r\n             new Chart(ctx, {\r\n                 type: \"line\",\r\n                 data: {\r\n-                    labels: data.days || [],\r\n+                    labels: chartLabels || [],\r\n                     datasets: [{\r\n                         label: \"Access Attempts\",\r\n-                        data: data.counts || [],\r\n+                        data: chartCounts || [],\r\n                         borderWidth: 2,\r\n                         tension: 0.4,\r\n                         borderColor: \"#2563eb\",\r\n                         backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n@@ -487,72 +498,26 @@\n         await loadDashboardSummary();\r\n         await loadAccessChart();\r\n     }\r\n })();\r\n+\r\n // =========================================\r\n-// Debug Fetch Wrapper\r\n+// Debug Fetch Wrapper (Removed unneeded base URL usage)\r\n // =========================================\r\n-async function debugFetch(name, url, options = {}) {\r\n-  console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n-  console.time(name);\r\n-\r\n-  try {\r\n-    const res = await fetch(url, options);\r\n-\r\n-    if (!res.ok) {\r\n-      console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n-      const text = await res.text();\r\n-      console.error(`Response text:`, text);\r\n-      console.timeEnd(name);\r\n-      return null;\r\n-    }\r\n-\r\n-    const data = await res.json();\r\n-    console.log(`✅ ${name} succeeded`, data);\r\n-    console.timeEnd(name);\r\n-    return data;\r\n-  } catch (err) {\r\n-    console.error(`❌ ${name} error:`, err);\r\n-    console.timeEnd(name);\r\n-    return null;\r\n-  }\r\n+// This block of code is not being used by the main initializer function above, \r\n+// so you can safely remove it if it's confusing, or keep it for future use.\r\n+// If you keep it, ensure you define API_HOST in this scope or pass it.\r\n+// I recommend removing it as the logic is duplicated in the main IIFE above.\r\n+// =========================================\r\n+/* async function debugFetch(name, url, options = {}) {\r\n+  // ... debug logic ...\r\n }\r\n \r\n-// =========================================\r\n-// Individual Fetch Functions\r\n-// =========================================\r\n async function fetchDashboardSummary() {\r\n   return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n }\r\n-\r\n-async function fetchAccessChartData() {\r\n-  return await debugFetch(\"Access Chart Data\", \"/api/access/chart\");\r\n-}\r\n-\r\n-async function fetchMembershipRequests() {\r\n-  return await debugFetch(\"Membership Requests\", \"/api/memberships/requests\");\r\n-}\r\n-\r\n-async function fetchMembershipRecords() {\r\n-  return await debugFetch(\"Membership Records\", \"/api/memberships/records\");\r\n-}\r\n-\r\n-// =========================================\r\n-// Main Loader\r\n-// =========================================\r\n+// ... other fetch functions ...\r\n async function loadAdminDashboard() {\r\n-  const [summary, chartData, requests, records] = await Promise.all([\r\n-    fetchDashboardSummary(),\r\n-    fetchAccessChartData(),\r\n-    fetchMembershipRequests(),\r\n-    fetchMembershipRecords(),\r\n-  ]);\r\n-\r\n-  // Example: populate your dashboard with data if available\r\n-  if (summary) populateDashboardSummary(summary);\r\n-  if (chartData) renderAccessChart(chartData);\r\n-  if (requests) renderMembershipRequests(requests);\r\n-  if (records) renderMembershipRecords(records);\r\n+  // ... logic\r\n }\r\n-\r\n-// Call on page load\r\n-loadAdminDashboard();\r\n+// loadAdminDashboard(); // This will execute on page load and conflict with the main IIFE\r\n+*/\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763694416772,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,523 +1,147 @@\n-/**\r\n- * Admin Dashboard Client-Side JavaScript\r\n- * Uses Fetch API to communicate with a Node.js/Express Backend (API_HOST)\r\n- */\r\n-(async function initializeDashboard() {\r\n-    // =======================================================\r\n-    // CONFIGURATION & INITIAL STATE\r\n-    // =======================================================\r\n-    // 1. Centralized API Host for all backend connections\r\n-    // NOTE: This port must match the one your Node.js server is running on (4050 in this case)\r\n-    const API_HOST = \"http://localhost:4050\"; \r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+// ================================\r\n+const token = localStorage.getItem(\"accessToken\");\r\n+if (!token) window.location.href = \"/login.html\";\r\n \r\n-    // 2. Auth State Check & Token Retrieval\r\n-    const token = localStorage.getItem(\"accessToken\");\r\n-    \r\n-    // Redirects to login if no access token is found\r\n-    if (!token) {\r\n-        window.location.href = \"/login.html\";\r\n-        return; // Stop execution if redirecting\r\n-    }\r\n+document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n+});\r\n \r\n-    // DOM Elements\r\n-    const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-    const mainContentArea = document.getElementById(\"main-content-area\");\r\n+// ================================\r\n+// SIDEBAR PAGE LOADING\r\n+// ================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+async function loadPageIntoMainContent(url) {\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html;\r\n \r\n-    // ================================\r\n-    // UTILITIES\r\n-    // ================================\r\n-\r\n-    /**\r\n-     * Safely updates the text content of an element by ID.\r\n-     * @param {string} id Element ID.\r\n-     * @param {string|number} value New value.\r\n-     * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n-     */\r\n-    const safeUpdate = (id, value, suffix = '') => {\r\n-        const element = document.getElementById(id);\r\n-        if (element) {\r\n-            element.textContent = value + suffix;\r\n-        } else {\r\n-            // console.warn(`Element with ID '${id}' not found.`); \r\n+        // For subsequent (non-initial) dashboard loads (via button click), \r\n+        // we call the functions directly after innerHTML.\r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            // NOTE: We don't need setTimeout here for subsequent clicks, \r\n+            // as the initial load issue is bypassed.\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n         }\r\n-    };\r\n-    \r\n-    // ================================\r\n-    // DYNAMIC CONTENT LOADERS (API INTERACTION)\r\n-    // ================================\r\n-\r\n-    /**\r\n-     * Loads and displays payment records from the API.\r\n-     */\r\n-    async function loadPaymentRecords() { \r\n-        console.log('Fetching payment records...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n-        \r\n-        try {\r\n-            // NOTE: Assuming this route is defined elsewhere, but keeping client URL for consistency\r\n-            const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const payments = await res.json();\r\n-            \r\n-            if (payments.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            // Basic HTML rendering for payments table\r\n-            let html = `\r\n-                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                    <thead class=\"bg-gray-200\">\r\n-                        <tr>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                        </tr>\r\n-                    </thead>\r\n-                    <tbody>\r\n-            `;\r\n-\r\n-            payments.forEach(p => {\r\n-                const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n-                const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n-                const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n-\r\n-                html += `\r\n-                    <tr class=\"border-b hover:bg-gray-50\">\r\n-                        <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n-                        <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n-                        <td class=\"py-2 px-4\">${date}</td>\r\n-                        <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n-                    </tr>`;\r\n-            });\r\n-\r\n-            html += `</tbody></table>`;\r\n-            container.innerHTML = html;\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading payment records:\", err);\r\n-            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n-        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n     }\r\n+}\r\n \r\n-    /**\r\n-     * Loads and displays visitors list data from the API.\r\n-     */\r\n-    async function loadVisitorsList() { \r\n-        console.log('Fetching visitors list...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n \r\n-        try {\r\n-            // FIX: Match the server's /api/residents/visitorsaccess route (or create a dedicated admin one)\r\n-            // Using the existing residents route as a placeholder since it returns visitor data\r\n-            const res = await fetch(`${API_HOST}/api/residents/visitorsaccess`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const data = await res.json();\r\n-            \r\n-            if (data.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n-                return;\r\n-            }\r\n+// *** REMOVED: loadPageIntoMainContent(\"sections/dashboardoverview.html\"); ***\r\n+// The initial page load is handled by the index.html content itself.\r\n \r\n-            // Example rendering for visitors (adjust fields based on actual API data)\r\n-            let html = `<ul class=\"space-y-3 p-4\">`;\r\n-            data.forEach(v => {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n-                        <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n-                        <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n-                        <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n-                    </li>`;\r\n-            });\r\n-            html += \"</ul>\";\r\n-            container.innerHTML = html;\r\n+// ================================\r\n+// VISITOR MANAGEMENT TOGGLE\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-        } catch (err) {\r\n-            console.error(\"Error loading visitors list:\", err);\r\n-            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n-        }\r\n-    }\r\n+visitorToggle.addEventListener(\"click\", () => {\r\n+    visitorSubMenu.classList.toggle(\"hidden\");\r\n+    visitorArrow.classList.toggle(\"rotate-90\");\r\n+});\r\n \r\n-\r\n-    /**\r\n-     * Loads and displays membership records (approved members) from the API.\r\n-     */\r\n-    async function loadMembershipRecords() {\r\n-        console.log('Fetching membership records...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n-\r\n-        try {\r\n-            // ✅ FIX: Use the corrected Server route: /api/memberships/records\r\n-            const res = await fetch(`${API_HOST}/api/memberships/records`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            // Assuming the server's getApprovedResidents returns an array of records\r\n-            const approvedMembers = await res.json(); \r\n-            \r\n-            // NOTE: No need to filter for \"Approved\" status if the server's /records route only returns approved ones.\r\n-\r\n-            if (approvedMembers.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            let html = `<ul class=\"space-y-3 p-4\">`;\r\n-\r\n-            approvedMembers.forEach(m => {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n-                        <div>\r\n-                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName || m.FullName}</p>\r\n-                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber || 'N/A'} - ${m.CourtName || 'N/A'}</span></p>\r\n-                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID || 'N/A'}</p>\r\n-                        </div>\r\n-                        <div class=\"text-right\">\r\n-                           <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n-                                Active\r\n-                           </span>\r\n-                        </div>\r\n-                    </li>`;\r\n-            });\r\n-\r\n-            html += \"</ul>\";\r\n-            container.innerHTML = html;\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading membership records:\", err);\r\n-            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n-        }\r\n+// ================================\r\n+// SAFE UPDATE HELPER\r\n+// ================================\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    } else {\r\n+        // This warning should now only appear if an ID is misspelled \r\n+        // or a sidebar page is missing the element.\r\n+        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n     }\r\n+};\r\n \r\n+// ================================\r\n+// DASHBOARD SUMMARY\r\n+// ================================\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-    /**\r\n-     * Loads and displays pending membership requests and handles approvals.\r\n-     */\r\n-    async function loadMembershipRequests() {\r\n-        console.log('Fetching membership requests...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n-        try {\r\n-            // ✅ FIX: Use the corrected Server route: /api/memberships/requests\r\n-            const res = await fetch(`${API_HOST}/api/memberships/requests`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            // Assuming the server's getMembershipRequests returns an array of records\r\n-            const allRecords = await res.json();\r\n-            \r\n-            // Filter for pending requests to show in this view\r\n-            const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n-            \r\n-            if (pendingRequests.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            let html = `\r\n-                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                    <thead class=\"bg-gray-200\">\r\n-                        <tr>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n-                        </tr>\r\n-                    </thead>\r\n-                    <tbody>\r\n-            `;\r\n-\r\n-            pendingRequests.forEach(r => {\r\n-                html += `\r\n-                    <tr class=\"border-b hover:bg-yellow-50\">\r\n-                        <td class=\"py-2 px-4\">${r.ResidentName || r.FullName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.HouseNumber || 'N/A'} - ${r.CourtName || 'N/A'}</td>\r\n-                        <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n-                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                        <td class=\"py-2 px-4 action-cell\">\r\n-                            <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n-                        </td>\r\n-                    </tr>`;\r\n-            });\r\n-\r\n-            html += `</tbody></table>`;\r\n-            container.innerHTML = html;\r\n-\r\n-            // Approve buttons event listeners (Binding Logic)\r\n-            document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n-                btn.addEventListener(\"click\", handleApproveClick);\r\n-            });\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading membership requests:\", err);\r\n-            const container = document.getElementById(\"dynamic-section-content\");\r\n-            if (container) {\r\n-                 container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n-            }\r\n-        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n     }\r\n+}\r\n \r\n-    /**\r\n-     * Handles the click event for approving a membership request.\r\n-     * @param {Event} event \r\n-     */\r\n-    async function handleApproveClick(event) {\r\n-        const btn = event.currentTarget;\r\n-        const requestId = btn.dataset.id;\r\n-        const originalText = btn.textContent;\r\n-        \r\n-        btn.disabled = true;\r\n-        btn.textContent = 'Processing...';\r\n+// ================================\r\n+// ACCESS CHART\r\n+// ================================\r\n+async function loadAccessChart() {\r\n+    try {\r\n+        const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-        try {\r\n-            // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n-            // Keeping the client URL as is, assuming /api/membershiprecords/approve/:id is a known route.\r\n-            const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n-                method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n-                headers: {\r\n-                    \"Content-Type\": \"application/json\",\r\n-                    \"Authorization\": `Bearer ${token}`\r\n-                },\r\n-                // Removed body: JSON.stringify({ requestId }) as ID is now in the URL\r\n-            });\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n \r\n-            if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n-\r\n-            // Success handling: update the UI\r\n-            const actionCell = btn.parentElement;\r\n-            const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n-            \r\n-            if (statusCell) {\r\n-                statusCell.textContent = 'Approved';\r\n-                statusCell.classList.add('font-bold', 'text-green-600');\r\n-            }\r\n-            actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n-            \r\n-        } catch (err) {\r\n-            console.error(\"Error approving request:\", err.message);\r\n-            \r\n-            // Failure handling: revert button and show error visually\r\n-            btn.disabled = false;\r\n-            btn.textContent = 'Failed!';\r\n-            btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n-            btn.classList.add('bg-red-500', 'animate-pulse');\r\n-\r\n-            // Reset after a short period\r\n-            setTimeout(() => {\r\n-                btn.textContent = originalText;\r\n-                btn.classList.remove('bg-red-500', 'animate-pulse');\r\n-                btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n-            }, 2000);\r\n-            \r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Loads dashboard summary metrics.\r\n-     */\r\n-    async function loadDashboardSummary() {\r\n-        console.log('Fetching dashboard summary...');\r\n-        try {\r\n-            // ✅ FIX: Use the corrected Server route: /api/dashboard/summary\r\n-            const res = await fetch(`${API_HOST}/api/dashboard/summary`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const data = await res.json();\r\n-\r\n-            // The data keys should now match your server query aliases:\r\n-            // ApprovedResidents, PendingRequests, WeeklyVisitors\r\n-            safeUpdate(\"totalResidents\", data.ApprovedResidents || 0);\r\n-            safeUpdate(\"pendingRequests\", data.PendingRequests || 0); // Changed key from pendingPayments\r\n-            safeUpdate(\"weeklyVisitors\", data.WeeklyVisitors || 0); // New key for the weekly count\r\n-            // NOTE: You will need to check your HTML IDs for the summary cards and match them here (e.g., 'totalResidents', 'pendingRequests', 'weeklyVisitors').\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading dashboard summary:\", err);\r\n-            // safeUpdate(\"totalResidents\", '---'); // Optional: Clear UI on error\r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Loads data and renders the Access Chart using Chart.js.\r\n-     */\r\n-    async function loadAccessChart() {\r\n-        console.log('Fetching access chart data...');\r\n-        try {\r\n-            // ✅ FIX: Use the corrected Server route: /api/access/chart\r\n-            const res = await fetch(`${API_HOST}/api/access/chart`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const rawData = await res.json();\r\n-\r\n-            const canvas = document.getElementById(\"accessChart\");\r\n-            if (!canvas) return;\r\n-\r\n-            // Check if Chart.js is available globally (must be included in HTML)\r\n-            if (typeof Chart === 'undefined') {\r\n-                console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n-                return;\r\n-            }\r\n-\r\n-            const ctx = canvas.getContext(\"2d\");\r\n-\r\n-            // Map data from server query (Date, TotalPasses) to Chart.js format (labels, data)\r\n-            const chartLabels = rawData.map(item => new Date(item.Date).toLocaleDateString());\r\n-            const chartCounts = rawData.map(item => item.TotalPasses);\r\n-\r\n-            new Chart(ctx, {\r\n-                type: \"line\",\r\n-                data: {\r\n-                    labels: chartLabels || [],\r\n-                    datasets: [{\r\n-                        label: \"Access Attempts\",\r\n-                        data: chartCounts || [],\r\n-                        borderWidth: 2,\r\n-                        tension: 0.4,\r\n-                        borderColor: \"#2563eb\",\r\n-                        backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n-                        fill: true\r\n-                    }]\r\n-                },\r\n-                options: { responsive: true, maintainAspectRatio: false }\r\n-            });\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading access chart:\", err);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    // ================================\r\n-    // SIDEBAR PAGE LOADING\r\n-    // ================================\r\n-\r\n-    /**\r\n-     * Fetches and loads HTML content into the main content area.\r\n-     * @param {string} url The URL of the page to load.\r\n-     */\r\n-    async function loadPageIntoMainContent(url) {\r\n-        try {\r\n-            const res = await fetch(url);\r\n-            if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n\\ No newline at end of file\n-\r\n-            const html = await res.text();\r\n-            mainContentArea.innerHTML = html;\r\n-\r\n-            // Trigger dashboard specific loads immediately after content is inserted\r\n-            if (url.includes(\"dashboardoverview.html\")) {\r\n-                await loadDashboardSummary();\r\n-                await loadAccessChart();\r\n-            }\r\n-        } catch (err) {\r\n-            console.error(\"Error loading page:\", err);\r\n-            mainContentArea.innerHTML =\r\n-                `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n-        }\r\n-    }\r\n-\r\n-    // Sidebar routing: Handles content loading and dynamic data fetching\r\n-    sidebarButtons.forEach(btn => {\r\n-        btn.addEventListener(\"click\", async () => {\r\n-            // Update active state for sidebar buttons\r\n-            sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-            btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n-            const page = btn.dataset.target;\r\n-            if (!page) return;\r\n-\r\n-            await loadPageIntoMainContent(page);\r\n-\r\n-            // Trigger dynamic page data loads after content is inserted\r\n-            if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n-            if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n-            if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-            if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n         });\r\n-    });\r\n \r\n-\r\n-    // ================================\r\n-    // EVENT LISTENERS & INITIALIZATION\r\n-    // ================================\r\n-\r\n-    // Logout Button\r\n-    document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n-        localStorage.removeItem(\"accessToken\");\r\n-        window.location.href = \"/login.html\";\r\n-    });\r\n-    \r\n-    // Visitor Management Dropdown Toggle\r\n-    const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-    const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-    const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n-    visitorToggle?.addEventListener(\"click\", () => {\r\n-        visitorSubMenu?.classList.toggle(\"hidden\");\r\n-        visitorArrow?.classList.toggle(\"rotate-90\");\r\n-    });\r\n-\r\n-\r\n-    // Initial Dashboard Load\r\n-    // This runs on page load. It defaults to loading the dashboard overview.\r\n-    const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n-    if (dashboardBtn) {\r\n-        dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n-    } else if (document.getElementById(\"totalResidents\")) {\r\n-        // Fallback for when content is already on the page (less common in SPA-style)\r\n-        await loadDashboardSummary();\r\n-        await loadAccessChart();\r\n+    } catch (err) {\r\n+        console.error(\"Error loading chart:\", err);\r\n     }\r\n-})();\r\n-\r\n-// =========================================\r\n-// Debug Fetch Wrapper (Removed unneeded base URL usage)\r\n-// =========================================\r\n-// This block of code is not being used by the main initializer function above, \r\n-// so you can safely remove it if it's confusing, or keep it for future use.\r\n-// If you keep it, ensure you define API_HOST in this scope or pass it.\r\n-// I recommend removing it as the logic is duplicated in the main IIFE above.\r\n-// =========================================\r\n-/* async function debugFetch(name, url, options = {}) {\r\n-  // ... debug logic ...\r\n }\r\n \r\n-async function fetchDashboardSummary() {\r\n-  return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n-}\r\n-// ... other fetch functions ...\r\n-async function loadAdminDashboard() {\r\n-  // ... logic\r\n-}\r\n-// loadAdminDashboard(); // This will execute on page load and conflict with the main IIFE\r\n-*/\n+// ================================\r\n+// INITIALIZATION ON PAGE LOAD\r\n+// ================================\r\n+/**\r\n+ * Run this function once on initial page load.\r\n+ * Since the Dashboard Overview content is ALREADY present in index.html, \r\n+ * we can call the data functions directly without a wrapper or delay.\r\n+ */\r\n+(async function initializeDashboard() {\r\n+    await loadDashboardSummary();\r\n+    await loadAccessChart();\r\n+})();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763747705937,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -78,25 +78,25 @@\n // ================================\r\n // DASHBOARD SUMMARY\r\n // ================================\r\n async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n+  try {\r\n+    const res = await fetch(\"http://localhost:4050/api/dashboard/summary\", {\r\n+      headers: { \"Authorization\": \"Bearer \" + token }\r\n+    });\r\n+    if (res.ok) {\r\n+      const data = await res.json();\r\n+      console.log(data);\r\n+      // update DOM\r\n+    } else {\r\n+      console.error(\"Summary fetch failed\", res.status);\r\n     }\r\n+  } catch (err) {\r\n+    console.error(err);\r\n+  }\r\n }\r\n \r\n+\r\n // ================================\r\n // ACCESS CHART\r\n // ================================\r\n async function loadAccessChart() {\r\n"
                },
                {
                    "date": 1763747737690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,24 +77,8 @@\n \r\n // ================================\r\n // DASHBOARD SUMMARY\r\n // ================================\r\n-async function loadDashboardSummary() {\r\n-  try {\r\n-    const res = await fetch(\"http://localhost:4050/api/dashboard/summary\", {\r\n-      headers: { \"Authorization\": \"Bearer \" + token }\r\n-    });\r\n-    if (res.ok) {\r\n-      const data = await res.json();\r\n-      console.log(data);\r\n-      // update DOM\r\n-    } else {\r\n-      console.error(\"Summary fetch failed\", res.status);\r\n-    }\r\n-  } catch (err) {\r\n-    console.error(err);\r\n-  }\r\n-}\r\n \r\n \r\n // ================================\r\n // ACCESS CHART\r\n"
                },
                {
                    "date": 1763747760594,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,10 +77,26 @@\n \r\n // ================================\r\n // DASHBOARD SUMMARY\r\n // ================================\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n+    }\r\n+}\r\n+\r\n // ================================\r\n // ACCESS CHART\r\n // ================================\r\n async function loadAccessChart() {\r\n"
                },
                {
                    "date": 1763781353045,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,87 +1,392 @@\n+// adminsdashboard.js\r\n+// NOTE: This file assumes the full body of the original membershiprecords.js \r\n+// (which includes loadPendingRequests, handleApproveClick, etc.) \r\n+// has been moved into this file for dynamic loading to work.\r\n+\r\n // ================================\r\n-// AUTH & LOGOUT\r\n+// 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n // ================================\r\n-const token = localStorage.getItem(\"accessToken\");\r\n+// Ensure these variables are correctly set up or imported from a config file.\r\n+const API_HOST = \"http://api.estate-management.com\"; \r\n+const token = localStorage.getItem(\"accessToken\"); \r\n+\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n+// Define API Endpoints\r\n+const ENDPOINTS = {\r\n+    // Dashboard Overview Endpoints (using http://localhost:4050 as seen in your code)\r\n+    DASHBOARD_SUMMARY: \"http://localhost:4050/api/residents/dashboard/summary\",\r\n+    DASHBOARD_CHART: \"http://localhost:4050/api/residents/admin/accesschart\",\r\n+\r\n+    // Membership Endpoints (using the general API_HOST for core admin actions)\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+};\r\n+\r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+// ================================\r\n document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n     window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n-// SIDEBAR PAGE LOADING\r\n+// UTILITIES AND HELPERS\r\n // ================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-async function loadPageIntoMainContent(url) {\r\n+/**\r\n+ * Creates and returns the standard headers needed for authenticated API calls.\r\n+ */\r\n+function getAuthHeaders() {\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n+}\r\n+\r\n+/**\r\n+ * Handles error display in a non-alert manner.\r\n+ */\r\n+function displayMessage(message, isError = false) {\r\n+    // Find the message element dynamically on the current page\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Formats a timestamp (string or number) into a readable date string.\r\n+ */\r\n+function formatTimestamp(timestamp) {\r\n     try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html;\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n+}\r\n \r\n-        // For subsequent (non-initial) dashboard loads (via button click), \r\n-        // we call the functions directly after innerHTML.\r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            // NOTE: We don't need setTimeout here for subsequent clicks, \r\n-            // as the initial load issue is bypassed.\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n+/**\r\n+ * Safely updates a DOM element's text content.\r\n+ */\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    } else {\r\n+        // Suppress warning if called when the element isn't in the DOM (i.e., we are on a different page)\r\n+        // console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n+    }\r\n+};\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🟢 CORE MEMBERSHIP LOGIC (MOVED FROM membershiprecords.js)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Sends an approval request to the backend API.\r\n+ */\r\n+async function handleApproveClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n         }\r\n+        \r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        \r\n+        // Reload data after a successful action\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Sends a rejection request to the backend API.\r\n+ */\r\n+async function handleRejectClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Sends a deletion request to the backend API.\r\n+ */\r\n+async function handleDeleteClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Executes a real API call to trigger server-side data synchronization.\r\n+ */\r\n+async function handleSyncClick(event) {\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n+\r\n+    // 1. Set Loading State\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { \r\n+            method: 'POST',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+        }\r\n+\r\n+        // 2. Set Success State\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+        // Reload data after a successful sync\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+        \r\n     } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+        // 3. Set Failure State\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+    } finally {\r\n+        // 4. Reset Button State after a short delay\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n     }\r\n }\r\n \r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+/**\r\n+ * Fetches and renders pending membership requests from the backend API.\r\n+ */\r\n+async function loadPendingRequests() {\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    \r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n \r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        \r\n+        const requests = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n \r\n-// *** REMOVED: loadPageIntoMainContent(\"sections/dashboardoverview.html\"); ***\r\n-// The initial page load is handled by the index.html content itself.\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n \r\n-// ================================\r\n-// VISITOR MANAGEMENT TOGGLE\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID; \r\n \r\n-visitorToggle.addEventListener(\"click\", () => {\r\n-    visitorSubMenu.classList.toggle(\"hidden\");\r\n-    visitorArrow.classList.toggle(\"rotate-90\");\r\n-});\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Approve\r\n+                        </button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Reject\r\n+                        </button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Delete\r\n+                        </button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            \r\n+            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n+}\r\n \r\n-// ================================\r\n-// SAFE UPDATE HELPER\r\n-// ================================\r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    } else {\r\n-        // This warning should now only appear if an ID is misspelled \r\n-        // or a sidebar page is missing the element.\r\n-        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n+/**\r\n+ * Fetches and renders approved residents from the backend API.\r\n+ */\r\n+async function loadApprovedResidents() {\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    \r\n+    if (!tableBody || !noResidentsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading approved residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents from API.\", true);\r\n     }\r\n-};\r\n+}\r\n \r\n-// ================================\r\n-// DASHBOARD SUMMARY\r\n-// ================================\r\n+/**\r\n+ * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+ */\r\n+function attachMembershipListeners() {\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC\r\n+// ====================================================================\r\n+\r\n async function loadDashboardSummary() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n         const data = await res.json();\r\n@@ -95,14 +400,11 @@\n         console.error(\"Error loading summary:\", err);\r\n     }\r\n }\r\n \r\n-// ================================\r\n-// ACCESS CHART\r\n-// ================================\r\n async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n         const data = await res.json();\r\n@@ -132,16 +434,72 @@\n         console.error(\"Error loading chart:\", err);\r\n     }\r\n }\r\n \r\n+\r\n // ================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIX)\r\n+// ================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n+\r\n+async function loadPageIntoMainContent(url) {\r\n+    // Show a loading state instantly\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html; // Inject HTML first\r\n+\r\n+        // 🟢 Execute data loading functions based on the page loaded \r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n+        } else if (url.includes(\"membershiprecords.html\") || url.includes(\"membership.html\")) {\r\n+            // Wait for the HTML structure to be in the DOM, then attach listeners and load data\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+            await loadApprovedResidents();\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    }\r\n+}\r\n+\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n+\r\n+\r\n+// ================================\r\n+// MISC UI TOGGLES\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+});\r\n+\r\n+// ================================\r\n // INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n /**\r\n- * Run this function once on initial page load.\r\n- * Since the Dashboard Overview content is ALREADY present in index.html, \r\n- * we can call the data functions directly without a wrapper or delay.\r\n+ * Run this function once on initial page load for the content that is ALREADY present \r\n+ * in the index.html (the Dashboard Overview).\r\n  */\r\n (async function initializeDashboard() {\r\n+    safeUpdate('year', new Date().getFullYear()); // Update copyright year if span exists\r\n     await loadDashboardSummary();\r\n     await loadAccessChart();\r\n })();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763781606645,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -501,5 +501,123 @@\n (async function initializeDashboard() {\r\n     safeUpdate('year', new Date().getFullYear()); // Update copyright year if span exists\r\n     await loadDashboardSummary();\r\n     await loadAccessChart();\r\n-})();\n\\ No newline at end of file\n+})();\r\n+// adminsdashboard.js\r\n+// ... (existing Membership logic: loadPendingRequests, handleApproveClick, etc.)\r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadPaymentsRecords() {\r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return;\r\n+    \r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading Payments Records...</td></tr>';\r\n+    \r\n+    try {\r\n+        // ❗ Implement API call to fetch payment data\r\n+        // Example: const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        // Example: const payments = await resp.json();\r\n+\r\n+        // ❗ Implement logic to loop through payments and populate paymentsTableBody\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-green-500 italic\">Payments data loaded. (Implement rendering logic here)</td></tr>';\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading payment records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading payments data.</td></tr>';\r\n+    }\r\n+}\r\n+\r\n+function attachPaymentsListeners() {\r\n+    // ❗ Attach listeners for any Verify/Archive buttons or filters on the payments page\r\n+}\r\n+\r\n+// ====================================================================\r\n+// 🧑 RESIDENTS LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadAllResidents() {\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-blue-500 italic\">Loading All Residents...</td></tr>';\r\n+\r\n+    try {\r\n+        // ❗ Implement API call to fetch all resident data\r\n+        // Example: const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        \r\n+        // ❗ Implement logic to populate allResidentsTableBody\r\n+        tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-green-500 italic\">All Residents data loaded. (Implement rendering logic here)</td></tr>';\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-red-500 italic\">Error loading all residents data.</td></tr>';\r\n+    }\r\n+}\r\n+\r\n+// ====================================================================\r\n+// 🚪 VISITORS MANAGEMENT LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadVisitorPassOverview() {\r\n+    const overviewContainer = document.getElementById('visitorOverviewStats');\r\n+    if (!overviewContainer) return;\r\n+\r\n+    // ❗ Implement API call to fetch visitor statistics (e.g., today's visitors, pending approvals)\r\n+    overviewContainer.innerHTML = '<p class=\"text-center py-4 text-green-500 italic\">Visitor overview data loaded. (Implement stats logic here)</p>';\r\n+}\r\n+\r\n+async function loadPendingVisitorApprovals() {\r\n+    const tableBody = document.getElementById('visitorApprovalTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading Pending Visitor Approvals...</td></tr>';\r\n+\r\n+    // ❗ Implement API call and table rendering for visitor approvals\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-green-500 italic\">Visitor Approvals loaded. (Implement rendering logic here)</td></tr>';\r\n+}\r\n+\r\n+function attachVisitorListeners() {\r\n+    // ❗ Attach listeners for Approve/Deny buttons, or date/time filters\r\n+}\r\n+\r\n+// ====================================================================\r\n+// 📈 CHARTS AND REPORTS LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+    const chartContainer = document.getElementById('mainReportsChart');\r\n+    if (!chartContainer) return;\r\n+    \r\n+    // ❗ Implement API calls for any required reports (e.g., annual revenue, resident growth)\r\n+    // ❗ Implement Chart.js initialization logic here for the reports\r\n+    chartContainer.innerHTML = '<p class=\"text-center py-4 text-green-500 italic\">Reports charts initialized. (Implement chart drawing here)</p>';\r\n+}\r\n+\r\n+// ====================================================================\r\n+// 🔑 MANUAL OVERRIDES LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+    const formContainer = document.getElementById('overrideForm');\r\n+    const logsBody = document.getElementById('overrideLogsBody');\r\n+    if (!formContainer || !logsBody) return;\r\n+\r\n+    // ❗ Implement API call to fetch recent override logs\r\n+    logsBody.innerHTML = '<tr><td colspan=\"5\" class=\"text-center py-4 text-blue-500 italic\">Loading Override Logs...</td></tr>';\r\n+    logsBody.innerHTML = '<tr><td colspan=\"5\" class=\"text-center py-4 text-green-500 italic\">Override Logs loaded. (Implement logs rendering here)</td></tr>';\r\n+}\r\n+\r\n+function attachOverrideListeners() {\r\n+    const overrideForm = document.getElementById('overrideForm');\r\n+    if (overrideForm) {\r\n+        // ❗ Attach listener for form submission to execute the manual override API call\r\n+        overrideForm.addEventListener('submit', (e) => {\r\n+            e.preventDefault();\r\n+            // Implement logic to send override request...\r\n+            displayMessage(\"Manual Override attempt sent. (Implement API call here)\", false);\r\n+        });\r\n+    }\r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763781879951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -441,8 +441,11 @@\n // ================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+// adminsdashboard.js\r\n+// ... (existing sidebarButtons and mainContentArea definitions)\r\n+\r\n async function loadPageIntoMainContent(url) {\r\n     // Show a loading state instantly\r\n     mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n \r\n@@ -455,20 +458,58 @@\n         // 🟢 Execute data loading functions based on the page loaded \r\n         if (url.includes(\"dashboardoverview.html\")) {\r\n             await loadDashboardSummary(); \r\n             await loadAccessChart();\r\n-        } else if (url.includes(\"membershiprecords.html\") || url.includes(\"membership.html\")) {\r\n-            // Wait for the HTML structure to be in the DOM, then attach listeners and load data\r\n+        } \r\n+        \r\n+        // --- MEMBERSHIP PAGES ---\r\n+        else if (url.includes(\"membershiprecords.html\")) {\r\n+            // This page typically holds the Sync button and Approved Residents table\r\n             attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            // Assuming membership.html holds the Pending Requests table\r\n+            attachMembershipListeners();\r\n             await loadPendingRequests();\r\n-            await loadApprovedResidents();\r\n         }\r\n+        \r\n+        // --- PAYMENTS RECORDS ---\r\n+        else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } \r\n+        \r\n+        // --- RESIDENTS ---\r\n+        else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } \r\n+        \r\n+        // --- VISITORS MANAGEMENT ---\r\n+        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\") || url.includes(\"visitor/\")) {\r\n+            // Group all visitor sub-pages together for listener and data loading\r\n+            attachVisitorListeners();\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        }\r\n+        \r\n+        // --- CHARTS AND REPORTS ---\r\n+        else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } \r\n+        \r\n+        // --- MANUAL OVERRIDES ---\r\n+        else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n     } catch (err) {\r\n         console.error(\"Error loading page:\", err);\r\n         mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n     }\r\n }\r\n \r\n+// ... (remaining code, including sidebarButtons.forEach loop)\r\n+\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n         sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n         btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n"
                },
                {
                    "date": 1763784296748,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,8 +24,15 @@\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n     REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n     DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n"
                },
                {
                    "date": 1763784449377,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -563,16 +563,30 @@\n     if (!tableBody) return;\r\n     \r\n     tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading Payments Records...</td></tr>';\r\n     \r\n-    try {\r\n-        // ❗ Implement API call to fetch payment data\r\n-        // Example: const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        // Example: const payments = await resp.json();\r\n+   try {\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+        \r\n+        const payments = await resp.json();\r\n \r\n-        // ❗ Implement logic to loop through payments and populate paymentsTableBody\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-green-500 italic\">Payments data loaded. (Implement rendering logic here)</td></tr>';\r\n+        if (payments.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500 italic\">No payment records found.</td></tr>';\r\n+            return;\r\n+        }\r\n \r\n+        tableBody.innerHTML = payments.map(p => `\r\n+            <tr class=\"hover:bg-gray-50\">\r\n+                <td class=\"px-4 py-3\">${p.TransactionID || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${p.ResidentName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${p.HouseNumber || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">Ksh ${p.Amount.toFixed(2)}</td>\r\n+                <td class=\"px-4 py-3\">${formatTimestamp(p.PaymentDate)}</td>\r\n+                <td class=\"px-4 py-3\"><span class=\"bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-xs\">${p.Status || 'Complete'}</span></td>\r\n+                <td class=\"px-4 py-3\">${p.PaymentMethod || 'N/A'}</td>\r\n+            </tr>\r\n+        `).join('');\r\n     } catch (error) {\r\n         console.error(\"Error loading payment records:\", error);\r\n         tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading payments data.</td></tr>';\r\n     }\r\n"
                },
                {
                    "date": 1763784547824,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -606,14 +606,29 @@\n \r\n     tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-blue-500 italic\">Loading All Residents...</td></tr>';\r\n \r\n     try {\r\n-        // ❗ Implement API call to fetch all resident data\r\n-        // Example: const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n         \r\n-        // ❗ Implement logic to populate allResidentsTableBody\r\n-        tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-green-500 italic\">All Residents data loaded. (Implement rendering logic here)</td></tr>';\r\n+        const residents = await resp.json();\r\n \r\n+        if (residents.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-gray-500 italic\">No resident records found.</td></tr>';\r\n+            return;\r\n+        }\r\n+\r\n+        tableBody.innerHTML = residents.map(r => `\r\n+            <tr class=\"hover:bg-gray-50\">\r\n+                <td class=\"px-4 py-3\">${r.ResidentName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${r.NationalID || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${r.Email || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${r.HouseNumber || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${r.CourtName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\"><span class=\"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs\">${r.RoleName || 'Resident'}</span></td>\r\n+            </tr>\r\n+        `).join('');\r\n+\r\n     } catch (error) {\r\n         console.error(\"Error loading all residents:\", error);\r\n         tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-red-500 italic\">Error loading all residents data.</td></tr>';\r\n     }\r\n"
                },
                {
                    "date": 1763784665802,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -637,28 +637,91 @@\n // ====================================================================\r\n // 🚪 VISITORS MANAGEMENT LOGIC\r\n // ====================================================================\r\n \r\n+// ... (inside loadVisitorPassOverview)\r\n+\r\n async function loadVisitorPassOverview() {\r\n     const overviewContainer = document.getElementById('visitorOverviewStats');\r\n     if (!overviewContainer) return;\r\n \r\n-    // ❗ Implement API call to fetch visitor statistics (e.g., today's visitors, pending approvals)\r\n-    overviewContainer.innerHTML = '<p class=\"text-center py-4 text-green-500 italic\">Visitor overview data loaded. (Implement stats logic here)</p>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch visitor overview.\");\r\n+\r\n+        const stats = await resp.json();\r\n+        \r\n+        // Assuming the stats object has properties like 'todayVisitors', 'pendingApprovals', 'activePasses'\r\n+        overviewContainer.innerHTML = `\r\n+            <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n+                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n+                    <p class=\"text-2xl font-bold text-blue-600\">${stats.todayVisitors || 0}</p>\r\n+                    <p class=\"text-sm text-gray-500\">Visitors Today</p>\r\n+                </div>\r\n+                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n+                    <p class=\"text-2xl font-bold text-yellow-600\">${stats.pendingApprovals || 0}</p>\r\n+                    <p class=\"text-sm text-gray-500\">Pending Approvals</p>\r\n+                </div>\r\n+                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n+                    <p class=\"text-2xl font-bold text-green-600\">${stats.activePasses || 0}</p>\r\n+                    <p class=\"text-sm text-gray-500\">Active Passes</p>\r\n+                </div>\r\n+            </div>\r\n+        `;\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading visitor overview:\", error);\r\n+        overviewContainer.innerHTML = '<p class=\"text-center py-4 text-red-500 italic\">Error loading visitor overview data.</p>';\r\n+        displayMessage(\"Failed to load visitor overview stats.\", true);\r\n+    }\r\n }\r\n \r\n async function loadPendingVisitorApprovals() {\r\n     const tableBody = document.getElementById('visitorApprovalTableBody');\r\n     if (!tableBody) return;\r\n \r\n     tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading Pending Visitor Approvals...</td></tr>';\r\n \r\n-    // ❗ Implement API call and table rendering for visitor approvals\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-green-500 italic\">Visitor Approvals loaded. (Implement rendering logic here)</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_VISITOR_APPROVALS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending visitor approvals.\");\r\n+\r\n+        const approvals = await resp.json();\r\n+\r\n+        if (approvals.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500 italic\">No pending visitor approvals.</td></tr>';\r\n+            return;\r\n+        }\r\n+\r\n+        tableBody.innerHTML = approvals.map(a => `\r\n+            <tr class=\"hover:bg-gray-50\">\r\n+                <td class=\"px-4 py-3\">${a.VisitorName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${a.HostName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${formatTimestamp(a.ScheduledEntry)}</td>\r\n+                <td class=\"px-4 py-3\">${a.VehiclePlate || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${a.AccessCode || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">\r\n+                    <button class=\"approve-visitor-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs\" data-id=\"${a.ID}\">Approve</button>\r\n+                    <button class=\"reject-visitor-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs\" data-id=\"${a.ID}\">Reject</button>\r\n+                </td>\r\n+            </tr>\r\n+        `).join('');\r\n+\r\n+        // 💡 Listener attachment placeholder (Assuming a handleVisitorAction function exists)\r\n+        tableBody.querySelectorAll('.approve-visitor-btn').forEach(btn => btn.addEventListener('click', () => {\r\n+            // handleVisitorAction(btn.dataset.id, 'approve'); \r\n+            displayMessage(`Approving visitor ${btn.dataset.id}... (Action required in attachVisitorListeners)`, false);\r\n+        }));\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending visitor approvals:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading visitor approvals.</td></tr>';\r\n+        displayMessage(\"Failed to load pending visitor approvals.\", true);\r\n+    }\r\n }\r\n \r\n function attachVisitorListeners() {\r\n-    // ❗ Attach listeners for Approve/Deny buttons, or date/time filters\r\n+    // Add logic for filtering, or handleVisitorAction(id, action) if implemented.\r\n }\r\n \r\n // ====================================================================\r\n // 📈 CHARTS AND REPORTS LOGIC\r\n"
                },
                {
                    "date": 1763784724150,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -725,18 +725,43 @@\n \r\n // ====================================================================\r\n // 📈 CHARTS AND REPORTS LOGIC\r\n // ====================================================================\r\n+// ... (inside loadReportsData)\r\n \r\n async function loadReportsData() {\r\n     const chartContainer = document.getElementById('mainReportsChart');\r\n     if (!chartContainer) return;\r\n     \r\n-    // ❗ Implement API calls for any required reports (e.g., annual revenue, resident growth)\r\n-    // ❗ Implement Chart.js initialization logic here for the reports\r\n-    chartContainer.innerHTML = '<p class=\"text-center py-4 text-green-500 italic\">Reports charts initialized. (Implement chart drawing here)</p>';\r\n+    chartContainer.innerHTML = '<p class=\"text-center py-4 text-blue-500 italic\">Fetching reports data...</p>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch reports data.\");\r\n+\r\n+        const reportData = await resp.json();\r\n+        \r\n+        // 💡 Assuming reportData contains { labels: [], residentGrowth: [], paymentVolume: [] }\r\n+        const ctx = chartContainer.getContext(\"2d\");\r\n+        new Chart(ctx, {\r\n+            type: \"bar\",\r\n+            data: {\r\n+                labels: reportData.labels || ['Jan', 'Feb', 'Mar'], \r\n+                datasets: [{\r\n+                    label: \"Resident Growth (New Members)\",\r\n+                    data: reportData.residentGrowth || [10, 15, 8],\r\n+                    backgroundColor: '#10b981', // Emerald green\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading reports data:\", error);\r\n+        chartContainer.innerHTML = '<p class=\"text-center py-4 text-red-500 italic\">Error loading reports data.</p>';\r\n+        displayMessage(\"Failed to load charts and reports data.\", true);\r\n+    }\r\n }\r\n-\r\n // ====================================================================\r\n // 🔑 MANUAL OVERRIDES LOGIC\r\n // ====================================================================\r\n \r\n"
                },
                {
                    "date": 1763785220109,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n // ================================\r\n // Ensure these variables are correctly set up or imported from a config file.\r\n-const API_HOST = \"http://api.estate-management.com\"; \r\n+const API_HOST = \"https://api.estate-management.com\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n"
                },
                {
                    "date": 1763785832014,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n // ================================\r\n // Ensure these variables are correctly set up or imported from a config file.\r\n-const API_HOST = \"https://api.estate-management.com\"; \r\n+const API_HOST = \"http://api.estate-management.com\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n"
                },
                {
                    "date": 1763785929208,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,11 +6,10 @@\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n // ================================\r\n // Ensure these variables are correctly set up or imported from a config file.\r\n-const API_HOST = \"http://api.estate-management.com\"; \r\n+const API_HOST =  \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n-\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n"
                }
            ],
            "date": 1763638300168,
            "name": "Commit-0",
            "content": "// ================================\r\n// AUTH & LOGOUT\r\n// ================================\r\nconst token = localStorage.getItem(\"accessToken\");\r\nif (!token) window.location.href = \"/login.html\";\r\n\r\ndocument.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n    localStorage.removeItem(\"accessToken\");\r\n    window.location.href = \"/login.html\";\r\n});\r\n\r\n// ================================\r\n// SIDEBAR PAGE LOADING\r\n// ================================\r\nconst sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\nconst mainContentArea = document.getElementById(\"main-content-area\");\r\n\r\nasync function loadPageIntoMainContent(url) {\r\n    try {\r\n        const res = await fetch(url);\r\n        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n        const html = await res.text();\r\n        mainContentArea.innerHTML = html;\r\n\r\n        // For subsequent (non-initial) dashboard loads (via button click), \r\n        // we call the functions directly after innerHTML.\r\n        if (url.includes(\"dashboardoverview.html\")) {\r\n            // NOTE: We don't need setTimeout here for subsequent clicks, \r\n            // as the initial load issue is bypassed.\r\n            await loadDashboardSummary(); \r\n            await loadAccessChart();\r\n        }\r\n    } catch (err) {\r\n        console.error(\"Error loading page:\", err);\r\n        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n    }\r\n}\r\n\r\nsidebarButtons.forEach(btn => {\r\n    btn.addEventListener(\"click\", async () => {\r\n        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n\r\n        const page = btn.dataset.target;\r\n        if (page) loadPageIntoMainContent(page);\r\n    });\r\n});\r\n\r\n// *** REMOVED: loadPageIntoMainContent(\"sections/dashboardoverview.html\"); ***\r\n// The initial page load is handled by the index.html content itself.\r\n\r\n// ================================\r\n// VISITOR MANAGEMENT TOGGLE\r\n// ================================\r\nconst visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\nconst visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\nconst visitorArrow = document.getElementById(\"visitorArrow\");\r\n\r\nvisitorToggle.addEventListener(\"click\", () => {\r\n    visitorSubMenu.classList.toggle(\"hidden\");\r\n    visitorArrow.classList.toggle(\"rotate-90\");\r\n});\r\n\r\n// ================================\r\n// SAFE UPDATE HELPER\r\n// ================================\r\nconst safeUpdate = (id, value, suffix = '') => {\r\n    const element = document.getElementById(id);\r\n    if (element) {\r\n        element.textContent = value + suffix;\r\n    } else {\r\n        // This warning should now only appear if an ID is misspelled \r\n        // or a sidebar page is missing the element.\r\n        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n    }\r\n};\r\n\r\n// ================================\r\n// DASHBOARD SUMMARY\r\n// ================================\r\nasync function loadDashboardSummary() {\r\n    try {\r\n        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n            headers: { \"Authorization\": `Bearer ${token}` }\r\n        });\r\n        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n        const data = await res.json();\r\n\r\n        safeUpdate(\"totalResidents\", data.residents || 0);\r\n        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n\r\n    } catch (err) {\r\n        console.error(\"Error loading summary:\", err);\r\n    }\r\n}\r\n\r\n// ================================\r\n// ACCESS CHART\r\n// ================================\r\nasync function loadAccessChart() {\r\n    try {\r\n        const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n            headers: { \"Authorization\": `Bearer ${token}` }\r\n        });\r\n        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n        const data = await res.json();\r\n\r\n        const accessChartElement = document.getElementById(\"accessChart\");\r\n        if (!accessChartElement) return;\r\n\r\n        const ctx = accessChartElement.getContext(\"2d\");\r\n        new Chart(ctx, {\r\n            type: \"line\",\r\n            data: {\r\n                labels: data.days || [],\r\n                datasets: [{\r\n                    label: \"Access Attempts\",\r\n                    data: data.counts || [],\r\n                    borderWidth: 2,\r\n                    tension: 0.4,\r\n                    borderColor: '#2563eb',\r\n                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n                    fill: true\r\n                }]\r\n            },\r\n            options: { responsive: true, maintainAspectRatio: false }\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(\"Error loading chart:\", err);\r\n    }\r\n}\r\n\r\n// ================================\r\n// INITIALIZATION ON PAGE LOAD\r\n// ================================\r\n/**\r\n * Run this function once on initial page load.\r\n * Since the Dashboard Overview content is ALREADY present in index.html, \r\n * we can call the data functions directly without a wrapper or delay.\r\n */\r\n(async function initializeDashboard() {\r\n    await loadDashboardSummary();\r\n    await loadAccessChart();\r\n})();\r\nasync function loadMembershipRequests() {\r\n    try {\r\n        const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n            headers: { \"Authorization\": `Bearer ${token}` }\r\n        });\r\n        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n        const requests = await res.json();\r\n\r\n        const container = document.getElementById(\"dynamic-section-content\");\r\n        if (!container) return;\r\n\r\n        if (requests.length === 0) {\r\n            container.innerHTML = \"<p class='text-gray-500 text-center'>No membership requests found.</p>\";\r\n            return;\r\n        }\r\n\r\n        let html = `<table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n                        <thead class=\"bg-gray-200\">\r\n                            <tr>\r\n                                <th class=\"py-2 px-4\">Name</th>\r\n                                <th class=\"py-2 px-4\">National ID</th>\r\n                                <th class=\"py-2 px-4\">Phone</th>\r\n                                <th class=\"py-2 px-4\">Email</th>\r\n                                <th class=\"py-2 px-4\">House</th>\r\n                                <th class=\"py-2 px-4\">Court</th>\r\n                                <th class=\"py-2 px-4\">Status</th>\r\n                                <th class=\"py-2 px-4\">Requested At</th>\r\n                                <th class=\"py-2 px-4\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>`;\r\n\r\n        requests.forEach(r => {\r\n            html += `<tr class=\"border-b\">\r\n                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n                        <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n                        <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n                        <td class=\"py-2 px-4\">${r.Email}</td>\r\n                        <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n                        <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n                        <td class=\"py-2 px-4\">${r.Status}</td>\r\n                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n                        <td class=\"py-2 px-4\">\r\n                            ${r.Status === \"Pending\" ? `<button class=\"approve-btn bg-green-500 px-2 py-1 text-white rounded\" data-id=\"${r.RequestID}\">Approve</button>` : \"\"}\r\n                        </td>\r\n                     </tr>`;\r\n        });\r\n\r\n        html += `</tbody></table>`;\r\n        container.innerHTML = html;\r\n\r\n        // Add click handlers for approve buttons\r\n        document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n            btn.addEventListener(\"click\", async (e) => {\r\n                const requestId = btn.dataset.id;\r\n                try {\r\n                    const resp = await fetch(\"http://localhost:4050/api/admin/approveResident\", {\r\n                        method: \"POST\",\r\n                        headers: {\r\n                            \"Content-Type\": \"application/json\",\r\n                            \"Authorization\": `Bearer ${token}`\r\n                        },\r\n                        body: JSON.stringify({ requestId })\r\n                    });\r\n                    if (!resp.ok) throw new Error(\"Failed to approve\");\r\n                    btn.parentElement.textContent = \"Approved ✅\";\r\n                } catch (err) {\r\n                    alert(\"Error approving request: \" + err.message);\r\n                }\r\n            });\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(\"Error loading membership requests:\", err);\r\n    }\r\n}\r\n"
        }
    ]
}