{
    "sourceFile": "frontend/js/membership.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 20,
            "patches": [
                {
                    "date": 1763700239143,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763701142264,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,20 @@\n+// membership.js\n document.addEventListener(\"DOMContentLoaded\", () => {\n   const form = document.getElementById(\"membershipForm\");\n   const feedbackMessage = document.getElementById(\"feedbackMessage\");\n   const membershipTableBody = document.getElementById(\"membershipTableBody\");\n   const membershipCount = document.getElementById(\"membershipCount\");\n \n-  // Fetch and display membership requests\n+  // Load membership requests from server\n   async function loadMembershipRequests() {\n     try {\n-      const response = await fetch(\"/api/memberships/records\");\n+      const response = await fetch(\"/api/memberships/records\"); // backend endpoint\n       if (!response.ok) throw new Error(\"Failed to fetch membership records\");\n \n-      const data = await response.json();\n+      const result = await response.json();\n+      const data = result.data || [];\n+\n       membershipTableBody.innerHTML = \"\";\n       data.forEach((item) => {\n         const row = document.createElement(\"tr\");\n         row.innerHTML = `\n@@ -27,35 +30,41 @@\n           <td class=\"border px-2 py-1\">${item.RoleName}</td>\n         `;\n         membershipTableBody.appendChild(row);\n       });\n+\n       membershipCount.textContent = data.length;\n-    } catch (error) {\n-      console.error(error);\n+    } catch (err) {\n+      console.error(err);\n       feedbackMessage.textContent = \"Error loading membership requests.\";\n     }\n   }\n \n-  // Submit membership form\n+  // Submit new membership request\n   form.addEventListener(\"submit\", async (e) => {\n     e.preventDefault();\n+\n     const formData = Object.fromEntries(new FormData(form).entries());\n \n     try {\n-      const response = await fetch(\"/api/memberships/records\", {\n+      const response = await fetch(\"/api/memberships/request\", {\n         method: \"POST\",\n         headers: { \"Content-Type\": \"application/json\" },\n         body: JSON.stringify(formData),\n       });\n \n-      if (!response.ok) throw new Error(\"Failed to submit membership request\");\n+      const result = await response.json();\n+\n+      if (!response.ok) throw new Error(result.message || \"Submission failed\");\n+\n       feedbackMessage.textContent = \"Request submitted successfully!\";\n       form.reset();\n-      loadMembershipRequests(); // Refresh table\n-    } catch (error) {\n-      console.error(error);\n-      feedbackMessage.textContent = \"Error submitting request.\";\n+      loadMembershipRequests(); // refresh table\n+    } catch (err) {\n+      console.error(err);\n+      feedbackMessage.textContent = `Error: ${err.message}`;\n     }\n   });\n \n+  // Initial load\n   loadMembershipRequests();\n });\n"
                },
                {
                    "date": 1763701276426,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,70 +1,250 @@\n-// membership.js\n-document.addEventListener(\"DOMContentLoaded\", () => {\n-  const form = document.getElementById(\"membershipForm\");\n-  const feedbackMessage = document.getElementById(\"feedbackMessage\");\n-  const membershipTableBody = document.getElementById(\"membershipTableBody\");\n-  const membershipCount = document.getElementById(\"membershipCount\");\n+// js/membership.js\n+const membershipForm = document.getElementById(\"membershipForm\");\n+const feedbackMessage = document.getElementById(\"feedbackMessage\");\n+const adminTableBody = document.getElementById(\"adminTableBody\");\n+const syncRecordsBtn = document.getElementById(\"syncRecordsBtn\");\n+const adminFeedback = document.getElementById(\"adminFeedback\");\n \n-  // Load membership requests from server\n-  async function loadMembershipRequests() {\n+// Get token from storage (REQUIRED for protected routes)\n+const token = localStorage.getItem(\"accessToken\");\n+if (!token) {\n+    console.error(\"Access Token missing. Cannot submit request or view admin data.\");\n+}\n+\n+// Keep track of the last RequestID and RecordID from backend\n+let lastRequestID = 0;\n+let lastRecordID = 0;\n+\n+// -------------------------\n+// Load Latest IDs from Backend\n+// -------------------------\n+async function loadLatestIDs() {\n     try {\n-      const response = await fetch(\"/api/memberships/records\"); // backend endpoint\n-      if (!response.ok) throw new Error(\"Failed to fetch membership records\");\n+        const res = await fetch(\"http://localhost:4050/api/membership/latest\", {\n+            headers: { \"Authorization\": `Bearer ${token}` }\n+        });\n+        const data = await res.json();\n \n-      const result = await response.json();\n-      const data = result.data || [];\n+        if (!res.ok) throw new Error(data.error || \"Failed to fetch latest IDs\");\n \n-      membershipTableBody.innerHTML = \"\";\n-      data.forEach((item) => {\n-        const row = document.createElement(\"tr\");\n-        row.innerHTML = `\n-          <td class=\"border px-2 py-1\">${item.RequestID}</td>\n-          <td class=\"border px-2 py-1\">${item.ResidentName}</td>\n-          <td class=\"border px-2 py-1\">${item.NationalID}</td>\n-          <td class=\"border px-2 py-1\">${item.PhoneNumber}</td>\n-          <td class=\"border px-2 py-1\">${item.Email}</td>\n-          <td class=\"border px-2 py-1\">${item.HouseNumber}</td>\n-          <td class=\"border px-2 py-1\">${item.CourtName}</td>\n-          <td class=\"border px-2 py-1\">${item.Status}</td>\n-          <td class=\"border px-2 py-1\">${new Date(item.RequestedAt).toLocaleString()}</td>\n-          <td class=\"border px-2 py-1\">${item.RoleName}</td>\n-        `;\n-        membershipTableBody.appendChild(row);\n-      });\n+        lastRequestID = data.lastRequestID || 0;\n+        lastRecordID = data.lastRecordID || 0;\n+        \n+        // Check if the form elements exist before setting value\n+        if (membershipForm && membershipForm.RequestID) {\n+            membershipForm.RequestID.value = lastRequestID + 1;\n+        }\n+        if (membershipForm && membershipForm.RecordID) {\n+            membershipForm.RecordID.value = lastRecordID + 1;\n+        }\n \n-      membershipCount.textContent = data.length;\n     } catch (err) {\n-      console.error(err);\n-      feedbackMessage.textContent = \"Error loading membership requests.\";\n+        console.error(err);\n+        adminFeedback.textContent = \"Failed to load latest IDs: \" + err.message;\n+        adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n     }\n-  }\n+}\n \n-  // Submit new membership request\n-  form.addEventListener(\"submit\", async (e) => {\n-    e.preventDefault();\n+// -------------------------\n+// Submit Membership Request\n+// -------------------------\n+if (membershipForm) { // Ensure the form element exists before adding listener\n+    membershipForm.addEventListener(\"submit\", async (e) => {\n+        e.preventDefault();\n \n-    const formData = Object.fromEntries(new FormData(form).entries());\n+        // --- Validation ---\n+        const nationalID = membershipForm.NationalID.value.trim();\n+        if (!/^\\d{8}$/.test(nationalID)) {\n+            feedbackMessage.textContent = \"National ID must be 8 digits\";\n+            feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+            return;\n+        }\n+        const phone = membershipForm.PhoneNumber.value.trim();\n+        if (!/^\\+\\d{9,15}$/.test(phone)) {\n+            feedbackMessage.textContent = \"Phone number must include country code, e.g., +254712345678\";\n+            feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+            return;\n+        }\n+        const role = membershipForm.RoleName.value;\n+        if (!role) {\n+            feedbackMessage.textContent = \"Please select a role\";\n+            feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+            return;\n+        }\n+        \n+        // -------------------------\n+        // Build data object to submit\n+        // -------------------------\n+        const formData = {\n+            RequestID: lastRequestID + 1,\n+            RecordID: lastRecordID + 1,\n+            ResidentName: membershipForm.ResidentName.value.trim(),\n+            NationalID: nationalID,\n+            PhoneNumber: phone,\n+            Email: membershipForm.Email.value.trim(),\n+            CourtName: membershipForm.CourtName.value.trim(),\n+            HouseNumber: membershipForm.HouseNumber.value.trim(),\n+            RoleName: role,\n+            Action: membershipForm.Action.value.trim() || \"New Membership Request\",\n+            Status: \"New\", // default status\n+            RequestedAt: new Date().toISOString(),\n+        };\n \n+        try {\n+            feedbackMessage.textContent = `Submitting request...`;\n+            feedbackMessage.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n+\n+            const res = await fetch(\"http://localhost:4050/api/membership/request\", {\n+                method: \"POST\",\n+                headers: { \n+                    \"Content-Type\": \"application/json\",\n+                    \"Authorization\": `Bearer ${token}` \n+                },\n+                body: JSON.stringify(formData),\n+            });\n+\n+            const data = await res.json();\n+            if (!res.ok) throw new Error(data.error || `Server error (${res.status})`);\n+\n+            feedbackMessage.textContent = `Membership request submitted successfully! RequestID: ${formData.RequestID}`;\n+            feedbackMessage.className = \"text-green-600 font-semibold mt-1 text-sm\";\n+\n+            // Increment local counters and refresh form for next submission\n+            lastRequestID++;\n+            lastRecordID++;\n+            membershipForm.reset();\n+            if (membershipForm.RequestID) membershipForm.RequestID.value = lastRequestID + 1;\n+            if (membershipForm.RecordID) membershipForm.RecordID.value = lastRecordID + 1;\n+\n+            // Refresh admin table\n+            if (adminTableBody) loadAdminTable(); \n+\n+        } catch (err) {\n+            console.error(err);\n+            feedbackMessage.textContent = err.message || \"Network or token error. Check console.\";\n+            feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+        }\n+    });\n+}\n+\n+\n+// -------------------------\n+// Load Admin Table (REQUIRED for full functionality)\n+// -------------------------\n+async function loadAdminTable() {\n     try {\n-      const response = await fetch(\"/api/memberships/request\", {\n-        method: \"POST\",\n-        headers: { \"Content-Type\": \"application/json\" },\n-        body: JSON.stringify(formData),\n-      });\n+        adminFeedback.textContent = \"Loading requests...\";\n+        adminFeedback.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n \n-      const result = await response.json();\n+        const res = await fetch(\"http://localhost:4050/api/membership/all\", {\n+            headers: { \"Authorization\": `Bearer ${token}` }\n+        });\n+        const requests = await res.json();\n \n-      if (!response.ok) throw new Error(result.message || \"Submission failed\");\n+        if (!res.ok) throw new Error(requests.error || \"Failed to fetch data from server\");\n \n-      feedbackMessage.textContent = \"Request submitted successfully!\";\n-      form.reset();\n-      loadMembershipRequests(); // refresh table\n+        if (requests.length === 0) {\n+            adminTableBody.innerHTML = `<tr><td colspan=\"13\" class=\"text-center p-2 text-gray-500\">No requests found.</td></tr>`;\n+            adminFeedback.textContent = \"No requests found.\";\n+            adminFeedback.className = \"text-gray-600 font-semibold mt-1 text-sm\";\n+            return;\n+        }\n+\n+        adminTableBody.innerHTML = requests.map(req => `\n+            <tr>\n+                <td>${req.RequestID || ''}</td>\n+                <td>${req.ResidentName || ''}</td>\n+                <td>${req.NationalID || ''}</td>\n+                <td>${req.PhoneNumber || ''}</td>\n+                <td>${req.Email || ''}</td>\n+                <td>${req.HouseNumber || ''}</td>\n+                <td>${req.CourtName || ''}</td>\n+                <td>${req.RoleName || ''}</td>\n+                <td>${req.Action || ''}</td>\n+                <td>${req.RequestedAt ? new Date(req.RequestedAt).toLocaleString() : ''}</td>\n+                <td>${req.Status || 'Pending'}</td>\n+                <td>${req.RecordID || 'N/A'}</td>\n+                <td>\n+                    ${req.Status !== 'Approved' && req.Status !== 'Rejected' ? `\n+                        <button class=\"approveBtn bg-green-500 text-white px-2 py-1 rounded text-xs\" data-id=\"${req.RequestID}\">Approve</button>\n+                        <button class=\"rejectBtn bg-red-500 text-white px-2 py-1 rounded text-xs\" data-id=\"${req.RequestID}\">Reject</button>\n+                    ` : req.Status}\n+                </td>\n+            </tr>\n+        `).join('');\n+\n+        adminFeedback.textContent = `Loaded ${requests.length} requests.`;\n+        adminFeedback.className = \"text-green-600 font-semibold mt-1 text-sm\";\n+        \n+        // Attach event listeners to the new buttons\n+        attachActionButtons();\n+\n     } catch (err) {\n-      console.error(err);\n-      feedbackMessage.textContent = `Error: ${err.message}`;\n+        console.error(\"Admin table load error:\", err);\n+        adminTableBody.innerHTML = `<tr><td colspan=\"13\" class=\"text-center p-2 text-red-600\">Failed to load data.</td></tr>`;\n+        adminFeedback.textContent = `Admin load error: ${err.message}`;\n+        adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n     }\n-  });\n+}\n \n-  // Initial load\n-  loadMembershipRequests();\n-});\n+// -------------------------\n+// Attach Approve/Reject Buttons (NEW FUNCTIONALITY)\n+// -------------------------\n+function attachActionButtons() {\n+    // Event delegation is cleaner, but this simple selector works for direct attachment after render\n+    document.querySelectorAll(\".approveBtn\").forEach((btn) => {\n+        const id = btn.getAttribute(\"data-id\"); \n+        btn.addEventListener(\"click\", () => updateStatus(id, \"approve\")); // Use \"approve\" endpoint\n+    });\n+\n+    document.querySelectorAll(\".rejectBtn\").forEach((btn) => {\n+        const id = btn.getAttribute(\"data-id\");\n+        btn.addEventListener(\"click\", () => updateStatus(id, \"reject\")); // Use \"reject\" endpoint\n+    });\n+}\n+\n+// -------------------------\n+// Update Request Status (NEW FUNCTIONALITY)\n+// -------------------------\n+async function updateStatus(requestID, action) {\n+    // Action will be either 'approve' or 'reject'\n+    try {\n+        adminFeedback.textContent = `Processing Request ID ${requestID} as ${action}...`;\n+        adminFeedback.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n+\n+        // Use dynamic URL based on action (e.g., /approve/123 or /reject/123)\n+        const res = await fetch(`http://localhost:4050/api/membership/${action}/${requestID}`, {\n+            method: \"PATCH\",\n+            headers: { \n+                \"Content-Type\": \"application/json\",\n+                \"Authorization\": `Bearer ${token}` \n+            }\n+            // No body needed as the action is in the URL\n+        });\n+        \n+        const data = await res.json();\n+        if (!res.ok) throw new Error(data.error || `Failed to ${action} request.`);\n+        \n+        adminFeedback.textContent = `Request ID ${requestID} successfully ${action}d.`;\n+        adminFeedback.className = \"text-green-600 font-semibold mt-1 text-sm\";\n+        \n+        loadAdminTable(); // Refresh table to show the new status\n+        \n+    } catch (err) {\n+        console.error(err);\n+        adminFeedback.textContent = err.message;\n+        adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+    }\n+}\n+\n+\n+// -------------------------\n+// Initial Load & Event Listeners\n+// -------------------------\n+loadLatestIDs();\n+\n+// If the table and sync button exist, load the data and attach listeners\n+if (adminTableBody && syncRecordsBtn) {\n+    loadAdminTable();\n+    syncRecordsBtn.addEventListener(\"click\", loadAdminTable);\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763701813568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,250 +1,249 @@\n-// js/membership.js\n-const membershipForm = document.getElementById(\"membershipForm\");\n-const feedbackMessage = document.getElementById(\"feedbackMessage\");\n-const adminTableBody = document.getElementById(\"adminTableBody\");\n-const syncRecordsBtn = document.getElementById(\"syncRecordsBtn\");\n-const adminFeedback = document.getElementById(\"adminFeedback\");\n+// ===============================================\n+// js/membership.js (COMBINED & CLEAN)\n+// ===============================================\n \n-// Get token from storage (REQUIRED for protected routes)\n-const token = localStorage.getItem(\"accessToken\");\n-if (!token) {\n-    console.error(\"Access Token missing. Cannot submit request or view admin data.\");\n-}\n+document.addEventListener(\"DOMContentLoaded\", () => {\n+    // -------------------------\n+    // DOM ELEMENTS\n+    // -------------------------\n+    const membershipForm = document.getElementById(\"membershipForm\");\n+    const feedbackMessage = document.getElementById(\"feedbackMessage\");\n+    const adminTableBody = document.getElementById(\"adminTableBody\");\n+    const membershipCount = document.getElementById(\"membershipCount\");\n+    const syncRecordsBtn = document.getElementById(\"syncRecordsBtn\");\n+    const adminFeedback = document.getElementById(\"adminFeedback\");\n \n-// Keep track of the last RequestID and RecordID from backend\n-let lastRequestID = 0;\n-let lastRecordID = 0;\n+    // -------------------------\n+    // TOKEN\n+    // -------------------------\n+    const token = localStorage.getItem(\"accessToken\");\n+    if (!token) {\n+        console.error(\"Access Token missing. Cannot submit request or view admin data.\");\n+        if (feedbackMessage) feedbackMessage.textContent = \"Please login first.\";\n+        return;\n+    }\n \n-// -------------------------\n-// Load Latest IDs from Backend\n-// -------------------------\n-async function loadLatestIDs() {\n-    try {\n-        const res = await fetch(\"http://localhost:4050/api/membership/latest\", {\n-            headers: { \"Authorization\": `Bearer ${token}` }\n-        });\n-        const data = await res.json();\n+    // -------------------------\n+    // TRACK LAST IDs\n+    // -------------------------\n+    let lastRequestID = 0;\n+    let lastRecordID = 0;\n \n-        if (!res.ok) throw new Error(data.error || \"Failed to fetch latest IDs\");\n+    // -------------------------\n+    // LOAD LATEST IDS\n+    // -------------------------\n+    async function loadLatestIDs() {\n+        try {\n+            const res = await fetch(\"http://localhost:4050/api/membership/latest\", {\n+                headers: { \"Authorization\": `Bearer ${token}` }\n+            });\n+            const data = await res.json();\n+            if (!res.ok) throw new Error(data.error || \"Failed to fetch latest IDs\");\n \n-        lastRequestID = data.lastRequestID || 0;\n-        lastRecordID = data.lastRecordID || 0;\n-        \n-        // Check if the form elements exist before setting value\n-        if (membershipForm && membershipForm.RequestID) {\n-            membershipForm.RequestID.value = lastRequestID + 1;\n+            lastRequestID = data.lastRequestID || 0;\n+            lastRecordID = data.lastRecordID || 0;\n+\n+            if (membershipForm && membershipForm.RequestID) membershipForm.RequestID.value = lastRequestID + 1;\n+            if (membershipForm && membershipForm.RecordID) membershipForm.RecordID.value = lastRecordID + 1;\n+        } catch (err) {\n+            console.error(err);\n+            if (adminFeedback) {\n+                adminFeedback.textContent = \"Failed to load latest IDs: \" + err.message;\n+                adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+            }\n         }\n-        if (membershipForm && membershipForm.RecordID) {\n-            membershipForm.RecordID.value = lastRecordID + 1;\n-        }\n-\n-    } catch (err) {\n-        console.error(err);\n-        adminFeedback.textContent = \"Failed to load latest IDs: \" + err.message;\n-        adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n     }\n-}\n \n-// -------------------------\n-// Submit Membership Request\n-// -------------------------\n-if (membershipForm) { // Ensure the form element exists before adding listener\n-    membershipForm.addEventListener(\"submit\", async (e) => {\n-        e.preventDefault();\n+    // -------------------------\n+    // SUBMIT MEMBERSHIP REQUEST\n+    // -------------------------\n+    if (membershipForm) {\n+        membershipForm.addEventListener(\"submit\", async (e) => {\n+            e.preventDefault();\n \n-        // --- Validation ---\n-        const nationalID = membershipForm.NationalID.value.trim();\n-        if (!/^\\d{8}$/.test(nationalID)) {\n-            feedbackMessage.textContent = \"National ID must be 8 digits\";\n-            feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-            return;\n-        }\n-        const phone = membershipForm.PhoneNumber.value.trim();\n-        if (!/^\\+\\d{9,15}$/.test(phone)) {\n-            feedbackMessage.textContent = \"Phone number must include country code, e.g., +254712345678\";\n-            feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-            return;\n-        }\n-        const role = membershipForm.RoleName.value;\n-        if (!role) {\n-            feedbackMessage.textContent = \"Please select a role\";\n-            feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-            return;\n-        }\n-        \n-        // -------------------------\n-        // Build data object to submit\n-        // -------------------------\n-        const formData = {\n-            RequestID: lastRequestID + 1,\n-            RecordID: lastRecordID + 1,\n-            ResidentName: membershipForm.ResidentName.value.trim(),\n-            NationalID: nationalID,\n-            PhoneNumber: phone,\n-            Email: membershipForm.Email.value.trim(),\n-            CourtName: membershipForm.CourtName.value.trim(),\n-            HouseNumber: membershipForm.HouseNumber.value.trim(),\n-            RoleName: role,\n-            Action: membershipForm.Action.value.trim() || \"New Membership Request\",\n-            Status: \"New\", // default status\n-            RequestedAt: new Date().toISOString(),\n-        };\n+            // --- Validation ---\n+            const nationalID = membershipForm.NationalID.value.trim();\n+            const phone = membershipForm.PhoneNumber.value.trim();\n+            const role = membershipForm.RoleName.value;\n \n-        try {\n-            feedbackMessage.textContent = `Submitting request...`;\n-            feedbackMessage.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n+            if (!/^\\d{8}$/.test(nationalID)) {\n+                feedbackMessage.textContent = \"National ID must be 8 digits\";\n+                feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+                return;\n+            }\n+            if (!/^\\+\\d{9,15}$/.test(phone)) {\n+                feedbackMessage.textContent = \"Phone number must include country code, e.g., +254712345678\";\n+                feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+                return;\n+            }\n+            if (!role) {\n+                feedbackMessage.textContent = \"Please select a role\";\n+                feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+                return;\n+            }\n \n-            const res = await fetch(\"http://localhost:4050/api/membership/request\", {\n-                method: \"POST\",\n-                headers: { \n-                    \"Content-Type\": \"application/json\",\n-                    \"Authorization\": `Bearer ${token}` \n-                },\n-                body: JSON.stringify(formData),\n-            });\n+            // --- Build data object ---\n+            const formData = {\n+                RequestID: lastRequestID + 1,\n+                RecordID: lastRecordID + 1,\n+                ResidentName: membershipForm.ResidentName.value.trim(),\n+                NationalID: nationalID,\n+                PhoneNumber: phone,\n+                Email: membershipForm.Email.value.trim(),\n+                CourtName: membershipForm.CourtName.value.trim(),\n+                HouseNumber: membershipForm.HouseNumber.value.trim(),\n+                RoleName: role,\n+                Action: membershipForm.Action.value.trim() || \"New Membership Request\",\n+                Status: \"New\",\n+                RequestedAt: new Date().toISOString(),\n+            };\n \n-            const data = await res.json();\n-            if (!res.ok) throw new Error(data.error || `Server error (${res.status})`);\n+            try {\n+                feedbackMessage.textContent = `Submitting request...`;\n+                feedbackMessage.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n \n-            feedbackMessage.textContent = `Membership request submitted successfully! RequestID: ${formData.RequestID}`;\n-            feedbackMessage.className = \"text-green-600 font-semibold mt-1 text-sm\";\n+                const res = await fetch(\"http://localhost:4050/api/membership/request\", {\n+                    method: \"POST\",\n+                    headers: { \n+                        \"Content-Type\": \"application/json\",\n+                        \"Authorization\": `Bearer ${token}` \n+                    },\n+                    body: JSON.stringify(formData),\n+                });\n \n-            // Increment local counters and refresh form for next submission\n-            lastRequestID++;\n-            lastRecordID++;\n-            membershipForm.reset();\n-            if (membershipForm.RequestID) membershipForm.RequestID.value = lastRequestID + 1;\n-            if (membershipForm.RecordID) membershipForm.RecordID.value = lastRecordID + 1;\n+                const data = await res.json();\n+                if (!res.ok) throw new Error(data.error || data.message || `Server error (${res.status})`);\n \n-            // Refresh admin table\n-            if (adminTableBody) loadAdminTable(); \n+                feedbackMessage.textContent = `Membership request submitted successfully! RequestID: ${formData.RequestID}`;\n+                feedbackMessage.className = \"text-green-600 font-semibold mt-1 text-sm\";\n \n-        } catch (err) {\n-            console.error(err);\n-            feedbackMessage.textContent = err.message || \"Network or token error. Check console.\";\n-            feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-        }\n-    });\n-}\n+                // Increment counters and reset form\n+                lastRequestID++;\n+                lastRecordID++;\n+                membershipForm.reset();\n+                if (membershipForm.RequestID) membershipForm.RequestID.value = lastRequestID + 1;\n+                if (membershipForm.RecordID) membershipForm.RecordID.value = lastRecordID + 1;\n \n+                // Refresh admin table\n+                if (adminTableBody) loadAdminTable();\n \n-// -------------------------\n-// Load Admin Table (REQUIRED for full functionality)\n-// -------------------------\n-async function loadAdminTable() {\n-    try {\n-        adminFeedback.textContent = \"Loading requests...\";\n-        adminFeedback.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n-\n-        const res = await fetch(\"http://localhost:4050/api/membership/all\", {\n\\ No newline at end of file\n-            headers: { \"Authorization\": `Bearer ${token}` }\n+            } catch (err) {\n+                console.error(err);\n+                feedbackMessage.textContent = err.message || \"Network or token error.\";\n+                feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+            }\n         });\n-        const requests = await res.json();\n+    }\n \n-        if (!res.ok) throw new Error(requests.error || \"Failed to fetch data from server\");\n+    // -------------------------\n+    // LOAD ADMIN TABLE\n+    // -------------------------\n+    async function loadAdminTable() {\n+        if (!adminTableBody) return;\n \n-        if (requests.length === 0) {\n-            adminTableBody.innerHTML = `<tr><td colspan=\"13\" class=\"text-center p-2 text-gray-500\">No requests found.</td></tr>`;\n-            adminFeedback.textContent = \"No requests found.\";\n-            adminFeedback.className = \"text-gray-600 font-semibold mt-1 text-sm\";\n-            return;\n-        }\n+        try {\n+            adminFeedback.textContent = \"Loading requests...\";\n+            adminFeedback.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n \n-        adminTableBody.innerHTML = requests.map(req => `\n-            <tr>\n-                <td>${req.RequestID || ''}</td>\n-                <td>${req.ResidentName || ''}</td>\n-                <td>${req.NationalID || ''}</td>\n-                <td>${req.PhoneNumber || ''}</td>\n-                <td>${req.Email || ''}</td>\n-                <td>${req.HouseNumber || ''}</td>\n-                <td>${req.CourtName || ''}</td>\n-                <td>${req.RoleName || ''}</td>\n-                <td>${req.Action || ''}</td>\n-                <td>${req.RequestedAt ? new Date(req.RequestedAt).toLocaleString() : ''}</td>\n-                <td>${req.Status || 'Pending'}</td>\n-                <td>${req.RecordID || 'N/A'}</td>\n-                <td>\n-                    ${req.Status !== 'Approved' && req.Status !== 'Rejected' ? `\n-                        <button class=\"approveBtn bg-green-500 text-white px-2 py-1 rounded text-xs\" data-id=\"${req.RequestID}\">Approve</button>\n-                        <button class=\"rejectBtn bg-red-500 text-white px-2 py-1 rounded text-xs\" data-id=\"${req.RequestID}\">Reject</button>\n-                    ` : req.Status}\n-                </td>\n-            </tr>\n-        `).join('');\n+            const res = await fetch(\"http://localhost:4050/api/membership/all\", {\n+                headers: { \"Authorization\": `Bearer ${token}` }\n+            });\n+            const requests = await res.json();\n+            if (!res.ok) throw new Error(requests.error || \"Failed to fetch data from server\");\n \n-        adminFeedback.textContent = `Loaded ${requests.length} requests.`;\n-        adminFeedback.className = \"text-green-600 font-semibold mt-1 text-sm\";\n-        \n-        // Attach event listeners to the new buttons\n-        attachActionButtons();\n+            if (!requests.data || requests.data.length === 0) {\n+                adminTableBody.innerHTML = `<tr><td colspan=\"13\" class=\"text-center p-2 text-gray-500\">No requests found.</td></tr>`;\n+                adminFeedback.textContent = \"No requests found.\";\n+                adminFeedback.className = \"text-gray-600 font-semibold mt-1 text-sm\";\n+                return;\n+            }\n \n-    } catch (err) {\n-        console.error(\"Admin table load error:\", err);\n-        adminTableBody.innerHTML = `<tr><td colspan=\"13\" class=\"text-center p-2 text-red-600\">Failed to load data.</td></tr>`;\n-        adminFeedback.textContent = `Admin load error: ${err.message}`;\n-        adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-    }\n-}\n+            adminTableBody.innerHTML = requests.data.map(req => `\n+                <tr>\n+                    <td>${req.RequestID || ''}</td>\n+                    <td>${req.ResidentName || ''}</td>\n+                    <td>${req.NationalID || ''}</td>\n+                    <td>${req.PhoneNumber || ''}</td>\n+                    <td>${req.Email || ''}</td>\n+                    <td>${req.HouseNumber || ''}</td>\n+                    <td>${req.CourtName || ''}</td>\n+                    <td>${req.RoleName || ''}</td>\n+                    <td>${req.Action || ''}</td>\n+                    <td>${req.RequestedAt ? new Date(req.RequestedAt).toLocaleString() : ''}</td>\n+                    <td>${req.Status || 'Pending'}</td>\n+                    <td>${req.RecordID || 'N/A'}</td>\n+                    <td>\n+                        ${req.Status !== 'Approved' && req.Status !== 'Rejected' ? `\n+                            <button class=\"approveBtn bg-green-500 text-white px-2 py-1 rounded text-xs\" data-id=\"${req.RequestID}\">Approve</button>\n+                            <button class=\"rejectBtn bg-red-500 text-white px-2 py-1 rounded text-xs\" data-id=\"${req.RequestID}\">Reject</button>\n+                        ` : req.Status}\n+                    </td>\n+                </tr>\n+            `).join('');\n \n-// -------------------------\n-// Attach Approve/Reject Buttons (NEW FUNCTIONALITY)\n-// -------------------------\n-function attachActionButtons() {\n-    // Event delegation is cleaner, but this simple selector works for direct attachment after render\n-    document.querySelectorAll(\".approveBtn\").forEach((btn) => {\n-        const id = btn.getAttribute(\"data-id\"); \n-        btn.addEventListener(\"click\", () => updateStatus(id, \"approve\")); // Use \"approve\" endpoint\n-    });\n+            adminFeedback.textContent = `Loaded ${requests.data.length} requests.`;\n+            adminFeedback.className = \"text-green-600 font-semibold mt-1 text-sm\";\n \n-    document.querySelectorAll(\".rejectBtn\").forEach((btn) => {\n-        const id = btn.getAttribute(\"data-id\");\n-        btn.addEventListener(\"click\", () => updateStatus(id, \"reject\")); // Use \"reject\" endpoint\n-    });\n-}\n+            attachActionButtons();\n \n-// -------------------------\n-// Update Request Status (NEW FUNCTIONALITY)\n-// -------------------------\n-async function updateStatus(requestID, action) {\n-    // Action will be either 'approve' or 'reject'\n-    try {\n-        adminFeedback.textContent = `Processing Request ID ${requestID} as ${action}...`;\n-        adminFeedback.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n+        } catch (err) {\n+            console.error(\"Admin table load error:\", err);\n+            adminTableBody.innerHTML = `<tr><td colspan=\"13\" class=\"text-center p-2 text-red-600\">Failed to load data.</td></tr>`;\n+            adminFeedback.textContent = `Admin load error: ${err.message}`;\n+            adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+        }\n+    }\n \n-        // Use dynamic URL based on action (e.g., /approve/123 or /reject/123)\n-        const res = await fetch(`http://localhost:4050/api/membership/${action}/${requestID}`, {\n-            method: \"PATCH\",\n-            headers: { \n-                \"Content-Type\": \"application/json\",\n-                \"Authorization\": `Bearer ${token}` \n-            }\n-            // No body needed as the action is in the URL\n+    // -------------------------\n+    // ATTACH ACTION BUTTONS\n+    // -------------------------\n+    function attachActionButtons() {\n+        document.querySelectorAll(\".approveBtn\").forEach(btn => {\n+            const id = btn.getAttribute(\"data-id\");\n+            btn.addEventListener(\"click\", () => updateStatus(id, \"approve\"));\n         });\n-        \n-        const data = await res.json();\n-        if (!res.ok) throw new Error(data.error || `Failed to ${action} request.`);\n-        \n-        adminFeedback.textContent = `Request ID ${requestID} successfully ${action}d.`;\n-        adminFeedback.className = \"text-green-600 font-semibold mt-1 text-sm\";\n-        \n-        loadAdminTable(); // Refresh table to show the new status\n-        \n-    } catch (err) {\n-        console.error(err);\n-        adminFeedback.textContent = err.message;\n-        adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+        document.querySelectorAll(\".rejectBtn\").forEach(btn => {\n+            const id = btn.getAttribute(\"data-id\");\n+            btn.addEventListener(\"click\", () => updateStatus(id, \"reject\"));\n+        });\n     }\n-}\n \n+    // -------------------------\n+    // UPDATE STATUS\n+    // -------------------------\n+    async function updateStatus(requestID, action) {\n+        try {\n+            adminFeedback.textContent = `Processing Request ID ${requestID} as ${action}...`;\n+            adminFeedback.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n \n-// -------------------------\n-// Initial Load & Event Listeners\n-// -------------------------\n-loadLatestIDs();\n+            const res = await fetch(`http://localhost:4050/api/membership/${action}/${requestID}`, {\n+                method: \"PATCH\",\n+                headers: { \n+                    \"Content-Type\": \"application/json\",\n+                    \"Authorization\": `Bearer ${token}` \n+                }\n+            });\n+            const data = await res.json();\n+            if (!res.ok) throw new Error(data.error || `Failed to ${action} request.`);\n \n-// If the table and sync button exist, load the data and attach listeners\n-if (adminTableBody && syncRecordsBtn) {\n-    loadAdminTable();\n-    syncRecordsBtn.addEventListener(\"click\", loadAdminTable);\n-}\n+            adminFeedback.textContent = `Request ID ${requestID} successfully ${action}d.`;\n+            adminFeedback.className = \"text-green-600 font-semibold mt-1 text-sm\";\n+\n+            loadAdminTable();\n+\n+        } catch (err) {\n+            console.error(err);\n+            adminFeedback.textContent = err.message;\n+            adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+        }\n+    }\n+\n+    // -------------------------\n+    // INITIAL LOAD\n+    // -------------------------\n+    loadLatestIDs();\n+    if (adminTableBody && syncRecordsBtn) {\n+        loadAdminTable();\n+        syncRecordsBtn.addEventListener(\"click\", loadAdminTable);\n+    }\n+});\n"
                },
                {
                    "date": 1763702543124,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,249 +1,83 @@\n-// ===============================================\n-// js/membership.js (COMBINED & CLEAN)\n-// ===============================================\n-\n document.addEventListener(\"DOMContentLoaded\", () => {\n-    // -------------------------\n-    // DOM ELEMENTS\n-    // -------------------------\n-    const membershipForm = document.getElementById(\"membershipForm\");\n-    const feedbackMessage = document.getElementById(\"feedbackMessage\");\n-    const adminTableBody = document.getElementById(\"adminTableBody\");\n-    const membershipCount = document.getElementById(\"membershipCount\");\n-    const syncRecordsBtn = document.getElementById(\"syncRecordsBtn\");\n-    const adminFeedback = document.getElementById(\"adminFeedback\");\n+  const form = document.getElementById(\"membershipForm\");\n+  const feedbackMessage = document.getElementById(\"feedbackMessage\");\n+  const membershipTableBody = document.getElementById(\"membershipTableBody\");\n+  const membershipCount = document.getElementById(\"membershipCount\");\n \n-    // -------------------------\n-    // TOKEN\n-    // -------------------------\n-    const token = localStorage.getItem(\"accessToken\");\n-    if (!token) {\n-        console.error(\"Access Token missing. Cannot submit request or view admin data.\");\n-        if (feedbackMessage) feedbackMessage.textContent = \"Please login first.\";\n-        return;\n-    }\n+  const token = localStorage.getItem(\"token\"); // JWT from login\n+  if (!token) feedbackMessage.textContent = \"You must log in to submit requests.\";\n \n-    // -------------------------\n-    // TRACK LAST IDs\n-    // -------------------------\n-    let lastRequestID = 0;\n-    let lastRecordID = 0;\n+  // -------------------------\n+  // Load membership requests\n+  // -------------------------\n+  async function loadMembershipRequests() {\n+    try {\n+      const response = await fetch(\"/api/membership/all\", {\n+        headers: { \"Authorization\": \"Bearer \" + token }\n+      });\n+      if (!response.ok) throw new Error(\"Failed to fetch membership requests\");\n \n-    // -------------------------\n-    // LOAD LATEST IDS\n-    // -------------------------\n-    async function loadLatestIDs() {\n-        try {\n-            const res = await fetch(\"http://localhost:4050/api/membership/latest\", {\n-                headers: { \"Authorization\": `Bearer ${token}` }\n-            });\n-            const data = await res.json();\n-            if (!res.ok) throw new Error(data.error || \"Failed to fetch latest IDs\");\n+      const data = await response.json();\n+      const requests = data.data || [];\n \n-            lastRequestID = data.lastRequestID || 0;\n-            lastRecordID = data.lastRecordID || 0;\n+      membershipTableBody.innerHTML = \"\";\n+      requests.forEach((item) => {\n+        const row = document.createElement(\"tr\");\n+        row.innerHTML = `\n+          <td class=\"border px-2 py-1\">${item.RequestID}</td>\n+          <td class=\"border px-2 py-1\">${item.ResidentName}</td>\n+          <td class=\"border px-2 py-1\">${item.NationalID}</td>\n+          <td class=\"border px-2 py-1\">${item.PhoneNumber}</td>\n+          <td class=\"border px-2 py-1\">${item.Email}</td>\n+          <td class=\"border px-2 py-1\">${item.HouseNumber}</td>\n+          <td class=\"border px-2 py-1\">${item.CourtName}</td>\n+          <td class=\"border px-2 py-1\">${item.RoleName}</td>\n+          <td class=\"border px-2 py-1\">${new Date(item.RequestedAt).toLocaleString()}</td>\n+          <td class=\"border px-2 py-1\">${item.Status}</td>\n+        `;\n+        membershipTableBody.appendChild(row);\n+      });\n \n-            if (membershipForm && membershipForm.RequestID) membershipForm.RequestID.value = lastRequestID + 1;\n-            if (membershipForm && membershipForm.RecordID) membershipForm.RecordID.value = lastRecordID + 1;\n-        } catch (err) {\n-            console.error(err);\n-            if (adminFeedback) {\n-                adminFeedback.textContent = \"Failed to load latest IDs: \" + err.message;\n-                adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-            }\n-        }\n-    }\n+      membershipCount.textContent = requests.length;\n \n-    // -------------------------\n-    // SUBMIT MEMBERSHIP REQUEST\n-    // -------------------------\n-    if (membershipForm) {\n-        membershipForm.addEventListener(\"submit\", async (e) => {\n-            e.preventDefault();\n-\n-            // --- Validation ---\n-            const nationalID = membershipForm.NationalID.value.trim();\n-            const phone = membershipForm.PhoneNumber.value.trim();\n-            const role = membershipForm.RoleName.value;\n-\n-            if (!/^\\d{8}$/.test(nationalID)) {\n-                feedbackMessage.textContent = \"National ID must be 8 digits\";\n-                feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-                return;\n-            }\n-            if (!/^\\+\\d{9,15}$/.test(phone)) {\n-                feedbackMessage.textContent = \"Phone number must include country code, e.g., +254712345678\";\n-                feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-                return;\n-            }\n-            if (!role) {\n-                feedbackMessage.textContent = \"Please select a role\";\n-                feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-                return;\n-            }\n-\n-            // --- Build data object ---\n-            const formData = {\n-                RequestID: lastRequestID + 1,\n-                RecordID: lastRecordID + 1,\n-                ResidentName: membershipForm.ResidentName.value.trim(),\n-                NationalID: nationalID,\n-                PhoneNumber: phone,\n-                Email: membershipForm.Email.value.trim(),\n-                CourtName: membershipForm.CourtName.value.trim(),\n-                HouseNumber: membershipForm.HouseNumber.value.trim(),\n-                RoleName: role,\n-                Action: membershipForm.Action.value.trim() || \"New Membership Request\",\n-                Status: \"New\",\n-                RequestedAt: new Date().toISOString(),\n-            };\n-\n-            try {\n-                feedbackMessage.textContent = `Submitting request...`;\n-                feedbackMessage.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n-\n-                const res = await fetch(\"http://localhost:4050/api/membership/request\", {\n-                    method: \"POST\",\n-                    headers: { \n-                        \"Content-Type\": \"application/json\",\n-                        \"Authorization\": `Bearer ${token}` \n-                    },\n-                    body: JSON.stringify(formData),\n-                });\n-\n-                const data = await res.json();\n-                if (!res.ok) throw new Error(data.error || data.message || `Server error (${res.status})`);\n-\n-                feedbackMessage.textContent = `Membership request submitted successfully! RequestID: ${formData.RequestID}`;\n-                feedbackMessage.className = \"text-green-600 font-semibold mt-1 text-sm\";\n-\n-                // Increment counters and reset form\n-                lastRequestID++;\n-                lastRecordID++;\n-                membershipForm.reset();\n-                if (membershipForm.RequestID) membershipForm.RequestID.value = lastRequestID + 1;\n-                if (membershipForm.RecordID) membershipForm.RecordID.value = lastRecordID + 1;\n-\n-                // Refresh admin table\n-                if (adminTableBody) loadAdminTable();\n-\n-            } catch (err) {\n-                console.error(err);\n-                feedbackMessage.textContent = err.message || \"Network or token error.\";\n-                feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-            }\n-        });\n+    } catch (err) {\n+      console.error(err);\n+      membershipTableBody.innerHTML = `<tr><td colspan=\"10\" class=\"text-center text-red-600 p-2\">Failed to load requests.</td></tr>`;\n+      feedbackMessage.textContent = \"Error loading membership requests.\";\n     }\n+  }\n \n-    // -------------------------\n-    // LOAD ADMIN TABLE\n-    // -------------------------\n-    async function loadAdminTable() {\n-        if (!adminTableBody) return;\n+  // -------------------------\n+  // Submit new membership request\n+  // -------------------------\n+  form.addEventListener(\"submit\", async (e) => {\n+    e.preventDefault();\n \n-        try {\n-            adminFeedback.textContent = \"Loading requests...\";\n-            adminFeedback.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n+    const formData = Object.fromEntries(new FormData(form).entries());\n \n-            const res = await fetch(\"http://localhost:4050/api/membership/all\", {\n-                headers: { \"Authorization\": `Bearer ${token}` }\n-            });\n-            const requests = await res.json();\n-            if (!res.ok) throw new Error(requests.error || \"Failed to fetch data from server\");\n+    try {\n+      const response = await fetch(\"/api/membership/request\", {\n+        method: \"POST\",\n+        headers: { \n+          \"Content-Type\": \"application/json\",\n+          \"Authorization\": \"Bearer \" + token\n+        },\n+        body: JSON.stringify(formData),\n+      });\n \n-            if (!requests.data || requests.data.length === 0) {\n-                adminTableBody.innerHTML = `<tr><td colspan=\"13\" class=\"text-center p-2 text-gray-500\">No requests found.</td></tr>`;\n-                adminFeedback.textContent = \"No requests found.\";\n-                adminFeedback.className = \"text-gray-600 font-semibold mt-1 text-sm\";\n-                return;\n-            }\n+      const result = await response.json();\n+      if (!result.success) throw new Error(result.message);\n \n-            adminTableBody.innerHTML = requests.data.map(req => `\n-                <tr>\n-                    <td>${req.RequestID || ''}</td>\n-                    <td>${req.ResidentName || ''}</td>\n-                    <td>${req.NationalID || ''}</td>\n-                    <td>${req.PhoneNumber || ''}</td>\n-                    <td>${req.Email || ''}</td>\n-                    <td>${req.HouseNumber || ''}</td>\n-                    <td>${req.CourtName || ''}</td>\n-                    <td>${req.RoleName || ''}</td>\n-                    <td>${req.Action || ''}</td>\n-                    <td>${req.RequestedAt ? new Date(req.RequestedAt).toLocaleString() : ''}</td>\n-                    <td>${req.Status || 'Pending'}</td>\n-                    <td>${req.RecordID || 'N/A'}</td>\n-                    <td>\n-                        ${req.Status !== 'Approved' && req.Status !== 'Rejected' ? `\n-                            <button class=\"approveBtn bg-green-500 text-white px-2 py-1 rounded text-xs\" data-id=\"${req.RequestID}\">Approve</button>\n-                            <button class=\"rejectBtn bg-red-500 text-white px-2 py-1 rounded text-xs\" data-id=\"${req.RequestID}\">Reject</button>\n-                        ` : req.Status}\n-                    </td>\n-                </tr>\n-            `).join('');\n-\n-            adminFeedback.textContent = `Loaded ${requests.data.length} requests.`;\n-            adminFeedback.className = \"text-green-600 font-semibold mt-1 text-sm\";\n-\n-            attachActionButtons();\n-\n-        } catch (err) {\n-            console.error(\"Admin table load error:\", err);\n-            adminTableBody.innerHTML = `<tr><td colspan=\"13\" class=\"text-center p-2 text-red-600\">Failed to load data.</td></tr>`;\n-            adminFeedback.textContent = `Admin load error: ${err.message}`;\n-            adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-        }\n+      feedbackMessage.textContent = result.message;\n+      feedbackMessage.className = \"text-green-600 font-semibold mt-1 text-sm\";\n+      form.reset();\n+      loadMembershipRequests();\n+    } catch (err) {\n+      console.error(err);\n+      feedbackMessage.textContent = err.message;\n+      feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n     }\n+  });\n \n-    // -------------------------\n-    // ATTACH ACTION BUTTONS\n-    // -------------------------\n-    function attachActionButtons() {\n-        document.querySelectorAll(\".approveBtn\").forEach(btn => {\n-            const id = btn.getAttribute(\"data-id\");\n-            btn.addEventListener(\"click\", () => updateStatus(id, \"approve\"));\n-        });\n-        document.querySelectorAll(\".rejectBtn\").forEach(btn => {\n-            const id = btn.getAttribute(\"data-id\");\n-            btn.addEventListener(\"click\", () => updateStatus(id, \"reject\"));\n-        });\n-    }\n-\n-    // -------------------------\n-    // UPDATE STATUS\n-    // -------------------------\n-    async function updateStatus(requestID, action) {\n-        try {\n-            adminFeedback.textContent = `Processing Request ID ${requestID} as ${action}...`;\n-            adminFeedback.className = \"text-blue-600 font-semibold mt-1 text-sm\";\n-\n-            const res = await fetch(`http://localhost:4050/api/membership/${action}/${requestID}`, {\n-                method: \"PATCH\",\n-                headers: { \n-                    \"Content-Type\": \"application/json\",\n-                    \"Authorization\": `Bearer ${token}` \n-                }\n-            });\n-            const data = await res.json();\n-            if (!res.ok) throw new Error(data.error || `Failed to ${action} request.`);\n-\n-            adminFeedback.textContent = `Request ID ${requestID} successfully ${action}d.`;\n-            adminFeedback.className = \"text-green-600 font-semibold mt-1 text-sm\";\n-\n-            loadAdminTable();\n-\n-        } catch (err) {\n-            console.error(err);\n-            adminFeedback.textContent = err.message;\n-            adminFeedback.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-        }\n-    }\n-\n-    // -------------------------\n-    // INITIAL LOAD\n-    // -------------------------\n-    loadLatestIDs();\n-    if (adminTableBody && syncRecordsBtn) {\n-        loadAdminTable();\n-        syncRecordsBtn.addEventListener(\"click\", loadAdminTable);\n-    }\n+  loadMembershipRequests();\n });\n"
                },
                {
                    "date": 1763703191877,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,13 +4,17 @@\n   const membershipTableBody = document.getElementById(\"membershipTableBody\");\n   const membershipCount = document.getElementById(\"membershipCount\");\n \n   const token = localStorage.getItem(\"token\"); // JWT from login\n-  if (!token) feedbackMessage.textContent = \"You must log in to submit requests.\";\n+  if (!token) {\n+    feedbackMessage.textContent = \"You must log in to submit requests.\";\n+    feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+    return;\n+  }\n \n-  // -------------------------\n-  // Load membership requests\n-  // -------------------------\n+  // Auto-fill RequestedAt with current date/time\n+  document.getElementById(\"RequestedAt\").value = new Date().toISOString();\n+\n   async function loadMembershipRequests() {\n     try {\n       const response = await fetch(\"/api/membership/all\", {\n         headers: { \"Authorization\": \"Bearer \" + token }\n@@ -24,8 +28,9 @@\n       requests.forEach((item) => {\n         const row = document.createElement(\"tr\");\n         row.innerHTML = `\n           <td class=\"border px-2 py-1\">${item.RequestID}</td>\n+          <td class=\"border px-2 py-1\">${item.RecordID || ''}</td>\n           <td class=\"border px-2 py-1\">${item.ResidentName}</td>\n           <td class=\"border px-2 py-1\">${item.NationalID}</td>\n           <td class=\"border px-2 py-1\">${item.PhoneNumber}</td>\n           <td class=\"border px-2 py-1\">${item.Email}</td>\n@@ -41,19 +46,21 @@\n       membershipCount.textContent = requests.length;\n \n     } catch (err) {\n       console.error(err);\n-      membershipTableBody.innerHTML = `<tr><td colspan=\"10\" class=\"text-center text-red-600 p-2\">Failed to load requests.</td></tr>`;\n+      membershipTableBody.innerHTML = `<tr><td colspan=\"11\" class=\"text-center text-red-600 p-2\">Failed to load requests.</td></tr>`;\n       feedbackMessage.textContent = \"Error loading membership requests.\";\n+      feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n     }\n   }\n \n-  // -------------------------\n-  // Submit new membership request\n-  // -------------------------\n   form.addEventListener(\"submit\", async (e) => {\n     e.preventDefault();\n \n+    // Ensure RequestedAt and Status are included\n+    form.RequestedAt.value = new Date().toISOString();\n+    form.Status.value = \"New\";\n+\n     const formData = Object.fromEntries(new FormData(form).entries());\n \n     try {\n       const response = await fetch(\"/api/membership/request\", {\n@@ -70,8 +77,13 @@\n \n       feedbackMessage.textContent = result.message;\n       feedbackMessage.className = \"text-green-600 font-semibold mt-1 text-sm\";\n       form.reset();\n+\n+      // Refill auto fields after reset\n+      form.RequestedAt.value = new Date().toISOString();\n+      form.Status.value = \"New\";\n+\n       loadMembershipRequests();\n     } catch (err) {\n       console.error(err);\n       feedbackMessage.textContent = err.message;\n"
                },
                {
                    "date": 1763729152846,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,95 +1,96 @@\n-document.addEventListener(\"DOMContentLoaded\", () => {\n-  const form = document.getElementById(\"membershipForm\");\n-  const feedbackMessage = document.getElementById(\"feedbackMessage\");\n-  const membershipTableBody = document.getElementById(\"membershipTableBody\");\n-  const membershipCount = document.getElementById(\"membershipCount\");\n+// =============================\n+// CONFIG\n+// =============================\n+// The base URL of your backend server running Express\n+const API_HOST = \"http://localhost:4050\"; \n \n-  const token = localStorage.getItem(\"token\"); // JWT from login\n-  if (!token) {\n-    feedbackMessage.textContent = \"You must log in to submit requests.\";\n-    feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n-    return;\n-  }\n+// DOM elements\n+const membershipForm = document.getElementById(\"membershipForm\");\n+const feedbackMessage = document.getElementById(\"feedbackMessage\");\n+const membershipCountSpan = document.getElementById(\"membershipCount\");\n \n-  // Auto-fill RequestedAt with current date/time\n-  document.getElementById(\"RequestedAt\").value = new Date().toISOString();\n-\n-  async function loadMembershipRequests() {\n+// =============================\n+// FETCH & DISPLAY MEMBERSHIP COUNT (Optional but good practice)\n+// =============================\n+async function fetchMembershipCount() {\n     try {\n-      const response = await fetch(\"/api/membership/all\", {\n-        headers: { \"Authorization\": \"Bearer \" + token }\n-      });\n-      if (!response.ok) throw new Error(\"Failed to fetch membership requests\");\n+        // Assuming you have a GET endpoint to fetch the total count (e.g., /api/membership/count)\n+        const response = await fetch(`${API_HOST}/api/membership/count`);\n+        if (response.ok) {\n+            const data = await response.json();\n+            // Assuming the response JSON has a field like { totalRequests: 50 }\n+            membershipCountSpan.textContent = data.totalRequests || '0';\n+        }\n+    } catch (error) {\n+        console.error(\"Failed to fetch membership count:\", error);\n+    }\n+}\n \n-      const data = await response.json();\n-      const requests = data.data || [];\n+// Call the function on load\n+// fetchMembershipCount(); \n \n-      membershipTableBody.innerHTML = \"\";\n-      requests.forEach((item) => {\n-        const row = document.createElement(\"tr\");\n-        row.innerHTML = `\n-          <td class=\"border px-2 py-1\">${item.RequestID}</td>\n-          <td class=\"border px-2 py-1\">${item.RecordID || ''}</td>\n-          <td class=\"border px-2 py-1\">${item.ResidentName}</td>\n-          <td class=\"border px-2 py-1\">${item.NationalID}</td>\n-          <td class=\"border px-2 py-1\">${item.PhoneNumber}</td>\n-          <td class=\"border px-2 py-1\">${item.Email}</td>\n-          <td class=\"border px-2 py-1\">${item.HouseNumber}</td>\n-          <td class=\"border px-2 py-1\">${item.CourtName}</td>\n-          <td class=\"border px-2 py-1\">${item.RoleName}</td>\n-          <td class=\"border px-2 py-1\">${new Date(item.RequestedAt).toLocaleString()}</td>\n-          <td class=\"border px-2 py-1\">${item.Status}</td>\n-        `;\n-        membershipTableBody.appendChild(row);\n-      });\n+// =============================\n+// SUBMIT MEMBERSHIP REQUEST\n+// =============================\n+membershipForm.addEventListener(\"submit\", async (e) => {\n+    e.preventDefault();\n \n-      membershipCount.textContent = requests.length;\n+    // 1. Update feedback state\n+    feedbackMessage.textContent = \"Submitting request...\";\n+    feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n \n-    } catch (err) {\n-      console.error(err);\n-      membershipTableBody.innerHTML = `<tr><td colspan=\"11\" class=\"text-center text-red-600 p-2\">Failed to load requests.</td></tr>`;\n-      feedbackMessage.textContent = \"Error loading membership requests.\";\n-      feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+    // 2. Serialize Form Data\n+    const formData = new FormData(membershipForm);\n+    // Convert FormData to a plain JavaScript object\n+    const data = Object.fromEntries(formData.entries());\n+\n+    // Clean up empty 'Action' field if it's blank, so it sends 'null' if required by DB\n+    if (data.Action === \"\") {\n+        data.Action = null;\n     }\n-  }\n+    \n+    // Simple validation (can be removed if relying purely on 'required' attribute)\n+    if (data.RoleName === \"\" || data.RoleName === \"Select Your Role\") {\n+        feedbackMessage.textContent = \"Please select a valid Role.\";\n+        feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+        return;\n+    }\n \n-  form.addEventListener(\"submit\", async (e) => {\n-    e.preventDefault();\n+    try {\n+        // 3. Send POST Request\n+        const response = await fetch(`${API_HOST}/api/membership`, {\n+            method: \"POST\",\n+            headers: {\n+                \"Content-Type\": \"application/json\"\n+            },\n+            body: JSON.stringify(data) // Send data as JSON string\n+        });\n \n-    // Ensure RequestedAt and Status are included\n-    form.RequestedAt.value = new Date().toISOString();\n-    form.Status.value = \"New\";\n+        const result = await response.json();\n \n-    const formData = Object.fromEntries(new FormData(form).entries());\n+        // 4. Handle Server Response\n+        if (!response.ok) {\n+            // Handle HTTP error codes (400, 500, etc.)\n+            const errorMessage = result.message || result.details || \"Failed to submit request.\";\n+            feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n+            feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+            return;\n+        }\n \n-    try {\n-      const response = await fetch(\"/api/membership/request\", {\n-        method: \"POST\",\n-        headers: { \n-          \"Content-Type\": \"application/json\",\n-          \"Authorization\": \"Bearer \" + token\n-        },\n-        body: JSON.stringify(formData),\n-      });\n+        // Success\n+        feedbackMessage.textContent = \"Membership Request Submitted Successfully! Awaiting admin approval.\";\n+        feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n \n-      const result = await response.json();\n-      if (!result.success) throw new Error(result.message);\n+        // Reset the form after successful submission\n+        membershipForm.reset();\n+        \n+        // Optional: Update the count after successful submission\n+        // fetchMembershipCount(); \n \n-      feedbackMessage.textContent = result.message;\n-      feedbackMessage.className = \"text-green-600 font-semibold mt-1 text-sm\";\n-      form.reset();\n-\n-      // Refill auto fields after reset\n-      form.RequestedAt.value = new Date().toISOString();\n-      form.Status.value = \"New\";\n-\n-      loadMembershipRequests();\n-    } catch (err) {\n-      console.error(err);\n-      feedbackMessage.textContent = err.message;\n-      feedbackMessage.className = \"text-red-600 font-semibold mt-1 text-sm\";\n+    } catch (error) {\n+         // Handle Network errors (server down, CORS issue, etc.)\n+         feedbackMessage.textContent = `Network error: Could not connect to the server at ${API_HOST}.`;\n+        feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+        console.error(\"Submit Error:\", error);\n     }\n-  });\n-\n-  loadMembershipRequests();\n-});\n+});\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763743979417,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,5 +92,62 @@\n          feedbackMessage.textContent = `Network error: Could not connect to the server at ${API_HOST}.`;\n         feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n         console.error(\"Submit Error:\", error);\n     }\n-});\n\\ No newline at end of file\n+});\n+\n+// Set the current year in the footer\n+        document.getElementById(\"year\").textContent = new Date().getFullYear();\n+\n+        // Placeholder for submission logic (since the original JS was not included)\n+        const membershipForm = document.getElementById(\"membershipForm\");\n+        const feedbackMessage = document.getElementById(\"feedbackMessage\");\n+        const membershipCountSpan = document.getElementById(\"membershipCount\");\n+\n+        // NOTE: Replace API_HOST with your actual backend URL when moving out of a single file\n+        const API_HOST = \"http://localhost:4050\"; \n+\n+        membershipForm.addEventListener(\"submit\", async (e) => {\n+            e.preventDefault();\n+\n+            feedbackMessage.textContent = \"Submitting request...\";\n+            feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n+\n+            const formData = new FormData(membershipForm);\n+            const data = Object.fromEntries(formData.entries());\n+            if (data.Action === \"\") {\n+                data.Action = null;\n+            }\n+\n+            try {\n+                const response = await fetch(`${API_HOST}/api/membership`, {\n+                    method: \"POST\",\n+                    headers: { \"Content-Type\": \"application/json\" },\n+                    body: JSON.stringify(data)\n+                });\n+\n+                const result = await response.json();\n+\n+                if (!response.ok) {\n+                    const errorMessage = result.message || \"Failed to submit request.\";\n+                    feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n+                    feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+                    return;\n+                }\n+\n+                feedbackMessage.textContent = \"Membership Request Submitted Successfully! Awaiting admin approval.\";\n+                feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n+                membershipForm.reset();\n+\n+            } catch (error) {\n+                feedbackMessage.textContent = `Network error: Could not connect to the server at ${API_HOST}.`;\n+                feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+                console.error(\"Submit Error:\", error);\n+            }\n+        });\n+        \n+        // Optional: Function to fetch and display the membership count\n+        async function fetchMembershipCount() {\n+             // Implementation requires a separate GET endpoint, commented out for brevity\n+             // membershipCountSpan.textContent = '50'; // Placeholder\n+        }\n+        fetchMembershipCount(); // You can uncomment this line if you implement the backend GET route\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763744110746,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,150 +4,108 @@\n // The base URL of your backend server running Express\n const API_HOST = \"http://localhost:4050\"; \n \n // DOM elements\n+// These must be defined once at the top\n const membershipForm = document.getElementById(\"membershipForm\");\n const feedbackMessage = document.getElementById(\"feedbackMessage\");\n const membershipCountSpan = document.getElementById(\"membershipCount\");\n+const yearSpan = document.getElementById(\"year\"); // Added DOM element for the year\n \n+// Set the current year in the footer (Moved here for better placement)\n+if (yearSpan) {\n+    yearSpan.textContent = new Date().getFullYear();\n+}\n+\n // =============================\n // FETCH & DISPLAY MEMBERSHIP COUNT (Optional but good practice)\n-// =============================\n+// ===================================\n async function fetchMembershipCount() {\n     try {\n         // Assuming you have a GET endpoint to fetch the total count (e.g., /api/membership/count)\n+        // NOTE: If you haven't implemented this route in your backend, it will cause a network error.\n         const response = await fetch(`${API_HOST}/api/membership/count`);\n+        \n         if (response.ok) {\n             const data = await response.json();\n             // Assuming the response JSON has a field like { totalRequests: 50 }\n             membershipCountSpan.textContent = data.totalRequests || '0';\n         }\n     } catch (error) {\n-        console.error(\"Failed to fetch membership count:\", error);\n+        // console.error(\"Failed to fetch membership count:\", error);\n+        // Optionally set a friendly message if the count fails\n+        membershipCountSpan.textContent = \"N/A\"; \n     }\n }\n \n // Call the function on load\n+// You can uncomment this line if you have the backend endpoint ready\n // fetchMembershipCount(); \n \n // =============================\n // SUBMIT MEMBERSHIP REQUEST\n // =============================\n-membershipForm.addEventListener(\"submit\", async (e) => {\n-    e.preventDefault();\n+if (membershipForm) {\n+    membershipForm.addEventListener(\"submit\", async (e) => {\n+        e.preventDefault();\n \n-    // 1. Update feedback state\n-    feedbackMessage.textContent = \"Submitting request...\";\n-    feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n+        // 1. Update feedback state\n+        feedbackMessage.textContent = \"Submitting request...\";\n+        feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n \n-    // 2. Serialize Form Data\n-    const formData = new FormData(membershipForm);\n-    // Convert FormData to a plain JavaScript object\n-    const data = Object.fromEntries(formData.entries());\n+        // 2. Serialize Form Data\n+        const formData = new FormData(membershipForm);\n+        const data = Object.fromEntries(formData.entries());\n \n-    // Clean up empty 'Action' field if it's blank, so it sends 'null' if required by DB\n-    if (data.Action === \"\") {\n-        data.Action = null;\n-    }\n-    \n-    // Simple validation (can be removed if relying purely on 'required' attribute)\n-    if (data.RoleName === \"\" || data.RoleName === \"Select Your Role\") {\n-        feedbackMessage.textContent = \"Please select a valid Role.\";\n-        feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-        return;\n-    }\n-\n-    try {\n-        // 3. Send POST Request\n-        const response = await fetch(`${API_HOST}/api/membership`, {\n-            method: \"POST\",\n-            headers: {\n-                \"Content-Type\": \"application/json\"\n-            },\n-            body: JSON.stringify(data) // Send data as JSON string\n-        });\n-\n-        const result = await response.json();\n-\n-        // 4. Handle Server Response\n-        if (!response.ok) {\n-            // Handle HTTP error codes (400, 500, etc.)\n-            const errorMessage = result.message || result.details || \"Failed to submit request.\";\n-            feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n+        // Clean up empty 'Action' field if it's blank, so it sends 'null' if required by DB\n+        if (data.Action === \"\") {\n+            data.Action = null;\n+        }\n+        \n+        // Simple validation check for RoleName\n+        if (data.RoleName === \"\" || data.RoleName === \"Select Your Role\") {\n+            feedbackMessage.textContent = \"Please select a valid Role.\";\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             return;\n         }\n \n-        // Success\n-        feedbackMessage.textContent = \"Membership Request Submitted Successfully! Awaiting admin approval.\";\n-        feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n+        try {\n+            // 3. Send POST Request\n+            const response = await fetch(`${API_HOST}/api/membership`, {\n+                method: \"POST\",\n+                headers: {\n+                    \"Content-Type\": \"application/json\"\n+                },\n+                body: JSON.stringify(data) // Send data as JSON string\n+            });\n \n-        // Reset the form after successful submission\n-        membershipForm.reset();\n-        \n-        // Optional: Update the count after successful submission\n-        // fetchMembershipCount(); \n+            const result = await response.json();\n \n-    } catch (error) {\n-         // Handle Network errors (server down, CORS issue, etc.)\n-         feedbackMessage.textContent = `Network error: Could not connect to the server at ${API_HOST}.`;\n-        feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-        console.error(\"Submit Error:\", error);\n-    }\n-});\n-\n-// Set the current year in the footer\n-        document.getElementById(\"year\").textContent = new Date().getFullYear();\n-\n-        // Placeholder for submission logic (since the original JS was not included)\n-        const membershipForm = document.getElementById(\"membershipForm\");\n-        const feedbackMessage = document.getElementById(\"feedbackMessage\");\n-        const membershipCountSpan = document.getElementById(\"membershipCount\");\n-\n-        // NOTE: Replace API_HOST with your actual backend URL when moving out of a single file\n-        const API_HOST = \"http://localhost:4050\"; \n-\n-        membershipForm.addEventListener(\"submit\", async (e) => {\n-            e.preventDefault();\n-\n-            feedbackMessage.textContent = \"Submitting request...\";\n\\ No newline at end of file\n-            feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n-\n-            const formData = new FormData(membershipForm);\n-            const data = Object.fromEntries(formData.entries());\n-            if (data.Action === \"\") {\n-                data.Action = null;\n+            // 4. Handle Server Response\n+            if (!response.ok) {\n+                // Handle HTTP error codes (400, 500, etc.)\n+                const errorMessage = result.message || result.details || \"Failed to submit request.\";\n+                feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n+                feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+                return;\n             }\n \n-            try {\n-                const response = await fetch(`${API_HOST}/api/membership`, {\n-                    method: \"POST\",\n-                    headers: { \"Content-Type\": \"application/json\" },\n-                    body: JSON.stringify(data)\n-                });\n+            // Success\n+            feedbackMessage.textContent = \"Membership Request Submitted Successfully! Awaiting admin approval.\";\n+            feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n \n-                const result = await response.json();\n+            // Reset the form after successful submission\n+            membershipForm.reset();\n+            \n+            // Optional: Update the count after successful submission\n+            // fetchMembershipCount(); \n \n-                if (!response.ok) {\n-                    const errorMessage = result.message || \"Failed to submit request.\";\n-                    feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n-                    feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-                    return;\n-                }\n-\n-                feedbackMessage.textContent = \"Membership Request Submitted Successfully! Awaiting admin approval.\";\n-                feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n-                membershipForm.reset();\n-\n-            } catch (error) {\n-                feedbackMessage.textContent = `Network error: Could not connect to the server at ${API_HOST}.`;\n-                feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-                console.error(\"Submit Error:\", error);\n-            }\n-        });\n-        \n-        // Optional: Function to fetch and display the membership count\n-        async function fetchMembershipCount() {\n-             // Implementation requires a separate GET endpoint, commented out for brevity\n-             // membershipCountSpan.textContent = '50'; // Placeholder\n+        } catch (error) {\n+            // Handle Network errors (server down, CORS issue, etc.)\n+            feedbackMessage.textContent = `Network error: Could not connect to the server at ${API_HOST}.`;\n+            feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+            console.error(\"Submit Error:\", error);\n         }\n-        fetchMembershipCount(); // You can uncomment this line if you implement the backend GET route\n+    });\n+} else {\n+    console.error(\"Error: membershipForm element not found in the DOM.\");\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763747974157,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,6 @@\n+console.log(\"membership.js loaded\");\n+\n // =============================\n // CONFIG\n // =============================\n // The base URL of your backend server running Express\n"
                },
                {
                    "date": 1763748011883,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,112 +2,112 @@\n \n // =============================\n // CONFIG\n // =============================\n-// The base URL of your backend server running Express\n const API_HOST = \"http://localhost:4050\"; \n \n // DOM elements\n-// These must be defined once at the top\n const membershipForm = document.getElementById(\"membershipForm\");\n const feedbackMessage = document.getElementById(\"feedbackMessage\");\n const membershipCountSpan = document.getElementById(\"membershipCount\");\n-const yearSpan = document.getElementById(\"year\"); // Added DOM element for the year\n+const yearSpan = document.getElementById(\"year\");\n \n-// Set the current year in the footer (Moved here for better placement)\n+// Set current year in footer\n if (yearSpan) {\n     yearSpan.textContent = new Date().getFullYear();\n }\n \n // =============================\n-// FETCH & DISPLAY MEMBERSHIP COUNT (Optional but good practice)\n-// ===================================\n+// FETCH & DISPLAY MEMBERSHIP COUNT\n+// =============================\n async function fetchMembershipCount() {\n     try {\n-        // Assuming you have a GET endpoint to fetch the total count (e.g., /api/membership/count)\n-        // NOTE: If you haven't implemented this route in your backend, it will cause a network error.\n         const response = await fetch(`${API_HOST}/api/membership/count`);\n-        \n+        let data = {};\n+\n+        try {\n+            data = await response.json();\n+        } catch (err) {\n+            console.error(\"Failed to parse membership count JSON:\", err);\n+        }\n+\n         if (response.ok) {\n-            const data = await response.json();\n-            // Assuming the response JSON has a field like { totalRequests: 50 }\n             membershipCountSpan.textContent = data.totalRequests || '0';\n+        } else {\n+            membershipCountSpan.textContent = \"N/A\";\n+            console.warn(\"Membership count fetch failed:\", data);\n         }\n     } catch (error) {\n-        // console.error(\"Failed to fetch membership count:\", error);\n-        // Optionally set a friendly message if the count fails\n-        membershipCountSpan.textContent = \"N/A\"; \n+        console.error(\"Failed to fetch membership count:\", error);\n+        membershipCountSpan.textContent = \"N/A\";\n     }\n }\n \n-// Call the function on load\n-// You can uncomment this line if you have the backend endpoint ready\n-// fetchMembershipCount(); \n+// Uncomment if you have the endpoint ready\n+// fetchMembershipCount();\n \n // =============================\n // SUBMIT MEMBERSHIP REQUEST\n // =============================\n if (membershipForm) {\n     membershipForm.addEventListener(\"submit\", async (e) => {\n         e.preventDefault();\n+        console.log(\"Submit clicked\");\n \n-        // 1. Update feedback state\n+        // Update feedback\n         feedbackMessage.textContent = \"Submitting request...\";\n         feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n \n-        // 2. Serialize Form Data\n+        // Serialize form data\n         const formData = new FormData(membershipForm);\n         const data = Object.fromEntries(formData.entries());\n+        if (data.Action === \"\") data.Action = null;\n \n-        // Clean up empty 'Action' field if it's blank, so it sends 'null' if required by DB\n-        if (data.Action === \"\") {\n-            data.Action = null;\n-        }\n-        \n-        // Simple validation check for RoleName\n         if (data.RoleName === \"\" || data.RoleName === \"Select Your Role\") {\n             feedbackMessage.textContent = \"Please select a valid Role.\";\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             return;\n         }\n \n         try {\n-            // 3. Send POST Request\n+            console.log(\"Sending POST request:\", data);\n+\n             const response = await fetch(`${API_HOST}/api/membership`, {\n                 method: \"POST\",\n-                headers: {\n-                    \"Content-Type\": \"application/json\"\n-                },\n-                body: JSON.stringify(data) // Send data as JSON string\n+                headers: { \"Content-Type\": \"application/json\" },\n+                body: JSON.stringify(data)\n             });\n \n-            const result = await response.json();\n+            let result = {};\n+            try {\n+                result = await response.json();\n\\ No newline at end of file\n+            } catch (err) {\n+                console.error(\"Failed to parse JSON response:\", err);\n+                result = { message: \"Invalid server response\" };\n+            }\n \n-            // 4. Handle Server Response\n             if (!response.ok) {\n-                // Handle HTTP error codes (400, 500, etc.)\n-                const errorMessage = result.message || result.details || \"Failed to submit request.\";\n+                const errorMessage = result.message || result.details || response.statusText;\n                 feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n                 feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+                console.error(\"Server error response:\", result);\n                 return;\n             }\n \n             // Success\n+            console.log(\"Submission successful:\", result);\n             feedbackMessage.textContent = \"Membership Request Submitted Successfully! Awaiting admin approval.\";\n             feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n-\n-            // Reset the form after successful submission\n             membershipForm.reset();\n-            \n-            // Optional: Update the count after successful submission\n-            // fetchMembershipCount(); \n \n-        } catch (error) {\n-            // Handle Network errors (server down, CORS issue, etc.)\n-            feedbackMessage.textContent = `Network error: Could not connect to the server at ${API_HOST}.`;\n+            // Optional: update count\n+            // fetchMembershipCount();\n+\n+        } catch (err) {\n+            feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}.`;\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-            console.error(\"Submit Error:\", error);\n+            console.error(\"Network/Fetch error:\", err);\n         }\n     });\n } else {\n     console.error(\"Error: membershipForm element not found in the DOM.\");\n-}\n+}\n"
                },
                {
                    "date": 1763748095341,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-console.log(\"membership.js loaded\");\n+console.log(\"membership.js loaded (debug version)\");\n \n // =============================\n // CONFIG\n // =============================\n@@ -16,38 +16,39 @@\n     yearSpan.textContent = new Date().getFullYear();\n }\n \n // =============================\n-// FETCH & DISPLAY MEMBERSHIP COUNT\n+// FETCH & DISPLAY MEMBERSHIP COUNT (debug)\n // =============================\n async function fetchMembershipCount() {\n+    console.log(\"Fetching membership count...\");\n     try {\n         const response = await fetch(`${API_HOST}/api/membership/count`);\n         let data = {};\n-\n         try {\n             data = await response.json();\n+            console.log(\"Membership count response JSON:\", data);\n         } catch (err) {\n             console.error(\"Failed to parse membership count JSON:\", err);\n         }\n \n         if (response.ok) {\n             membershipCountSpan.textContent = data.totalRequests || '0';\n         } else {\n             membershipCountSpan.textContent = \"N/A\";\n-            console.warn(\"Membership count fetch failed:\", data);\n+            console.warn(\"Membership count fetch failed:\", response.status, response.statusText);\n         }\n     } catch (error) {\n-        console.error(\"Failed to fetch membership count:\", error);\n+        console.error(\"Network error while fetching membership count:\", error);\n         membershipCountSpan.textContent = \"N/A\";\n     }\n }\n \n-// Uncomment if you have the endpoint ready\n+// Uncomment to test fetch on load\n // fetchMembershipCount();\n \n // =============================\n-// SUBMIT MEMBERSHIP REQUEST\n+// SUBMIT MEMBERSHIP REQUEST (debug)\n // =============================\n if (membershipForm) {\n     membershipForm.addEventListener(\"submit\", async (e) => {\n         e.preventDefault();\n@@ -67,20 +68,23 @@\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             return;\n         }\n \n+        console.log(\"Data to be sent:\", data);\n+\n         try {\n-            console.log(\"Sending POST request:\", data);\n-\n             const response = await fetch(`${API_HOST}/api/membership`, {\n                 method: \"POST\",\n                 headers: { \"Content-Type\": \"application/json\" },\n                 body: JSON.stringify(data)\n             });\n \n+            console.log(\"Raw fetch response:\", response);\n+\n             let result = {};\n             try {\n                 result = await response.json();\n+                console.log(\"Parsed JSON response:\", result);\n             } catch (err) {\n                 console.error(\"Failed to parse JSON response:\", err);\n                 result = { message: \"Invalid server response\" };\n             }\n@@ -88,9 +92,9 @@\n             if (!response.ok) {\n                 const errorMessage = result.message || result.details || response.statusText;\n                 feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n                 feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-                console.error(\"Server error response:\", result);\n+                console.error(\"Server returned error:\", response.status, errorMessage);\n                 return;\n             }\n \n             // Success\n@@ -98,9 +102,9 @@\n             feedbackMessage.textContent = \"Membership Request Submitted Successfully! Awaiting admin approval.\";\n             feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n             membershipForm.reset();\n \n-            // Optional: update count\n+            // Optional: fetch updated membership count\n             // fetchMembershipCount();\n \n         } catch (err) {\n             feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}.`;\n@@ -109,5 +113,5 @@\n         }\n     });\n } else {\n     console.error(\"Error: membershipForm element not found in the DOM.\");\n-}\n\\ No newline at end of file\n+}\n"
                },
                {
                    "date": 1763748152333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,10 @@\n-console.log(\"membership.js loaded (debug version)\");\n+console.log(\"membership.js loaded (with mock backend)\");\n \n // =============================\n // CONFIG\n // =============================\n+const USE_MOCK_BACKEND = true; // <-- set to false to use real backend\n const API_HOST = \"http://localhost:4050\"; \n \n // DOM elements\n const membershipForm = document.getElementById(\"membershipForm\");\n@@ -11,55 +12,50 @@\n const membershipCountSpan = document.getElementById(\"membershipCount\");\n const yearSpan = document.getElementById(\"year\");\n \n // Set current year in footer\n-if (yearSpan) {\n-    yearSpan.textContent = new Date().getFullYear();\n-}\n+if (yearSpan) yearSpan.textContent = new Date().getFullYear();\n \n // =============================\n-// FETCH & DISPLAY MEMBERSHIP COUNT (debug)\n+// MOCK BACKEND (for testing)\n // =============================\n-async function fetchMembershipCount() {\n-    console.log(\"Fetching membership count...\");\n-    try {\n-        const response = await fetch(`${API_HOST}/api/membership/count`);\n-        let data = {};\n-        try {\n-            data = await response.json();\n-            console.log(\"Membership count response JSON:\", data);\n-        } catch (err) {\n-            console.error(\"Failed to parse membership count JSON:\", err);\n-        }\n+async function mockPostMembership(data) {\n+    console.log(\"Mock backend received data:\", data);\n \n-        if (response.ok) {\n-            membershipCountSpan.textContent = data.totalRequests || '0';\n-        } else {\n-            membershipCountSpan.textContent = \"N/A\";\n-            console.warn(\"Membership count fetch failed:\", response.status, response.statusText);\n-        }\n-    } catch (error) {\n-        console.error(\"Network error while fetching membership count:\", error);\n-        membershipCountSpan.textContent = \"N/A\";\n+    // Simulate network delay\n+    await new Promise(res => setTimeout(res, 800));\n+\n+    // Simple validation\n+    if (!data.ResidentName || !data.NationalID || !data.RoleName) {\n+        return {\n+            ok: false,\n+            status: 400,\n+            json: async () => ({ message: \"Missing required fields\" })\n+        };\n     }\n+\n+    // Success response\n+    return {\n+        ok: true,\n+        status: 201,\n+        json: async () => ({\n+            message: \"Membership request received (mock)\",\n+            requestId: Math.floor(Math.random() * 10000)\n+        })\n+    };\n }\n \n-// Uncomment to test fetch on load\n-// fetchMembershipCount();\n-\n // =============================\n-// SUBMIT MEMBERSHIP REQUEST (debug)\n+// SUBMIT MEMBERSHIP REQUEST\n // =============================\n if (membershipForm) {\n     membershipForm.addEventListener(\"submit\", async (e) => {\n         e.preventDefault();\n         console.log(\"Submit clicked\");\n \n-        // Update feedback\n         feedbackMessage.textContent = \"Submitting request...\";\n         feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n \n-        // Serialize form data\n         const formData = new FormData(membershipForm);\n         const data = Object.fromEntries(formData.entries());\n         if (data.Action === \"\") data.Action = null;\n \n@@ -68,45 +64,47 @@\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             return;\n         }\n \n-        console.log(\"Data to be sent:\", data);\n+        console.log(\"Data to send:\", data);\n \n         try {\n-            const response = await fetch(`${API_HOST}/api/membership`, {\n-                method: \"POST\",\n-                headers: { \"Content-Type\": \"application/json\" },\n-                body: JSON.stringify(data)\n-            });\n+            let response;\n+            if (USE_MOCK_BACKEND) {\n+                // Use mock backend\n+                response = await mockPostMembership(data);\n+            } else {\n+                // Use real backend\n+                response = await fetch(`${API_HOST}/api/membership`, {\n+                    method: \"POST\",\n+                    headers: { \"Content-Type\": \"application/json\" },\n+                    body: JSON.stringify(data)\n+                });\n+            }\n \n-            console.log(\"Raw fetch response:\", response);\n-\n             let result = {};\n             try {\n                 result = await response.json();\n-                console.log(\"Parsed JSON response:\", result);\n+                console.log(\"Server response:\", result);\n             } catch (err) {\n                 console.error(\"Failed to parse JSON response:\", err);\n                 result = { message: \"Invalid server response\" };\n             }\n \n             if (!response.ok) {\n-                const errorMessage = result.message || result.details || response.statusText;\n+                const errorMessage = result.message || response.statusText;\n                 feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n                 feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n                 console.error(\"Server returned error:\", response.status, errorMessage);\n                 return;\n             }\n \n             // Success\n             console.log(\"Submission successful:\", result);\n-            feedbackMessage.textContent = \"Membership Request Submitted Successfully! Awaiting admin approval.\";\n+            feedbackMessage.textContent = `Membership Request Submitted! Request ID: ${result.requestId || \"N/A\"}`;\n             feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n             membershipForm.reset();\n \n-            // Optional: fetch updated membership count\n-            // fetchMembershipCount();\n-\n         } catch (err) {\n             feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}.`;\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             console.error(\"Network/Fetch error:\", err);\n"
                },
                {
                    "date": 1763748223335,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,37 +15,64 @@\n // Set current year in footer\n if (yearSpan) yearSpan.textContent = new Date().getFullYear();\n \n // =============================\n-// MOCK BACKEND (for testing)\n+// MOCK BACKEND DATA\n // =============================\n+let mockMembershipRequests = []; // Array to hold submitted requests\n+\n+// Mock GET /api/membership/count\n+async function mockGetMembershipCount() {\n+    await new Promise(res => setTimeout(res, 300)); // Simulate network delay\n+    return {\n+        ok: true,\n+        status: 200,\n+        json: async () => ({ totalRequests: mockMembershipRequests.length })\n+    };\n+}\n+\n+// Mock POST /api/membership\n async function mockPostMembership(data) {\n     console.log(\"Mock backend received data:\", data);\n+    await new Promise(res => setTimeout(res, 800)); // Simulate network delay\n \n-    // Simulate network delay\n-    await new Promise(res => setTimeout(res, 800));\n-\n     // Simple validation\n     if (!data.ResidentName || !data.NationalID || !data.RoleName) {\n-        return {\n-            ok: false,\n-            status: 400,\n-            json: async () => ({ message: \"Missing required fields\" })\n-        };\n+        return { ok: false, status: 400, json: async () => ({ message: \"Missing required fields\" }) };\n     }\n \n-    // Success response\n-    return {\n-        ok: true,\n-        status: 201,\n-        json: async () => ({\n-            message: \"Membership request received (mock)\",\n-            requestId: Math.floor(Math.random() * 10000)\n-        })\n-    };\n+    // Add request to mock array\n+    const requestId = Math.floor(Math.random() * 10000);\n+    mockMembershipRequests.push({ ...data, requestId });\n+\n+    return { ok: true, status: 201, json: async () => ({ message: \"Membership request received (mock)\", requestId }) };\n }\n \n // =============================\n+// FETCH & DISPLAY MEMBERSHIP COUNT\n+// =============================\n+async function fetchMembershipCount() {\n+    try {\n+        let response;\n+        if (USE_MOCK_BACKEND) {\n+            response = await mockGetMembershipCount();\n+        } else {\n+            response = await fetch(`${API_HOST}/api/membership/count`);\n+        }\n+\n+        const data = await response.json();\n+        membershipCountSpan.textContent = data.totalRequests || '0';\n+\n+    } catch (error) {\n+        membershipCountSpan.textContent = \"N/A\";\n+        console.error(\"Failed to fetch membership count:\", error);\n+    }\n+}\n+\n+// Call on load\n+fetchMembershipCount();\n+\n+// =============================\n // SUBMIT MEMBERSHIP REQUEST\n // =============================\n if (membershipForm) {\n     membershipForm.addEventListener(\"submit\", async (e) => {\n@@ -69,42 +96,35 @@\n \n         try {\n             let response;\n             if (USE_MOCK_BACKEND) {\n-                // Use mock backend\n                 response = await mockPostMembership(data);\n             } else {\n-                // Use real backend\n                 response = await fetch(`${API_HOST}/api/membership`, {\n                     method: \"POST\",\n                     headers: { \"Content-Type\": \"application/json\" },\n                     body: JSON.stringify(data)\n                 });\n             }\n \n             let result = {};\n-            try {\n-                result = await response.json();\n-                console.log(\"Server response:\", result);\n-            } catch (err) {\n-                console.error(\"Failed to parse JSON response:\", err);\n-                result = { message: \"Invalid server response\" };\n-            }\n+            try { result = await response.json(); } \n+            catch (err) { result = { message: \"Invalid server response\" }; }\n \n             if (!response.ok) {\n-                const errorMessage = result.message || response.statusText;\n-                feedbackMessage.textContent = `Submission Error: ${errorMessage}`;\n+                feedbackMessage.textContent = `Submission Error: ${result.message || \"Unknown error\"}`;\n                 feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-                console.error(\"Server returned error:\", response.status, errorMessage);\n+                console.error(\"Server error:\", response.status, result.message);\n                 return;\n             }\n \n-            // Success\n-            console.log(\"Submission successful:\", result);\n             feedbackMessage.textContent = `Membership Request Submitted! Request ID: ${result.requestId || \"N/A\"}`;\n             feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n             membershipForm.reset();\n \n+            // Update count after successful submission\n+            fetchMembershipCount();\n+\n         } catch (err) {\n             feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}.`;\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             console.error(\"Network/Fetch error:\", err);\n"
                },
                {
                    "date": 1763753033403,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,10 @@\n-console.log(\"membership.js loaded (with mock backend)\");\n+console.log(\"membership.js loaded (DEBUG mode)\");\n \n // =============================\n // CONFIG\n // =============================\n-const USE_MOCK_BACKEND = true; // <-- set to false to use real backend\n+const USE_MOCK_BACKEND = true; // <-- set false to use real backend\n const API_HOST = \"http://localhost:4050\"; \n \n // DOM elements\n const membershipForm = document.getElementById(\"membershipForm\");\n@@ -17,33 +17,32 @@\n \n // =============================\n // MOCK BACKEND DATA\n // =============================\n-let mockMembershipRequests = []; // Array to hold submitted requests\n+let mockMembershipRequests = [];\n \n-// Mock GET /api/membership/count\n async function mockGetMembershipCount() {\n-    await new Promise(res => setTimeout(res, 300)); // Simulate network delay\n+    console.log(\"[DEBUG] mockGetMembershipCount called\");\n+    await new Promise(res => setTimeout(res, 300));\n     return {\n         ok: true,\n         status: 200,\n         json: async () => ({ totalRequests: mockMembershipRequests.length })\n     };\n }\n \n-// Mock POST /api/membership\n async function mockPostMembership(data) {\n-    console.log(\"Mock backend received data:\", data);\n-    await new Promise(res => setTimeout(res, 800)); // Simulate network delay\n+    console.log(\"[DEBUG] mockPostMembership called with:\", data);\n+    await new Promise(res => setTimeout(res, 800));\n \n-    // Simple validation\n     if (!data.ResidentName || !data.NationalID || !data.RoleName) {\n+        console.warn(\"[DEBUG] Missing required fields in mockPostMembership\");\n         return { ok: false, status: 400, json: async () => ({ message: \"Missing required fields\" }) };\n     }\n \n-    // Add request to mock array\n     const requestId = Math.floor(Math.random() * 10000);\n     mockMembershipRequests.push({ ...data, requestId });\n+    console.log(\"[DEBUG] Request added to mockMembershipRequests:\", mockMembershipRequests);\n \n     return { ok: true, status: 201, json: async () => ({ message: \"Membership request received (mock)\", requestId }) };\n }\n \n@@ -51,21 +50,26 @@\n // FETCH & DISPLAY MEMBERSHIP COUNT\n // =============================\n async function fetchMembershipCount() {\n     try {\n+        console.log(\"[DEBUG] fetchMembershipCount called\");\n         let response;\n+\n         if (USE_MOCK_BACKEND) {\n             response = await mockGetMembershipCount();\n         } else {\n+            console.log(\"[DEBUG] Fetching real backend membership count\");\n             response = await fetch(`${API_HOST}/api/membership/count`);\n         }\n \n+        console.log(\"[DEBUG] Response received:\", response);\n         const data = await response.json();\n+        console.log(\"[DEBUG] Count data:\", data);\n+\n         membershipCountSpan.textContent = data.totalRequests || '0';\n-\n     } catch (error) {\n+        console.error(\"[DEBUG] Failed to fetch membership count:\", error);\n         membershipCountSpan.textContent = \"N/A\";\n-        console.error(\"Failed to fetch membership count:\", error);\n     }\n }\n \n // Call on load\n@@ -76,45 +80,53 @@\n // =============================\n if (membershipForm) {\n     membershipForm.addEventListener(\"submit\", async (e) => {\n         e.preventDefault();\n-        console.log(\"Submit clicked\");\n+        console.log(\"[DEBUG] Form submit clicked\");\n \n         feedbackMessage.textContent = \"Submitting request...\";\n         feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n \n         const formData = new FormData(membershipForm);\n         const data = Object.fromEntries(formData.entries());\n         if (data.Action === \"\") data.Action = null;\n \n+        console.log(\"[DEBUG] Form data serialized:\", data);\n+\n         if (data.RoleName === \"\" || data.RoleName === \"Select Your Role\") {\n             feedbackMessage.textContent = \"Please select a valid Role.\";\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+            console.warn(\"[DEBUG] Invalid RoleName selected\");\n             return;\n         }\n \n-        console.log(\"Data to send:\", data);\n-\n         try {\n             let response;\n             if (USE_MOCK_BACKEND) {\n                 response = await mockPostMembership(data);\n             } else {\n+                console.log(\"[DEBUG] Sending POST to real backend:\", data);\n                 response = await fetch(`${API_HOST}/api/membership`, {\n                     method: \"POST\",\n                     headers: { \"Content-Type\": \"application/json\" },\n                     body: JSON.stringify(data)\n                 });\n             }\n \n+            console.log(\"[DEBUG] Response received:\", response);\n             let result = {};\n-            try { result = await response.json(); } \n-            catch (err) { result = { message: \"Invalid server response\" }; }\n+            try {\n+                result = await response.json();\n+                console.log(\"[DEBUG] Response JSON:\", result);\n+            } catch (err) {\n+                console.warn(\"[DEBUG] Failed to parse response JSON:\", err);\n+                result = { message: \"Invalid server response\" };\n+            }\n \n             if (!response.ok) {\n                 feedbackMessage.textContent = `Submission Error: ${result.message || \"Unknown error\"}`;\n                 feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-                console.error(\"Server error:\", response.status, result.message);\n+                console.error(\"[DEBUG] Server error:\", response.status, result.message);\n                 return;\n             }\n \n             feedbackMessage.textContent = `Membership Request Submitted! Request ID: ${result.requestId || \"N/A\"}`;\n@@ -126,10 +138,10 @@\n \n         } catch (err) {\n             feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}.`;\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-            console.error(\"Network/Fetch error:\", err);\n+            console.error(\"[DEBUG] Network/Fetch error:\", err);\n         }\n     });\n } else {\n-    console.error(\"Error: membershipForm element not found in the DOM.\");\n+    console.error(\"[DEBUG] membershipForm element not found in the DOM.\");\n }\n"
                },
                {
                    "date": 1763757584091,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,10 @@\n-console.log(\"membership.js loaded (DEBUG mode)\");\n+console.log(\"membership.js loaded (PRODUCTION mode)\");\n \n // =============================\n // CONFIG\n // =============================\n-const USE_MOCK_BACKEND = true; // <-- set false to use real backend\n+const USE_MOCK_BACKEND = false; // <-- Changed to FALSE to use the real backend\n const API_HOST = \"http://localhost:4050\"; \n \n // DOM elements\n const membershipForm = document.getElementById(\"membershipForm\");\n@@ -15,59 +15,37 @@\n // Set current year in footer\n if (yearSpan) yearSpan.textContent = new Date().getFullYear();\n \n // =============================\n-// MOCK BACKEND DATA\n+// FETCH & DISPLAY MEMBERSHIP COUNT\n // =============================\n-let mockMembershipRequests = [];\n-\n-async function mockGetMembershipCount() {\n-    console.log(\"[DEBUG] mockGetMembershipCount called\");\n-    await new Promise(res => setTimeout(res, 300));\n-    return {\n-        ok: true,\n-        status: 200,\n-        json: async () => ({ totalRequests: mockMembershipRequests.length })\n-    };\n-}\n-\n-async function mockPostMembership(data) {\n-    console.log(\"[DEBUG] mockPostMembership called with:\", data);\n-    await new Promise(res => setTimeout(res, 800));\n-\n-    if (!data.ResidentName || !data.NationalID || !data.RoleName) {\n-        console.warn(\"[DEBUG] Missing required fields in mockPostMembership\");\n-        return { ok: false, status: 400, json: async () => ({ message: \"Missing required fields\" }) };\n+async function fetchMembershipCount() {\n+    if (!membershipCountSpan) {\n+        console.warn(\"[DEBUG] membershipCountSpan element not found.\");\n+        return;\n     }\n \n-    const requestId = Math.floor(Math.random() * 10000);\n-    mockMembershipRequests.push({ ...data, requestId });\n-    console.log(\"[DEBUG] Request added to mockMembershipRequests:\", mockMembershipRequests);\n-\n-    return { ok: true, status: 201, json: async () => ({ message: \"Membership request received (mock)\", requestId }) };\n-}\n-\n-// =============================\n-// FETCH & DISPLAY MEMBERSHIP COUNT\n-// =============================\n-async function fetchMembershipCount() {\n     try {\n-        console.log(\"[DEBUG] fetchMembershipCount called\");\n-        let response;\n+        console.log(\"[DEBUG] Fetching real backend membership count\");\n+        \n+        // 1. Fetch from the real API\n+        const response = await fetch(`${API_HOST}/api/membership/count`);\n \n-        if (USE_MOCK_BACKEND) {\n-            response = await mockGetMembershipCount();\n-        } else {\n-            console.log(\"[DEBUG] Fetching real backend membership count\");\n-            response = await fetch(`${API_HOST}/api/membership/count`);\n-        }\n-\n         console.log(\"[DEBUG] Response received:\", response);\n+        \n         const data = await response.json();\n         console.log(\"[DEBUG] Count data:\", data);\n \n-        membershipCountSpan.textContent = data.totalRequests || '0';\n+        if (response.ok) {\n+            // Update the span with the count from the real server\n+            membershipCountSpan.textContent = data.totalRequests != null ? data.totalRequests : '0';\n+        } else {\n+            console.error(\"[DEBUG] Server responded with error status:\", data.message);\n+            membershipCountSpan.textContent = \"Error\";\n+        }\n+        \n     } catch (error) {\n+        // This is a network/CORS error, meaning the API server isn't reachable\n         console.error(\"[DEBUG] Failed to fetch membership count:\", error);\n         membershipCountSpan.textContent = \"N/A\";\n     }\n }\n@@ -82,39 +60,45 @@\n     membershipForm.addEventListener(\"submit\", async (e) => {\n         e.preventDefault();\n         console.log(\"[DEBUG] Form submit clicked\");\n \n+        if (!feedbackMessage) {\n+            console.error(\"[DEBUG] feedbackMessage element not found in the DOM.\");\n+            return;\n+        }\n+\n+        // Set pending message\n         feedbackMessage.textContent = \"Submitting request...\";\n         feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n \n+        // Collect form data\n         const formData = new FormData(membershipForm);\n         const data = Object.fromEntries(formData.entries());\n         if (data.Action === \"\") data.Action = null;\n \n         console.log(\"[DEBUG] Form data serialized:\", data);\n \n-        if (data.RoleName === \"\" || data.RoleName === \"Select Your Role\") {\n+        // Simple client-side validation for RoleName\n+        if (!data.RoleName || data.RoleName === \"Select Your Role\") {\n             feedbackMessage.textContent = \"Please select a valid Role.\";\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             console.warn(\"[DEBUG] Invalid RoleName selected\");\n             return;\n         }\n \n         try {\n-            let response;\n-            if (USE_MOCK_BACKEND) {\n-                response = await mockPostMembership(data);\n-            } else {\n-                console.log(\"[DEBUG] Sending POST to real backend:\", data);\n-                response = await fetch(`${API_HOST}/api/membership`, {\n-                    method: \"POST\",\n-                    headers: { \"Content-Type\": \"application/json\" },\n-                    body: JSON.stringify(data)\n-                });\n-            }\n+            console.log(\"[DEBUG] Sending POST to real backend:\", data);\n+            \n+            // 2. Post to the real API\n+            const response = await fetch(`${API_HOST}/api/membership`, {\n+                method: \"POST\",\n+                headers: { \"Content-Type\": \"application/json\" },\n+                body: JSON.stringify(data)\n+            });\n \n             console.log(\"[DEBUG] Response received:\", response);\n             let result = {};\n+            \n             try {\n                 result = await response.json();\n                 console.log(\"[DEBUG] Response JSON:\", result);\n             } catch (err) {\n@@ -128,20 +112,21 @@\n                 console.error(\"[DEBUG] Server error:\", response.status, result.message);\n                 return;\n             }\n \n+            // Success\n             feedbackMessage.textContent = `Membership Request Submitted! Request ID: ${result.requestId || \"N/A\"}`;\n             feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n             membershipForm.reset();\n \n             // Update count after successful submission\n             fetchMembershipCount();\n \n         } catch (err) {\n-            feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}.`;\n+            feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}. Ensure your backend server is running.`;\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             console.error(\"[DEBUG] Network/Fetch error:\", err);\n         }\n     });\n } else {\n     console.error(\"[DEBUG] membershipForm element not found in the DOM.\");\n-}\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763760111614,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -60,10 +60,15 @@\n     membershipForm.addEventListener(\"submit\", async (e) => {\n         e.preventDefault();\n         console.log(\"[DEBUG] Form submit clicked\");\n \n+        // Disable button during processing\n+        const submitButton = membershipForm.querySelector('button[type=\"submit\"]');\n+        submitButton.disabled = true;\n+\n         if (!feedbackMessage) {\n             console.error(\"[DEBUG] feedbackMessage element not found in the DOM.\");\n+            submitButton.disabled = false;\n             return;\n         }\n \n         // Set pending message\n@@ -72,17 +77,21 @@\n \n         // Collect form data\n         const formData = new FormData(membershipForm);\n         const data = Object.fromEntries(formData.entries());\n+        \n+        // If Action is an empty string, set it to null for the SQL INSERT query\n         if (data.Action === \"\") data.Action = null;\n \n         console.log(\"[DEBUG] Form data serialized:\", data);\n \n         // Simple client-side validation for RoleName\n-        if (!data.RoleName || data.RoleName === \"Select Your Role\") {\n+        // The HTML value is an empty string ('') when \"Select Your Role\" is chosen.\n+        if (!data.RoleName || data.RoleName === \"\") { // 👈 AMENDMENT HERE\n             feedbackMessage.textContent = \"Please select a valid Role.\";\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             console.warn(\"[DEBUG] Invalid RoleName selected\");\n+            submitButton.disabled = false; // Re-enable button on validation failure\n             return;\n         }\n \n         try {\n@@ -101,10 +110,10 @@\n             try {\n                 result = await response.json();\n                 console.log(\"[DEBUG] Response JSON:\", result);\n             } catch (err) {\n-                console.warn(\"[DEBUG] Failed to parse response JSON:\", err);\n-                result = { message: \"Invalid server response\" };\n+                console.warn(\"[DEBUG] Failed to parse response JSON. Response status:\", response.status);\n+                result = { message: \"Invalid server response structure.\" };\n             }\n \n             if (!response.ok) {\n                 feedbackMessage.textContent = `Submission Error: ${result.message || \"Unknown error\"}`;\n@@ -124,8 +133,10 @@\n         } catch (err) {\n             feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}. Ensure your backend server is running.`;\n             feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n             console.error(\"[DEBUG] Network/Fetch error:\", err);\n+        } finally {\n+            submitButton.disabled = false; // Always re-enable button at the end\n         }\n     });\n } else {\n     console.error(\"[DEBUG] membershipForm element not found in the DOM.\");\n"
                },
                {
                    "date": 1763776790753,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n \n // =============================\n // CONFIG\n // =============================\n-const USE_MOCK_BACKEND = false; // <-- Changed to FALSE to use the real backend\n+const USE_MOCK_BACKEND = false; \n const API_HOST = \"http://localhost:4050\"; \n \n // DOM elements\n const membershipForm = document.getElementById(\"membershipForm\");\n@@ -15,38 +15,60 @@\n // Set current year in footer\n if (yearSpan) yearSpan.textContent = new Date().getFullYear();\n \n // =============================\n+// UI HELPER FUNCTIONS 🎨\n+// =============================\n+\n+/**\n+ * Updates the UI with a styled message.\n+ * @param {string} message - The text content to display.\n+ * @param {boolean} isSuccess - True for success (green), false for error (red).\n+ * @param {boolean} isPending - True for pending (blue).\n+ */\n+function updateFeedback(message, isSuccess, isPending = false) {\n+    if (feedbackMessage) {\n+        feedbackMessage.textContent = message;\n+        feedbackMessage.classList.remove(\"text-red-600\", \"text-green-600\", \"text-blue-600\");\n+        \n+        if (isPending) {\n+            feedbackMessage.classList.add(\"text-blue-600\");\n+        } else if (isSuccess) {\n+            feedbackMessage.classList.add(\"text-green-600\");\n+        } else {\n+            feedbackMessage.classList.add(\"text-red-600\");\n+        }\n+        feedbackMessage.classList.add(\"text-sm\", \"font-medium\");\n+    }\n+}\n+\n+/** Manages the submit button state. */\n+function setButtonState(disabled) {\n+    const submitButton = membershipForm.querySelector('button[type=\"submit\"]');\n+    if (submitButton) {\n+        submitButton.disabled = disabled;\n+        submitButton.textContent = disabled ? \"Processing...\" : \"Submit Request\";\n+    }\n+}\n+\n+// =============================\n // FETCH & DISPLAY MEMBERSHIP COUNT\n // =============================\n async function fetchMembershipCount() {\n-    if (!membershipCountSpan) {\n-        console.warn(\"[DEBUG] membershipCountSpan element not found.\");\n-        return;\n-    }\n+    if (!membershipCountSpan) return;\n \n     try {\n-        console.log(\"[DEBUG] Fetching real backend membership count\");\n-        \n-        // 1. Fetch from the real API\n+        // ... (existing count logic)\n         const response = await fetch(`${API_HOST}/api/membership/count`);\n-\n-        console.log(\"[DEBUG] Response received:\", response);\n-        \n         const data = await response.json();\n-        console.log(\"[DEBUG] Count data:\", data);\n \n         if (response.ok) {\n-            // Update the span with the count from the real server\n             membershipCountSpan.textContent = data.totalRequests != null ? data.totalRequests : '0';\n         } else {\n-            console.error(\"[DEBUG] Server responded with error status:\", data.message);\n             membershipCountSpan.textContent = \"Error\";\n         }\n         \n     } catch (error) {\n-        // This is a network/CORS error, meaning the API server isn't reachable\n-        console.error(\"[DEBUG] Failed to fetch membership count:\", error);\n         membershipCountSpan.textContent = \"N/A\";\n     }\n }\n \n@@ -60,83 +82,73 @@\n     membershipForm.addEventListener(\"submit\", async (e) => {\n         e.preventDefault();\n         console.log(\"[DEBUG] Form submit clicked\");\n \n-        // Disable button during processing\n-        const submitButton = membershipForm.querySelector('button[type=\"submit\"]');\n-        submitButton.disabled = true;\n-\n         if (!feedbackMessage) {\n             console.error(\"[DEBUG] feedbackMessage element not found in the DOM.\");\n-            submitButton.disabled = false;\n             return;\n         }\n+        \n+        // 1. Initial UI Setup\n+        setButtonState(true);\n+        updateFeedback(\"Submitting request to backend...\", false, true); // Set pending message (blue)\n \n-        // Set pending message\n-        feedbackMessage.textContent = \"Submitting request...\";\n-        feedbackMessage.className = \"text-blue-600 text-sm font-medium\";\n-\n-        // Collect form data\n+        // 2. Collect and process data\n         const formData = new FormData(membershipForm);\n         const data = Object.fromEntries(formData.entries());\n-        \n-        // If Action is an empty string, set it to null for the SQL INSERT query\n         if (data.Action === \"\") data.Action = null;\n \n-        console.log(\"[DEBUG] Form data serialized:\", data);\n-\n-        // Simple client-side validation for RoleName\n-        // The HTML value is an empty string ('') when \"Select Your Role\" is chosen.\n-        if (!data.RoleName || data.RoleName === \"\") { // 👈 AMENDMENT HERE\n-            feedbackMessage.textContent = \"Please select a valid Role.\";\n-            feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-            console.warn(\"[DEBUG] Invalid RoleName selected\");\n-            submitButton.disabled = false; // Re-enable button on validation failure\n+        // 3. Client-side Validation (RoleName)\n+        if (!data.RoleName || data.RoleName === \"\") { \n+            updateFeedback(\"❌ Submission Failed: Please select a valid Role.\", false);\n+            setButtonState(false);\n             return;\n         }\n \n         try {\n-            console.log(\"[DEBUG] Sending POST to real backend:\", data);\n+            console.log(`[DEBUG] Sending POST to ${API_HOST}/api/membership`);\n             \n-            // 2. Post to the real API\n+            // 4. Send Request\n             const response = await fetch(`${API_HOST}/api/membership`, {\n                 method: \"POST\",\n                 headers: { \"Content-Type\": \"application/json\" },\n                 body: JSON.stringify(data)\n             });\n \n-            console.log(\"[DEBUG] Response received:\", response);\n+            console.log(`[DEBUG] Response received: Status ${response.status}`);\n             let result = {};\n             \n             try {\n                 result = await response.json();\n-                console.log(\"[DEBUG] Response JSON:\", result);\n             } catch (err) {\n-                console.warn(\"[DEBUG] Failed to parse response JSON. Response status:\", response.status);\n-                result = { message: \"Invalid server response structure.\" };\n+                // If the server returns a non-JSON response (e.g., HTML error), handle it gracefully\n+                console.warn(\"[DEBUG] Failed to parse response JSON.\", err);\n+                result = { message: \"Server returned an unreadable response.\" };\n             }\n \n-            if (!response.ok) {\n-                feedbackMessage.textContent = `Submission Error: ${result.message || \"Unknown error\"}`;\n-                feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n-                console.error(\"[DEBUG] Server error:\", response.status, result.message);\n-                return;\n+            if (response.ok) {\n+                // 5a. Success (HTTP 200-299)\n+                updateFeedback(`✅ Success! Membership request has been **RECEIVED** by the backend. Request ID: ${result.requestId || \"N/A\"}`, true);\n+                membershipForm.reset();\n+                fetchMembershipCount();\n+            } else {\n+                // 5b. Server Error (HTTP 4xx/5xx - Backend received it, but rejected it)\n+                const errorMessage = result.message || `Server Error (${response.status}): Request received but rejected by the backend.`;\n+                updateFeedback(`❌ Submission Failed: ${errorMessage}`, false);\n             }\n \n-            // Success\n-            feedbackMessage.textContent = `Membership Request Submitted! Request ID: ${result.requestId || \"N/A\"}`;\n-            feedbackMessage.className = \"text-green-600 text-sm font-medium\";\n-            membershipForm.reset();\n-\n-            // Update count after successful submission\n-            fetchMembershipCount();\n-\n         } catch (err) {\n-            feedbackMessage.textContent = `Network error: Could not connect to server at ${API_HOST}. Ensure your backend server is running.`;\n-            feedbackMessage.className = \"text-red-600 text-sm font-medium\";\n+            // 5c. Network Error (Request did not reach the backend)\n             console.error(\"[DEBUG] Network/Fetch error:\", err);\n+            updateFeedback(\n+                `🛑 **CONNECTION FAILURE** 🛑: Request did not reach ${API_HOST}. \n+                Check 1: Is your backend server running? \n+                Check 2: Is your backend configured for CORS (Cross-Origin Resource Sharing)?`, \n+                false\n+            );\n         } finally {\n-            submitButton.disabled = false; // Always re-enable button at the end\n+            // 6. Final Cleanup\n+            setButtonState(false); // Always re-enable button\n         }\n     });\n } else {\n     console.error(\"[DEBUG] membershipForm element not found in the DOM.\");\n"
                },
                {
                    "date": 1763787633948,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -151,5 +151,81 @@\n         }\n     });\n } else {\n     console.error(\"[DEBUG] membershipForm element not found in the DOM.\");\n-}\n\\ No newline at end of file\n+}\n+const pendingTableBody = document.getElementById(\"pendingTableBody\"); // <tbody> in HTML\n+const pendingCount = document.getElementById(\"pendingCount\"); // optional badge\n+\n+async function loadPendingRequests() {\n+  try {\n+    const res = await fetch(`${API_HOST}/api/admin/residents/pending`, {\n+      headers: { Authorization: `Bearer ${token}` },\n+    });\n+\n+    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);\n+\n+    const pendingRequests = await res.json();\n+\n+    renderPendingTable(pendingRequests);\n+    pendingCount.textContent = pendingRequests.length;\n+  } catch (err) {\n+    console.error(\"Error loading pending requests:\", err);\n+    pendingTableBody.innerHTML = `<tr><td colspan=\"10\" class=\"text-center text-red-600\">Failed to load pending requests</td></tr>`;\n+  }\n+}\n+\n+function renderPendingTable(data) {\n+  pendingTableBody.innerHTML = \"\";\n+\n+  data.forEach((item) => {\n+    const row = document.createElement(\"tr\");\n+    row.classList.add(\"border-b\");\n+\n+    row.innerHTML = `\n+      <td class=\"px-4 py-2\">${item.RequestID}</td>\n+      <td class=\"px-4 py-2\">${item.ResidentName}</td>\n+      <td class=\"px-4 py-2\">${item.NationalID}</td>\n+      <td class=\"px-4 py-2\">${item.PhoneNumber}</td>\n+      <td class=\"px-4 py-2\">${item.Email}</td>\n+      <td class=\"px-4 py-2\">${item.HouseNumber}</td>\n+      <td class=\"px-4 py-2\">${item.CourtName}</td>\n+      <td class=\"px-4 py-2\">${item.RoleName}</td>\n+      <td class=\"px-4 py-2\">${item.Status}</td>\n+      <td class=\"px-4 py-2\">${item.RequestedAt ? new Date(item.RequestedAt).toLocaleString() : \"-\"}</td>\n+      <td class=\"px-4 py-2 text-center\">\n+        <button class=\"bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700\" onclick=\"approveRequest(${item.RequestID})\">\n+          Approve\n+        </button>\n+      </td>\n+    `;\n+\n+    pendingTableBody.appendChild(row);\n+  });\n+}\n+\n+// Optional: approve request action\n+async function approveRequest(requestId) {\n+  if (!confirm(\"Approve this membership request?\")) return;\n+\n+  try {\n+    const res = await fetch(`${API_HOST}/api/admin/residents/approve/${requestId}`, {\n+      method: \"PUT\",\n+      headers: { Authorization: `Bearer ${token}` },\n+    });\n+\n+    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);\n+\n+    alert(\"Request approved!\");\n+    loadPendingRequests();\n+    loadMembershipRecords(); // refresh main table\n+  } catch (err) {\n+    console.error(\"Error approving request:\", err);\n+    alert(\"Failed to approve request\");\n+  }\n+}\n+\n+// Initial load\n+window.addEventListener(\"DOMContentLoaded\", () => {\n+  loadMembershipRecords(); // existing memberships\n+  loadPendingRequests();   // new pending requests\n+});\n"
                },
                {
                    "date": 1763788466540,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,80 +152,4 @@\n     });\n } else {\n     console.error(\"[DEBUG] membershipForm element not found in the DOM.\");\n }\n-const pendingTableBody = document.getElementById(\"pendingTableBody\"); // <tbody> in HTML\n-const pendingCount = document.getElementById(\"pendingCount\"); // optional badge\n-\n-async function loadPendingRequests() {\n-  try {\n-    const res = await fetch(`${API_HOST}/api/admin/residents/pending`, {\n-      headers: { Authorization: `Bearer ${token}` },\n-    });\n-\n-    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);\n-\n-    const pendingRequests = await res.json();\n-\n-    renderPendingTable(pendingRequests);\n-    pendingCount.textContent = pendingRequests.length;\n-  } catch (err) {\n-    console.error(\"Error loading pending requests:\", err);\n-    pendingTableBody.innerHTML = `<tr><td colspan=\"10\" class=\"text-center text-red-600\">Failed to load pending requests</td></tr>`;\n-  }\n-}\n-\n-function renderPendingTable(data) {\n-  pendingTableBody.innerHTML = \"\";\n-\n-  data.forEach((item) => {\n-    const row = document.createElement(\"tr\");\n-    row.classList.add(\"border-b\");\n-\n-    row.innerHTML = `\n-      <td class=\"px-4 py-2\">${item.RequestID}</td>\n-      <td class=\"px-4 py-2\">${item.ResidentName}</td>\n-      <td class=\"px-4 py-2\">${item.NationalID}</td>\n-      <td class=\"px-4 py-2\">${item.PhoneNumber}</td>\n-      <td class=\"px-4 py-2\">${item.Email}</td>\n-      <td class=\"px-4 py-2\">${item.HouseNumber}</td>\n-      <td class=\"px-4 py-2\">${item.CourtName}</td>\n-      <td class=\"px-4 py-2\">${item.RoleName}</td>\n-      <td class=\"px-4 py-2\">${item.Status}</td>\n-      <td class=\"px-4 py-2\">${item.RequestedAt ? new Date(item.RequestedAt).toLocaleString() : \"-\"}</td>\n-      <td class=\"px-4 py-2 text-center\">\n-        <button class=\"bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700\" onclick=\"approveRequest(${item.RequestID})\">\n-          Approve\n-        </button>\n-      </td>\n-    `;\n-\n-    pendingTableBody.appendChild(row);\n-  });\n-}\n-\n-// Optional: approve request action\n-async function approveRequest(requestId) {\n-  if (!confirm(\"Approve this membership request?\")) return;\n-\n-  try {\n-    const res = await fetch(`${API_HOST}/api/admin/residents/approve/${requestId}`, {\n-      method: \"PUT\",\n-      headers: { Authorization: `Bearer ${token}` },\n-    });\n-\n-    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);\n-\n-    alert(\"Request approved!\");\n-    loadPendingRequests();\n-    loadMembershipRecords(); // refresh main table\n-  } catch (err) {\n-    console.error(\"Error approving request:\", err);\n-    alert(\"Failed to approve request\");\n-  }\n-}\n-\n-// Initial load\n-window.addEventListener(\"DOMContentLoaded\", () => {\n-  loadMembershipRecords(); // existing memberships\n-  loadPendingRequests();   // new pending requests\n-});\n"
                },
                {
                    "date": 1763788839636,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,4 +152,40 @@\n     });\n } else {\n     console.error(\"[DEBUG] membershipForm element not found in the DOM.\");\n }\n+const submitBtn = document.getElementById(\"submitMembershipBtn\");\n+const form = document.getElementById(\"membershipForm\");\n+\n+form.addEventListener(\"submit\", async (e) => {\n+  e.preventDefault();\n+\n+  const data = {\n+    ResidentName: form.ResidentName.value,\n+    NationalID: form.NationalID.value,\n+    PhoneNumber: form.PhoneNumber.value,\n+    Email: form.Email.value,\n+    HouseNumber: form.HouseNumber.value,\n+    CourtName: form.CourtName.value,\n+    RoleName: form.RoleName.value\n+  };\n+\n+  try {\n+    const res = await fetch(\"http://localhost:4050/api/memberships/request\", {\n+      method: \"POST\",\n+      headers: {\n+        \"Content-Type\": \"application/json\"\n+      },\n+      body: JSON.stringify(data)\n+    });\n+\n+    const result = await res.json();\n+\n+    if (!res.ok) throw new Error(result.message);\n+\n+    alert(\"Membership request submitted successfully!\");\n+    form.reset();\n+  } catch (err) {\n+    console.error(err);\n+    alert(\"Failed to submit membership request: \" + err.message);\n+  }\n+});\n\\ No newline at end of file\n"
                }
            ],
            "date": 1763700239143,
            "name": "Commit-0",
            "content": "document.addEventListener(\"DOMContentLoaded\", () => {\n  const form = document.getElementById(\"membershipForm\");\n  const feedbackMessage = document.getElementById(\"feedbackMessage\");\n  const membershipTableBody = document.getElementById(\"membershipTableBody\");\n  const membershipCount = document.getElementById(\"membershipCount\");\n\n  // Fetch and display membership requests\n  async function loadMembershipRequests() {\n    try {\n      const response = await fetch(\"/api/memberships/records\");\n      if (!response.ok) throw new Error(\"Failed to fetch membership records\");\n\n      const data = await response.json();\n      membershipTableBody.innerHTML = \"\";\n      data.forEach((item) => {\n        const row = document.createElement(\"tr\");\n        row.innerHTML = `\n          <td class=\"border px-2 py-1\">${item.RequestID}</td>\n          <td class=\"border px-2 py-1\">${item.ResidentName}</td>\n          <td class=\"border px-2 py-1\">${item.NationalID}</td>\n          <td class=\"border px-2 py-1\">${item.PhoneNumber}</td>\n          <td class=\"border px-2 py-1\">${item.Email}</td>\n          <td class=\"border px-2 py-1\">${item.HouseNumber}</td>\n          <td class=\"border px-2 py-1\">${item.CourtName}</td>\n          <td class=\"border px-2 py-1\">${item.Status}</td>\n          <td class=\"border px-2 py-1\">${new Date(item.RequestedAt).toLocaleString()}</td>\n          <td class=\"border px-2 py-1\">${item.RoleName}</td>\n        `;\n        membershipTableBody.appendChild(row);\n      });\n      membershipCount.textContent = data.length;\n    } catch (error) {\n      console.error(error);\n      feedbackMessage.textContent = \"Error loading membership requests.\";\n    }\n  }\n\n  // Submit membership form\n  form.addEventListener(\"submit\", async (e) => {\n    e.preventDefault();\n    const formData = Object.fromEntries(new FormData(form).entries());\n\n    try {\n      const response = await fetch(\"/api/memberships/records\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(formData),\n      });\n\n      if (!response.ok) throw new Error(\"Failed to submit membership request\");\n      feedbackMessage.textContent = \"Request submitted successfully!\";\n      form.reset();\n      loadMembershipRequests(); // Refresh table\n    } catch (error) {\n      console.error(error);\n      feedbackMessage.textContent = \"Error submitting request.\";\n    }\n  });\n\n  loadMembershipRequests();\n});\n"
        }
    ]
}