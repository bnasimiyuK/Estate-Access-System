{
    "sourceFile": "backend/controllers/dashboardController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1763698079269,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763698104263,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,9 @@\n // ==========================================\r\n \r\n import sql from \"mssql\";\r\n import dotenv from \"dotenv\";\r\n+import { getDashboardSummary, getAccessChartData } from \"../controllers/residentsController.js\";\r\n dotenv.config();\r\n \r\n // ==========================================\r\n // Database Configuration\r\n"
                },
                {
                    "date": 1763698117752,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n // ==========================================\r\n \r\n import sql from \"mssql\";\r\n import dotenv from \"dotenv\";\r\n-import { getDashboardSummary, getAccessChartData } from \"../controllers/residentsController.js\";\r\n+\r\n dotenv.config();\r\n \r\n // ==========================================\r\n // Database Configuration\r\n"
                },
                {
                    "date": 1763698125738,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n // ==========================================\r\n \r\n import sql from \"mssql\";\r\n import dotenv from \"dotenv\";\r\n-\r\n+import { getDashboardSummary, getAccessChartData } from \"../controllers/residentsController.js\";\r\n dotenv.config();\r\n \r\n // ==========================================\r\n // Database Configuration\r\n"
                },
                {
                    "date": 1763698234650,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,9 @@\n \r\n import sql from \"mssql\";\r\n import dotenv from \"dotenv\";\r\n import { getDashboardSummary, getAccessChartData } from \"../controllers/residentsController.js\";\r\n+import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\r\n dotenv.config();\r\n \r\n // ==========================================\r\n // Database Configuration\r\n@@ -150,4 +151,6 @@\n         console.error(\"❌ getMembershipStatusStats Error:\", err);\r\n         res.status(500).json({ success: false, message: \"Failed to load membership status stats\" });\r\n     }\r\n };\r\n+router.get(\"/summary\", authenticateJWT, isAdmin, getDashboardSummary);\r\n+router.get(\"/accesschart\", authenticateJWT, isAdmin, getAccessChartData);\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763698313590,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,34 +1,21 @@\n-// ==========================================\r\n-// controllers/dashboardController.js\r\n-// Admin Dashboard: Summaries & Analytics\r\n-// ==========================================\r\n-\r\n+// dashboardController.js\r\n import sql from \"mssql\";\r\n import dotenv from \"dotenv\";\r\n-import { getDashboardSummary, getAccessChartData } from \"../controllers/residentsController.js\";\r\n-import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\r\n dotenv.config();\r\n \r\n-// ==========================================\r\n-// Database Configuration\r\n-// ==========================================\r\n const dbConfig = {\r\n     user: process.env.DB_USER || \"Beverly\",\r\n     password: process.env.DB_PASS || \"Bev@1234567\",\r\n     server: process.env.DB_SERVER || \"localhost\",\r\n     database: process.env.DB_NAME || \"EstateAccessManagementSystem\",\r\n     options: { encrypt: true, trustServerCertificate: true },\r\n };\r\n \r\n-// ====================================================\r\n-// Get dashboard summary stats\r\n-// ====================================================\r\n+// Dashboard summary\r\n export const getDashboardSummary = async (req, res) => {\r\n     try {\r\n         const pool = await sql.connect(dbConfig);\r\n-\r\n-        // Query for totals\r\n         const result = await pool.request().query(`\r\n             SELECT\r\n                 (SELECT COUNT(*) FROM Residents) AS totalResidents,\r\n                 (SELECT COUNT(*) FROM Visitors) AS totalVisitors,\r\n@@ -36,121 +23,27 @@\n                 (SELECT COUNT(*) FROM MembershipRecords) AS totalMemberships,\r\n                 (SELECT COUNT(*) FROM AccessLogs WHERE LogType='CheckIn' AND CAST(LogTimestamp AS DATE) = CAST(GETDATE() AS DATE)) AS visitorsCheckedInToday,\r\n                 (SELECT COUNT(*) FROM AccessLogs WHERE LogType='CheckOut' AND CAST(LogTimestamp AS DATE) = CAST(GETDATE() AS DATE)) AS visitorsCheckedOutToday\r\n         `);\r\n-\r\n         res.status(200).json({ success: true, data: result.recordset[0] });\r\n     } catch (err) {\r\n         console.error(\"❌ getDashboardSummary Error:\", err);\r\n         res.status(500).json({ success: false, message: \"Failed to load dashboard summary\" });\r\n     }\r\n };\r\n \r\n-// ====================================================\r\n-// Get monthly access logs for chart\r\n-// ====================================================\r\n-export const getMonthlyAccessStats = async (req, res) => {\r\n+// Access chart data\r\n+export const getAccessChartData = async (req, res) => {\r\n     try {\r\n         const pool = await sql.connect(dbConfig);\r\n-\r\n-        // Example: Last 6 months visitor check-ins\r\n         const result = await pool.request().query(`\r\n-            SELECT \r\n-                FORMAT(LogTimestamp, 'yyyy-MM') AS Month,\r\n-                SUM(CASE WHEN LogType='CheckIn' THEN 1 ELSE 0 END) AS CheckIns,\r\n-                SUM(CASE WHEN LogType='CheckOut' THEN 1 ELSE 0 END) AS CheckOuts\r\n+            SELECT TOP 7 CAST(LogTimestamp AS DATE) AS Date, COUNT(*) AS TotalPasses\r\n             FROM AccessLogs\r\n-            WHERE LogTimestamp >= DATEADD(MONTH, -6, GETDATE())\r\n-            GROUP BY FORMAT(LogTimestamp, 'yyyy-MM')\r\n-            ORDER BY Month ASC\r\n+            GROUP BY CAST(LogTimestamp AS DATE)\r\n+            ORDER BY Date DESC\r\n         `);\r\n-\r\n         res.status(200).json({ success: true, data: result.recordset });\r\n     } catch (err) {\r\n-        console.error(\"❌ getMonthlyAccessStats Error:\", err);\r\n-        res.status(500).json({ success: false, message: \"Failed to load monthly access stats\" });\r\n+        console.error(\"❌ getAccessChartData Error:\", err);\r\n+        res.status(500).json({ success: false, message: \"Failed to load access chart data\" });\r\n     }\r\n };\r\n-\r\n-// ====================================================\r\n-// Get recent membership requests\r\n-// ====================================================\r\n-export const getRecentMembershipRequests = async (req, res) => {\r\n-    try {\r\n-        const pool = await sql.connect(dbConfig);\r\n-\r\n-        const result = await pool.request().query(`\r\n-            SELECT TOP (10) RequestID, ResidentName, RoleName, Status, RequestedAt\r\n-            FROM MembershipRequests\r\n-            ORDER BY RequestedAt DESC\r\n-        `);\r\n-\r\n-        res.status(200).json({ success: true, data: result.recordset });\r\n-    } catch (err) {\r\n-        console.error(\"❌ getRecentMembershipRequests Error:\", err);\r\n-        res.status(500).json({ success: false, message: \"Failed to load recent membership requests\" });\r\n-    }\r\n-};\r\n-\r\n-// ====================================================\r\n-// Get recent visitor logs\r\n-// ====================================================\r\n-export const getRecentVisitorLogs = async (req, res) => {\r\n-    try {\r\n-        const pool = await sql.connect(dbConfig);\r\n-\r\n-        const result = await pool.request().query(`\r\n-            SELECT TOP (10) VisitorName, LogType, LogTimestamp, HouseNumber, CourtName\r\n-            FROM AccessLogs\r\n-            ORDER BY LogTimestamp DESC\r\n-        `);\r\n-\r\n-        res.status(200).json({ success: true, data: result.recordset });\r\n-    } catch (err) {\r\n-        console.error(\"❌ getRecentVisitorLogs Error:\", err);\r\n-        res.status(500).json({ success: false, message: \"Failed to load recent visitor logs\" });\r\n-    }\r\n-};\r\n-\r\n-// ====================================================\r\n-// Get residents statistics for charts\r\n-// ====================================================\r\n-export const getResidentsStats = async (req, res) => {\r\n-    try {\r\n-        const pool = await sql.connect(dbConfig);\r\n-\r\n-        // Example: residents per court\r\n-        const result = await pool.request().query(`\r\n-            SELECT CourtName, COUNT(*) AS ResidentCount\r\n-            FROM Residents\r\n-            GROUP BY CourtName\r\n-            ORDER BY CourtName\r\n-        `);\r\n-\r\n-        res.status(200).json({ success: true, data: result.recordset });\r\n-    } catch (err) {\r\n-        console.error(\"❌ getResidentsStats Error:\", err);\r\n-        res.status(500).json({ success: false, message: \"Failed to load residents stats\" });\r\n-    }\r\n-};\r\n-\r\n-// ====================================================\r\n-// Get membership approvals stats\r\n-// ====================================================\r\n-export const getMembershipStatusStats = async (req, res) => {\r\n-    try {\r\n-        const pool = await sql.connect(dbConfig);\r\n-\r\n-        const result = await pool.request().query(`\r\n-            SELECT Status, COUNT(*) AS Total\r\n-            FROM MembershipRequests\r\n-            GROUP BY Status\r\n-        `);\r\n-\r\n-        res.status(200).json({ success: true, data: result.recordset });\r\n\\ No newline at end of file\n-    } catch (err) {\r\n-        console.error(\"❌ getMembershipStatusStats Error:\", err);\r\n-        res.status(500).json({ success: false, message: \"Failed to load membership status stats\" });\r\n-    }\r\n-};\r\n-router.get(\"/summary\", authenticateJWT, isAdmin, getDashboardSummary);\r\n-router.get(\"/accesschart\", authenticateJWT, isAdmin, getAccessChartData);\n"
                }
            ],
            "date": 1763698079269,
            "name": "Commit-0",
            "content": "// ==========================================\r\n// controllers/dashboardController.js\r\n// Admin Dashboard: Summaries & Analytics\r\n// ==========================================\r\n\r\nimport sql from \"mssql\";\r\nimport dotenv from \"dotenv\";\r\ndotenv.config();\r\n\r\n// ==========================================\r\n// Database Configuration\r\n// ==========================================\r\nconst dbConfig = {\r\n    user: process.env.DB_USER || \"Beverly\",\r\n    password: process.env.DB_PASS || \"Bev@1234567\",\r\n    server: process.env.DB_SERVER || \"localhost\",\r\n    database: process.env.DB_NAME || \"EstateAccessManagementSystem\",\r\n    options: { encrypt: true, trustServerCertificate: true },\r\n};\r\n\r\n// ====================================================\r\n// Get dashboard summary stats\r\n// ====================================================\r\nexport const getDashboardSummary = async (req, res) => {\r\n    try {\r\n        const pool = await sql.connect(dbConfig);\r\n\r\n        // Query for totals\r\n        const result = await pool.request().query(`\r\n            SELECT\r\n                (SELECT COUNT(*) FROM Residents) AS totalResidents,\r\n                (SELECT COUNT(*) FROM Visitors) AS totalVisitors,\r\n                (SELECT COUNT(*) FROM MembershipRequests WHERE Status = 'Pending') AS pendingMemberships,\r\n                (SELECT COUNT(*) FROM MembershipRecords) AS totalMemberships,\r\n                (SELECT COUNT(*) FROM AccessLogs WHERE LogType='CheckIn' AND CAST(LogTimestamp AS DATE) = CAST(GETDATE() AS DATE)) AS visitorsCheckedInToday,\r\n                (SELECT COUNT(*) FROM AccessLogs WHERE LogType='CheckOut' AND CAST(LogTimestamp AS DATE) = CAST(GETDATE() AS DATE)) AS visitorsCheckedOutToday\r\n        `);\r\n\r\n        res.status(200).json({ success: true, data: result.recordset[0] });\r\n    } catch (err) {\r\n        console.error(\"❌ getDashboardSummary Error:\", err);\r\n        res.status(500).json({ success: false, message: \"Failed to load dashboard summary\" });\r\n    }\r\n};\r\n\r\n// ====================================================\r\n// Get monthly access logs for chart\r\n// ====================================================\r\nexport const getMonthlyAccessStats = async (req, res) => {\r\n    try {\r\n        const pool = await sql.connect(dbConfig);\r\n\r\n        // Example: Last 6 months visitor check-ins\r\n        const result = await pool.request().query(`\r\n            SELECT \r\n                FORMAT(LogTimestamp, 'yyyy-MM') AS Month,\r\n                SUM(CASE WHEN LogType='CheckIn' THEN 1 ELSE 0 END) AS CheckIns,\r\n                SUM(CASE WHEN LogType='CheckOut' THEN 1 ELSE 0 END) AS CheckOuts\r\n            FROM AccessLogs\r\n            WHERE LogTimestamp >= DATEADD(MONTH, -6, GETDATE())\r\n            GROUP BY FORMAT(LogTimestamp, 'yyyy-MM')\r\n            ORDER BY Month ASC\r\n        `);\r\n\r\n        res.status(200).json({ success: true, data: result.recordset });\r\n    } catch (err) {\r\n        console.error(\"❌ getMonthlyAccessStats Error:\", err);\r\n        res.status(500).json({ success: false, message: \"Failed to load monthly access stats\" });\r\n    }\r\n};\r\n\r\n// ====================================================\r\n// Get recent membership requests\r\n// ====================================================\r\nexport const getRecentMembershipRequests = async (req, res) => {\r\n    try {\r\n        const pool = await sql.connect(dbConfig);\r\n\r\n        const result = await pool.request().query(`\r\n            SELECT TOP (10) RequestID, ResidentName, RoleName, Status, RequestedAt\r\n            FROM MembershipRequests\r\n            ORDER BY RequestedAt DESC\r\n        `);\r\n\r\n        res.status(200).json({ success: true, data: result.recordset });\r\n    } catch (err) {\r\n        console.error(\"❌ getRecentMembershipRequests Error:\", err);\r\n        res.status(500).json({ success: false, message: \"Failed to load recent membership requests\" });\r\n    }\r\n};\r\n\r\n// ====================================================\r\n// Get recent visitor logs\r\n// ====================================================\r\nexport const getRecentVisitorLogs = async (req, res) => {\r\n    try {\r\n        const pool = await sql.connect(dbConfig);\r\n\r\n        const result = await pool.request().query(`\r\n            SELECT TOP (10) VisitorName, LogType, LogTimestamp, HouseNumber, CourtName\r\n            FROM AccessLogs\r\n            ORDER BY LogTimestamp DESC\r\n        `);\r\n\r\n        res.status(200).json({ success: true, data: result.recordset });\r\n    } catch (err) {\r\n        console.error(\"❌ getRecentVisitorLogs Error:\", err);\r\n        res.status(500).json({ success: false, message: \"Failed to load recent visitor logs\" });\r\n    }\r\n};\r\n\r\n// ====================================================\r\n// Get residents statistics for charts\r\n// ====================================================\r\nexport const getResidentsStats = async (req, res) => {\r\n    try {\r\n        const pool = await sql.connect(dbConfig);\r\n\r\n        // Example: residents per court\r\n        const result = await pool.request().query(`\r\n            SELECT CourtName, COUNT(*) AS ResidentCount\r\n            FROM Residents\r\n            GROUP BY CourtName\r\n            ORDER BY CourtName\r\n        `);\r\n\r\n        res.status(200).json({ success: true, data: result.recordset });\r\n    } catch (err) {\r\n        console.error(\"❌ getResidentsStats Error:\", err);\r\n        res.status(500).json({ success: false, message: \"Failed to load residents stats\" });\r\n    }\r\n};\r\n\r\n// ====================================================\r\n// Get membership approvals stats\r\n// ====================================================\r\nexport const getMembershipStatusStats = async (req, res) => {\r\n    try {\r\n        const pool = await sql.connect(dbConfig);\r\n\r\n        const result = await pool.request().query(`\r\n            SELECT Status, COUNT(*) AS Total\r\n            FROM MembershipRequests\r\n            GROUP BY Status\r\n        `);\r\n\r\n        res.status(200).json({ success: true, data: result.recordset });\r\n    } catch (err) {\r\n        console.error(\"❌ getMembershipStatusStats Error:\", err);\r\n        res.status(500).json({ success: false, message: \"Failed to load membership status stats\" });\r\n    }\r\n};\r\n"
        }
    ]
}