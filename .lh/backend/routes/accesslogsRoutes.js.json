{
    "sourceFile": "backend/routes/accesslogsRoutes.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 13,
            "patches": [
                {
                    "date": 1763846520761,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763846675243,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n // backend/routes/accessLogsRoutes.js\n import { Router } from \"express\";\n+import sql from \"mssql\";\n import { dbPool } from \"../server.js\";\n import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n \n const router = Router();\n@@ -8,31 +9,34 @@\n // GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\n router.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\n     try {\n         const { from, to } = req.query;\n-        let query = `SELECT TOP (1000)\n-            [Id],\n-            [TimestampUtc],\n-            [UserId],\n-            [Action],\n-            [Resource],\n-            [IpAddress],\n-            [UserAgent],\n-            [Referrer],\n-            [Metadata],\n-            [LogType]\n-        FROM [EstateAccessManagementSystem].[dbo].[accesslogs]`;\n-        \n+\n+        let query = `\n+            SELECT TOP (1000)\n+                [Id],\n+                [TimestampUtc],\n+                [UserId],\n+                [Action],\n+                [Resource],\n+                [IpAddress],\n+                [UserAgent],\n+                [Referrer],\n+                [Metadata],\n+                [LogType]\n+            FROM [EstateAccessManagementSystem].[dbo].[accesslogs]\n+        `;\n+\n         if (from && to) {\n             query += \" WHERE CAST(TimestampUtc AS DATE) BETWEEN @from AND @to\";\n         }\n+\n         query += \" ORDER BY TimestampUtc DESC\";\n \n-        const pool = await dbPool;\n-        const request = pool.request();\n+        const request = dbPool.request();\n         if (from && to) {\n-            request.input(\"from\", \"Date\", from);\n-            request.input(\"to\", \"Date\", to);\n+            request.input(\"from\", sql.Date, from);\n+            request.input(\"to\", sql.Date, to);\n         }\n \n         const result = await request.query(query);\n         res.json(result.recordset);\n"
                },
                {
                    "date": 1763847243782,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n // backend/routes/accessLogsRoutes.js\n import { Router } from \"express\";\n+import { dbPool } from \"../server.js\";\n import sql from \"mssql\";\n-import { dbPool } from \"../server.js\";\n import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n \n const router = Router();\n \n@@ -12,26 +12,26 @@\n         const { from, to } = req.query;\n \n         let query = `\n             SELECT TOP (1000)\n-                [Id],\n-                [TimestampUtc],\n-                [UserId],\n-                [Action],\n-                [Resource],\n-                [IpAddress],\n-                [UserAgent],\n-                [Referrer],\n-                [Metadata],\n-                [LogType]\n+                [id],\n+                [timestampUtc],\n+                [userId],\n+                [action],\n+                [resource],\n+                [ipAddress],\n+                [userAgent],\n+                [referrer],\n+                [metadata],\n+                [logType]\n             FROM [EstateAccessManagementSystem].[dbo].[accesslogs]\n         `;\n \n         if (from && to) {\n-            query += \" WHERE CAST(TimestampUtc AS DATE) BETWEEN @from AND @to\";\n+            query += \" WHERE CAST(timestampUtc AS DATE) BETWEEN @from AND @to\";\n         }\n \n-        query += \" ORDER BY TimestampUtc DESC\";\n+        query += \" ORDER BY timestampUtc DESC\";\n \n         const request = dbPool.request();\n         if (from && to) {\n             request.input(\"from\", sql.Date, from);\n@@ -39,10 +39,11 @@\n         }\n \n         const result = await request.query(query);\n         res.json(result.recordset);\n+\n     } catch (err) {\n-        console.error(\"Access logs error:\", err);\n+        console.error(\"Access logs fetch error:\", err);\n         res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\n     }\n });\n \n"
                },
                {
                    "date": 1763847320567,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-// backend/routes/accessLogsRoutes.js\n+// routes/accessLogsRoutes.js\n import { Router } from \"express\";\n import { dbPool } from \"../server.js\";\n import sql from \"mssql\";\n import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n"
                },
                {
                    "date": 1763862688510,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,58 @@\n+// routes/accessLogsRoutes.js\n+import { Router } from \"express\";\n+import { dbPool } from \"../server.js\";\n+import sql from \"mssql\";\n+import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n+// backend/routes/accessLogsRoutes.js\n+import { getAccessLogs } from \"../controllers/accessLogsController.js\";\n+\n+const router = Router();\n+\n+// GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\n+router.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\n+    try {\n+        const { from, to } = req.query;\n+\n+        let query = `\n+            SELECT TOP (1000)\n+                [id],\n+                [timestampUtc],\n+                [userId],\n+                [action],\n+                [resource],\n+                [ipAddress],\n+                [userAgent],\n+                [referrer],\n+                [metadata],\n+                [logType]\n+            FROM [EstateAccessManagementSystem].[dbo].[accesslogs]\n+        `;\n+\n+        if (from && to) {\n+            query += \" WHERE CAST(timestampUtc AS DATE) BETWEEN @from AND @to\";\n+        }\n+\n+        query += \" ORDER BY timestampUtc DESC\";\n+\n+        const request = dbPool.request();\n+        if (from && to) {\n+            request.input(\"from\", sql.Date, from);\n+            request.input(\"to\", sql.Date, to);\n+        }\n+\n+        const result = await request.query(query);\n+        res.json(result.recordset);\n+\n+    } catch (err) {\n+        console.error(\"Access logs fetch error:\", err);\n+        res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\n+    }\n+});\n+// Admin only\n+router.get(\"/logs\", authenticateJWT, isAdmin, getAccessLogs);\n+export default router;\n+\n+\n+\n+\n+\n"
                },
                {
                    "date": 1763863708995,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,108 +1,13 @@\n-// routes/accessLogsRoutes.js\n-import { Router } from \"express\";\n-import { dbPool } from \"../server.js\";\n-import sql from \"mssql\";\n-import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n // backend/routes/accessLogsRoutes.js\n-import { getAccessLogs } from \"../controllers/accessLogsController.js\";\n+import express from \"express\";\n+import { getAccessLogs, createAccessLog } from \"../controllers/accessLogsController.js\";\n \n-const router = Router();\n+const router = express.Router();\n \n-// GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\n-router.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\n-    try {\n-        const { from, to } = req.query;\n+// GET logs (filter optional)\n+router.get(\"/\", getAccessLogs);\n \n-        let query = `\n-            SELECT TOP (1000)\n-                [id],\n-                [timestampUtc],\n-                [userId],\n-                [action],\n-                [resource],\n-                [ipAddress],\n-                [userAgent],\n-                [referrer],\n-                [metadata],\n-                [logType]\n-            FROM [EstateAccessManagementSystem].[dbo].[accesslogs]\n-        `;\n+// POST new log\n+router.post(\"/\", createAccessLog);\n \n-        if (from && to) {\n-            query += \" WHERE CAST(timestampUtc AS DATE) BETWEEN @from AND @to\";\n-        }\n-\n-        query += \" ORDER BY timestampUtc DESC\";\n-\n-        const request = dbPool.request();\n-        if (from && to) {\n-            request.input(\"from\", sql.Date, from);\n-            request.input(\"to\", sql.Date, to);\n-        }\n-\n-        const result = await request.query(query);\n-        res.json(result.recordset);\n-\n-    } catch (err) {\n-        console.error(\"Access logs fetch error:\", err);\n-        res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\n-    }\n-});\n-// Admin only\n-router.get(\"/logs\", authenticateJWT, isAdmin, getAccessLogs);\n export default router;\n-\n-\n-\n-\n-\n-// routes/accessLogsRoutes.js\n-import { Router } from \"express\";\n-import { dbPool } from \"../server.js\";\n-import sql from \"mssql\";\n-import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n-\n-const router = Router();\n-\n-// GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\n-router.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\n-    try {\n-        const { from, to } = req.query;\n-\n-        let query = `\n-            SELECT TOP (1000)\n-                [id],\n-                [timestampUtc],\n-                [userId],\n-                [action],\n-                [resource],\n-                [ipAddress],\n-                [userAgent],\n-                [referrer],\n-                [metadata],\n-                [logType]\n-            FROM [EstateAccessManagementSystem].[dbo].[accesslogs]\n-        `;\n-\n-        if (from && to) {\n-            query += \" WHERE CAST(timestampUtc AS DATE) BETWEEN @from AND @to\";\n-        }\n-\n-        query += \" ORDER BY timestampUtc DESC\";\n-\n-        const request = dbPool.request();\n-        if (from && to) {\n-            request.input(\"from\", sql.Date, from);\n-            request.input(\"to\", sql.Date, to);\n-        }\n-\n-        const result = await request.query(query);\n-        res.json(result.recordset);\n-\n-    } catch (err) {\n-        console.error(\"Access logs fetch error:\", err);\n-        res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\n-    }\n-});\n-\n-export default router;\n"
                },
                {
                    "date": 1763864911434,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,12 @@\n // backend/routes/accessLogsRoutes.js\n import express from \"express\";\n-import { getAccessLogs, createAccessLog } from \"../controllers/accessLogsController.js\";\n+import { getaccesslogs, createAccessLog } from \"../controllers/accessLogsController.js\";\n \n const router = express.Router();\n \n // GET logs (filter optional)\n-router.get(\"/\", getAccessLogs);\n+router.get(\"/\", getaccesslogs);\n \n // POST new log\n router.post(\"/\", createAccessLog);\n \n"
                },
                {
                    "date": 1763865193123,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,13 @@\n // backend/routes/accessLogsRoutes.js\n import express from \"express\";\n-import { getaccesslogs, createAccessLog } from \"../controllers/accessLogsController.js\";\n+import { getaccesslogs, createaccessLog } from \"../controllers/accessLogsController.js\";\n \n const router = express.Router();\n \n // GET logs (filter optional)\n router.get(\"/\", getaccesslogs);\n \n // POST new log\n-router.post(\"/\", createAccessLog);\n+router.post(\"/\", createaccessLog);\n \n export default router;\n"
                },
                {
                    "date": 1763865735910,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,12 @@\n-// backend/routes/accessLogsRoutes.js\n import express from \"express\";\n-import { getaccesslogs, createaccessLog } from \"../controllers/accessLogsController.js\";\n+import { getaccesslogs, createaccesslog } from \"../controllers/accesslogsController.js\";\n \n const router = express.Router();\n \n-// GET logs (filter optional)\n+// GET all accesslogs\n router.get(\"/\", getaccesslogs);\n \n-// POST new log\n-router.post(\"/\", createaccessLog);\n+// POST a new accesslog\n+router.post(\"/\", createaccesslog);\n \n export default router;\n"
                },
                {
                    "date": 1763869268738,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,19 @@\n+// ===============================================\n+// CORRECTED: ./routes/accesslogsRoutes.js\n+// Fixes the 404 error by changing the GET path\n+// ===============================================\n+\n import express from \"express\";\n import { getaccesslogs, createaccesslog } from \"../controllers/accesslogsController.js\";\n \n const router = express.Router();\n \n-// GET all accesslogs\n-router.get(\"/\", getaccesslogs);\n+// 游릭 CORRECTED: Changed the path from \"/\" to \"/logs\"\n+// Combined with the server mount point of \"/api/access\", \n+// this creates the full working path: /api/access/logs\n+router.get(\"/logs\", getaccesslogs);\n \n-// POST a new accesslog\n+// POST a new accesslog (Path remains /api/access)\n router.post(\"/\", createaccesslog);\n \n-export default router;\n+export default router;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763890609084,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,19 +1,21 @@\n-// ===============================================\n-// CORRECTED: ./routes/accesslogsRoutes.js\n-// Fixes the 404 error by changing the GET path\n-// ===============================================\n+    // ===============================================\n+    // CORRECTED: ./routes/accesslogsRoutes.js\n+    // Fixes the 404 error by changing the GET path\n+    // ===============================================\n \n-import express from \"express\";\n-import { getaccesslogs, createaccesslog } from \"../controllers/accesslogsController.js\";\n+    import express from \"express\";\n+    import { getaccesslogs, createaccesslog } from \"../controllers/accesslogsController.js\";\n \n-const router = express.Router();\n+    const router = express.Router();\n \n-// 游릭 CORRECTED: Changed the path from \"/\" to \"/logs\"\n-// Combined with the server mount point of \"/api/access\", \n\\ No newline at end of file\n-// this creates the full working path: /api/access/logs\n-router.get(\"/logs\", getaccesslogs);\n+    // 游릭 CORRECTED: Changed the path from \"/\" to \"/logs\"\n+    // Combined with the server mount point of \"/api/access\", \n+    // this creates the full working path: /api/access/logs\n+    // in accesslogsRoutes.js\n+     router.get(\"/admin/accesslogs\", getaccesslogs); // now matches /api/admin/accesslogs\n \n-// POST a new accesslog (Path remains /api/access)\n-router.post(\"/\", createaccesslog);\n \n-export default router;\n+    // POST a new accesslog (Path remains /api/access)\n+    router.post(\"/\", createaccesslog);\n+\n+    export default router;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763890818320,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,10 @@\n     // 游릭 CORRECTED: Changed the path from \"/\" to \"/logs\"\n     // Combined with the server mount point of \"/api/access\", \n     // this creates the full working path: /api/access/logs\n     // in accesslogsRoutes.js\n-     router.get(\"/admin/accesslogs\", getaccesslogs); // now matches /api/admin/accesslogs\n+     router.get(\"/accesslogs\", getaccesslogs);  // now full URL = /api/admin/accesslogs\n+ // now matches /api/admin/accesslogs\n \n \n     // POST a new accesslog (Path remains /api/access)\n     router.post(\"/\", createaccesslog);\n"
                },
                {
                    "date": 1763891010426,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,9 @@\n     // 游릭 CORRECTED: Changed the path from \"/\" to \"/logs\"\n     // Combined with the server mount point of \"/api/access\", \n     // this creates the full working path: /api/access/logs\n     // in accesslogsRoutes.js\n-     router.get(\"/accesslogs\", getaccesslogs);  // now full URL = /api/admin/accesslogs\n+     router.get(\"/admin/accesslogs\", getaccesslogs); // full URL = /api/accesslogs/admin/accesslogs\n  // now matches /api/admin/accesslogs\n \n \n     // POST a new accesslog (Path remains /api/access)\n"
                },
                {
                    "date": 1763892518654,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,22 +1,18 @@\n-    // ===============================================\n-    // CORRECTED: ./routes/accesslogsRoutes.js\n-    // Fixes the 404 error by changing the GET path\n-    // ===============================================\n+import express from \"express\";\n+import { getaccesslogs, createaccesslog } from \"../controllers/accesslogsController.js\";\n+import { authenticateJWT } from \"../middleware/authMiddleware.js\"; // if protected\n \n-    import express from \"express\";\n-    import { getaccesslogs, createaccesslog } from \"../controllers/accesslogsController.js\";\n+const router = express.Router();\n \n-    const router = express.Router();\n+// Apply JWT auth if needed\n+router.use(authenticateJWT);\n \n-    // 游릭 CORRECTED: Changed the path from \"/\" to \"/logs\"\n-    // Combined with the server mount point of \"/api/access\", \n-    // this creates the full working path: /api/access/logs\n-    // in accesslogsRoutes.js\n-     router.get(\"/admin/accesslogs\", getaccesslogs); // full URL = /api/accesslogs/admin/accesslogs\n- // now matches /api/admin/accesslogs\n\\ No newline at end of file\n+// GET all access logs\n+// Full URL: GET /api/accesslogs\n+router.get(\"/\", getaccesslogs);\n \n+// POST a new access log\n+// Full URL: POST /api/accesslogs\n+router.post(\"/\", createaccesslog);\n \n-    // POST a new accesslog (Path remains /api/access)\n-    router.post(\"/\", createaccesslog);\n-\n-    export default router;\n+export default router;\n"
                }
            ],
            "date": 1763846520761,
            "name": "Commit-0",
            "content": "// backend/routes/accessLogsRoutes.js\nimport { Router } from \"express\";\nimport { dbPool } from \"../server.js\";\nimport { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\n\nconst router = Router();\n\n// GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\nrouter.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\n    try {\n        const { from, to } = req.query;\n        let query = `SELECT TOP (1000)\n            [Id],\n            [TimestampUtc],\n            [UserId],\n            [Action],\n            [Resource],\n            [IpAddress],\n            [UserAgent],\n            [Referrer],\n            [Metadata],\n            [LogType]\n        FROM [EstateAccessManagementSystem].[dbo].[accesslogs]`;\n        \n        if (from && to) {\n            query += \" WHERE CAST(TimestampUtc AS DATE) BETWEEN @from AND @to\";\n        }\n        query += \" ORDER BY TimestampUtc DESC\";\n\n        const pool = await dbPool;\n        const request = pool.request();\n        if (from && to) {\n            request.input(\"from\", \"Date\", from);\n            request.input(\"to\", \"Date\", to);\n        }\n\n        const result = await request.query(query);\n        res.json(result.recordset);\n    } catch (err) {\n        console.error(\"Access logs error:\", err);\n        res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\n    }\n});\n\nexport default router;\n"
        }
    ]
}