{
    "sourceFile": "frontend/js/securitydashboardoverview.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763970140964,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763970140964,
            "name": "Commit-0",
            "content": "// js/dashboardoverview.js\n\n// NOTE: This assumes Chart.js and Tailwind CSS are loaded in the HTML file.\n// NOTE: The token is assumed to be stored in localStorage upon successful login.\nconst token = localStorage.getItem(\"accessToken\");\nconst BACKEND_URL = \"http://localhost:4050/api/residents\";\n\n// ================================\n// SAFE UPDATE HELPER\n// Prevents the \"Element not found\" errors if a page loads before the full content is ready.\n// ================================\nconst safeUpdate = (id, value, suffix = '') => {\n    const element = document.getElementById(id);\n    if (element) {\n        element.textContent = value + suffix;\n    } else {\n        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\n    }\n};\n\n// ================================\n// 1. DASHBOARD SUMMARY DATA FETCH\n// Fetches data for all 7 counter cards.\n// ================================\nasync function loadDashboardSummary() {\n    if (!token) {\n        console.error(\"Authentication token not found.\");\n        return;\n    }\n    \n    try {\n        const res = await fetch(`${BACKEND_URL}/dashboard/summary`, {\n            headers: { \"Authorization\": `Bearer ${token}` }\n        });\n        \n        if (!res.ok) throw new Error(`API Error: ${res.status} ${res.statusText}`);\n        \n        // Data structure assumed: \n        // { totalResidents: 1024, pendingPayments: 56, compliancePct: 87, \n        //   overrideCount: 4, visitorscheckedin: 50, visitorscheckedout: 45, rejects: 5 }\n        const data = await res.json(); \n\n        // Update all counters using the safe helper\n        safeUpdate(\"totalResidents\", data.totalResidents || 0);\n        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\n        safeUpdate(\"compliancePct\", data.compliancePct || 0, '%');\n        safeUpdate(\"overrideCount\", data.overrideCount || 0);\n        \n        // Visitor counters (Matching previous API logic and new HTML IDs)\n        safeUpdate(\"totalVisitorsCheckedin\", data.visitorscheckedin || 0);\n        safeUpdate(\"totalVisitorsCheckedout\", data.visitorscheckedout || 0);\n        safeUpdate(\"rejects\", data.rejects || 0);\n\n    } catch (err) {\n        console.error(\"Error loading dashboard summary:\", err.message);\n        // Fallback for visual indication of failure\n        safeUpdate(\"totalResidents\", \"Error\");\n    }\n}\n\n\n// ================================\n// 2. ACCESS CHART DATA FETCH & RENDERING\n// Fetches chart data and renders the Chart.js line graph.\n// ================================\nasync function loadAccessChart() {\n    if (!token) return;\n\n    try {\n        const res = await fetch(`${BACKEND_URL}/admin/accesschart`, { \n            headers: { \"Authorization\": `Bearer ${token}` }\n        });\n        \n        if (!res.ok) throw new Error(`API Error: ${res.status} ${res.statusText}`);\n        \n        // Data structure assumed (matching the dummy data's format): \n        // { labels: [\"Day -13\", ...], data: [23, 18, ...] }\n        const chartData = await res.json(); \n\n        const accessChartElement = document.getElementById(\"accessChart\");\n        if (!accessChartElement) {\n            console.warn(\"Chart element not found for rendering.\");\n            return;\n        }\n\n        const ctx = accessChartElement.getContext(\"2d\");\n        new Chart(ctx, {\n            type: 'line',\n            data: {\n                // Use the data retrieved from the server\n                labels: chartData.labels, \n                datasets: [{\n                    label: 'Daily Access Attempts',\n                    data: chartData.data,\n                    borderColor: '#3b82f6', // Tailwind blue-500\n                    backgroundColor: 'rgba(59, 130, 246, 0.2)',\n                    fill: true,\n                    tension: 0.3,\n                    pointRadius: 4,\n                    pointHoverRadius: 6,\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                maintainAspectRatio: false, // Allows chart to respect container height\n                scales: {\n                    y: {\n                        beginAtZero: true,\n                        ticks: { stepSize: 5 }\n                    }\n                },\n                plugins: {\n                    legend: { display: true, position: 'top' },\n                    tooltip: { enabled: true }\n                }\n            }\n        });\n\n    } catch (err) {\n        console.error(\"Error loading access chart:\", err.message);\n    }\n}\n\n"
        }
    ]
}