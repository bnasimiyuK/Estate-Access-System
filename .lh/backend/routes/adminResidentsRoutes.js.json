{
    "sourceFile": "backend/routes/adminResidentsRoutes.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1763786403507,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763787497689,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,6 +24,22 @@\n         console.error(\"Error fetching approved residents:\", error);\r\n         res.status(500).json({ message: \"Server error\" });\r\n     }\r\n });\r\n+router.get(\"/pending\", authenticateJWT, isAdmin, async (req, res) => {\r\n+  try {\r\n+    const pool = await dbPool;\r\n+    const result = await pool.request().query(`\r\n+      SELECT RequestID, ResidentName, NationalID, PhoneNumber, Email,\r\n+             HouseNumber, CourtName, RoleName, Status, RequestedAt\r\n+      FROM MembershipRequests\r\n+      WHERE Status = 'Pending'\r\n+      ORDER BY RequestedAt DESC\r\n+    `);\r\n \r\n+    res.status(200).json(result.recordset);\r\n+  } catch (error) {\r\n+    console.error(\"Error fetching pending requests:\", error);\r\n+    res.status(500).json({ message: \"Server error\" });\r\n+  }\r\n+});\r\n export default router;\r\n"
                },
                {
                    "date": 1763865910637,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,5 +41,7 @@\n     console.error(\"Error fetching pending requests:\", error);\r\n     res.status(500).json({ message: \"Server error\" });\r\n   }\r\n });\r\n+router.get(\"/\", (req, res) => res.send(\"Admin Residents API\"));\r\n+\r\n export default router;\r\n"
                },
                {
                    "date": 1764014702473,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,24 +24,60 @@\n         console.error(\"Error fetching approved residents:\", error);\r\n         res.status(500).json({ message: \"Server error\" });\r\n     }\r\n });\r\n+\r\n+/**\r\n+ * @route GET /api/admin/residents/pending\r\n+ * @desc Fetch all pending membership requests\r\n+ * @access Admin only\r\n+ */\r\n router.get(\"/pending\", authenticateJWT, isAdmin, async (req, res) => {\r\n-  try {\r\n-    const pool = await dbPool;\r\n-    const result = await pool.request().query(`\r\n-      SELECT RequestID, ResidentName, NationalID, PhoneNumber, Email,\r\n-             HouseNumber, CourtName, RoleName, Status, RequestedAt\r\n-      FROM MembershipRequests\r\n-      WHERE Status = 'Pending'\r\n-      ORDER BY RequestedAt DESC\r\n-    `);\r\n+    try {\r\n+        const pool = await dbPool;\r\n+        const result = await pool.request().query(`\r\n+            SELECT RequestID, ResidentName, NationalID, PhoneNumber, Email,\r\n+                   HouseNumber, CourtName, RoleName, Status, RequestedAt\r\n+            FROM MembershipRequests\r\n+            WHERE Status = 'Pending'\r\n+            ORDER BY RequestedAt DESC\r\n+        `);\r\n \r\n-    res.status(200).json(result.recordset);\r\n-  } catch (error) {\r\n-    console.error(\"Error fetching pending requests:\", error);\r\n-    res.status(500).json({ message: \"Server error\" });\r\n-  }\r\n+        res.status(200).json(result.recordset);\r\n+    } catch (error) {\r\n+        console.error(\"Error fetching pending requests:\", error);\r\n+        res.status(500).json({ message: \"Server error\" });\r\n+    }\r\n });\r\n+\r\n+/**\r\n+ * @route GET /api/admin/residents/accesschart\r\n+ * @desc Access chart for admin dashboard (FIX FOR 404 ERROR)\r\n+ * @access Admin only\r\n+ */\r\n+router.get(\"/accesschart\", authenticateJWT, isAdmin, async (req, res) => {\r\n+    try {\r\n+        const pool = await dbPool;\r\n+\r\n+        const result = await pool.request().query(`\r\n+            SELECT \r\n+                FORMAT(AccessTime, 'yyyy-MM') AS Month,\r\n+                COUNT(*) AS TotalAccess\r\n+            FROM AccessLogs\r\n+            GROUP BY FORMAT(AccessTime, 'yyyy-MM')\r\n+            ORDER BY Month\r\n+        `);\r\n+\r\n+        res.status(200).json(result.recordset);\r\n+    } catch (error) {\r\n+        console.error(\"Error fetching access chart:\", error);\r\n+        res.status(500).json({ message: \"Server error\" });\r\n+    }\r\n+});\r\n+\r\n+/**\r\n+ * @route GET /api/admin/residents/\r\n+ * @desc Base API test route\r\n+ */\r\n router.get(\"/\", (req, res) => res.send(\"Admin Residents API\"));\r\n \r\n export default router;\r\n"
                },
                {
                    "date": 1764014792617,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,80 +4,92 @@\n import { dbPool } from \"../server.js\";\r\n \r\n const router = express.Router();\r\n \r\n-/**\r\n- * @route GET /api/admin/residents/approved\r\n- * @desc Fetch all approved residents\r\n- * @access Admin only\r\n- */\r\n-router.get(\"/approved\", authenticateJWT, isAdmin, async (req, res) => {\r\n+/* ============================================================\r\n+   DASHBOARD SUMMARY (FIX FOR /api/residents/dashboard/summary)\r\n+=============================================================== */\r\n+router.get(\"/dashboard/summary\", authenticateJWT, isAdmin, async (req, res) => {\r\n     try {\r\n         const pool = await dbPool;\r\n+\r\n         const result = await pool.request().query(`\r\n-            SELECT ResidentID, ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName \r\n-            FROM Residents\r\n-            WHERE Status = 'Approved'\r\n+            SELECT\r\n+                (SELECT COUNT(*) FROM Residents WHERE Status='Approved') AS TotalResidents,\r\n+                (SELECT COUNT(*) FROM Visitors) AS TotalVisitors,\r\n+                (SELECT COUNT(*) FROM AccessLogs) AS TotalAccessLogs,\r\n+                (SELECT COUNT(*) FROM MembershipRequests WHERE Status='Pending') AS PendingRequests\r\n         `);\r\n \r\n+        res.status(200).json(result.recordset[0]);\r\n+    } catch (error) {\r\n+        console.error(\"Error loading dashboard summary:\", error);\r\n+        res.status(500).json({ message: \"Server error\" });\r\n+    }\r\n+});\r\n+\r\n+/* ============================================================\r\n+   ACCESS CHART ROUTE (FIX FOR /api/residents/admin/accesschart)\r\n+=============================================================== */\r\n+router.get(\"/dashboard/accesschart\", authenticateJWT, isAdmin, async (req, res) => {\r\n+    try {\r\n+        const pool = await dbPool;\r\n+\r\n+        const result = await pool.request().query(`\r\n+            SELECT \r\n+                FORMAT(AccessTime, 'yyyy-MM') AS Month,\r\n+                COUNT(*) AS TotalAccess\r\n+            FROM AccessLogs\r\n+            GROUP BY FORMAT(AccessTime, 'yyyy-MM')\r\n+            ORDER BY Month\r\n+        `);\r\n+\r\n         res.status(200).json(result.recordset);\r\n     } catch (error) {\r\n-        console.error(\"Error fetching approved residents:\", error);\r\n+        console.error(\"Error fetching access chart:\", error);\r\n         res.status(500).json({ message: \"Server error\" });\r\n     }\r\n });\r\n \r\n-/**\r\n- * @route GET /api/admin/residents/pending\r\n- * @desc Fetch all pending membership requests\r\n- * @access Admin only\r\n- */\r\n-router.get(\"/pending\", authenticateJWT, isAdmin, async (req, res) => {\r\n+/* ============================================================\r\n+   APPROVED RESIDENTS\r\n+=============================================================== */\r\n+router.get(\"/residents/approved\", authenticateJWT, isAdmin, async (req, res) => {\r\n     try {\r\n         const pool = await dbPool;\r\n         const result = await pool.request().query(`\r\n-            SELECT RequestID, ResidentName, NationalID, PhoneNumber, Email,\r\n-                   HouseNumber, CourtName, RoleName, Status, RequestedAt\r\n-            FROM MembershipRequests\r\n-            WHERE Status = 'Pending'\r\n-            ORDER BY RequestedAt DESC\r\n+            SELECT ResidentID, ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName \r\n+            FROM Residents\r\n+            WHERE Status = 'Approved'\r\n         `);\r\n \r\n         res.status(200).json(result.recordset);\r\n     } catch (error) {\r\n-        console.error(\"Error fetching pending requests:\", error);\r\n+        console.error(\"Error fetching approved residents:\", error);\r\n         res.status(500).json({ message: \"Server error\" });\r\n     }\r\n });\r\n \r\n-/**\r\n- * @route GET /api/admin/residents/accesschart\r\n- * @desc Access chart for admin dashboard (FIX FOR 404 ERROR)\r\n- * @access Admin only\r\n- */\r\n-router.get(\"/accesschart\", authenticateJWT, isAdmin, async (req, res) => {\r\n+/* ============================================================\r\n+   PENDING MEMBERSHIP REQUESTS\r\n+=============================================================== */\r\n+router.get(\"/residents/pending\", authenticateJWT, isAdmin, async (req, res) => {\r\n     try {\r\n         const pool = await dbPool;\r\n-\r\n         const result = await pool.request().query(`\r\n-            SELECT \r\n-                FORMAT(AccessTime, 'yyyy-MM') AS Month,\r\n-                COUNT(*) AS TotalAccess\r\n-            FROM AccessLogs\r\n-            GROUP BY FORMAT(AccessTime, 'yyyy-MM')\r\n-            ORDER BY Month\r\n+            SELECT RequestID, ResidentName, NationalID, PhoneNumber, Email,\r\n+                   HouseNumber, CourtName, RoleName, Status, RequestedAt\r\n+            FROM MembershipRequests\r\n+            WHERE Status = 'Pending'\r\n+            ORDER BY RequestedAt DESC\r\n         `);\r\n \r\n         res.status(200).json(result.recordset);\r\n     } catch (error) {\r\n-        console.error(\"Error fetching access chart:\", error);\r\n+        console.error(\"Error fetching pending requests:\", error);\r\n         res.status(500).json({ message: \"Server error\" });\r\n     }\r\n });\r\n \r\n-/**\r\n- * @route GET /api/admin/residents/\r\n- * @desc Base API test route\r\n- */\r\n-router.get(\"/\", (req, res) => res.send(\"Admin Residents API\"));\r\n+router.get(\"/\", (req, res) => res.send(\"Admin Dashboard API\"));\r\n \r\n export default router;\r\n"
                },
                {
                    "date": 1764015019834,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,92 +4,80 @@\n import { dbPool } from \"../server.js\";\r\n \r\n const router = express.Router();\r\n \r\n-/* ============================================================\r\n-   DASHBOARD SUMMARY (FIX FOR /api/residents/dashboard/summary)\r\n-=============================================================== */\r\n-router.get(\"/dashboard/summary\", authenticateJWT, isAdmin, async (req, res) => {\r\n+/**\r\n+ * @route GET /api/admin/residents/approved\r\n+ * @desc Fetch all approved residents\r\n+ * @access Admin only\r\n+ */\r\n+router.get(\"/approved\", authenticateJWT, isAdmin, async (req, res) => {\r\n     try {\r\n         const pool = await dbPool;\r\n-\r\n         const result = await pool.request().query(`\r\n-            SELECT\r\n-                (SELECT COUNT(*) FROM Residents WHERE Status='Approved') AS TotalResidents,\r\n-                (SELECT COUNT(*) FROM Visitors) AS TotalVisitors,\r\n-                (SELECT COUNT(*) FROM AccessLogs) AS TotalAccessLogs,\r\n-                (SELECT COUNT(*) FROM MembershipRequests WHERE Status='Pending') AS PendingRequests\r\n+            SELECT ResidentID, ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName \r\n+            FROM Residents\r\n+            WHERE Status = 'Approved'\r\n         `);\r\n \r\n-        res.status(200).json(result.recordset[0]);\r\n+        res.status(200).json(result.recordset);\r\n     } catch (error) {\r\n-        console.error(\"Error loading dashboard summary:\", error);\r\n+        console.error(\"Error fetching approved residents:\", error);\r\n         res.status(500).json({ message: \"Server error\" });\r\n     }\r\n });\r\n \r\n-/* ============================================================\r\n-   ACCESS CHART ROUTE (FIX FOR /api/residents/admin/accesschart)\r\n-=============================================================== */\r\n-router.get(\"/dashboard/accesschart\", authenticateJWT, isAdmin, async (req, res) => {\r\n+/**\r\n+ * @route GET /api/admin/residents/pending\r\n+ * @desc Fetch all pending membership requests\r\n+ * @access Admin only\r\n+ */\r\n+router.get(\"/pending\", authenticateJWT, isAdmin, async (req, res) => {\r\n     try {\r\n         const pool = await dbPool;\r\n-\r\n         const result = await pool.request().query(`\r\n-            SELECT \r\n-                FORMAT(AccessTime, 'yyyy-MM') AS Month,\r\n-                COUNT(*) AS TotalAccess\r\n-            FROM AccessLogs\r\n-            GROUP BY FORMAT(AccessTime, 'yyyy-MM')\r\n-            ORDER BY Month\r\n+            SELECT RequestID, ResidentName, NationalID, PhoneNumber, Email,\r\n+                   HouseNumber, CourtName, RoleName, Status, RequestedAt\r\n+            FROM MembershipRequests\r\n+            WHERE Status = 'Pending'\r\n+            ORDER BY RequestedAt DESC\r\n         `);\r\n \r\n         res.status(200).json(result.recordset);\r\n     } catch (error) {\r\n-        console.error(\"Error fetching access chart:\", error);\r\n+        console.error(\"Error fetching pending requests:\", error);\r\n         res.status(500).json({ message: \"Server error\" });\r\n     }\r\n });\r\n \r\n-/* ============================================================\r\n-   APPROVED RESIDENTS\r\n-=============================================================== */\r\n-router.get(\"/residents/approved\", authenticateJWT, isAdmin, async (req, res) => {\r\n+/**\r\n+ * @route GET /api/admin/residents/accesschart\r\n+ * @desc Access chart for admin dashboard (FIX FOR 404 ERROR)\r\n+ * @access Admin only\r\n+ */\r\n+router.get(\"/accesschart\", authenticateJWT, isAdmin, async (req, res) => {\r\n     try {\r\n         const pool = await dbPool;\r\n-        const result = await pool.request().query(`\r\n-            SELECT ResidentID, ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName \r\n-            FROM Residents\r\n-            WHERE Status = 'Approved'\r\n-        `);\r\n \r\n-        res.status(200).json(result.recordset);\r\n-    } catch (error) {\r\n-        console.error(\"Error fetching approved residents:\", error);\r\n-        res.status(500).json({ message: \"Server error\" });\r\n-    }\r\n-});\r\n-\r\n-/* ============================================================\r\n-   PENDING MEMBERSHIP REQUESTS\r\n-=============================================================== */\r\n-router.get(\"/residents/pending\", authenticateJWT, isAdmin, async (req, res) => {\r\n-    try {\r\n-        const pool = await dbPool;\r\n         const result = await pool.request().query(`\r\n-            SELECT RequestID, ResidentName, NationalID, PhoneNumber, Email,\r\n-                   HouseNumber, CourtName, RoleName, Status, RequestedAt\r\n-            FROM MembershipRequests\r\n-            WHERE Status = 'Pending'\r\n-            ORDER BY RequestedAt DESC\r\n+            SELECT \r\n+                FORMAT(AccessTime, 'yyyy-MM') AS Month,\r\n+                COUNT(*) AS TotalAccess\r\n+            FROM AccessLogs\r\n+            GROUP BY FORMAT(AccessTime, 'yyyy-MM')\r\n+            ORDER BY Month\r\n         `);\r\n \r\n         res.status(200).json(result.recordset);\r\n     } catch (error) {\r\n-        console.error(\"Error fetching pending requests:\", error);\r\n+        console.error(\"Error fetching access chart:\", error);\r\n         res.status(500).json({ message: \"Server error\" });\r\n     }\r\n });\r\n \r\n-router.get(\"/\", (req, res) => res.send(\"Admin Dashboard API\"));\r\n+/**\r\n+ * @route GET /api/admin/residents/\r\n+ * @desc Base API test route\r\n+ */\r\n+router.get(\"/\", (req, res) => res.send(\"Admin Residents API\"));\r\n \r\n export default router;\r\n"
                }
            ],
            "date": 1763786403507,
            "name": "Commit-0",
            "content": "import express from \"express\";\r\nimport sql from \"mssql\";\r\nimport { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\r\nimport { dbPool } from \"../server.js\";\r\n\r\nconst router = express.Router();\r\n\r\n/**\r\n * @route GET /api/admin/residents/approved\r\n * @desc Fetch all approved residents\r\n * @access Admin only\r\n */\r\nrouter.get(\"/approved\", authenticateJWT, isAdmin, async (req, res) => {\r\n    try {\r\n        const pool = await dbPool;\r\n        const result = await pool.request().query(`\r\n            SELECT ResidentID, ResidentName, NationalID, PhoneNumber, Email, HouseNumber, CourtName \r\n            FROM Residents\r\n            WHERE Status = 'Approved'\r\n        `);\r\n\r\n        res.status(200).json(result.recordset);\r\n    } catch (error) {\r\n        console.error(\"Error fetching approved residents:\", error);\r\n        res.status(500).json({ message: \"Server error\" });\r\n    }\r\n});\r\n\r\nexport default router;\r\n"
        }
    ]
}