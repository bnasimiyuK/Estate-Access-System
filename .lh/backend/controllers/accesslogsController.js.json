{
    "sourceFile": "backend/controllers/accesslogsController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1763865366271,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763865426310,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,98 +1,47 @@\n-// backend/controllers/accesslogsController.js\n+// backend/controllers/accessLogsController.js\n import sql from \"mssql\";\n import { dbPool } from \"../server.js\";\n \n /**\n- * Get Access Logs with optional date filter\n- * @route GET /api/accesslogs\n+ * Get all access logs\n  */\n-export const getaccesslogs = async (req, res) => {\n+export async function getaccesslogs(req, res) {\n     try {\n-        const { from, to } = req.query;\n-\n         const pool = await dbPool;\n-\n-        let query = `\n-            SELECT \n-                Id,\n-                TimestampUtc,\n-                UserId,\n-                Action,\n-                Resource,\n-                IpAddress,\n-                UserAgent,\n-                Referrer,\n-                Metadata,\n-                LogType\n-            FROM accesslogs\n-            WHERE 1 = 1\n-        `;\n-\n-        if (from) query += ` AND TimestampUtc >= @from`;\n-        if (to) query += ` AND TimestampUtc <= @to`;\n-\n-        const request = pool.request();\n-        if (from) request.input(\"from\", sql.DateTime, new Date(from));\n-        if (to) request.input(\"to\", sql.DateTime, new Date(to));\n-\n-        const result = await request.query(query);\n-\n-        res.status(200).json({\n-            success: true,\n-            total: result.recordset.length,\n-            logs: result.recordset,\n-        });\n-    } catch (error) {\n-        console.error(\"Get Logs Error: \", error);\n-        res.status(500).json({ message: \"Server error fetching logs\" });\n+        const result = await pool.request()\n+            .query(`SELECT TOP (1000)\n+                    [Id], [TimestampUtc], [UserId], [Action], [Resource],\n+                    [IpAddress], [UserAgent], [Referrer], [Metadata], [LogType]\n+                    FROM [EstateAccessManagementSystem].[dbo].[accesslogs]`);\n+        res.json(result.recordset);\n+    } catch (err) {\n+        console.error(err);\n+        res.status(500).json({ message: \"Error fetching access logs\" });\n     }\n-};\n+}\n \n-\n /**\n- * Create a log entry (system use)\n- * @route POST /api/accesslogs\n+ * Create a new access log\n  */\n-export const createAccessLog = async (req, res) => {\n+export async function createAccessLog(req, res) {\n     try {\n-        const {\n-            UserId,\n-            Action,\n-            Resource,\n-            IpAddress,\n-            UserAgent,\n-            Referrer,\n-            Metadata,\n-            LogType\n-        } = req.body;\n-\n+        const { UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType } = req.body;\n         const pool = await dbPool;\n-\n         await pool.request()\n-            .input(\"TimestampUtc\", sql.DateTime, new Date())\n-            .input(\"UserId\", sql.VarChar(255), UserId)\n-            .input(\"Action\", sql.VarChar(255), Action)\n-            .input(\"Resource\", sql.VarChar(255), Resource)\n-            .input(\"IpAddress\", sql.VarChar(255), IpAddress)\n-            .input(\"UserAgent\", sql.VarChar(sql.MAX), UserAgent)\n-            .input(\"Referrer\", sql.VarChar(255), Referrer)\n-            .input(\"Metadata\", sql.VarChar(sql.MAX), Metadata)\n-            .input(\"LogType\", sql.VarChar(50), LogType)\n-            .query(`\n-                INSERT INTO accesslogs (\n-                    TimestampUtc, UserId, Action, Resource, \n-                    IpAddress, UserAgent, Referrer, Metadata, LogType\n-                )\n-                VALUES (\n-                    @TimestampUtc, @UserId, @Action, @Resource,\n-                    @IpAddress, @UserAgent, @Referrer, @Metadata, @LogType\n-                )\n-            `);\n-\n-        res.status(201).json({ success: true, message: \"Log stored successfully\" });\n-\n-    } catch (error) {\n-        console.error(\"Create Log Error: \", error);\n-        res.status(500).json({ message: \"Server error saving log\" });\n+            .input(\"UserId\", sql.Int, UserId)\n+            .input(\"Action\", sql.VarChar, Action)\n+            .input(\"Resource\", sql.VarChar, Resource)\n+            .input(\"IpAddress\", sql.VarChar, IpAddress)\n+            .input(\"UserAgent\", sql.VarChar, UserAgent)\n+            .input(\"Referrer\", sql.VarChar, Referrer)\n+            .input(\"Metadata\", sql.VarChar, Metadata)\n+            .input(\"LogType\", sql.VarChar, LogType)\n+            .query(`INSERT INTO [accesslogs] \n+                    (UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType, TimestampUtc)\n+                    VALUES (@UserId, @Action, @Resource, @IpAddress, @UserAgent, @Referrer, @Metadata, @LogType, GETUTCDATE())`);\n+        res.status(201).json({ message: \"Access log created\" });\n+    } catch (err) {\n+        console.error(err);\n+        res.status(500).json({ message: \"Error creating access log\" });\n     }\n-};\n+}\n"
                },
                {
                    "date": 1763865477327,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n \n /**\n  * Create a new access log\n  */\n-export async function createAccessLog(req, res) {\n+export async function createaccesslog(req, res) {\n     try {\n         const { UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType } = req.body;\n         const pool = await dbPool;\n         await pool.request()\n"
                },
                {
                    "date": 1763865703151,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,47 +1,54 @@\n-// backend/controllers/accessLogsController.js\n import sql from \"mssql\";\n-import { dbPool } from \"../server.js\";\n+import { dbPool } from \"../server.js\"; // your dbPool from server.js\n \n-/**\n- * Get all access logs\n- */\n+// Get all accesslogs\n export async function getaccesslogs(req, res) {\n     try {\n         const pool = await dbPool;\n         const result = await pool.request()\n-            .query(`SELECT TOP (1000)\n-                    [Id], [TimestampUtc], [UserId], [Action], [Resource],\n-                    [IpAddress], [UserAgent], [Referrer], [Metadata], [LogType]\n-                    FROM [EstateAccessManagementSystem].[dbo].[accesslogs]`);\n-        res.json(result.recordset);\n+            .query(`SELECT TOP (1000) \n+                        [Id],\n+                        [TimestampUtc],\n+                        [UserId],\n+                        [Action],\n+                        [Resource],\n+                        [IpAddress],\n+                        [UserAgent],\n+                        [Referrer],\n+                        [Metadata],\n+                        [LogType]\n+                    FROM [EstateAccessManagementSystem].[dbo].[accesslogs]\n+                    ORDER BY [TimestampUtc] DESC`);\n+\n+        res.status(200).json(result.recordset);\n     } catch (err) {\n-        console.error(err);\n-        res.status(500).json({ message: \"Error fetching access logs\" });\n+        console.error(\"Accesslogs Error:\", err);\n+        res.status(500).json({ message: \"Failed to fetch accesslogs\", error: err.message });\n     }\n }\n \n-/**\n- * Create a new access log\n- */\n+// Create a new accesslog\n export async function createaccesslog(req, res) {\n+    const { UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType } = req.body;\n+\n     try {\n-        const { UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType } = req.body;\n         const pool = await dbPool;\n         await pool.request()\n             .input(\"UserId\", sql.Int, UserId)\n-            .input(\"Action\", sql.VarChar, Action)\n-            .input(\"Resource\", sql.VarChar, Resource)\n-            .input(\"IpAddress\", sql.VarChar, IpAddress)\n-            .input(\"UserAgent\", sql.VarChar, UserAgent)\n-            .input(\"Referrer\", sql.VarChar, Referrer)\n-            .input(\"Metadata\", sql.VarChar, Metadata)\n-            .input(\"LogType\", sql.VarChar, LogType)\n-            .query(`INSERT INTO [accesslogs] \n-                    (UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType, TimestampUtc)\n-                    VALUES (@UserId, @Action, @Resource, @IpAddress, @UserAgent, @Referrer, @Metadata, @LogType, GETUTCDATE())`);\n-        res.status(201).json({ message: \"Access log created\" });\n+            .input(\"Action\", sql.VarChar(100), Action)\n+            .input(\"Resource\", sql.VarChar(255), Resource)\n+            .input(\"IpAddress\", sql.VarChar(50), IpAddress)\n+            .input(\"UserAgent\", sql.VarChar(255), UserAgent)\n+            .input(\"Referrer\", sql.VarChar(255), Referrer)\n+            .input(\"Metadata\", sql.NVarChar(sql.MAX), Metadata)\n+            .input(\"LogType\", sql.VarChar(50), LogType)\n+            .query(`INSERT INTO [EstateAccessManagementSystem].[dbo].[accesslogs] \n+                    (TimestampUtc, UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType)\n+                    VALUES (GETUTCDATE(), @UserId, @Action, @Resource, @IpAddress, @UserAgent, @Referrer, @Metadata, @LogType)`);\n+\n+        res.status(201).json({ message: \"Accesslog created successfully\" });\n     } catch (err) {\n-        console.error(err);\n-        res.status(500).json({ message: \"Error creating access log\" });\n+        console.error(\"Create Accesslog Error:\", err);\n+        res.status(500).json({ message: \"Failed to create accesslog\", error: err.message });\n     }\n }\n"
                },
                {
                    "date": 1763891839853,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,33 +1,27 @@\n import sql from \"mssql\";\n import { dbPool } from \"../server.js\"; // your dbPool from server.js\n \n-// Get all accesslogs\n+// Get all accesslogs getaccesslogs(req, res) {\n+    try {\n+     \n export async function getaccesslogs(req, res) {\n-    try {\n-        const pool = await dbPool;\n-        const result = await pool.request()\n-            .query(`SELECT TOP (1000) \n-                        [Id],\n-                        [TimestampUtc],\n-                        [UserId],\n-                        [Action],\n-                        [Resource],\n-                        [IpAddress],\n-                        [UserAgent],\n-                        [Referrer],\n-                        [Metadata],\n-                        [LogType]\n-                    FROM [EstateAccessManagementSystem].[dbo].[accesslogs]\n-                    ORDER BY [TimestampUtc] DESC`);\n-\n-        res.status(200).json(result.recordset);\n-    } catch (err) {\n-        console.error(\"Accesslogs Error:\", err);\n-        res.status(500).json({ message: \"Failed to fetch accesslogs\", error: err.message });\n-    }\n+  console.log(\"Request received at accesslogs route\");\n+  try {\n+    const result = await dbPool.request().query(`\n+      SELECT TOP (1000) \n+        [Id],[TimestampUtc],[UserId],[Action],[Resource],[IpAddress],\n+        [UserAgent],[Referrer],[Metadata],[LogType]\n+      FROM [accesslogs]\n+      ORDER BY [TimestampUtc] DESC\n+    `);\n+    console.log(\"Query returned\", result.recordset.length, \"rows\");\n+    res.json(result.recordset);\n+  } catch (err) {\n+    console.error(\"Error fetching access logs:\", err);\n+    res.status(500).json({ message: \"Error fetching logs\", error: err.message });\n+  }\n }\n-\n // Create a new accesslog\n export async function createaccesslog(req, res) {\n     const { UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType } = req.body;\n \n"
                },
                {
                    "date": 1763892147609,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,45 +1,60 @@\n import sql from \"mssql\";\n import { dbPool } from \"../server.js\"; // your dbPool from server.js\n \n-// Get all accesslogs getaccesslogs(req, res) {\n+// ================================\n+// GET ALL ACCESS LOGS\n+// ================================\n+export async function getaccesslogs(req, res) {\n+    console.log(\"Request received at accesslogs route\");\n+\n     try {\n-     \n-export async function getaccesslogs(req, res) {\n-  console.log(\"Request received at accesslogs route\");\n-  try {\n-    const result = await dbPool.request().query(`\n-      SELECT TOP (1000) \n-        [Id],[TimestampUtc],[UserId],[Action],[Resource],[IpAddress],\n-        [UserAgent],[Referrer],[Metadata],[LogType]\n-      FROM [accesslogs]\n-      ORDER BY [TimestampUtc] DESC\n-    `);\n-    console.log(\"Query returned\", result.recordset.length, \"rows\");\n-    res.json(result.recordset);\n-  } catch (err) {\n-    console.error(\"Error fetching access logs:\", err);\n-    res.status(500).json({ message: \"Error fetching logs\", error: err.message });\n-  }\n+        const result = await dbPool.request().query(`\n+            SELECT TOP (1000)\n+                [Id],\n+                [TimestampUtc],\n+                [UserId],\n+                [Action],\n+                [Resource],\n+                [IpAddress],\n+                [UserAgent],\n+                [Referrer],\n+                [Metadata],\n+                [LogType]\n+            FROM [EstateAccessManagementSystem].[dbo].[accesslogs]\n+            ORDER BY [TimestampUtc] DESC\n+        `);\n+\n+        console.log(\"Query returned\", result.recordset.length, \"rows\");\n+        res.json(result.recordset);\n+    } catch (err) {\n+        console.error(\"Error fetching access logs:\", err);\n+        res.status(500).json({ message: \"Error fetching logs\", error: err.message });\n+    }\n }\n-// Create a new accesslog\n+\n+// ================================\n+// CREATE NEW ACCESS LOG\n+// ================================\n export async function createaccesslog(req, res) {\n     const { UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType } = req.body;\n \n     try {\n-        const pool = await dbPool;\n-        await pool.request()\n+        await dbPool.request()\n             .input(\"UserId\", sql.Int, UserId)\n             .input(\"Action\", sql.VarChar(100), Action)\n             .input(\"Resource\", sql.VarChar(255), Resource)\n             .input(\"IpAddress\", sql.VarChar(50), IpAddress)\n             .input(\"UserAgent\", sql.VarChar(255), UserAgent)\n             .input(\"Referrer\", sql.VarChar(255), Referrer)\n             .input(\"Metadata\", sql.NVarChar(sql.MAX), Metadata)\n             .input(\"LogType\", sql.VarChar(50), LogType)\n-            .query(`INSERT INTO [EstateAccessManagementSystem].[dbo].[accesslogs] \n+            .query(`\n+                INSERT INTO [EstateAccessManagementSystem].[dbo].[accesslogs]\n                     (TimestampUtc, UserId, Action, Resource, IpAddress, UserAgent, Referrer, Metadata, LogType)\n-                    VALUES (GETUTCDATE(), @UserId, @Action, @Resource, @IpAddress, @UserAgent, @Referrer, @Metadata, @LogType)`);\n+                VALUES\n+                    (GETUTCDATE(), @UserId, @Action, @Resource, @IpAddress, @UserAgent, @Referrer, @Metadata, @LogType)\n+            `);\n \n         res.status(201).json({ message: \"Accesslog created successfully\" });\n     } catch (err) {\n         console.error(\"Create Accesslog Error:\", err);\n"
                }
            ],
            "date": 1763865366271,
            "name": "Commit-0",
            "content": "// backend/controllers/accesslogsController.js\nimport sql from \"mssql\";\nimport { dbPool } from \"../server.js\";\n\n/**\n * Get Access Logs with optional date filter\n * @route GET /api/accesslogs\n */\nexport const getaccesslogs = async (req, res) => {\n    try {\n        const { from, to } = req.query;\n\n        const pool = await dbPool;\n\n        let query = `\n            SELECT \n                Id,\n                TimestampUtc,\n                UserId,\n                Action,\n                Resource,\n                IpAddress,\n                UserAgent,\n                Referrer,\n                Metadata,\n                LogType\n            FROM accesslogs\n            WHERE 1 = 1\n        `;\n\n        if (from) query += ` AND TimestampUtc >= @from`;\n        if (to) query += ` AND TimestampUtc <= @to`;\n\n        const request = pool.request();\n        if (from) request.input(\"from\", sql.DateTime, new Date(from));\n        if (to) request.input(\"to\", sql.DateTime, new Date(to));\n\n        const result = await request.query(query);\n\n        res.status(200).json({\n            success: true,\n            total: result.recordset.length,\n            logs: result.recordset,\n        });\n    } catch (error) {\n        console.error(\"Get Logs Error: \", error);\n        res.status(500).json({ message: \"Server error fetching logs\" });\n    }\n};\n\n\n/**\n * Create a log entry (system use)\n * @route POST /api/accesslogs\n */\nexport const createAccessLog = async (req, res) => {\n    try {\n        const {\n            UserId,\n            Action,\n            Resource,\n            IpAddress,\n            UserAgent,\n            Referrer,\n            Metadata,\n            LogType\n        } = req.body;\n\n        const pool = await dbPool;\n\n        await pool.request()\n            .input(\"TimestampUtc\", sql.DateTime, new Date())\n            .input(\"UserId\", sql.VarChar(255), UserId)\n            .input(\"Action\", sql.VarChar(255), Action)\n            .input(\"Resource\", sql.VarChar(255), Resource)\n            .input(\"IpAddress\", sql.VarChar(255), IpAddress)\n            .input(\"UserAgent\", sql.VarChar(sql.MAX), UserAgent)\n            .input(\"Referrer\", sql.VarChar(255), Referrer)\n            .input(\"Metadata\", sql.VarChar(sql.MAX), Metadata)\n            .input(\"LogType\", sql.VarChar(50), LogType)\n            .query(`\n                INSERT INTO accesslogs (\n                    TimestampUtc, UserId, Action, Resource, \n                    IpAddress, UserAgent, Referrer, Metadata, LogType\n                )\n                VALUES (\n                    @TimestampUtc, @UserId, @Action, @Resource,\n                    @IpAddress, @UserAgent, @Referrer, @Metadata, @LogType\n                )\n            `);\n\n        res.status(201).json({ success: true, message: \"Log stored successfully\" });\n\n    } catch (error) {\n        console.error(\"Create Log Error: \", error);\n        res.status(500).json({ message: \"Server error saving log\" });\n    }\n};\n"
        }
    ]
}