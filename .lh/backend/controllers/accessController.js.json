{
    "sourceFile": "backend/controllers/accessController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1763862588350,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763863690657,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,29 +1,98 @@\n // backend/controllers/accessLogsController.js\n+import sql from \"mssql\";\n import { dbPool } from \"../server.js\";\n-import sql from \"mssql\";\n \n-// GET /api/access/logs\n+/**\n+ * Get Access Logs with optional date filter\n+ * @route GET /api/accesslogs\n+ */\n export const getAccessLogs = async (req, res) => {\n-  try {\n-    const pool = await dbPool;\n+    try {\n+        const { from, to } = req.query;\n \n-    const result = await pool.request().query(`\n-      SELECT \n-        id,\n-        timestamp,\n-        userId,\n-        action,\n-        resource,\n-        ipAddress,\n-        userAgent,\n-        logType\n-      FROM access_logs\n-      ORDER BY timestamp DESC\n-    `);\n+        const pool = await dbPool;\n \n-    res.json(result.recordset);\n-  } catch (err) {\n-    console.error(\"FAILED TO LOAD ACCESS LOGS:\", err);\n-    res.status(500).json({ message: \"Server error loading logs\" });\n-  }\n+        let query = `\n+            SELECT \n+                Id,\n+                TimestampUtc,\n+                UserId,\n+                Action,\n+                Resource,\n+                IpAddress,\n+                UserAgent,\n+                Referrer,\n+                Metadata,\n+                LogType\n+            FROM accesslogs\n+            WHERE 1 = 1\n+        `;\n+\n+        if (from) query += ` AND TimestampUtc >= @from`;\n+        if (to) query += ` AND TimestampUtc <= @to`;\n+\n+        const request = pool.request();\n+        if (from) request.input(\"from\", sql.DateTime, new Date(from));\n+        if (to) request.input(\"to\", sql.DateTime, new Date(to));\n+\n+        const result = await request.query(query);\n+\n+        res.status(200).json({\n+            success: true,\n+            total: result.recordset.length,\n+            logs: result.recordset,\n+        });\n+    } catch (error) {\n+        console.error(\"Get Logs Error: \", error);\n+        res.status(500).json({ message: \"Server error fetching logs\" });\n+    }\n };\n+\n+\n+/**\n+ * Create a log entry (system use)\n+ * @route POST /api/accesslogs\n+ */\n+export const createAccessLog = async (req, res) => {\n+    try {\n+        const {\n+            UserId,\n+            Action,\n+            Resource,\n+            IpAddress,\n+            UserAgent,\n+            Referrer,\n+            Metadata,\n+            LogType\n+        } = req.body;\n+\n+        const pool = await dbPool;\n+\n+        await pool.request()\n+            .input(\"TimestampUtc\", sql.DateTime, new Date())\n+            .input(\"UserId\", sql.VarChar(255), UserId)\n+            .input(\"Action\", sql.VarChar(255), Action)\n+            .input(\"Resource\", sql.VarChar(255), Resource)\n+            .input(\"IpAddress\", sql.VarChar(255), IpAddress)\n+            .input(\"UserAgent\", sql.VarChar(sql.MAX), UserAgent)\n+            .input(\"Referrer\", sql.VarChar(255), Referrer)\n+            .input(\"Metadata\", sql.VarChar(sql.MAX), Metadata)\n+            .input(\"LogType\", sql.VarChar(50), LogType)\n+            .query(`\n+                INSERT INTO accesslogs (\n+                    TimestampUtc, UserId, Action, Resource, \n+                    IpAddress, UserAgent, Referrer, Metadata, LogType\n+                )\n+                VALUES (\n+                    @TimestampUtc, @UserId, @Action, @Resource,\n+                    @IpAddress, @UserAgent, @Referrer, @Metadata, @LogType\n+                )\n+            `);\n+\n+        res.status(201).json({ success: true, message: \"Log stored successfully\" });\n+\n+    } catch (error) {\n+        console.error(\"Create Log Error: \", error);\n+        res.status(500).json({ message: \"Server error saving log\" });\n+    }\n+};\n"
                },
                {
                    "date": 1763864859653,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,9 @@\n /**\n  * Get Access Logs with optional date filter\n  * @route GET /api/accesslogs\n  */\n-export const getAccessLogs = async (req, res) => {\n+export const getaccesslogs = async (req, res) => {\n     try {\n         const { from, to } = req.query;\n \n         const pool = await dbPool;\n"
                }
            ],
            "date": 1763862588350,
            "name": "Commit-0",
            "content": "// backend/controllers/accessLogsController.js\nimport { dbPool } from \"../server.js\";\nimport sql from \"mssql\";\n\n// GET /api/access/logs\nexport const getAccessLogs = async (req, res) => {\n  try {\n    const pool = await dbPool;\n\n    const result = await pool.request().query(`\n      SELECT \n        id,\n        timestamp,\n        userId,\n        action,\n        resource,\n        ipAddress,\n        userAgent,\n        logType\n      FROM access_logs\n      ORDER BY timestamp DESC\n    `);\n\n    res.json(result.recordset);\n  } catch (err) {\n    console.error(\"FAILED TO LOAD ACCESS LOGS:\", err);\n    res.status(500).json({ message: \"Server error loading logs\" });\n  }\n};\n"
        }
    ]
}