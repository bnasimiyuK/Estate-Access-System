{
    "sourceFile": "frontend/js/adminsdashboard.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 92,
            "patches": [
                {
                    "date": 1763638300168,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763639253854,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -220,4 +220,35 @@\n     } catch (err) {\r\n         console.error(\"Error loading membership requests:\", err);\r\n     }\r\n }\r\n+async function loadMembershipRecords() {\r\n+    try {\r\n+        const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const members = await res.json();\r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        if (members.length === 0) {\r\n+            container.innerHTML = \"<p class='text-gray-500 text-center'>No membership records found.</p>\";\r\n+            return;\r\n+        }\r\n+        let html = `<ul class=\"space-y-2\">`;\r\n+        members.forEach(m => {\r\n+            if (m.Status === \"Approved\") {\r\n+                html += `<li class=\"bg-white shadow-md rounded-lg p-4 flex justify-between items-center\">\r\n+                            <div>\r\n+                                <p class=\"font-semibold\">${m.ResidentName}</p>\r\n+                                <p class=\"text-sm text-gray-500\">${m.NationalID} | ${m.HouseNumber} - ${m.CourtName}</p>\r\n+                            </div>\r\n+                          </li>`;\r\n+            }\r\n+        });\r\n+        html += `</ul>`;\r\n+        container.innerHTML = html;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading membership records:\", err);\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1763639427681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -251,4 +251,22 @@\n     } catch (err) {\r\n         console.error(\"Error loading membership records:\", err);\r\n     }\r\n }\r\n+\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n+        const page = btn.dataset.target;\r\n+        if (!page) return;\r\n+\r\n+        await loadPageIntoMainContent(page);\r\n+\r\n+        // Trigger data load for each page\r\n+        if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n+        if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n+        if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+        if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n+    });\r\n+});\r\n"
                },
                {
                    "date": 1763639527780,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,40 +18,45 @@\n async function loadPageIntoMainContent(url) {\r\n     try {\r\n         const res = await fetch(url);\r\n         if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+\r\n         const html = await res.text();\r\n         mainContentArea.innerHTML = html;\r\n \r\n-        // For subsequent (non-initial) dashboard loads (via button click), \r\n-        // we call the functions directly after innerHTML.\r\n+        // If dashboard loaded into main content\r\n         if (url.includes(\"dashboardoverview.html\")) {\r\n-            // NOTE: We don't need setTimeout here for subsequent clicks, \r\n-            // as the initial load issue is bypassed.\r\n-            await loadDashboardSummary(); \r\n+            await loadDashboardSummary();\r\n             await loadAccessChart();\r\n         }\r\n     } catch (err) {\r\n         console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+        mainContentArea.innerHTML =\r\n+            `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n     }\r\n }\r\n \r\n+// Sidebar routing\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n         sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n         btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n         const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n+        if (!page) return;\r\n+\r\n+        await loadPageIntoMainContent(page);\r\n+\r\n+        // Trigger dynamic page data loads\r\n+        if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n+        if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n+        if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+        if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n     });\r\n });\r\n \r\n-// *** REMOVED: loadPageIntoMainContent(\"sections/dashboardoverview.html\"); ***\r\n-// The initial page load is handled by the index.html content itself.\r\n-\r\n // ================================\r\n-// VISITOR MANAGEMENT TOGGLE\r\n+// VISITOR MANAGEMENT DROPDOWN\r\n // ================================\r\n const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n const visitorArrow = document.getElementById(\"visitorArrow\");\r\n@@ -68,11 +73,9 @@\n     const element = document.getElementById(id);\r\n     if (element) {\r\n         element.textContent = value + suffix;\r\n     } else {\r\n-        // This warning should now only appear if an ID is misspelled \r\n-        // or a sidebar page is missing the element.\r\n-        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n+        console.warn(`Element with ID '${id}' not found.`);\r\n     }\r\n };\r\n \r\n // ================================\r\n@@ -82,9 +85,11 @@\n     try {\r\n         const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n+\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n         const data = await res.json();\r\n \r\n         safeUpdate(\"totalResidents\", data.residents || 0);\r\n         safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n@@ -103,15 +108,18 @@\n     try {\r\n         const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n+\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n         const data = await res.json();\r\n \r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n+        const canvas = document.getElementById(\"accessChart\");\r\n+        if (!canvas) return;\r\n \r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n+        const ctx = canvas.getContext(\"2d\");\r\n+\r\n         new Chart(ctx, {\r\n             type: \"line\",\r\n             data: {\r\n                 labels: data.days || [],\r\n@@ -119,10 +127,10 @@\n                     label: \"Access Attempts\",\r\n                     data: data.counts || [],\r\n                     borderWidth: 2,\r\n                     tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    borderColor: \"#2563eb\",\r\n+                    backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n                     fill: true\r\n                 }]\r\n             },\r\n             options: { responsive: true, maintainAspectRatio: false }\r\n@@ -133,74 +141,80 @@\n     }\r\n }\r\n \r\n // ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n+// INITIAL DASHBOARD LOAD\r\n // ================================\r\n-/**\r\n- * Run this function once on initial page load.\r\n- * Since the Dashboard Overview content is ALREADY present in index.html, \r\n- * we can call the data functions directly without a wrapper or delay.\r\n- */\r\n (async function initializeDashboard() {\r\n     await loadDashboardSummary();\r\n     await loadAccessChart();\r\n })();\r\n+\r\n+// ================================\r\n+// MEMBERSHIP REQUESTS\r\n+// ================================\r\n async function loadMembershipRequests() {\r\n     try {\r\n         const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n         const requests = await res.json();\r\n-\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         if (requests.length === 0) {\r\n             container.innerHTML = \"<p class='text-gray-500 text-center'>No membership requests found.</p>\";\r\n             return;\r\n         }\r\n \r\n-        let html = `<table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                        <thead class=\"bg-gray-200\">\r\n-                            <tr>\r\n-                                <th class=\"py-2 px-4\">Name</th>\r\n-                                <th class=\"py-2 px-4\">National ID</th>\r\n-                                <th class=\"py-2 px-4\">Phone</th>\r\n-                                <th class=\"py-2 px-4\">Email</th>\r\n-                                <th class=\"py-2 px-4\">House</th>\r\n-                                <th class=\"py-2 px-4\">Court</th>\r\n-                                <th class=\"py-2 px-4\">Status</th>\r\n-                                <th class=\"py-2 px-4\">Requested At</th>\r\n-                                <th class=\"py-2 px-4\">Actions</th>\r\n-                            </tr>\r\n-                        </thead>\r\n-                        <tbody>`;\r\n+        let html = `\r\n+            <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                <thead class=\"bg-gray-200\">\r\n+                    <tr>\r\n+                        <th class=\"py-2 px-4\">Name</th>\r\n+                        <th class=\"py-2 px-4\">National ID</th>\r\n+                        <th class=\"py-2 px-4\">Phone</th>\r\n+                        <th class=\"py-2 px-4\">Email</th>\r\n+                        <th class=\"py-2 px-4\">House</th>\r\n+                        <th class=\"py-2 px-4\">Court</th>\r\n+                        <th class=\"py-2 px-4\">Status</th>\r\n+                        <th class=\"py-2 px-4\">Requested At</th>\r\n+                        <th class=\"py-2 px-4\">Actions</th>\r\n+                    </tr>\r\n+                </thead>\r\n+                <tbody>\r\n+        `;\r\n \r\n         requests.forEach(r => {\r\n-            html += `<tr class=\"border-b\">\r\n-                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n-                        <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n-                        <td class=\"py-2 px-4\">${r.Email}</td>\r\n-                        <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n-                        <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.Status}</td>\r\n-                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                        <td class=\"py-2 px-4\">\r\n-                            ${r.Status === \"Pending\" ? `<button class=\"approve-btn bg-green-500 px-2 py-1 text-white rounded\" data-id=\"${r.RequestID}\">Approve</button>` : \"\"}\r\n-                        </td>\r\n-                     </tr>`;\r\n+            html += `\r\n+                <tr class=\"border-b\">\r\n+                    <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n+                    <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n+                    <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n+                    <td class=\"py-2 px-4\">${r.Email}</td>\r\n+                    <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n+                    <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n+                    <td class=\"py-2 px-4\">${r.Status}</td>\r\n+                    <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n+                    <td class=\"py-2 px-4\">\r\n+                        ${r.Status === \"Pending\"\r\n+                            ? `<button class=\"approve-btn bg-green-500 px-2 py-1 text-white rounded\" data-id=\"${r.RequestID}\">Approve</button>`\r\n+                            : \"\"\r\n+                        }\r\n+                    </td>\r\n+                </tr>`;\r\n         });\r\n \r\n         html += `</tbody></table>`;\r\n         container.innerHTML = html;\r\n \r\n-        // Add click handlers for approve buttons\r\n+        // Approve buttons\r\n         document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n-            btn.addEventListener(\"click\", async (e) => {\r\n+            btn.addEventListener(\"click\", async () => {\r\n                 const requestId = btn.dataset.id;\r\n+\r\n                 try {\r\n                     const resp = await fetch(\"http://localhost:4050/api/admin/approveResident\", {\r\n                         method: \"POST\",\r\n                         headers: {\r\n@@ -208,10 +222,12 @@\n                             \"Authorization\": `Bearer ${token}`\r\n                         },\r\n                         body: JSON.stringify({ requestId })\r\n                     });\r\n+\r\n                     if (!resp.ok) throw new Error(\"Failed to approve\");\r\n-                    btn.parentElement.textContent = \"Approved ✅\";\r\n+\r\n+                    btn.parentElement.textContent = \"Approved ✔️\";\r\n                 } catch (err) {\r\n                     alert(\"Error approving request: \" + err.message);\r\n                 }\r\n             });\r\n@@ -220,53 +236,46 @@\n     } catch (err) {\r\n         console.error(\"Error loading membership requests:\", err);\r\n     }\r\n }\r\n+\r\n+// ================================\r\n+// MEMBERSHIP RECORDS\r\n+// ================================\r\n async function loadMembershipRecords() {\r\n     try {\r\n         const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n+\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n         const members = await res.json();\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n+\r\n         if (members.length === 0) {\r\n             container.innerHTML = \"<p class='text-gray-500 text-center'>No membership records found.</p>\";\r\n             return;\r\n         }\r\n+\r\n         let html = `<ul class=\"space-y-2\">`;\r\n+\r\n         members.forEach(m => {\r\n             if (m.Status === \"Approved\") {\r\n-                html += `<li class=\"bg-white shadow-md rounded-lg p-4 flex justify-between items-center\">\r\n-                            <div>\r\n-                                <p class=\"font-semibold\">${m.ResidentName}</p>\r\n-                                <p class=\"text-sm text-gray-500\">${m.NationalID} | ${m.HouseNumber} - ${m.CourtName}</p>\r\n-                            </div>\r\n-                          </li>`;\r\n+                html += `\r\n+                    <li class=\"bg-white shadow-md rounded-lg p-4 flex justify-between\">\r\n+                        <div>\r\n+                            <p class=\"font-semibold\">${m.ResidentName}</p>\r\n+                            <p class=\"text-gray-500 text-sm\">${m.NationalID} | ${m.HouseNumber} - ${m.CourtName}</p>\r\n+                        </div>\r\n+                    </li>`;\r\n             }\r\n         });\r\n-        html += `</ul>`;\r\n+\r\n+        html += \"</ul>\";\r\n         container.innerHTML = html;\r\n \r\n     } catch (err) {\r\n         console.error(\"Error loading membership records:\", err);\r\n     }\r\n }\r\n-\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (!page) return;\r\n-\r\n-        await loadPageIntoMainContent(page);\r\n-\r\n-        // Trigger data load for each page\r\n-        if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n-        if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n-        if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-        if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n-    });\r\n-});\r\n"
                },
                {
                    "date": 1763640427520,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,11 +1,21 @@\n+// =======================================================\r\n+// FIREBASE CONFIG (Required setup, even if not fully used)\r\n+// =======================================================\r\n+// This ensures the environment is recognized, though current storage is localStorage/API.\r\n+const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n+const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n+// const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\r\n+// You would use these variables if switching to Firestore/Firebase Auth.\r\n+\r\n+\r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n const token = localStorage.getItem(\"accessToken\");\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n     window.location.href = \"/login.html\";\r\n });\r\n \r\n@@ -14,17 +24,21 @@\n // ================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+/**\r\n+ * Fetches and loads HTML content into the main content area.\r\n+ * @param {string} url The URL of the page to load.\r\n+ */\r\n async function loadPageIntoMainContent(url) {\r\n     try {\r\n         const res = await fetch(url);\r\n         if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n \r\n         const html = await res.text();\r\n         mainContentArea.innerHTML = html;\r\n \r\n-        // If dashboard loaded into main content\r\n+        // If dashboard loaded into main content, trigger its data loads\r\n         if (url.includes(\"dashboardoverview.html\")) {\r\n             await loadDashboardSummary();\r\n             await loadAccessChart();\r\n         }\r\n@@ -37,39 +51,53 @@\n \r\n // Sidebar routing\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n+        // Update active state for sidebar buttons\r\n         sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n         btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n         const page = btn.dataset.target;\r\n         if (!page) return;\r\n \r\n         await loadPageIntoMainContent(page);\r\n \r\n-        // Trigger dynamic page data loads\r\n+        // Trigger dynamic page data loads after content is inserted\r\n         if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n         if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n         if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n         if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n+        \r\n+        // Note: loadVisitorsList and loadPaymentRecords are placeholders \r\n+        // as their functions were not provided, but the event listeners are preserved.\r\n     });\r\n });\r\n \r\n+// Placeholder functions for pages whose data loaders were not provided\r\n+async function loadVisitorsList() { console.log('Loading visitors list...'); }\r\n+async function loadPaymentRecords() { console.log('Loading payment records...'); }\r\n+\r\n // ================================\r\n // VISITOR MANAGEMENT DROPDOWN\r\n // ================================\r\n const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-visitorToggle.addEventListener(\"click\", () => {\r\n-    visitorSubMenu.classList.toggle(\"hidden\");\r\n-    visitorArrow.classList.toggle(\"rotate-90\");\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n });\r\n \r\n // ================================\r\n // SAFE UPDATE HELPER\r\n // ================================\r\n+/**\r\n+ * Safely updates the text content of an element by ID.\r\n+ * @param {string} id Element ID.\r\n+ * @param {string|number} value New value.\r\n+ * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n+ */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n     const element = document.getElementById(id);\r\n     if (element) {\r\n         element.textContent = value + suffix;\r\n@@ -96,9 +124,9 @@\n         safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n         safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n     } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n+        console.error(\"Error loading dashboard summary:\", err);\r\n     }\r\n }\r\n \r\n // ================================\r\n@@ -116,8 +144,14 @@\n \r\n         const canvas = document.getElementById(\"accessChart\");\r\n         if (!canvas) return;\r\n \r\n+        // Ensure Chart.js is available globally before calling new Chart\r\n+        if (typeof Chart === 'undefined') {\r\n+            console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n+            return;\r\n+        }\r\n+\r\n         const ctx = canvas.getContext(\"2d\");\r\n \r\n         new Chart(ctx, {\r\n             type: \"line\",\r\n@@ -136,18 +170,31 @@\n             options: { responsive: true, maintainAspectRatio: false }\r\n         });\r\n \r\n     } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n+        console.error(\"Error loading access chart:\", err);\r\n     }\r\n }\r\n \r\n // ================================\r\n // INITIAL DASHBOARD LOAD\r\n // ================================\r\n+// This runs on page load and assumes the dashboard HTML structure is initially present.\r\n (async function initializeDashboard() {\r\n-    await loadDashboardSummary();\r\n-    await loadAccessChart();\r\n+    // Only attempt to load if the content area is empty or specific dashboard elements exist\r\n+    if (document.getElementById(\"totalResidents\")) {\r\n+        await loadDashboardSummary();\r\n+        await loadAccessChart();\r\n+    } else {\r\n+        // If the main page structure implies dashboard is default, load it.\r\n+        // Assuming dashboardoverview.html is the default page.\r\n+        // Find the dashboard button and simulate a click to ensure the content is loaded first.\r\n+        const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n+        if(dashboardBtn) {\r\n+            dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+            await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n+        }\r\n+    }\r\n })();\r\n \r\n // ================================\r\n // MEMBERSHIP REQUESTS\r\n@@ -171,49 +218,54 @@\n         let html = `\r\n             <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n                 <thead class=\"bg-gray-200\">\r\n                     <tr>\r\n-                        <th class=\"py-2 px-4\">Name</th>\r\n-                        <th class=\"py-2 px-4\">National ID</th>\r\n-                        <th class=\"py-2 px-4\">Phone</th>\r\n-                        <th class=\"py-2 px-4\">Email</th>\r\n-                        <th class=\"py-2 px-4\">House</th>\r\n-                        <th class=\"py-2 px-4\">Court</th>\r\n-                        <th class=\"py-2 px-4\">Status</th>\r\n-                        <th class=\"py-2 px-4\">Requested At</th>\r\n-                        <th class=\"py-2 px-4\">Actions</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">National ID</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Phone</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Email</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Court</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n                     </tr>\r\n                 </thead>\r\n                 <tbody>\r\n         `;\r\n \r\n         requests.forEach(r => {\r\n+            const rowClass = r.Status === \"Approved\" ? \"bg-green-50\" : r.Status === \"Pending\" ? \"hover:bg-yellow-50\" : \"bg-red-50\";\r\n             html += `\r\n-                <tr class=\"border-b\">\r\n+                <tr class=\"border-b ${rowClass}\">\r\n                     <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n                     <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n                     <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n                     <td class=\"py-2 px-4\">${r.Email}</td>\r\n                     <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n                     <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n-                    <td class=\"py-2 px-4\">${r.Status}</td>\r\n+                    <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n                     <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                    <td class=\"py-2 px-4\">\r\n+                    <td class=\"py-2 px-4 action-cell\">\r\n                         ${r.Status === \"Pending\"\r\n-                            ? `<button class=\"approve-btn bg-green-500 px-2 py-1 text-white rounded\" data-id=\"${r.RequestID}\">Approve</button>`\r\n-                            : \"\"\r\n+                            ? `<button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>`\r\n+                            : `<span class=\"text-gray-500 text-sm\">${r.Status}</span>`\r\n                         }\r\n                     </td>\r\n                 </tr>`;\r\n         });\r\n \r\n         html += `</tbody></table>`;\r\n         container.innerHTML = html;\r\n \r\n-        // Approve buttons\r\n+        // Approve buttons event listeners\r\n         document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n             btn.addEventListener(\"click\", async () => {\r\n                 const requestId = btn.dataset.id;\r\n+                const originalText = btn.textContent;\r\n+                \r\n+                btn.disabled = true;\r\n+                btn.textContent = 'Processing...';\r\n \r\n                 try {\r\n                     const resp = await fetch(\"http://localhost:4050/api/admin/approveResident\", {\r\n                         method: \"POST\",\r\n@@ -223,19 +275,49 @@\n                         },\r\n                         body: JSON.stringify({ requestId })\r\n                     });\r\n \r\n-                    if (!resp.ok) throw new Error(\"Failed to approve\");\r\n+                    if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n \r\n-                    btn.parentElement.textContent = \"Approved ✔️\";\r\n+                    // Success handling: update the UI\r\n+                    const actionCell = btn.parentElement;\r\n+                    const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n+                    \r\n+                    if (statusCell) {\r\n+                        statusCell.textContent = 'Approved';\r\n+                        statusCell.classList.add('font-bold', 'text-green-600');\r\n+                    }\r\n+                    actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n+                    \r\n+                    // Optional: Reload the list to refresh the status of all requests\r\n+                    // await loadMembershipRequests();\r\n+\r\n                 } catch (err) {\r\n-                    alert(\"Error approving request: \" + err.message);\r\n+                    console.error(\"Error approving request:\", err.message);\r\n+                    \r\n+                    // Failure handling: revert button and show error visually (non-alert)\r\n+                    btn.disabled = false;\r\n+                    btn.textContent = 'Failed!';\r\n+                    btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n+                    btn.classList.add('bg-red-500', 'animate-pulse');\r\n+\r\n+                    // Reset after a short period\r\n+                    setTimeout(() => {\r\n+                        btn.textContent = originalText;\r\n+                        btn.classList.remove('bg-red-500', 'animate-pulse');\r\n+                        btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n+                    }, 2000);\r\n+                    \r\n                 }\r\n             });\r\n         });\r\n \r\n     } catch (err) {\r\n         console.error(\"Error loading membership requests:\", err);\r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (container) {\r\n+             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n+        }\r\n     }\r\n }\r\n \r\n // ================================\r\n@@ -252,30 +334,41 @@\n         const members = await res.json();\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n-        if (members.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No membership records found.</p>\";\r\n+        // Filter for only approved members for the records section\r\n+        const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+\r\n+        if (approvedMembers.length === 0) {\r\n+            container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n             return;\r\n         }\r\n \r\n-        let html = `<ul class=\"space-y-2\">`;\r\n+        let html = `<ul class=\"space-y-3 p-4\">`;\r\n \r\n-        members.forEach(m => {\r\n-            if (m.Status === \"Approved\") {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow-md rounded-lg p-4 flex justify-between\">\r\n-                        <div>\r\n-                            <p class=\"font-semibold\">${m.ResidentName}</p>\r\n-                            <p class=\"text-gray-500 text-sm\">${m.NationalID} | ${m.HouseNumber} - ${m.CourtName}</p>\r\n-                        </div>\r\n-                    </li>`;\r\n-            }\r\n+        approvedMembers.forEach(m => {\r\n+            html += `\r\n+                <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n+                    <div>\r\n+                        <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n+                        <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n+                        <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n+                    </div>\r\n+                    <div class=\"text-right\">\r\n+                         <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n+                            Active\r\n+                        </span>\r\n+                    </div>\r\n+                </li>`;\r\n         });\r\n \r\n         html += \"</ul>\";\r\n         container.innerHTML = html;\r\n \r\n     } catch (err) {\r\n         console.error(\"Error loading membership records:\", err);\r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (container) {\r\n+             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n+        }\r\n     }\r\n-}\r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763664935250,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,18 +1,19 @@\n // =======================================================\r\n-// FIREBASE CONFIG (Required setup, even if not fully used)\r\n+// CONFIGURATION & SETUP\r\n // =======================================================\r\n-// This ensures the environment is recognized, though current storage is localStorage/API.\r\n+// 1. Centralized API Host for all backend connections\r\n+const API_HOST = \"http://localhost:4050\"; \r\n+\r\n const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n-// const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\r\n-// You would use these variables if switching to Firestore/Firebase Auth.\r\n \r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n const token = localStorage.getItem(\"accessToken\");\r\n+// Redirects to login if no access token is found\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n@@ -36,9 +37,9 @@\n \r\n         const html = await res.text();\r\n         mainContentArea.innerHTML = html;\r\n \r\n-        // If dashboard loaded into main content, trigger its data loads\r\n+        // Trigger dashboard specific loads immediately after content is inserted\r\n         if (url.includes(\"dashboardoverview.html\")) {\r\n             await loadDashboardSummary();\r\n             await loadAccessChart();\r\n         }\r\n@@ -48,9 +49,9 @@\n             `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n     }\r\n }\r\n \r\n-// Sidebar routing\r\n+// Sidebar routing: Handles content loading and dynamic data fetching\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n         // Update active state for sidebar buttons\r\n         sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n@@ -65,18 +66,119 @@\n         if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n         if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n         if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n         if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n-        \r\n-        // Note: loadVisitorsList and loadPaymentRecords are placeholders \r\n-        // as their functions were not provided, but the event listeners are preserved.\r\n     });\r\n });\r\n \r\n-// Placeholder functions for pages whose data loaders were not provided\r\n-async function loadVisitorsList() { console.log('Loading visitors list...'); }\r\n-async function loadPaymentRecords() { console.log('Loading payment records...'); }\r\n+// ================================\r\n+// DYNAMIC CONTENT LOADERS (Now Fully Implemented)\r\n+// ================================\r\n \r\n+/**\r\n+ * Loads and displays payment records from the API.\r\n+ */\r\n+async function loadPaymentRecords() { \r\n+    console.log('Fetching payment records...'); \r\n+    const container = document.getElementById(\"dynamic-section-content\");\r\n+    if (!container) return;\r\n+    \r\n+    container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n+    \r\n+    try {\r\n+        const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        \r\n+        const payments = await res.json();\r\n+        \r\n+        if (payments.length === 0) {\r\n+            container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n+            return;\r\n+        }\r\n+\r\n+        // Basic HTML rendering for payments table\r\n+        let html = `\r\n+            <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                <thead class=\"bg-gray-200\">\r\n+                    <tr>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                    </tr>\r\n+                </thead>\r\n+                <tbody>\r\n+        `;\r\n+\r\n+        payments.forEach(p => {\r\n+            const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n+            const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n+            const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n+\r\n+            html += `\r\n+                <tr class=\"border-b hover:bg-gray-50\">\r\n+                    <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n+                    <td class=\"py-2 px-4\">${date}</td>\r\n+                    <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n+                </tr>`;\r\n+        });\r\n+\r\n+        html += `</tbody></table>`;\r\n+        container.innerHTML = html;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading payment records:\", err);\r\n+        container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n+    }\r\n+}\r\n+\r\n+\r\n+/**\r\n+ * Loads and displays visitors list data from the API.\r\n+ */\r\n+async function loadVisitorsList() { \r\n+    console.log('Fetching visitors list...'); \r\n+    const container = document.getElementById(\"dynamic-section-content\");\r\n+    if (!container) return;\r\n+\r\n+    container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n+\r\n+    try {\r\n+        const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        \r\n+        const data = await res.json();\r\n+        \r\n+        if (data.length === 0) {\r\n+            container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n+            return;\r\n+        }\r\n+\r\n+        // Example rendering for visitors (adjust fields based on actual API data)\r\n+        let html = `<ul class=\"space-y-3 p-4\">`;\r\n+        data.forEach(v => {\r\n+            html += `\r\n+                <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n+                    <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n+                    <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n+                    <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n+                </li>`;\r\n+        });\r\n+        html += \"</ul>\";\r\n+        container.innerHTML = html;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading visitors list:\", err);\r\n+        container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n+    }\r\n+}\r\n+\r\n+\r\n // ================================\r\n // VISITOR MANAGEMENT DROPDOWN\r\n // ================================\r\n const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n@@ -110,9 +212,9 @@\n // DASHBOARD SUMMARY\r\n // ================================\r\n async function loadDashboardSummary() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n+        const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n@@ -133,9 +235,9 @@\n // ACCESS CHART\r\n // ================================\r\n async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n+        const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n@@ -144,9 +246,8 @@\n \r\n         const canvas = document.getElementById(\"accessChart\");\r\n         if (!canvas) return;\r\n \r\n-        // Ensure Chart.js is available globally before calling new Chart\r\n         if (typeof Chart === 'undefined') {\r\n             console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n             return;\r\n         }\r\n@@ -177,18 +278,16 @@\n \r\n // ================================\r\n // INITIAL DASHBOARD LOAD\r\n // ================================\r\n-// This runs on page load and assumes the dashboard HTML structure is initially present.\r\n+// This runs on page load. It defaults to loading the dashboard overview.\r\n (async function initializeDashboard() {\r\n-    // Only attempt to load if the content area is empty or specific dashboard elements exist\r\n+    // If specific dashboard elements exist, load data directly\r\n     if (document.getElementById(\"totalResidents\")) {\r\n         await loadDashboardSummary();\r\n         await loadAccessChart();\r\n     } else {\r\n-        // If the main page structure implies dashboard is default, load it.\r\n-        // Assuming dashboardoverview.html is the default page.\r\n-        // Find the dashboard button and simulate a click to ensure the content is loaded first.\r\n+        // Otherwise, simulate a click on the dashboard button to load content and data\r\n         const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n         if(dashboardBtn) {\r\n             dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n             await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n@@ -200,9 +299,9 @@\n // MEMBERSHIP REQUESTS\r\n // ================================\r\n async function loadMembershipRequests() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n+        const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n@@ -266,9 +365,9 @@\n                 btn.disabled = true;\r\n                 btn.textContent = 'Processing...';\r\n \r\n                 try {\r\n-                    const resp = await fetch(\"http://localhost:4050/api/admin/approveResident\", {\r\n+                    const resp = await fetch(`${API_HOST}/api/admin/approveResident`, {\r\n                         method: \"POST\",\r\n                         headers: {\r\n                             \"Content-Type\": \"application/json\",\r\n                             \"Authorization\": `Bearer ${token}`\r\n@@ -287,15 +386,12 @@\n                         statusCell.classList.add('font-bold', 'text-green-600');\r\n                     }\r\n                     actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n                     \r\n-                    // Optional: Reload the list to refresh the status of all requests\r\n-                    // await loadMembershipRequests();\r\n-\r\n                 } catch (err) {\r\n                     console.error(\"Error approving request:\", err.message);\r\n                     \r\n-                    // Failure handling: revert button and show error visually (non-alert)\r\n+                    // Failure handling: revert button and show error visually\r\n                     btn.disabled = false;\r\n                     btn.textContent = 'Failed!';\r\n                     btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n                     btn.classList.add('bg-red-500', 'animate-pulse');\r\n@@ -324,9 +420,9 @@\n // MEMBERSHIP RECORDS\r\n // ================================\r\n async function loadMembershipRecords() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n+        const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n \r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n@@ -353,9 +449,9 @@\n                         <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n                         <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n                     </div>\r\n                     <div class=\"text-right\">\r\n-                         <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n+                       <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n                             Active\r\n                         </span>\r\n                     </div>\r\n                 </li>`;\r\n"
                },
                {
                    "date": 1763667064103,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,470 +1,488 @@\n-// =======================================================\r\n-// CONFIGURATION & SETUP\r\n-// =======================================================\r\n-// 1. Centralized API Host for all backend connections\r\n-const API_HOST = \"http://localhost:4050\"; \r\n+/**\r\n+ * Admin Dashboard Client-Side JavaScript\r\n+ * Uses Fetch API to communicate with a Node.js/Express Backend (API_HOST)\r\n+ */\r\n+(async function initializeDashboard() {\r\n+    // =======================================================\r\n+    // CONFIGURATION & INITIAL STATE\r\n+    // =======================================================\r\n+    // 1. Centralized API Host for all backend connections\r\n+    const API_HOST = \"http://localhost:4050\"; \r\n \r\n-const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n-const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n+    // Remove unused/legacy Firebase config variables\r\n+    // const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n+    // const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n \r\n+    // 2. Auth State Check & Token Retrieval\r\n+    const token = localStorage.getItem(\"accessToken\");\r\n+    \r\n+    // Redirects to login if no access token is found\r\n+    if (!token) {\r\n+        window.location.href = \"/login.html\";\r\n+        return; // Stop execution if redirecting\r\n+    }\r\n \r\n-// ================================\r\n-// AUTH & LOGOUT\r\n-// ================================\r\n-const token = localStorage.getItem(\"accessToken\");\r\n-// Redirects to login if no access token is found\r\n-if (!token) window.location.href = \"/login.html\";\r\n+    // DOM Elements\r\n+    const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+    const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n-});\r\n \r\n-// ================================\r\n-// SIDEBAR PAGE LOADING\r\n-// ================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n+    // ================================\r\n+    // UTILITIES\r\n+    // ================================\r\n \r\n-/**\r\n- * Fetches and loads HTML content into the main content area.\r\n- * @param {string} url The URL of the page to load.\r\n- */\r\n-async function loadPageIntoMainContent(url) {\r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html;\r\n-\r\n-        // Trigger dashboard specific loads immediately after content is inserted\r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary();\r\n-            await loadAccessChart();\r\n+    /**\r\n+     * Safely updates the text content of an element by ID.\r\n+     * @param {string} id Element ID.\r\n+     * @param {string|number} value New value.\r\n+     * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n+     */\r\n+    const safeUpdate = (id, value, suffix = '') => {\r\n+        const element = document.getElementById(id);\r\n+        if (element) {\r\n+            element.textContent = value + suffix;\r\n+        } else {\r\n+            // console.warn(`Element with ID '${id}' not found.`); // Keep silent for clean console\r\n         }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML =\r\n-            `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n-    }\r\n-}\r\n+    };\r\n+    \r\n+    // ================================\r\n+    // DYNAMIC CONTENT LOADERS (API INTERACTION)\r\n+    // ================================\r\n \r\n-// Sidebar routing: Handles content loading and dynamic data fetching\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        // Update active state for sidebar buttons\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+    /**\r\n+     * Loads and displays payment records from the API.\r\n+     */\r\n+    async function loadPaymentRecords() { \r\n+        console.log('Fetching payment records...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n+        \r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const payments = await res.json();\r\n+            \r\n+            if (payments.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n+                return;\r\n+            }\r\n \r\n-        const page = btn.dataset.target;\r\n-        if (!page) return;\r\n+            // Basic HTML rendering for payments table\r\n+            let html = `\r\n+                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                    <thead class=\"bg-gray-200\">\r\n+                        <tr>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                        </tr>\r\n+                    </thead>\r\n+                    <tbody>\r\n+            `;\r\n \r\n-        await loadPageIntoMainContent(page);\r\n+            payments.forEach(p => {\r\n+                const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n+                const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n+                const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n \r\n-        // Trigger dynamic page data loads after content is inserted\r\n-        if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n-        if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n-        if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-        if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n-    });\r\n-});\r\n+                html += `\r\n+                    <tr class=\"border-b hover:bg-gray-50\">\r\n+                        <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n+                        <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n+                        <td class=\"py-2 px-4\">${date}</td>\r\n+                        <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n+                    </tr>`;\r\n+            });\r\n \r\n-// ================================\r\n-// DYNAMIC CONTENT LOADERS (Now Fully Implemented)\r\n-// ================================\r\n+            html += `</tbody></table>`;\r\n+            container.innerHTML = html;\r\n \r\n-/**\r\n- * Loads and displays payment records from the API.\r\n- */\r\n-async function loadPaymentRecords() { \r\n-    console.log('Fetching payment records...'); \r\n-    const container = document.getElementById(\"dynamic-section-content\");\r\n-    if (!container) return;\r\n-    \r\n-    container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n-    \r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        \r\n-        const payments = await res.json();\r\n-        \r\n-        if (payments.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n-            return;\r\n+        } catch (err) {\r\n+            console.error(\"Error loading payment records:\", err);\r\n+            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n         }\r\n+    }\r\n \r\n-        // Basic HTML rendering for payments table\r\n-        let html = `\r\n-            <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                <thead class=\"bg-gray-200\">\r\n-                    <tr>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                    </tr>\r\n-                </thead>\r\n-                <tbody>\r\n-        `;\r\n+    /**\r\n+     * Loads and displays visitors list data from the API.\r\n+     */\r\n+    async function loadVisitorsList() { \r\n+        console.log('Fetching visitors list...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n \r\n-        payments.forEach(p => {\r\n-            const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n-            const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n-            const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n \r\n-            html += `\r\n-                <tr class=\"border-b hover:bg-gray-50\">\r\n-                    <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n-                    <td class=\"py-2 px-4\">${date}</td>\r\n-                    <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n-                </tr>`;\r\n-        });\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const data = await res.json();\r\n+            \r\n+            if (data.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n+                return;\r\n+            }\r\n \r\n-        html += `</tbody></table>`;\r\n-        container.innerHTML = html;\r\n+            // Example rendering for visitors (adjust fields based on actual API data)\r\n+            let html = `<ul class=\"space-y-3 p-4\">`;\r\n+            data.forEach(v => {\r\n+                html += `\r\n+                    <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n+                        <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n+                        <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n+                        <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n+                    </li>`;\r\n+            });\r\n+            html += \"</ul>\";\r\n+            container.innerHTML = html;\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading payment records:\", err);\r\n-        container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n+        } catch (err) {\r\n+            console.error(\"Error loading visitors list:\", err);\r\n+            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n+        }\r\n     }\r\n-}\r\n \r\n \r\n-/**\r\n- * Loads and displays visitors list data from the API.\r\n- */\r\n-async function loadVisitorsList() { \r\n-    console.log('Fetching visitors list...'); \r\n-    const container = document.getElementById(\"dynamic-section-content\");\r\n-    if (!container) return;\r\n+    /**\r\n+     * Loads and displays membership records (approved members) from the API.\r\n+     */\r\n+    async function loadMembershipRecords() {\r\n+        console.log('Fetching membership records...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n \r\n-    container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n+        try {\r\n+            // Note: This API endpoint seems to return ALL membership states.\r\n+            const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n \r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        \r\n-        const data = await res.json();\r\n-        \r\n-        if (data.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n-            return;\r\n-        }\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-        // Example rendering for visitors (adjust fields based on actual API data)\r\n-        let html = `<ul class=\"space-y-3 p-4\">`;\r\n-        data.forEach(v => {\r\n-            html += `\r\n-                <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n-                    <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n-                    <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n-                    <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n-                </li>`;\r\n-        });\r\n-        html += \"</ul>\";\r\n-        container.innerHTML = html;\r\n+            const members = await res.json();\r\n+            \r\n+            // Filter for only approved members for the records section\r\n+            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitors list:\", err);\r\n-        container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n-    }\r\n-}\r\n+            if (approvedMembers.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n+                return;\r\n+            }\r\n \r\n+            let html = `<ul class=\"space-y-3 p-4\">`;\r\n \r\n-// ================================\r\n-// VISITOR MANAGEMENT DROPDOWN\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+            approvedMembers.forEach(m => {\r\n+                html += `\r\n+                    <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n+                        <div>\r\n+                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n+                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n+                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n+                        </div>\r\n+                        <div class=\"text-right\">\r\n+                           <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n+                                Active\r\n+                           </span>\r\n+                        </div>\r\n+                    </li>`;\r\n+            });\r\n \r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n-});\r\n+            html += \"</ul>\";\r\n+            container.innerHTML = html;\r\n \r\n-// ================================\r\n-// SAFE UPDATE HELPER\r\n-// ================================\r\n-/**\r\n- * Safely updates the text content of an element by ID.\r\n- * @param {string} id Element ID.\r\n- * @param {string|number} value New value.\r\n- * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n- */\r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    } else {\r\n-        console.warn(`Element with ID '${id}' not found.`);\r\n+        } catch (err) {\r\n+            console.error(\"Error loading membership records:\", err);\r\n+            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n+        }\r\n     }\r\n-};\r\n \r\n-// ================================\r\n-// DASHBOARD SUMMARY\r\n-// ================================\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n \r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    /**\r\n+     * Loads and displays pending membership requests and handles approvals.\r\n+     */\r\n+    async function loadMembershipRequests() {\r\n+        console.log('Fetching membership requests...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n \r\n-        const data = await res.json();\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+            const requests = await res.json();\r\n+            \r\n+            // Filter for pending requests to show in this view\r\n+            const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading dashboard summary:\", err);\r\n-    }\r\n-}\r\n+            if (pendingRequests.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n+                return;\r\n+            }\r\n \r\n-// ================================\r\n-// ACCESS CHART\r\n-// ================================\r\n-async function loadAccessChart() {\r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n+            let html = `\r\n+                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                    <thead class=\"bg-gray-200\">\r\n+                        <tr>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n+                        </tr>\r\n+                    </thead>\r\n+                    <tbody>\r\n+            `;\r\n \r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            pendingRequests.forEach(r => {\r\n+                html += `\r\n+                    <tr class=\"border-b hover:bg-yellow-50\">\r\n+                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n+                        <td class=\"py-2 px-4\">${r.HouseNumber} - ${r.CourtName}</td>\r\n+                        <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n+                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n+                        <td class=\"py-2 px-4 action-cell\">\r\n+                            <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n+                        </td>\r\n+                    </tr>`;\r\n+            });\r\n \r\n-        const data = await res.json();\r\n\\ No newline at end of file\n+            html += `</tbody></table>`;\r\n+            container.innerHTML = html;\r\n \r\n-        const canvas = document.getElementById(\"accessChart\");\r\n-        if (!canvas) return;\r\n+            // Approve buttons event listeners (Binding Logic)\r\n+            document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n+                btn.addEventListener(\"click\", handleApproveClick);\r\n+            });\r\n \r\n-        if (typeof Chart === 'undefined') {\r\n-            console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n-            return;\r\n+        } catch (err) {\r\n+            console.error(\"Error loading membership requests:\", err);\r\n+            const container = document.getElementById(\"dynamic-section-content\");\r\n+            if (container) {\r\n+                 container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n+            }\r\n         }\r\n+    }\r\n \r\n-        const ctx = canvas.getContext(\"2d\");\r\n+    /**\r\n+     * Handles the click event for approving a membership request.\r\n+     * @param {Event} event \r\n+     */\r\n+    async function handleApproveClick(event) {\r\n+        const btn = event.currentTarget;\r\n+        const requestId = btn.dataset.id;\r\n+        const originalText = btn.textContent;\r\n+        \r\n+        btn.disabled = true;\r\n+        btn.textContent = 'Processing...';\r\n \r\n-        new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: \"#2563eb\",\r\n-                    backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n+        try {\r\n+            const resp = await fetch(`${API_HOST}/api/admin/approveResident`, {\r\n+                method: \"POST\",\r\n+                headers: {\r\n+                    \"Content-Type\": \"application/json\",\r\n+                    \"Authorization\": `Bearer ${token}`\r\n+                },\r\n+                body: JSON.stringify({ requestId })\r\n+            });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading access chart:\", err);\r\n-    }\r\n-}\r\n+            if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n \r\n-// ================================\r\n-// INITIAL DASHBOARD LOAD\r\n-// ================================\r\n-// This runs on page load. It defaults to loading the dashboard overview.\r\n-(async function initializeDashboard() {\r\n-    // If specific dashboard elements exist, load data directly\r\n-    if (document.getElementById(\"totalResidents\")) {\r\n-        await loadDashboardSummary();\r\n-        await loadAccessChart();\r\n-    } else {\r\n-        // Otherwise, simulate a click on the dashboard button to load content and data\r\n-        const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n-        if(dashboardBtn) {\r\n-            dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-            await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n+            // Success handling: update the UI\r\n+            const actionCell = btn.parentElement;\r\n+            const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n+            \r\n+            if (statusCell) {\r\n+                statusCell.textContent = 'Approved';\r\n+                statusCell.classList.add('font-bold', 'text-green-600');\r\n+            }\r\n+            actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n+            \r\n+        } catch (err) {\r\n+            console.error(\"Error approving request:\", err.message);\r\n+            \r\n+            // Failure handling: revert button and show error visually\r\n+            btn.disabled = false;\r\n+            btn.textContent = 'Failed!';\r\n+            btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n+            btn.classList.add('bg-red-500', 'animate-pulse');\r\n+\r\n+            // Reset after a short period\r\n+            setTimeout(() => {\r\n+                btn.textContent = originalText;\r\n+                btn.classList.remove('bg-red-500', 'animate-pulse');\r\n+                btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n+            }, 2000);\r\n+            \r\n         }\r\n     }\r\n-})();\r\n \r\n-// ================================\r\n-// MEMBERSHIP REQUESTS\r\n-// ================================\r\n-async function loadMembershipRequests() {\r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    /**\r\n+     * Loads dashboard summary metrics.\r\n+     */\r\n+    async function loadDashboardSummary() {\r\n+        console.log('Fetching dashboard summary...');\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n \r\n-        const requests = await res.json();\r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-        if (requests.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No membership requests found.</p>\";\r\n-            return;\r\n+            const data = await res.json();\r\n+\r\n+            safeUpdate(\"totalResidents\", data.residents || 0);\r\n+            safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+            safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+            safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading dashboard summary:\", err);\r\n         }\r\n+    }\r\n \r\n-        let html = `\r\n-            <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                <thead class=\"bg-gray-200\">\r\n-                    <tr>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">National ID</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Phone</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Email</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Court</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n-                    </tr>\r\n-                </thead>\r\n-                <tbody>\r\n-        `;\r\n+    /**\r\n+     * Loads data and renders the Access Chart using Chart.js.\r\n+     */\r\n+    async function loadAccessChart() {\r\n+        console.log('Fetching access chart data...');\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n \r\n-        requests.forEach(r => {\r\n-            const rowClass = r.Status === \"Approved\" ? \"bg-green-50\" : r.Status === \"Pending\" ? \"hover:bg-yellow-50\" : \"bg-red-50\";\r\n-            html += `\r\n-                <tr class=\"border-b ${rowClass}\">\r\n-                    <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n-                    <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n-                    <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n-                    <td class=\"py-2 px-4\">${r.Email}</td>\r\n-                    <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n-                    <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n-                    <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n-                    <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                    <td class=\"py-2 px-4 action-cell\">\r\n-                        ${r.Status === \"Pending\"\r\n-                            ? `<button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>`\r\n-                            : `<span class=\"text-gray-500 text-sm\">${r.Status}</span>`\r\n-                        }\r\n-                    </td>\r\n-                </tr>`;\r\n-        });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-        html += `</tbody></table>`;\r\n-        container.innerHTML = html;\r\n+            const data = await res.json();\r\n \r\n-        // Approve buttons event listeners\r\n-        document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n-            btn.addEventListener(\"click\", async () => {\r\n-                const requestId = btn.dataset.id;\r\n-                const originalText = btn.textContent;\r\n-                \r\n-                btn.disabled = true;\r\n-                btn.textContent = 'Processing...';\r\n+            const canvas = document.getElementById(\"accessChart\");\r\n+            if (!canvas) return;\r\n \r\n-                try {\r\n-                    const resp = await fetch(`${API_HOST}/api/admin/approveResident`, {\r\n-                        method: \"POST\",\r\n-                        headers: {\r\n-                            \"Content-Type\": \"application/json\",\r\n-                            \"Authorization\": `Bearer ${token}`\r\n-                        },\r\n-                        body: JSON.stringify({ requestId })\r\n-                    });\r\n+            // Check if Chart.js is available globally (must be included in HTML)\r\n+            if (typeof Chart === 'undefined') {\r\n+                console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n+                return;\r\n+            }\r\n \r\n-                    if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n+            const ctx = canvas.getContext(\"2d\");\r\n \r\n-                    // Success handling: update the UI\r\n-                    const actionCell = btn.parentElement;\r\n-                    const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n-                    \r\n-                    if (statusCell) {\r\n-                        statusCell.textContent = 'Approved';\r\n-                        statusCell.classList.add('font-bold', 'text-green-600');\r\n-                    }\r\n-                    actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n-                    \r\n-                } catch (err) {\r\n-                    console.error(\"Error approving request:\", err.message);\r\n-                    \r\n-                    // Failure handling: revert button and show error visually\r\n-                    btn.disabled = false;\r\n-                    btn.textContent = 'Failed!';\r\n-                    btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n-                    btn.classList.add('bg-red-500', 'animate-pulse');\r\n-\r\n-                    // Reset after a short period\r\n-                    setTimeout(() => {\r\n-                        btn.textContent = originalText;\r\n-                        btn.classList.remove('bg-red-500', 'animate-pulse');\r\n-                        btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n-                    }, 2000);\r\n-                    \r\n-                }\r\n+            new Chart(ctx, {\r\n+                type: \"line\",\r\n+                data: {\r\n+                    labels: data.days || [],\r\n+                    datasets: [{\r\n+                        label: \"Access Attempts\",\r\n+                        data: data.counts || [],\r\n+                        borderWidth: 2,\r\n+                        tension: 0.4,\r\n+                        borderColor: \"#2563eb\",\r\n+                        backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n+                        fill: true\r\n+                    }]\r\n+                },\r\n+                options: { responsive: true, maintainAspectRatio: false }\r\n             });\r\n-        });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading membership requests:\", err);\r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (container) {\r\n-             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n+        } catch (err) {\r\n+            console.error(\"Error loading access chart:\", err);\r\n         }\r\n     }\r\n-}\r\n \r\n-// ================================\r\n-// MEMBERSHIP RECORDS\r\n-// ================================\r\n-async function loadMembershipRecords() {\r\n-    try {\r\n-        const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n \r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    // ================================\r\n+    // SIDEBAR PAGE LOADING\r\n+    // ================================\r\n \r\n-        const members = await res.json();\r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n+    /**\r\n+     * Fetches and loads HTML content into the main content area.\r\n+     * @param {string} url The URL of the page to load.\r\n+     */\r\n+    async function loadPageIntoMainContent(url) {\r\n+        try {\r\n+            const res = await fetch(url);\r\n+            if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n \r\n-        // Filter for only approved members for the records section\r\n-        const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+            const html = await res.text();\r\n+            mainContentArea.innerHTML = html;\r\n \r\n-        if (approvedMembers.length === 0) {\r\n-            container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n-            return;\r\n+            // Trigger dashboard specific loads immediately after content is inserted\r\n+            if (url.includes(\"dashboardoverview.html\")) {\r\n+                await loadDashboardSummary();\r\n+                await loadAccessChart();\r\n+            }\r\n+        } catch (err) {\r\n+            console.error(\"Error loading page:\", err);\r\n+            mainContentArea.innerHTML =\r\n+                `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n         }\r\n+    }\r\n \r\n-        let html = `<ul class=\"space-y-3 p-4\">`;\r\n+    // Sidebar routing: Handles content loading and dynamic data fetching\r\n+    sidebarButtons.forEach(btn => {\r\n+        btn.addEventListener(\"click\", async () => {\r\n+            // Update active state for sidebar buttons\r\n+            sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+            btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n-        approvedMembers.forEach(m => {\r\n-            html += `\r\n-                <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n-                    <div>\r\n-                        <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n-                        <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n-                        <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n-                    </div>\r\n-                    <div class=\"text-right\">\r\n-                       <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n-                            Active\r\n-                        </span>\r\n-                    </div>\r\n-                </li>`;\r\n+            const page = btn.dataset.target;\r\n+            if (!page) return;\r\n+\r\n+            await loadPageIntoMainContent(page);\r\n+\r\n+            // Trigger dynamic page data loads after content is inserted\r\n+            if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n+            if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n+            if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+            if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n         });\r\n+    });\r\n \r\n-        html += \"</ul>\";\r\n-        container.innerHTML = html;\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading membership records:\", err);\r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (container) {\r\n-             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n-        }\r\n+    // ================================\r\n+    // EVENT LISTENERS & INITIALIZATION\r\n+    // ================================\r\n+\r\n+    // Logout Button\r\n+    document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+        localStorage.removeItem(\"accessToken\");\r\n+        window.location.href = \"/login.html\";\r\n+    });\r\n+    \r\n+    // Visitor Management Dropdown Toggle\r\n+    const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+    const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+    const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+    visitorToggle?.addEventListener(\"click\", () => {\r\n+        visitorSubMenu?.classList.toggle(\"hidden\");\r\n+        visitorArrow?.classList.toggle(\"rotate-90\");\r\n+    });\r\n+\r\n+\r\n+    // Initial Dashboard Load\r\n+    // This runs on page load. It defaults to loading the dashboard overview.\r\n+    const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n+    if (dashboardBtn) {\r\n+        dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n+    } else if (document.getElementById(\"totalResidents\")) {\r\n+        // Fallback for when content is already on the page (less common in SPA-style)\r\n+        await loadDashboardSummary();\r\n+        await loadAccessChart();\r\n     }\r\n-}\n+})();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763670476398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -219,13 +219,18 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n \r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n+            const res = await fetch(`${API_HOST}/api/membershipsrecords/all`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n+            const responseData = await res.json();\r\n+            // Assuming the backend returns an object with a 'records' property\r\n+            const members = responseData.records || []; \r\n+            \r\n+            // Filter for only approved members for the records section\r\n+            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n             const requests = await res.json();\r\n             \r\n             // Filter for pending requests to show in this view\r\n             const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n"
                },
                {
                    "date": 1763670637705,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -226,16 +226,14 @@\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n             const responseData = await res.json();\r\n             // Assuming the backend returns an object with a 'records' property\r\n             const members = responseData.records || []; \r\n-            \r\n-            // Filter for only approved members for the records section\r\n-            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n-            const requests = await res.json();\r\n-            \r\n             // Filter for pending requests to show in this view\r\n             const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n \r\n+            // Filter for only approved members for the records section\r\n+            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+            const requests = await res.json();        \r\n             if (pendingRequests.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n                 return;\r\n             }\r\n"
                },
                {
                    "date": 1763670643529,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -228,9 +228,8 @@\n             // Assuming the backend returns an object with a 'records' property\r\n             const members = responseData.records || []; \r\n             // Filter for pending requests to show in this view\r\n             const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n-\r\n             // Filter for only approved members for the records section\r\n             const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n             const requests = await res.json();        \r\n             if (pendingRequests.length === 0) {\r\n"
                },
                {
                    "date": 1763670830121,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,12 +8,8 @@\n     // =======================================================\r\n     // 1. Centralized API Host for all backend connections\r\n     const API_HOST = \"http://localhost:4050\"; \r\n \r\n-    // Remove unused/legacy Firebase config variables\r\n-    // const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\n-    // const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;\r\n-\r\n     // 2. Auth State Check & Token Retrieval\r\n     const token = localStorage.getItem(\"accessToken\");\r\n     \r\n     // Redirects to login if no access token is found\r\n@@ -41,9 +37,9 @@\n         const element = document.getElementById(id);\r\n         if (element) {\r\n             element.textContent = value + suffix;\r\n         } else {\r\n-            // console.warn(`Element with ID '${id}' not found.`); // Keep silent for clean console\r\n+            // console.warn(`Element with ID '${id}' not found.`); \r\n         }\r\n     };\r\n     \r\n     // ================================\r\n@@ -163,16 +159,18 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n \r\n         try {\r\n-            // Note: This API endpoint seems to return ALL membership states.\r\n-            const res = await fetch(`${API_HOST}/api/admin/memberships`, {\r\n+            // FIX 1: Standardize API Endpoint path\r\n+            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n \r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-            const members = await res.json();\r\n+            const responseData = await res.json();\r\n+            // FIX 2: Access the 'records' property, which the backend controller returns\r\n+            const members = responseData.records || []; \r\n             \r\n             // Filter for only approved members for the records section\r\n             const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n \r\n@@ -219,20 +217,21 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n \r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/membershipsrecords/all`, {\r\n+            // FIX 1: Standardize API Endpoint path\r\n+            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n             const responseData = await res.json();\r\n-            // Assuming the backend returns an object with a 'records' property\r\n-            const members = responseData.records || []; \r\n+            // FIX 2: Access the 'records' property, which the backend controller returns\r\n+            const allRecords = responseData.records || [];\r\n+            \r\n             // Filter for pending requests to show in this view\r\n-            const pendingRequests = requests.filter(r => r.Status === \"Pending\");\r\n-            // Filter for only approved members for the records section\r\n-            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n-            const requests = await res.json();        \r\n+            const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n+            \r\n             if (pendingRequests.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n                 return;\r\n             }\r\n@@ -293,15 +292,16 @@\n         btn.disabled = true;\r\n         btn.textContent = 'Processing...';\r\n \r\n         try {\r\n-            const resp = await fetch(`${API_HOST}/api/admin/approveResident`, {\r\n-                method: \"POST\",\r\n+            // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n+            const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n+                method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n                 headers: {\r\n                     \"Content-Type\": \"application/json\",\r\n                     \"Authorization\": `Bearer ${token}`\r\n                 },\r\n-                body: JSON.stringify({ requestId })\r\n+                // Removed body: JSON.stringify({ requestId }) as ID is now in the URL\r\n             });\r\n \r\n             if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n \r\n"
                },
                {
                    "date": 1763672835095,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -486,5 +486,73 @@\n         // Fallback for when content is already on the page (less common in SPA-style)\r\n         await loadDashboardSummary();\r\n         await loadAccessChart();\r\n     }\r\n-})();\n\\ No newline at end of file\n+})();\r\n+// =========================================\r\n+// Debug Fetch Wrapper\r\n+// =========================================\r\n+async function debugFetch(name, url, options = {}) {\r\n+  console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n+  console.time(name);\r\n+\r\n+  try {\r\n+    const res = await fetch(url, options);\r\n+\r\n+    if (!res.ok) {\r\n+      console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n+      const text = await res.text();\r\n+      console.error(`Response text:`, text);\r\n+      console.timeEnd(name);\r\n+      return null;\r\n+    }\r\n+\r\n+    const data = await res.json();\r\n+    console.log(`✅ ${name} succeeded`, data);\r\n+    console.timeEnd(name);\r\n+    return data;\r\n+  } catch (err) {\r\n+    console.error(`❌ ${name} error:`, err);\r\n+    console.timeEnd(name);\r\n+    return null;\r\n+  }\r\n+}\r\n+\r\n+// =========================================\r\n+// Individual Fetch Functions\r\n+// =========================================\r\n+async function fetchDashboardSummary() {\r\n+  return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n+}\r\n+\r\n+async function fetchAccessChartData() {\r\n+  return await debugFetch(\"Access Chart Data\", \"/api/access/chart\");\r\n+}\r\n+\r\n+async function fetchMembershipRequests() {\r\n+  return await debugFetch(\"Membership Requests\", \"/api/memberships/requests\");\r\n+}\r\n+\r\n+async function fetchMembershipRecords() {\r\n+  return await debugFetch(\"Membership Records\", \"/api/memberships/records\");\r\n+}\r\n+\r\n+// =========================================\r\n+// Main Loader\r\n+// =========================================\r\n+async function loadAdminDashboard() {\r\n+  const [summary, chartData, requests, records] = await Promise.all([\r\n+    fetchDashboardSummary(),\r\n+    fetchAccessChartData(),\r\n+    fetchMembershipRequests(),\r\n+    fetchMembershipRecords(),\r\n+  ]);\r\n+\r\n+  // Example: populate your dashboard with data if available\r\n+  if (summary) populateDashboardSummary(summary);\r\n+  if (chartData) renderAccessChart(chartData);\r\n+  if (requests) renderMembershipRequests(requests);\r\n+  if (records) renderMembershipRecords(records);\r\n+}\r\n+\r\n+// Call on page load\r\n+loadAdminDashboard();\r\n"
                },
                {
                    "date": 1763673344126,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,558 +1,217 @@\n /**\r\n  * Admin Dashboard Client-Side JavaScript\r\n- * Uses Fetch API to communicate with a Node.js/Express Backend (API_HOST)\r\n+ * Uses Fetch API to communicate with a Node.js/Express Backend (API_BASE)\r\n  */\r\n (async function initializeDashboard() {\r\n     // =======================================================\r\n     // CONFIGURATION & INITIAL STATE\r\n     // =======================================================\r\n-    // 1. Centralized API Host for all backend connections\r\n-    const API_HOST = \"http://localhost:4050\"; \r\n-\r\n-    // 2. Auth State Check & Token Retrieval\r\n+    // Centralized API Host for all backend connections\r\n+    const API_BASE = \"http://localhost:4050\"; \r\n     const token = localStorage.getItem(\"accessToken\");\r\n     \r\n-    // Redirects to login if no access token is found\r\n     if (!token) {\r\n         window.location.href = \"/login.html\";\r\n         return; // Stop execution if redirecting\r\n     }\r\n \r\n-    // DOM Elements\r\n     const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n     const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-\r\n     // ================================\r\n     // UTILITIES\r\n     // ================================\r\n-\r\n-    /**\r\n-     * Safely updates the text content of an element by ID.\r\n-     * @param {string} id Element ID.\r\n-     * @param {string|number} value New value.\r\n-     * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n-     */\r\n     const safeUpdate = (id, value, suffix = '') => {\r\n         const element = document.getElementById(id);\r\n-        if (element) {\r\n-            element.textContent = value + suffix;\r\n-        } else {\r\n-            // console.warn(`Element with ID '${id}' not found.`); \r\n-        }\r\n+        if (element) element.textContent = value + suffix;\r\n     };\r\n-    \r\n-    // ================================\r\n-    // DYNAMIC CONTENT LOADERS (API INTERACTION)\r\n-    // ================================\r\n \r\n-    /**\r\n-     * Loads and displays payment records from the API.\r\n-     */\r\n+    // =========================================\r\n+    // Debug Fetch Wrapper\r\n+    // =========================================\r\n+    async function debugFetch(name, url, options = {}) {\r\n+        console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n+        console.time(name);\r\n+        try {\r\n+            const res = await fetch(url, { ...options, headers: { ...options.headers, \"Authorization\": `Bearer ${token}` } });\r\n+            if (!res.ok) {\r\n+                console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n+                const text = await res.text();\r\n+                console.error(`Response text:`, text);\r\n+                console.timeEnd(name);\r\n+                return null;\r\n+            }\r\n+            const data = await res.json();\r\n+            console.log(`✅ ${name} succeeded`, data);\r\n+            console.timeEnd(name);\r\n+            return data;\r\n+        } catch (err) {\r\n+            console.error(`❌ ${name} error:`, err);\r\n+            console.timeEnd(name);\r\n+            return null;\r\n+        }\r\n+    }\r\n+\r\n+    // =========================================\r\n+    // Individual Fetch Functions\r\n+    // =========================================\r\n+    async function fetchDashboardSummary() {\r\n+        return await debugFetch(\"Dashboard Summary\", `${API_BASE}/api/dashboard/summary`);\r\n+    }\r\n+\r\n+    async function fetchAccessChartData() {\r\n+        return await debugFetch(\"Access Chart Data\", `${API_BASE}/api/access/chart`);\r\n+    }\r\n+\r\n+    async function fetchMembershipRequests() {\r\n+        return await debugFetch(\"Membership Requests\", `${API_BASE}/api/memberships/requests`);\r\n+    }\r\n+\r\n+    async function fetchMembershipRecords() {\r\n+        return await debugFetch(\"Membership Records\", `${API_BASE}/api/memberships/records`);\r\n+    }\r\n+\r\n+    // =========================================\r\n+    // Main Loader\r\n+    // =========================================\r\n+    async function loadAdminDashboard() {\r\n+        const [summary, chartData, requests, records] = await Promise.all([\r\n+            fetchDashboardSummary(),\r\n+            fetchAccessChartData(),\r\n+            fetchMembershipRequests(),\r\n+            fetchMembershipRecords(),\r\n+        ]);\r\n+\r\n+        if (summary) populateDashboardSummary(summary);\r\n+        if (chartData) renderAccessChart(chartData);\r\n+        if (requests) renderMembershipRequests(requests);\r\n+        if (records) renderMembershipRecords(records);\r\n+    }\r\n+\r\n+    // =========================================\r\n+    // Other Page-Specific Loaders\r\n+    // =========================================\r\n     async function loadPaymentRecords() { \r\n-        console.log('Fetching payment records...'); \r\n+        console.log('Fetching payment records...');\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n-        \r\n+\r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n-        \r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const payments = await res.json();\r\n-            \r\n-            if (payments.length === 0) {\r\n+            const payments = await debugFetch(\"Payment Records\", `${API_BASE}/api/admin/payments`);\r\n+            if (!payments || payments.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n                 return;\r\n             }\r\n \r\n-            // Basic HTML rendering for payments table\r\n-            let html = `\r\n-                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                    <thead class=\"bg-gray-200\">\r\n-                        <tr>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                        </tr>\r\n-                    </thead>\r\n-                    <tbody>\r\n-            `;\r\n+            let html = `<table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                <thead class=\"bg-gray-200\">\r\n+                    <tr>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n+                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                    </tr>\r\n+                </thead>\r\n+                <tbody>`;\r\n \r\n             payments.forEach(p => {\r\n                 const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n                 const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n                 const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n-\r\n-                html += `\r\n-                    <tr class=\"border-b hover:bg-gray-50\">\r\n-                        <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n-                        <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n-                        <td class=\"py-2 px-4\">${date}</td>\r\n-                        <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n-                    </tr>`;\r\n+                html += `<tr class=\"border-b hover:bg-gray-50\">\r\n+                    <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n+                    <td class=\"py-2 px-4\">${date}</td>\r\n+                    <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n+                </tr>`;\r\n             });\r\n-\r\n             html += `</tbody></table>`;\r\n             container.innerHTML = html;\r\n-\r\n         } catch (err) {\r\n             console.error(\"Error loading payment records:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n-    /**\r\n-     * Loads and displays visitors list data from the API.\r\n-     */\r\n     async function loadVisitorsList() { \r\n-        console.log('Fetching visitors list...'); \r\n+        console.log('Fetching visitors list...');\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n-\r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const data = await res.json();\r\n-            \r\n-            if (data.length === 0) {\r\n+            const visitors = await debugFetch(\"Visitors List\", `${API_BASE}/api/admin/visitors`);\r\n+            if (!visitors || visitors.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n                 return;\r\n             }\r\n \r\n-            // Example rendering for visitors (adjust fields based on actual API data)\r\n             let html = `<ul class=\"space-y-3 p-4\">`;\r\n-            data.forEach(v => {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n-                        <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n-                        <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n-                        <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n-                    </li>`;\r\n+            visitors.forEach(v => {\r\n+                html += `<li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n+                    <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n+                    <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n+                    <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n+                </li>`;\r\n             });\r\n             html += \"</ul>\";\r\n             container.innerHTML = html;\r\n-\r\n         } catch (err) {\r\n             console.error(\"Error loading visitors list:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n-\r\n-    /**\r\n-     * Loads and displays membership records (approved members) from the API.\r\n-     */\r\n-    async function loadMembershipRecords() {\r\n-        console.log('Fetching membership records...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n-\r\n-        try {\r\n-            // FIX 1: Standardize API Endpoint path\r\n-            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const responseData = await res.json();\r\n-            // FIX 2: Access the 'records' property, which the backend controller returns\r\n-            const members = responseData.records || []; \r\n-            \r\n-            // Filter for only approved members for the records section\r\n-            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n-\r\n-            if (approvedMembers.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            let html = `<ul class=\"space-y-3 p-4\">`;\r\n-\r\n-            approvedMembers.forEach(m => {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n-                        <div>\r\n-                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n-                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n-                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n-                        </div>\r\n-                        <div class=\"text-right\">\r\n-                           <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n-                                Active\r\n-                           </span>\r\n-                        </div>\r\n-                    </li>`;\r\n-            });\r\n-\r\n-            html += \"</ul>\";\r\n-            container.innerHTML = html;\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading membership records:\", err);\r\n-            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * Loads and displays pending membership requests and handles approvals.\r\n-     */\r\n-    async function loadMembershipRequests() {\r\n-        console.log('Fetching membership requests...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n-\r\n-        try {\r\n-            // FIX 1: Standardize API Endpoint path\r\n-            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const responseData = await res.json();\r\n-            // FIX 2: Access the 'records' property, which the backend controller returns\r\n-            const allRecords = responseData.records || [];\r\n-            \r\n-            // Filter for pending requests to show in this view\r\n-            const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n-            \r\n-            if (pendingRequests.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            let html = `\r\n-                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                    <thead class=\"bg-gray-200\">\r\n-                        <tr>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n-                        </tr>\r\n-                    </thead>\r\n-                    <tbody>\r\n-            `;\r\n-\r\n-            pendingRequests.forEach(r => {\r\n-                html += `\r\n-                    <tr class=\"border-b hover:bg-yellow-50\">\r\n-                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.HouseNumber} - ${r.CourtName}</td>\r\n-                        <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n-                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                        <td class=\"py-2 px-4 action-cell\">\r\n-                            <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n-                        </td>\r\n-                    </tr>`;\r\n-            });\r\n-\r\n-            html += `</tbody></table>`;\r\n-            container.innerHTML = html;\r\n-\r\n-            // Approve buttons event listeners (Binding Logic)\r\n-            document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n-                btn.addEventListener(\"click\", handleApproveClick);\r\n-            });\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading membership requests:\", err);\r\n-            const container = document.getElementById(\"dynamic-section-content\");\r\n-            if (container) {\r\n-                 container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Handles the click event for approving a membership request.\r\n-     * @param {Event} event \r\n-     */\r\n-    async function handleApproveClick(event) {\r\n-        const btn = event.currentTarget;\r\n-        const requestId = btn.dataset.id;\r\n-        const originalText = btn.textContent;\r\n-        \r\n-        btn.disabled = true;\r\n-        btn.textContent = 'Processing...';\r\n-\r\n-        try {\r\n-            // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n-            const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n-                method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n-                headers: {\r\n-                    \"Content-Type\": \"application/json\",\r\n-                    \"Authorization\": `Bearer ${token}`\r\n-                },\r\n-                // Removed body: JSON.stringify({ requestId }) as ID is now in the URL\r\n-            });\r\n-\r\n-            if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n-\r\n-            // Success handling: update the UI\r\n-            const actionCell = btn.parentElement;\r\n-            const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n-            \r\n-            if (statusCell) {\r\n-                statusCell.textContent = 'Approved';\r\n-                statusCell.classList.add('font-bold', 'text-green-600');\r\n-            }\r\n-            actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n-            \r\n-        } catch (err) {\r\n-            console.error(\"Error approving request:\", err.message);\r\n-            \r\n-            // Failure handling: revert button and show error visually\r\n-            btn.disabled = false;\r\n-            btn.textContent = 'Failed!';\r\n-            btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n-            btn.classList.add('bg-red-500', 'animate-pulse');\r\n-\r\n-            // Reset after a short period\r\n-            setTimeout(() => {\r\n-                btn.textContent = originalText;\r\n-                btn.classList.remove('bg-red-500', 'animate-pulse');\r\n-                btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n-            }, 2000);\r\n-            \r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Loads dashboard summary metrics.\r\n-     */\r\n-    async function loadDashboardSummary() {\r\n-        console.log('Fetching dashboard summary...');\r\n-        try {\r\n-            const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const data = await res.json();\r\n-\r\n-            safeUpdate(\"totalResidents\", data.residents || 0);\r\n-            safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-            safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-            safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading dashboard summary:\", err);\r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Loads data and renders the Access Chart using Chart.js.\r\n-     */\r\n-    async function loadAccessChart() {\r\n-        console.log('Fetching access chart data...');\r\n-        try {\r\n-            const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const data = await res.json();\r\n-\r\n-            const canvas = document.getElementById(\"accessChart\");\r\n-            if (!canvas) return;\r\n-\r\n-            // Check if Chart.js is available globally (must be included in HTML)\r\n-            if (typeof Chart === 'undefined') {\r\n-                console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n-                return;\r\n-            }\r\n-\r\n-            const ctx = canvas.getContext(\"2d\");\r\n-\r\n-            new Chart(ctx, {\r\n-                type: \"line\",\r\n-                data: {\r\n-                    labels: data.days || [],\r\n-                    datasets: [{\r\n-                        label: \"Access Attempts\",\r\n-                        data: data.counts || [],\r\n-                        borderWidth: 2,\r\n-                        tension: 0.4,\r\n-                        borderColor: \"#2563eb\",\r\n-                        backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n-                        fill: true\r\n-                    }]\r\n-                },\r\n-                options: { responsive: true, maintainAspectRatio: false }\r\n-            });\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading access chart:\", err);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    // ================================\r\n-    // SIDEBAR PAGE LOADING\r\n-    // ================================\r\n-\r\n-    /**\r\n-     * Fetches and loads HTML content into the main content area.\r\n-     * @param {string} url The URL of the page to load.\r\n-     */\r\n+    // =========================================\r\n+    // Sidebar Page Loading\r\n+    // =========================================\r\n     async function loadPageIntoMainContent(url) {\r\n         try {\r\n             const res = await fetch(url);\r\n             if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-\r\n             const html = await res.text();\r\n             mainContentArea.innerHTML = html;\r\n \r\n-            // Trigger dashboard specific loads immediately after content is inserted\r\n+            // Trigger page-specific loaders\r\n             if (url.includes(\"dashboardoverview.html\")) {\r\n-                await loadDashboardSummary();\r\n-                await loadAccessChart();\r\n+                await loadAdminDashboard();\r\n             }\r\n+            if (url.includes(\"membership.html\")) await fetchMembershipRequests();\r\n+            if (url.includes(\"membershiprecords.html\")) await fetchMembershipRecords();\r\n+            if (url.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+            if (url.includes(\"payments.html\")) await loadPaymentRecords();\r\n         } catch (err) {\r\n             console.error(\"Error loading page:\", err);\r\n-            mainContentArea.innerHTML =\r\n-                `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+            mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n         }\r\n     }\r\n \r\n-    // Sidebar routing: Handles content loading and dynamic data fetching\r\n+    // Sidebar navigation\r\n     sidebarButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", async () => {\r\n-            // Update active state for sidebar buttons\r\n             sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n             btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n             const page = btn.dataset.target;\r\n             if (!page) return;\r\n-\r\n             await loadPageIntoMainContent(page);\r\n-\r\n-            // Trigger dynamic page data loads after content is inserted\r\n-            if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n-            if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n-            if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-            if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n         });\r\n     });\r\n \r\n-\r\n-    // ================================\r\n-    // EVENT LISTENERS & INITIALIZATION\r\n-    // ================================\r\n-\r\n-    // Logout Button\r\n+    // Logout button\r\n     document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n         localStorage.removeItem(\"accessToken\");\r\n         window.location.href = \"/login.html\";\r\n     });\r\n-    \r\n-    // Visitor Management Dropdown Toggle\r\n-    const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-    const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-    const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-    visitorToggle?.addEventListener(\"click\", () => {\r\n-        visitorSubMenu?.classList.toggle(\"hidden\");\r\n-        visitorArrow?.classList.toggle(\"rotate-90\");\r\n-    });\r\n-\r\n-\r\n-    // Initial Dashboard Load\r\n-    // This runs on page load. It defaults to loading the dashboard overview.\r\n+    // Initial dashboard load\r\n     const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n     if (dashboardBtn) {\r\n         dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n         await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n     } else if (document.getElementById(\"totalResidents\")) {\r\n-        // Fallback for when content is already on the page (less common in SPA-style)\r\n-        await loadDashboardSummary();\r\n-        await loadAccessChart();\r\n+        await loadAdminDashboard();\r\n     }\r\n+\r\n })();\r\n-// =========================================\r\n-// Debug Fetch Wrapper\r\n-// =========================================\r\n-async function debugFetch(name, url, options = {}) {\r\n-  console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n-  console.time(name);\r\n-\r\n-  try {\r\n-    const res = await fetch(url, options);\r\n-\r\n-    if (!res.ok) {\r\n-      console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n-      const text = await res.text();\r\n-      console.error(`Response text:`, text);\r\n-      console.timeEnd(name);\r\n-      return null;\r\n-    }\r\n-\r\n-    const data = await res.json();\r\n-    console.log(`✅ ${name} succeeded`, data);\r\n-    console.timeEnd(name);\r\n-    return data;\r\n-  } catch (err) {\r\n-    console.error(`❌ ${name} error:`, err);\r\n-    console.timeEnd(name);\r\n-    return null;\r\n-  }\r\n-}\r\n-\r\n-// =========================================\r\n-// Individual Fetch Functions\r\n-// =========================================\r\n-async function fetchDashboardSummary() {\r\n-  return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n-}\r\n-\r\n-async function fetchAccessChartData() {\r\n-  return await debugFetch(\"Access Chart Data\", \"/api/access/chart\");\r\n-}\r\n-\r\n-async function fetchMembershipRequests() {\r\n-  return await debugFetch(\"Membership Requests\", \"/api/memberships/requests\");\r\n-}\r\n-\r\n-async function fetchMembershipRecords() {\r\n-  return await debugFetch(\"Membership Records\", \"/api/memberships/records\");\r\n-}\r\n-\r\n-// =========================================\r\n-// Main Loader\r\n-// =========================================\r\n-async function loadAdminDashboard() {\r\n-  const [summary, chartData, requests, records] = await Promise.all([\r\n-    fetchDashboardSummary(),\r\n-    fetchAccessChartData(),\r\n-    fetchMembershipRequests(),\r\n-    fetchMembershipRecords(),\r\n-  ]);\r\n-\r\n-  // Example: populate your dashboard with data if available\r\n-  if (summary) populateDashboardSummary(summary);\r\n-  if (chartData) renderAccessChart(chartData);\r\n-  if (requests) renderMembershipRequests(requests);\r\n-  if (records) renderMembershipRecords(records);\r\n-}\r\n-\r\n-// Call on page load\r\n-loadAdminDashboard();\r\n"
                },
                {
                    "date": 1763673512690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,15 +5,14 @@\n (async function initializeDashboard() {\r\n     // =======================================================\r\n     // CONFIGURATION & INITIAL STATE\r\n     // =======================================================\r\n-    // Centralized API Host for all backend connections\r\n     const API_BASE = \"http://localhost:4050\"; \r\n     const token = localStorage.getItem(\"accessToken\");\r\n     \r\n     if (!token) {\r\n         window.location.href = \"/login.html\";\r\n-        return; // Stop execution if redirecting\r\n+        return; \r\n     }\r\n \r\n     const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n     const mainContentArea = document.getElementById(\"main-content-area\");\r\n@@ -52,24 +51,36 @@\n         }\r\n     }\r\n \r\n     // =========================================\r\n-    // Individual Fetch Functions\r\n+    // Individual Fetch Functions (Corrected URLs)\r\n     // =========================================\r\n     async function fetchDashboardSummary() {\r\n-        return await debugFetch(\"Dashboard Summary\", `${API_BASE}/api/dashboard/summary`);\r\n+        return await debugFetch(\r\n+            \"Dashboard Summary\",\r\n+            `${API_BASE}/api/residents/dashboard/summary`\r\n+        );\r\n     }\r\n \r\n     async function fetchAccessChartData() {\r\n-        return await debugFetch(\"Access Chart Data\", `${API_BASE}/api/access/chart`);\r\n+        return await debugFetch(\r\n+            \"Access Chart Data\",\r\n+            `${API_BASE}/api/residents/admin/accesschart`\r\n+        );\r\n     }\r\n \r\n     async function fetchMembershipRequests() {\r\n-        return await debugFetch(\"Membership Requests\", `${API_BASE}/api/memberships/requests`);\r\n+        return await debugFetch(\r\n+            \"Membership Requests\",\r\n+            `${API_BASE}/api/membershiprecords/all`\r\n+        );\r\n     }\r\n \r\n     async function fetchMembershipRecords() {\r\n-        return await debugFetch(\"Membership Records\", `${API_BASE}/api/memberships/records`);\r\n+        return await debugFetch(\r\n+            \"Membership Records\",\r\n+            `${API_BASE}/api/membershiprecords/all`\r\n+        );\r\n     }\r\n \r\n     // =========================================\r\n     // Main Loader\r\n@@ -88,12 +99,11 @@\n         if (records) renderMembershipRecords(records);\r\n     }\r\n \r\n     // =========================================\r\n-    // Other Page-Specific Loaders\r\n+    // Example Page Loaders (Payments / Visitors / Memberships)\r\n     // =========================================\r\n     async function loadPaymentRecords() { \r\n-        console.log('Fetching payment records...');\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n@@ -128,15 +138,13 @@\n             });\r\n             html += `</tbody></table>`;\r\n             container.innerHTML = html;\r\n         } catch (err) {\r\n-            console.error(\"Error loading payment records:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n     async function loadVisitorsList() { \r\n-        console.log('Fetching visitors list...');\r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n@@ -157,9 +165,8 @@\n             });\r\n             html += \"</ul>\";\r\n             container.innerHTML = html;\r\n         } catch (err) {\r\n-            console.error(\"Error loading visitors list:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n@@ -172,35 +179,30 @@\n             if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n             const html = await res.text();\r\n             mainContentArea.innerHTML = html;\r\n \r\n-            // Trigger page-specific loaders\r\n             if (url.includes(\"dashboardoverview.html\")) {\r\n                 await loadAdminDashboard();\r\n             }\r\n             if (url.includes(\"membership.html\")) await fetchMembershipRequests();\r\n             if (url.includes(\"membershiprecords.html\")) await fetchMembershipRecords();\r\n             if (url.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n             if (url.includes(\"payments.html\")) await loadPaymentRecords();\r\n         } catch (err) {\r\n-            console.error(\"Error loading page:\", err);\r\n             mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n         }\r\n     }\r\n \r\n-    // Sidebar navigation\r\n     sidebarButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", async () => {\r\n             sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n             btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n             const page = btn.dataset.target;\r\n             if (!page) return;\r\n             await loadPageIntoMainContent(page);\r\n         });\r\n     });\r\n \r\n-    // Logout button\r\n     document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n         localStorage.removeItem(\"accessToken\");\r\n         window.location.href = \"/login.html\";\r\n     });\r\n"
                },
                {
                    "date": 1763673569834,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,219 +1,558 @@\n /**\r\n  * Admin Dashboard Client-Side JavaScript\r\n- * Uses Fetch API to communicate with a Node.js/Express Backend (API_BASE)\r\n+ * Uses Fetch API to communicate with a Node.js/Express Backend (API_HOST)\r\n  */\r\n (async function initializeDashboard() {\r\n     // =======================================================\r\n     // CONFIGURATION & INITIAL STATE\r\n     // =======================================================\r\n-    const API_BASE = \"http://localhost:4050\"; \r\n+    // 1. Centralized API Host for all backend connections\r\n+    const API_HOST = \"http://localhost:4050\"; \r\n+\r\n+    // 2. Auth State Check & Token Retrieval\r\n     const token = localStorage.getItem(\"accessToken\");\r\n     \r\n+    // Redirects to login if no access token is found\r\n     if (!token) {\r\n         window.location.href = \"/login.html\";\r\n-        return; \r\n+        return; // Stop execution if redirecting\r\n     }\r\n \r\n+    // DOM Elements\r\n     const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n     const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+\r\n     // ================================\r\n     // UTILITIES\r\n     // ================================\r\n+\r\n+    /**\r\n+     * Safely updates the text content of an element by ID.\r\n+     * @param {string} id Element ID.\r\n+     * @param {string|number} value New value.\r\n+     * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n+     */\r\n     const safeUpdate = (id, value, suffix = '') => {\r\n         const element = document.getElementById(id);\r\n-        if (element) element.textContent = value + suffix;\r\n+        if (element) {\r\n+            element.textContent = value + suffix;\r\n+        } else {\r\n+            // console.warn(`Element with ID '${id}' not found.`); \r\n+        }\r\n     };\r\n+    \r\n+    // ================================\r\n+    // DYNAMIC CONTENT LOADERS (API INTERACTION)\r\n+    // ================================\r\n \r\n-    // =========================================\r\n-    // Debug Fetch Wrapper\r\n-    // =========================================\r\n-    async function debugFetch(name, url, options = {}) {\r\n-        console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n-        console.time(name);\r\n-        try {\r\n-            const res = await fetch(url, { ...options, headers: { ...options.headers, \"Authorization\": `Bearer ${token}` } });\r\n-            if (!res.ok) {\r\n-                console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n-                const text = await res.text();\r\n-                console.error(`Response text:`, text);\r\n-                console.timeEnd(name);\r\n-                return null;\r\n-            }\r\n-            const data = await res.json();\r\n-            console.log(`✅ ${name} succeeded`, data);\r\n-            console.timeEnd(name);\r\n-            return data;\r\n-        } catch (err) {\r\n-            console.error(`❌ ${name} error:`, err);\r\n-            console.timeEnd(name);\r\n-            return null;\r\n-        }\r\n-    }\r\n-\r\n-    // =========================================\r\n-    // Individual Fetch Functions (Corrected URLs)\r\n-    // =========================================\r\n-    async function fetchDashboardSummary() {\r\n-        return await debugFetch(\r\n-            \"Dashboard Summary\",\r\n-            `${API_BASE}/api/residents/dashboard/summary`\r\n-        );\r\n-    }\r\n-\r\n-    async function fetchAccessChartData() {\r\n-        return await debugFetch(\r\n-            \"Access Chart Data\",\r\n-            `${API_BASE}/api/residents/admin/accesschart`\r\n-        );\r\n-    }\r\n-\r\n-    async function fetchMembershipRequests() {\r\n-        return await debugFetch(\r\n-            \"Membership Requests\",\r\n-            `${API_BASE}/api/membershiprecords/all`\r\n-        );\r\n-    }\r\n-\r\n-    async function fetchMembershipRecords() {\r\n-        return await debugFetch(\r\n-            \"Membership Records\",\r\n-            `${API_BASE}/api/membershiprecords/all`\r\n-        );\r\n-    }\r\n-\r\n-    // =========================================\r\n-    // Main Loader\r\n-    // =========================================\r\n-    async function loadAdminDashboard() {\r\n-        const [summary, chartData, requests, records] = await Promise.all([\r\n-            fetchDashboardSummary(),\r\n-            fetchAccessChartData(),\r\n-            fetchMembershipRequests(),\r\n-            fetchMembershipRecords(),\r\n-        ]);\r\n-\r\n-        if (summary) populateDashboardSummary(summary);\r\n-        if (chartData) renderAccessChart(chartData);\r\n-        if (requests) renderMembershipRequests(requests);\r\n-        if (records) renderMembershipRecords(records);\r\n-    }\r\n-\r\n-    // =========================================\r\n-    // Example Page Loaders (Payments / Visitors / Memberships)\r\n-    // =========================================\r\n+    /**\r\n+     * Loads and displays payment records from the API.\r\n+     */\r\n     async function loadPaymentRecords() { \r\n+        console.log('Fetching payment records...'); \r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n-\r\n+        \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n+        \r\n         try {\r\n-            const payments = await debugFetch(\"Payment Records\", `${API_BASE}/api/admin/payments`);\r\n-            if (!payments || payments.length === 0) {\r\n+            const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const payments = await res.json();\r\n+            \r\n+            if (payments.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n                 return;\r\n             }\r\n \r\n-            let html = `<table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                <thead class=\"bg-gray-200\">\r\n-                    <tr>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n-                        <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                    </tr>\r\n-                </thead>\r\n-                <tbody>`;\r\n+            // Basic HTML rendering for payments table\r\n+            let html = `\r\n+                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                    <thead class=\"bg-gray-200\">\r\n+                        <tr>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                        </tr>\r\n+                    </thead>\r\n+                    <tbody>\r\n+            `;\r\n \r\n             payments.forEach(p => {\r\n                 const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n                 const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n                 const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n-                html += `<tr class=\"border-b hover:bg-gray-50\">\r\n-                    <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n-                    <td class=\"py-2 px-4\">${date}</td>\r\n-                    <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n-                </tr>`;\r\n+\r\n+                html += `\r\n+                    <tr class=\"border-b hover:bg-gray-50\">\r\n+                        <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n+                        <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n+                        <td class=\"py-2 px-4\">${date}</td>\r\n+                        <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n+                    </tr>`;\r\n             });\r\n+\r\n             html += `</tbody></table>`;\r\n             container.innerHTML = html;\r\n+\r\n         } catch (err) {\r\n+            console.error(\"Error loading payment records:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n+    /**\r\n+     * Loads and displays visitors list data from the API.\r\n+     */\r\n     async function loadVisitorsList() { \r\n+        console.log('Fetching visitors list...'); \r\n         const container = document.getElementById(\"dynamic-section-content\");\r\n         if (!container) return;\r\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n+\r\n         try {\r\n-            const visitors = await debugFetch(\"Visitors List\", `${API_BASE}/api/admin/visitors`);\r\n-            if (!visitors || visitors.length === 0) {\r\n+            const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const data = await res.json();\r\n+            \r\n+            if (data.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n                 return;\r\n             }\r\n \r\n+            // Example rendering for visitors (adjust fields based on actual API data)\r\n             let html = `<ul class=\"space-y-3 p-4\">`;\r\n-            visitors.forEach(v => {\r\n-                html += `<li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n-                    <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n-                    <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n-                    <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n-                </li>`;\r\n+            data.forEach(v => {\r\n+                html += `\r\n+                    <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n+                        <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n+                        <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n+                        <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n+                    </li>`;\r\n             });\r\n             html += \"</ul>\";\r\n             container.innerHTML = html;\r\n+\r\n         } catch (err) {\r\n+            console.error(\"Error loading visitors list:\", err);\r\n             container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n         }\r\n     }\r\n \r\n-    // =========================================\r\n-    // Sidebar Page Loading\r\n-    // =========================================\r\n+\r\n+    /**\r\n+     * Loads and displays membership records (approved members) from the API.\r\n+     */\r\n+    async function loadMembershipRecords() {\r\n+        console.log('Fetching membership records...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n+\r\n+        try {\r\n+            // FIX 1: Standardize API Endpoint path\r\n+            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n+            const responseData = await res.json();\r\n+            // FIX 2: Access the 'records' property, which the backend controller returns\r\n+            const members = responseData.records || []; \r\n+            \r\n+            // Filter for only approved members for the records section\r\n+            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+\r\n+            if (approvedMembers.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n+                return;\r\n+            }\r\n+\r\n+            let html = `<ul class=\"space-y-3 p-4\">`;\r\n+\r\n+            approvedMembers.forEach(m => {\r\n+                html += `\r\n+                    <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n+                        <div>\r\n+                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n+                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n+                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n+                        </div>\r\n+                        <div class=\"text-right\">\r\n+                           <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n+                                Active\r\n+                           </span>\r\n+                        </div>\r\n+                    </li>`;\r\n+            });\r\n+\r\n+            html += \"</ul>\";\r\n+            container.innerHTML = html;\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading membership records:\", err);\r\n+            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * Loads and displays pending membership requests and handles approvals.\r\n+     */\r\n+    async function loadMembershipRequests() {\r\n+        console.log('Fetching membership requests...'); \r\n+        const container = document.getElementById(\"dynamic-section-content\");\r\n+        if (!container) return;\r\n+        \r\n+        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n+\r\n+        try {\r\n+            // FIX 1: Standardize API Endpoint path\r\n+            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+            \r\n+            const responseData = await res.json();\r\n+            // FIX 2: Access the 'records' property, which the backend controller returns\r\n+            const allRecords = responseData.records || [];\r\n+            \r\n+            // Filter for pending requests to show in this view\r\n+            const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n+            \r\n+            if (pendingRequests.length === 0) {\r\n+                container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n+                return;\r\n+            }\r\n+\r\n+            let html = `\r\n+                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n+                    <thead class=\"bg-gray-200\">\r\n+                        <tr>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n+                            <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n+                        </tr>\r\n+                    </thead>\r\n+                    <tbody>\r\n+            `;\r\n+\r\n+            pendingRequests.forEach(r => {\r\n+                html += `\r\n+                    <tr class=\"border-b hover:bg-yellow-50\">\r\n+                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n+                        <td class=\"py-2 px-4\">${r.HouseNumber} - ${r.CourtName}</td>\r\n+                        <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n+                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n+                        <td class=\"py-2 px-4 action-cell\">\r\n+                            <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n+                        </td>\r\n+                    </tr>`;\r\n+            });\r\n+\r\n+            html += `</tbody></table>`;\r\n+            container.innerHTML = html;\r\n+\r\n+            // Approve buttons event listeners (Binding Logic)\r\n+            document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n+                btn.addEventListener(\"click\", handleApproveClick);\r\n+            });\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading membership requests:\", err);\r\n+            const container = document.getElementById(\"dynamic-section-content\");\r\n+            if (container) {\r\n+                 container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    /**\r\n+     * Handles the click event for approving a membership request.\r\n+     * @param {Event} event \r\n+     */\r\n+    async function handleApproveClick(event) {\r\n+        const btn = event.currentTarget;\r\n+        const requestId = btn.dataset.id;\r\n+        const originalText = btn.textContent;\r\n+        \r\n+        btn.disabled = true;\r\n+        btn.textContent = 'Processing...';\r\n+\r\n+        try {\r\n+            // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n+            const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n+                method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n+                headers: {\r\n+                    \"Content-Type\": \"application/json\",\r\n+                    \"Authorization\": `Bearer ${token}`\r\n+                },\r\n+                // Removed body: JSON.stringify({ requestId }) as ID is now in the URL\r\n+            });\r\n+\r\n+            if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n+\r\n+            // Success handling: update the UI\r\n+            const actionCell = btn.parentElement;\r\n+            const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n+            \r\n+            if (statusCell) {\r\n+                statusCell.textContent = 'Approved';\r\n+                statusCell.classList.add('font-bold', 'text-green-600');\r\n+            }\r\n+            actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n+            \r\n+        } catch (err) {\r\n+            console.error(\"Error approving request:\", err.message);\r\n+            \r\n+            // Failure handling: revert button and show error visually\r\n+            btn.disabled = false;\r\n+            btn.textContent = 'Failed!';\r\n+            btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n+            btn.classList.add('bg-red-500', 'animate-pulse');\r\n+\r\n+            // Reset after a short period\r\n+            setTimeout(() => {\r\n+                btn.textContent = originalText;\r\n+                btn.classList.remove('bg-red-500', 'animate-pulse');\r\n+                btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n+            }, 2000);\r\n+            \r\n+        }\r\n+    }\r\n+\r\n+    /**\r\n+     * Loads dashboard summary metrics.\r\n+     */\r\n+    async function loadDashboardSummary() {\r\n+        console.log('Fetching dashboard summary...');\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n+            const data = await res.json();\r\n+\r\n+            safeUpdate(\"totalResidents\", data.residents || 0);\r\n+            safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+            safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+            safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading dashboard summary:\", err);\r\n+        }\r\n+    }\r\n+\r\n+    /**\r\n+     * Loads data and renders the Access Chart using Chart.js.\r\n+     */\r\n+    async function loadAccessChart() {\r\n+        console.log('Fetching access chart data...');\r\n+        try {\r\n+            const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n+                headers: { \"Authorization\": `Bearer ${token}` }\r\n+            });\r\n+\r\n+            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+\r\n+            const data = await res.json();\r\n+\r\n+            const canvas = document.getElementById(\"accessChart\");\r\n+            if (!canvas) return;\r\n+\r\n+            // Check if Chart.js is available globally (must be included in HTML)\r\n+            if (typeof Chart === 'undefined') {\r\n+                console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n+                return;\r\n+            }\r\n+\r\n+            const ctx = canvas.getContext(\"2d\");\r\n+\r\n+            new Chart(ctx, {\r\n+                type: \"line\",\r\n+                data: {\r\n+                    labels: data.days || [],\r\n+                    datasets: [{\r\n+                        label: \"Access Attempts\",\r\n+                        data: data.counts || [],\r\n+                        borderWidth: 2,\r\n+                        tension: 0.4,\r\n+                        borderColor: \"#2563eb\",\r\n+                        backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n+                        fill: true\r\n+                    }]\r\n+                },\r\n+                options: { responsive: true, maintainAspectRatio: false }\r\n+            });\r\n+\r\n+        } catch (err) {\r\n+            console.error(\"Error loading access chart:\", err);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    // ================================\r\n+    // SIDEBAR PAGE LOADING\r\n+    // ================================\r\n+\r\n+    /**\r\n+     * Fetches and loads HTML content into the main content area.\r\n+     * @param {string} url The URL of the page to load.\r\n+     */\r\n     async function loadPageIntoMainContent(url) {\r\n         try {\r\n             const res = await fetch(url);\r\n             if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+\r\n             const html = await res.text();\r\n             mainContentArea.innerHTML = html;\r\n \r\n+            // Trigger dashboard specific loads immediately after content is inserted\r\n             if (url.includes(\"dashboardoverview.html\")) {\r\n-                await loadAdminDashboard();\r\n+                await loadDashboardSummary();\r\n+                await loadAccessChart();\r\n             }\r\n-            if (url.includes(\"membership.html\")) await fetchMembershipRequests();\r\n-            if (url.includes(\"membershiprecords.html\")) await fetchMembershipRecords();\r\n-            if (url.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-            if (url.includes(\"payments.html\")) await loadPaymentRecords();\r\n         } catch (err) {\r\n-            mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+            console.error(\"Error loading page:\", err);\r\n+            mainContentArea.innerHTML =\r\n+                `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n         }\r\n     }\r\n \r\n+    // Sidebar routing: Handles content loading and dynamic data fetching\r\n     sidebarButtons.forEach(btn => {\r\n         btn.addEventListener(\"click\", async () => {\r\n+            // Update active state for sidebar buttons\r\n             sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n             btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n             const page = btn.dataset.target;\r\n             if (!page) return;\r\n+\r\n             await loadPageIntoMainContent(page);\r\n+\r\n+            // Trigger dynamic page data loads after content is inserted\r\n+            if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n+            if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n+            if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n+            if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n         });\r\n     });\r\n \r\n+\r\n+    // ================================\r\n+    // EVENT LISTENERS & INITIALIZATION\r\n+    // ================================\r\n+\r\n+    // Logout Button\r\n     document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n         localStorage.removeItem(\"accessToken\");\r\n         window.location.href = \"/login.html\";\r\n     });\r\n+    \r\n+    // Visitor Management Dropdown Toggle\r\n+    const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+    const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+    const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-    // Initial dashboard load\r\n+    visitorToggle?.addEventListener(\"click\", () => {\r\n+        visitorSubMenu?.classList.toggle(\"hidden\");\r\n+        visitorArrow?.classList.toggle(\"rotate-90\");\r\n+    });\r\n+\r\n+\r\n+    // Initial Dashboard Load\r\n+    // This runs on page load. It defaults to loading the dashboard overview.\r\n     const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n     if (dashboardBtn) {\r\n         dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n         await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n     } else if (document.getElementById(\"totalResidents\")) {\r\n-        await loadAdminDashboard();\r\n+        // Fallback for when content is already on the page (less common in SPA-style)\r\n+        await loadDashboardSummary();\r\n+        await loadAccessChart();\r\n     }\r\n+})();\r\n+// =========================================\r\n+// Debug Fetch Wrapper\r\n+// =========================================\r\n+async function debugFetch(name, url, options = {}) {\r\n+  console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n+  console.time(name);\r\n \r\n-})();\r\n+  try {\r\n+    const res = await fetch(url, options);\r\n+\r\n+    if (!res.ok) {\r\n+      console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n+      const text = await res.text();\r\n+      console.error(`Response text:`, text);\r\n+      console.timeEnd(name);\r\n+      return null;\r\n+    }\r\n+\r\n+    const data = await res.json();\r\n+    console.log(`✅ ${name} succeeded`, data);\r\n+    console.timeEnd(name);\r\n+    return data;\r\n+  } catch (err) {\r\n+    console.error(`❌ ${name} error:`, err);\r\n+    console.timeEnd(name);\r\n+    return null;\r\n+  }\r\n+}\r\n+\r\n+// =========================================\r\n+// Individual Fetch Functions\r\n+// =========================================\r\n+async function fetchDashboardSummary() {\r\n+  return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n+}\r\n+\r\n+async function fetchAccessChartData() {\r\n+  return await debugFetch(\"Access Chart Data\", \"/api/access/chart\");\r\n+}\r\n+\r\n+async function fetchMembershipRequests() {\r\n+  return await debugFetch(\"Membership Requests\", \"/api/memberships/requests\");\r\n+}\r\n+\r\n+async function fetchMembershipRecords() {\r\n+  return await debugFetch(\"Membership Records\", \"/api/memberships/records\");\r\n+}\r\n+\r\n+// =========================================\r\n+// Main Loader\r\n+// =========================================\r\n+async function loadAdminDashboard() {\r\n+  const [summary, chartData, requests, records] = await Promise.all([\r\n+    fetchDashboardSummary(),\r\n+    fetchAccessChartData(),\r\n+    fetchMembershipRequests(),\r\n+    fetchMembershipRecords(),\r\n+  ]);\r\n+\r\n+  // Example: populate your dashboard with data if available\r\n+  if (summary) populateDashboardSummary(summary);\r\n+  if (chartData) renderAccessChart(chartData);\r\n+  if (requests) renderMembershipRequests(requests);\r\n+  if (records) renderMembershipRecords(records);\r\n+}\r\n+\r\n+// Call on page load\r\n+loadAdminDashboard();\r\n"
                },
                {
                    "date": 1763674684960,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,9 @@\n     // =======================================================\r\n     // CONFIGURATION & INITIAL STATE\r\n     // =======================================================\r\n     // 1. Centralized API Host for all backend connections\r\n+    // NOTE: This port must match the one your Node.js server is running on (4050 in this case)\r\n     const API_HOST = \"http://localhost:4050\"; \r\n \r\n     // 2. Auth State Check & Token Retrieval\r\n     const token = localStorage.getItem(\"accessToken\");\r\n@@ -56,8 +57,9 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n         \r\n         try {\r\n+            // NOTE: Assuming this route is defined elsewhere, but keeping client URL for consistency\r\n             const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n@@ -116,9 +118,11 @@\n \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n \r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/admin/visitors`, {\r\n+            // FIX: Match the server's /api/residents/visitorsaccess route (or create a dedicated admin one)\r\n+            // Using the existing residents route as a placeholder since it returns visitor data\r\n+            const res = await fetch(`${API_HOST}/api/residents/visitorsaccess`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n             \r\n@@ -159,21 +163,19 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n \r\n         try {\r\n-            // FIX 1: Standardize API Endpoint path\r\n-            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n+            // ✅ FIX: Use the corrected Server route: /api/memberships/records\r\n+            const res = await fetch(`${API_HOST}/api/memberships/records`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n \r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-            const responseData = await res.json();\r\n-            // FIX 2: Access the 'records' property, which the backend controller returns\r\n-            const members = responseData.records || []; \r\n+            // Assuming the server's getApprovedResidents returns an array of records\r\n+            const approvedMembers = await res.json(); \r\n             \r\n-            // Filter for only approved members for the records section\r\n-            const approvedMembers = members.filter(m => m.Status === \"Approved\");\r\n+            // NOTE: No need to filter for \"Approved\" status if the server's /records route only returns approved ones.\r\n \r\n             if (approvedMembers.length === 0) {\r\n                 container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n                 return;\r\n@@ -184,11 +186,11 @@\n             approvedMembers.forEach(m => {\r\n                 html += `\r\n                     <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n                         <div>\r\n-                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName}</p>\r\n-                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber} - ${m.CourtName}</span></p>\r\n-                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID}</p>\r\n+                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName || m.FullName}</p>\r\n+                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber || 'N/A'} - ${m.CourtName || 'N/A'}</span></p>\r\n+                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID || 'N/A'}</p>\r\n                         </div>\r\n                         <div class=\"text-right\">\r\n                            <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n                                 Active\r\n@@ -217,17 +219,16 @@\n         \r\n         container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n \r\n         try {\r\n-            // FIX 1: Standardize API Endpoint path\r\n-            const res = await fetch(`${API_HOST}/api/membershiprecords/all`, {\r\n+            // ✅ FIX: Use the corrected Server route: /api/memberships/requests\r\n+            const res = await fetch(`${API_HOST}/api/memberships/requests`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n             \r\n-            const responseData = await res.json();\r\n-            // FIX 2: Access the 'records' property, which the backend controller returns\r\n-            const allRecords = responseData.records || [];\r\n+            // Assuming the server's getMembershipRequests returns an array of records\r\n+            const allRecords = await res.json();\r\n             \r\n             // Filter for pending requests to show in this view\r\n             const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n             \r\n@@ -252,10 +253,10 @@\n \r\n             pendingRequests.forEach(r => {\r\n                 html += `\r\n                     <tr class=\"border-b hover:bg-yellow-50\">\r\n-                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.HouseNumber} - ${r.CourtName}</td>\r\n+                        <td class=\"py-2 px-4\">${r.ResidentName || r.FullName}</td>\r\n+                        <td class=\"py-2 px-4\">${r.HouseNumber || 'N/A'} - ${r.CourtName || 'N/A'}</td>\r\n                         <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n                         <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n                         <td class=\"py-2 px-4 action-cell\">\r\n                             <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n@@ -293,8 +294,9 @@\n         btn.textContent = 'Processing...';\r\n \r\n         try {\r\n             // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n+            // Keeping the client URL as is, assuming /api/membershiprecords/approve/:id is a known route.\r\n             const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n                 method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n                 headers: {\r\n                     \"Content-Type\": \"application/json\",\r\n@@ -339,23 +341,27 @@\n      */\r\n     async function loadDashboardSummary() {\r\n         console.log('Fetching dashboard summary...');\r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/residents/dashboard/summary`, {\r\n+            // ✅ FIX: Use the corrected Server route: /api/dashboard/summary\r\n+            const res = await fetch(`${API_HOST}/api/dashboard/summary`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n \r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n             const data = await res.json();\r\n \r\n-            safeUpdate(\"totalResidents\", data.residents || 0);\r\n-            safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-            safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-            safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+            // The data keys should now match your server query aliases:\r\n+            // ApprovedResidents, PendingRequests, WeeklyVisitors\r\n+            safeUpdate(\"totalResidents\", data.ApprovedResidents || 0);\r\n+            safeUpdate(\"pendingRequests\", data.PendingRequests || 0); // Changed key from pendingPayments\r\n+            safeUpdate(\"weeklyVisitors\", data.WeeklyVisitors || 0); // New key for the weekly count\r\n+            // NOTE: You will need to check your HTML IDs for the summary cards and match them here (e.g., 'totalResidents', 'pendingRequests', 'weeklyVisitors').\r\n \r\n         } catch (err) {\r\n             console.error(\"Error loading dashboard summary:\", err);\r\n+            // safeUpdate(\"totalResidents\", '---'); // Optional: Clear UI on error\r\n         }\r\n     }\r\n \r\n     /**\r\n@@ -363,15 +369,16 @@\n      */\r\n     async function loadAccessChart() {\r\n         console.log('Fetching access chart data...');\r\n         try {\r\n-            const res = await fetch(`${API_HOST}/api/residents/admin/accesschart`, {\r\n+            // ✅ FIX: Use the corrected Server route: /api/access/chart\r\n+            const res = await fetch(`${API_HOST}/api/access/chart`, {\r\n                 headers: { \"Authorization\": `Bearer ${token}` }\r\n             });\r\n \r\n             if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n \r\n-            const data = await res.json();\r\n+            const rawData = await res.json();\r\n \r\n             const canvas = document.getElementById(\"accessChart\");\r\n             if (!canvas) return;\r\n \r\n@@ -382,15 +389,19 @@\n             }\r\n \r\n             const ctx = canvas.getContext(\"2d\");\r\n \r\n+            // Map data from server query (Date, TotalPasses) to Chart.js format (labels, data)\r\n+            const chartLabels = rawData.map(item => new Date(item.Date).toLocaleDateString());\r\n+            const chartCounts = rawData.map(item => item.TotalPasses);\r\n+\r\n             new Chart(ctx, {\r\n                 type: \"line\",\r\n                 data: {\r\n-                    labels: data.days || [],\r\n+                    labels: chartLabels || [],\r\n                     datasets: [{\r\n                         label: \"Access Attempts\",\r\n-                        data: data.counts || [],\r\n+                        data: chartCounts || [],\r\n                         borderWidth: 2,\r\n                         tension: 0.4,\r\n                         borderColor: \"#2563eb\",\r\n                         backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n@@ -487,72 +498,26 @@\n         await loadDashboardSummary();\r\n         await loadAccessChart();\r\n     }\r\n })();\r\n+\r\n // =========================================\r\n-// Debug Fetch Wrapper\r\n+// Debug Fetch Wrapper (Removed unneeded base URL usage)\r\n // =========================================\r\n-async function debugFetch(name, url, options = {}) {\r\n-  console.log(`➡️ Starting fetch: ${name} (${url})`);\r\n-  console.time(name);\r\n-\r\n-  try {\r\n-    const res = await fetch(url, options);\r\n-\r\n-    if (!res.ok) {\r\n-      console.error(`❌ ${name} failed with status ${res.status}: ${res.statusText}`);\r\n-      const text = await res.text();\r\n-      console.error(`Response text:`, text);\r\n-      console.timeEnd(name);\r\n-      return null;\r\n-    }\r\n-\r\n-    const data = await res.json();\r\n-    console.log(`✅ ${name} succeeded`, data);\r\n-    console.timeEnd(name);\r\n-    return data;\r\n-  } catch (err) {\r\n-    console.error(`❌ ${name} error:`, err);\r\n-    console.timeEnd(name);\r\n-    return null;\r\n-  }\r\n+// This block of code is not being used by the main initializer function above, \r\n+// so you can safely remove it if it's confusing, or keep it for future use.\r\n+// If you keep it, ensure you define API_HOST in this scope or pass it.\r\n+// I recommend removing it as the logic is duplicated in the main IIFE above.\r\n+// =========================================\r\n+/* async function debugFetch(name, url, options = {}) {\r\n+  // ... debug logic ...\r\n }\r\n \r\n-// =========================================\r\n-// Individual Fetch Functions\r\n-// =========================================\r\n async function fetchDashboardSummary() {\r\n   return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n }\r\n-\r\n-async function fetchAccessChartData() {\r\n-  return await debugFetch(\"Access Chart Data\", \"/api/access/chart\");\r\n-}\r\n-\r\n-async function fetchMembershipRequests() {\r\n-  return await debugFetch(\"Membership Requests\", \"/api/memberships/requests\");\r\n-}\r\n-\r\n-async function fetchMembershipRecords() {\r\n-  return await debugFetch(\"Membership Records\", \"/api/memberships/records\");\r\n-}\r\n-\r\n-// =========================================\r\n-// Main Loader\r\n-// =========================================\r\n+// ... other fetch functions ...\r\n async function loadAdminDashboard() {\r\n-  const [summary, chartData, requests, records] = await Promise.all([\r\n-    fetchDashboardSummary(),\r\n-    fetchAccessChartData(),\r\n-    fetchMembershipRequests(),\r\n-    fetchMembershipRecords(),\r\n-  ]);\r\n-\r\n-  // Example: populate your dashboard with data if available\r\n-  if (summary) populateDashboardSummary(summary);\r\n-  if (chartData) renderAccessChart(chartData);\r\n-  if (requests) renderMembershipRequests(requests);\r\n-  if (records) renderMembershipRecords(records);\r\n+  // ... logic\r\n }\r\n-\r\n-// Call on page load\r\n-loadAdminDashboard();\r\n+// loadAdminDashboard(); // This will execute on page load and conflict with the main IIFE\r\n+*/\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763694416772,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,523 +1,147 @@\n-/**\r\n- * Admin Dashboard Client-Side JavaScript\r\n- * Uses Fetch API to communicate with a Node.js/Express Backend (API_HOST)\r\n- */\r\n-(async function initializeDashboard() {\r\n-    // =======================================================\r\n-    // CONFIGURATION & INITIAL STATE\r\n-    // =======================================================\r\n-    // 1. Centralized API Host for all backend connections\r\n-    // NOTE: This port must match the one your Node.js server is running on (4050 in this case)\r\n-    const API_HOST = \"http://localhost:4050\"; \r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+// ================================\r\n+const token = localStorage.getItem(\"accessToken\");\r\n+if (!token) window.location.href = \"/login.html\";\r\n \r\n-    // 2. Auth State Check & Token Retrieval\r\n-    const token = localStorage.getItem(\"accessToken\");\r\n-    \r\n-    // Redirects to login if no access token is found\r\n-    if (!token) {\r\n-        window.location.href = \"/login.html\";\r\n-        return; // Stop execution if redirecting\r\n-    }\r\n+document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n+});\r\n \r\n-    // DOM Elements\r\n-    const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-    const mainContentArea = document.getElementById(\"main-content-area\");\r\n+// ================================\r\n+// SIDEBAR PAGE LOADING\r\n+// ================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+async function loadPageIntoMainContent(url) {\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html;\r\n \r\n-    // ================================\r\n-    // UTILITIES\r\n-    // ================================\r\n-\r\n-    /**\r\n-     * Safely updates the text content of an element by ID.\r\n-     * @param {string} id Element ID.\r\n-     * @param {string|number} value New value.\r\n-     * @param {string} [suffix=''] Optional text suffix (e.g., '%').\r\n-     */\r\n-    const safeUpdate = (id, value, suffix = '') => {\r\n-        const element = document.getElementById(id);\r\n-        if (element) {\r\n-            element.textContent = value + suffix;\r\n-        } else {\r\n-            // console.warn(`Element with ID '${id}' not found.`); \r\n+        // For subsequent (non-initial) dashboard loads (via button click), \r\n+        // we call the functions directly after innerHTML.\r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            // NOTE: We don't need setTimeout here for subsequent clicks, \r\n+            // as the initial load issue is bypassed.\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n         }\r\n-    };\r\n-    \r\n-    // ================================\r\n-    // DYNAMIC CONTENT LOADERS (API INTERACTION)\r\n-    // ================================\r\n-\r\n-    /**\r\n-     * Loads and displays payment records from the API.\r\n-     */\r\n-    async function loadPaymentRecords() { \r\n-        console.log('Fetching payment records...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading payment records...</div>`;\r\n-        \r\n-        try {\r\n-            // NOTE: Assuming this route is defined elsewhere, but keeping client URL for consistency\r\n-            const res = await fetch(`${API_HOST}/api/admin/payments`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const payments = await res.json();\r\n-            \r\n-            if (payments.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No payment records found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            // Basic HTML rendering for payments table\r\n-            let html = `\r\n-                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                    <thead class=\"bg-gray-200\">\r\n-                        <tr>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Resident Name</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Amount</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Date</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                        </tr>\r\n-                    </thead>\r\n-                    <tbody>\r\n-            `;\r\n-\r\n-            payments.forEach(p => {\r\n-                const date = new Date(p.PaymentDate || Date.now()).toLocaleDateString();\r\n-                const statusClass = p.Status === \"Completed\" ? \"text-green-600\" : \"text-yellow-600\";\r\n-                const amount = p.Amount ? `$${parseFloat(p.Amount).toFixed(2)}` : 'N/A';\r\n-\r\n-                html += `\r\n-                    <tr class=\"border-b hover:bg-gray-50\">\r\n-                        <td class=\"py-2 px-4\">${p.ResidentName || 'N/A'}</td>\r\n-                        <td class=\"py-2 px-4 font-mono\">${amount}</td>\r\n-                        <td class=\"py-2 px-4\">${date}</td>\r\n-                        <td class=\"py-2 px-4 ${statusClass}\">${p.Status || 'Pending'}</td>\r\n-                    </tr>`;\r\n-            });\r\n-\r\n-            html += `</tbody></table>`;\r\n-            container.innerHTML = html;\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading payment records:\", err);\r\n-            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load payments: ${err.message}</div>`;\r\n-        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n     }\r\n+}\r\n \r\n-    /**\r\n-     * Loads and displays visitors list data from the API.\r\n-     */\r\n-    async function loadVisitorsList() { \r\n-        console.log('Fetching visitors list...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading visitor data...</div>`;\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n \r\n-        try {\r\n-            // FIX: Match the server's /api/residents/visitorsaccess route (or create a dedicated admin one)\r\n-            // Using the existing residents route as a placeholder since it returns visitor data\r\n-            const res = await fetch(`${API_HOST}/api/residents/visitorsaccess`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            const data = await res.json();\r\n-            \r\n-            if (data.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No visitor records found.</p>\";\r\n-                return;\r\n-            }\r\n+// *** REMOVED: loadPageIntoMainContent(\"sections/dashboardoverview.html\"); ***\r\n+// The initial page load is handled by the index.html content itself.\r\n \r\n-            // Example rendering for visitors (adjust fields based on actual API data)\r\n-            let html = `<ul class=\"space-y-3 p-4\">`;\r\n-            data.forEach(v => {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow rounded-xl p-4 border-l-4 border-teal-500\">\r\n-                        <p class=\"font-bold text-gray-800\">${v.VisitorName || 'Unknown Visitor'}</p>\r\n-                        <p class=\"text-sm text-gray-600\">Resident: ${v.ResidentName || 'N/A'}</p>\r\n-                        <p class=\"text-xs text-gray-500\">Access Time: ${new Date(v.AccessTime).toLocaleString()}</p>\r\n-                    </li>`;\r\n-            });\r\n-            html += \"</ul>\";\r\n-            container.innerHTML = html;\r\n+// ================================\r\n+// VISITOR MANAGEMENT TOGGLE\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-        } catch (err) {\r\n-            console.error(\"Error loading visitors list:\", err);\r\n-            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load visitors list: ${err.message}</div>`;\r\n-        }\r\n-    }\r\n+visitorToggle.addEventListener(\"click\", () => {\r\n+    visitorSubMenu.classList.toggle(\"hidden\");\r\n+    visitorArrow.classList.toggle(\"rotate-90\");\r\n+});\r\n \r\n-\r\n-    /**\r\n-     * Loads and displays membership records (approved members) from the API.\r\n-     */\r\n-    async function loadMembershipRecords() {\r\n-        console.log('Fetching membership records...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading membership records...</div>`;\r\n-\r\n-        try {\r\n-            // ✅ FIX: Use the corrected Server route: /api/memberships/records\r\n-            const res = await fetch(`${API_HOST}/api/memberships/records`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            // Assuming the server's getApprovedResidents returns an array of records\r\n-            const approvedMembers = await res.json(); \r\n-            \r\n-            // NOTE: No need to filter for \"Approved\" status if the server's /records route only returns approved ones.\r\n-\r\n-            if (approvedMembers.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No approved membership records found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            let html = `<ul class=\"space-y-3 p-4\">`;\r\n-\r\n-            approvedMembers.forEach(m => {\r\n-                html += `\r\n-                    <li class=\"bg-white shadow-lg rounded-xl p-5 flex justify-between items-center transition duration-150 ease-in-out hover:shadow-xl border-l-4 border-blue-500\">\r\n-                        <div>\r\n-                            <p class=\"font-bold text-lg text-gray-800\">${m.ResidentName || m.FullName}</p>\r\n-                            <p class=\"text-gray-600 text-sm mt-1\">House: <span class=\"font-medium\">${m.HouseNumber || 'N/A'} - ${m.CourtName || 'N/A'}</span></p>\r\n-                            <p class=\"text-gray-500 text-xs\">National ID: ${m.NationalID || 'N/A'}</p>\r\n-                        </div>\r\n-                        <div class=\"text-right\">\r\n-                           <span class=\"inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-xs font-semibold text-blue-700\">\r\n-                                Active\r\n-                           </span>\r\n-                        </div>\r\n-                    </li>`;\r\n-            });\r\n-\r\n-            html += \"</ul>\";\r\n-            container.innerHTML = html;\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading membership records:\", err);\r\n-            container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load records: ${err.message}</div>`;\r\n-        }\r\n+// ================================\r\n+// SAFE UPDATE HELPER\r\n+// ================================\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    } else {\r\n+        // This warning should now only appear if an ID is misspelled \r\n+        // or a sidebar page is missing the element.\r\n+        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n     }\r\n+};\r\n \r\n+// ================================\r\n+// DASHBOARD SUMMARY\r\n+// ================================\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-    /**\r\n-     * Loads and displays pending membership requests and handles approvals.\r\n-     */\r\n-    async function loadMembershipRequests() {\r\n-        console.log('Fetching membership requests...'); \r\n-        const container = document.getElementById(\"dynamic-section-content\");\r\n-        if (!container) return;\r\n-        \r\n-        container.innerHTML = `<div class='p-4 text-center text-blue-500'>Loading requests...</div>`;\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n-        try {\r\n-            // ✅ FIX: Use the corrected Server route: /api/memberships/requests\r\n-            const res = await fetch(`${API_HOST}/api/memberships/requests`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-            \r\n-            // Assuming the server's getMembershipRequests returns an array of records\r\n-            const allRecords = await res.json();\r\n-            \r\n-            // Filter for pending requests to show in this view\r\n-            const pendingRequests = allRecords.filter(r => r.Status === \"Pending\");\r\n-            \r\n-            if (pendingRequests.length === 0) {\r\n-                container.innerHTML = \"<p class='text-gray-500 text-center'>No pending membership requests found.</p>\";\r\n-                return;\r\n-            }\r\n-\r\n-            let html = `\r\n-                <table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n-                    <thead class=\"bg-gray-200\">\r\n-                        <tr>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Name</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">House</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Status</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Requested At</th>\r\n-                            <th class=\"py-2 px-4 text-left text-gray-700\">Actions</th>\r\n-                        </tr>\r\n-                    </thead>\r\n-                    <tbody>\r\n-            `;\r\n-\r\n-            pendingRequests.forEach(r => {\r\n-                html += `\r\n-                    <tr class=\"border-b hover:bg-yellow-50\">\r\n-                        <td class=\"py-2 px-4\">${r.ResidentName || r.FullName}</td>\r\n-                        <td class=\"py-2 px-4\">${r.HouseNumber || 'N/A'} - ${r.CourtName || 'N/A'}</td>\r\n-                        <td class=\"py-2 px-4 status-cell\">${r.Status}</td>\r\n-                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n-                        <td class=\"py-2 px-4 action-cell\">\r\n-                            <button class=\"approve-btn bg-green-500 hover:bg-green-600 px-3 py-1 text-white text-sm font-medium rounded transition duration-150 ease-in-out shadow-md\" data-id=\"${r.RequestID}\">Approve</button>\r\n-                        </td>\r\n-                    </tr>`;\r\n-            });\r\n-\r\n-            html += `</tbody></table>`;\r\n-            container.innerHTML = html;\r\n-\r\n-            // Approve buttons event listeners (Binding Logic)\r\n-            document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n-                btn.addEventListener(\"click\", handleApproveClick);\r\n-            });\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading membership requests:\", err);\r\n-            const container = document.getElementById(\"dynamic-section-content\");\r\n-            if (container) {\r\n-                 container.innerHTML = `<div class='p-4 bg-red-100 text-red-700 rounded-lg'>Could not load requests: ${err.message}</div>`;\r\n-            }\r\n-        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n     }\r\n+}\r\n \r\n-    /**\r\n-     * Handles the click event for approving a membership request.\r\n-     * @param {Event} event \r\n-     */\r\n-    async function handleApproveClick(event) {\r\n-        const btn = event.currentTarget;\r\n-        const requestId = btn.dataset.id;\r\n-        const originalText = btn.textContent;\r\n-        \r\n-        btn.disabled = true;\r\n-        btn.textContent = 'Processing...';\r\n+// ================================\r\n+// ACCESS CHART\r\n+// ================================\r\n+async function loadAccessChart() {\r\n+    try {\r\n+        const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-        try {\r\n-            // FIX: Use the correct RESTful PUT route defined in membershiprecordsRoutes.js\r\n-            // Keeping the client URL as is, assuming /api/membershiprecords/approve/:id is a known route.\r\n-            const resp = await fetch(`${API_HOST}/api/membershiprecords/approve/${requestId}`, {\r\n-                method: \"PUT\", // Changed method to PUT and uses ID in URL path\r\n-                headers: {\r\n-                    \"Content-Type\": \"application/json\",\r\n-                    \"Authorization\": `Bearer ${token}`\r\n-                },\r\n-                // Removed body: JSON.stringify({ requestId }) as ID is now in the URL\r\n-            });\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n \r\n-            if (!resp.ok) throw new Error(\"Failed to approve resident. Check backend logs.\");\r\n-\r\n-            // Success handling: update the UI\r\n-            const actionCell = btn.parentElement;\r\n-            const statusCell = actionCell.closest('tr').querySelector('.status-cell');\r\n-            \r\n-            if (statusCell) {\r\n-                statusCell.textContent = 'Approved';\r\n-                statusCell.classList.add('font-bold', 'text-green-600');\r\n-            }\r\n-            actionCell.innerHTML = `<span class=\"text-green-600 font-semibold\">Approved ✔️</span>`;\r\n-            \r\n-        } catch (err) {\r\n-            console.error(\"Error approving request:\", err.message);\r\n-            \r\n-            // Failure handling: revert button and show error visually\r\n-            btn.disabled = false;\r\n-            btn.textContent = 'Failed!';\r\n-            btn.classList.remove('bg-green-500', 'hover:bg-green-600');\r\n-            btn.classList.add('bg-red-500', 'animate-pulse');\r\n-\r\n-            // Reset after a short period\r\n-            setTimeout(() => {\r\n-                btn.textContent = originalText;\r\n-                btn.classList.remove('bg-red-500', 'animate-pulse');\r\n-                btn.classList.add('bg-green-500', 'hover:bg-green-600');\r\n-            }, 2000);\r\n-            \r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Loads dashboard summary metrics.\r\n-     */\r\n-    async function loadDashboardSummary() {\r\n-        console.log('Fetching dashboard summary...');\r\n-        try {\r\n-            // ✅ FIX: Use the corrected Server route: /api/dashboard/summary\r\n-            const res = await fetch(`${API_HOST}/api/dashboard/summary`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const data = await res.json();\r\n-\r\n-            // The data keys should now match your server query aliases:\r\n-            // ApprovedResidents, PendingRequests, WeeklyVisitors\r\n-            safeUpdate(\"totalResidents\", data.ApprovedResidents || 0);\r\n-            safeUpdate(\"pendingRequests\", data.PendingRequests || 0); // Changed key from pendingPayments\r\n-            safeUpdate(\"weeklyVisitors\", data.WeeklyVisitors || 0); // New key for the weekly count\r\n-            // NOTE: You will need to check your HTML IDs for the summary cards and match them here (e.g., 'totalResidents', 'pendingRequests', 'weeklyVisitors').\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading dashboard summary:\", err);\r\n-            // safeUpdate(\"totalResidents\", '---'); // Optional: Clear UI on error\r\n-        }\r\n-    }\r\n-\r\n-    /**\r\n-     * Loads data and renders the Access Chart using Chart.js.\r\n-     */\r\n-    async function loadAccessChart() {\r\n-        console.log('Fetching access chart data...');\r\n-        try {\r\n-            // ✅ FIX: Use the corrected Server route: /api/access/chart\r\n-            const res = await fetch(`${API_HOST}/api/access/chart`, {\r\n-                headers: { \"Authorization\": `Bearer ${token}` }\r\n-            });\r\n-\r\n-            if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-\r\n-            const rawData = await res.json();\r\n-\r\n-            const canvas = document.getElementById(\"accessChart\");\r\n-            if (!canvas) return;\r\n-\r\n-            // Check if Chart.js is available globally (must be included in HTML)\r\n-            if (typeof Chart === 'undefined') {\r\n-                console.warn(\"Chart.js library is not loaded. Cannot render chart.\");\r\n-                return;\r\n-            }\r\n-\r\n-            const ctx = canvas.getContext(\"2d\");\r\n-\r\n-            // Map data from server query (Date, TotalPasses) to Chart.js format (labels, data)\r\n-            const chartLabels = rawData.map(item => new Date(item.Date).toLocaleDateString());\r\n-            const chartCounts = rawData.map(item => item.TotalPasses);\r\n-\r\n-            new Chart(ctx, {\r\n-                type: \"line\",\r\n-                data: {\r\n-                    labels: chartLabels || [],\r\n-                    datasets: [{\r\n-                        label: \"Access Attempts\",\r\n-                        data: chartCounts || [],\r\n-                        borderWidth: 2,\r\n-                        tension: 0.4,\r\n-                        borderColor: \"#2563eb\",\r\n-                        backgroundColor: \"rgba(37, 99, 235, .2)\",\r\n-                        fill: true\r\n-                    }]\r\n-                },\r\n-                options: { responsive: true, maintainAspectRatio: false }\r\n-            });\r\n-\r\n-        } catch (err) {\r\n-            console.error(\"Error loading access chart:\", err);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    // ================================\r\n-    // SIDEBAR PAGE LOADING\r\n-    // ================================\r\n-\r\n-    /**\r\n-     * Fetches and loads HTML content into the main content area.\r\n-     * @param {string} url The URL of the page to load.\r\n-     */\r\n-    async function loadPageIntoMainContent(url) {\r\n-        try {\r\n-            const res = await fetch(url);\r\n-            if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n\\ No newline at end of file\n-\r\n-            const html = await res.text();\r\n-            mainContentArea.innerHTML = html;\r\n-\r\n-            // Trigger dashboard specific loads immediately after content is inserted\r\n-            if (url.includes(\"dashboardoverview.html\")) {\r\n-                await loadDashboardSummary();\r\n-                await loadAccessChart();\r\n-            }\r\n-        } catch (err) {\r\n-            console.error(\"Error loading page:\", err);\r\n-            mainContentArea.innerHTML =\r\n-                `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n-        }\r\n-    }\r\n-\r\n-    // Sidebar routing: Handles content loading and dynamic data fetching\r\n-    sidebarButtons.forEach(btn => {\r\n-        btn.addEventListener(\"click\", async () => {\r\n-            // Update active state for sidebar buttons\r\n-            sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-            btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n-            const page = btn.dataset.target;\r\n-            if (!page) return;\r\n-\r\n-            await loadPageIntoMainContent(page);\r\n-\r\n-            // Trigger dynamic page data loads after content is inserted\r\n-            if (page.includes(\"membership.html\")) await loadMembershipRequests();\r\n-            if (page.includes(\"membershiprecords.html\")) await loadMembershipRecords();\r\n-            if (page.includes(\"visitorsaccess.html\")) await loadVisitorsList();\r\n-            if (page.includes(\"payments.html\")) await loadPaymentRecords();\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n         });\r\n-    });\r\n \r\n-\r\n-    // ================================\r\n-    // EVENT LISTENERS & INITIALIZATION\r\n-    // ================================\r\n-\r\n-    // Logout Button\r\n-    document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n-        localStorage.removeItem(\"accessToken\");\r\n-        window.location.href = \"/login.html\";\r\n-    });\r\n-    \r\n-    // Visitor Management Dropdown Toggle\r\n-    const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-    const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-    const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n-    visitorToggle?.addEventListener(\"click\", () => {\r\n-        visitorSubMenu?.classList.toggle(\"hidden\");\r\n-        visitorArrow?.classList.toggle(\"rotate-90\");\r\n-    });\r\n-\r\n-\r\n-    // Initial Dashboard Load\r\n-    // This runs on page load. It defaults to loading the dashboard overview.\r\n-    const dashboardBtn = document.querySelector('[data-target=\"dashboardoverview.html\"]');\r\n-    if (dashboardBtn) {\r\n-        dashboardBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        await loadPageIntoMainContent(\"dashboardoverview.html\");\r\n-    } else if (document.getElementById(\"totalResidents\")) {\r\n-        // Fallback for when content is already on the page (less common in SPA-style)\r\n-        await loadDashboardSummary();\r\n-        await loadAccessChart();\r\n+    } catch (err) {\r\n+        console.error(\"Error loading chart:\", err);\r\n     }\r\n-})();\r\n-\r\n-// =========================================\r\n-// Debug Fetch Wrapper (Removed unneeded base URL usage)\r\n-// =========================================\r\n-// This block of code is not being used by the main initializer function above, \r\n-// so you can safely remove it if it's confusing, or keep it for future use.\r\n-// If you keep it, ensure you define API_HOST in this scope or pass it.\r\n-// I recommend removing it as the logic is duplicated in the main IIFE above.\r\n-// =========================================\r\n-/* async function debugFetch(name, url, options = {}) {\r\n-  // ... debug logic ...\r\n }\r\n \r\n-async function fetchDashboardSummary() {\r\n-  return await debugFetch(\"Dashboard Summary\", \"/api/dashboard/summary\");\r\n-}\r\n-// ... other fetch functions ...\r\n-async function loadAdminDashboard() {\r\n-  // ... logic\r\n-}\r\n-// loadAdminDashboard(); // This will execute on page load and conflict with the main IIFE\r\n-*/\n+// ================================\r\n+// INITIALIZATION ON PAGE LOAD\r\n+// ================================\r\n+/**\r\n+ * Run this function once on initial page load.\r\n+ * Since the Dashboard Overview content is ALREADY present in index.html, \r\n+ * we can call the data functions directly without a wrapper or delay.\r\n+ */\r\n+(async function initializeDashboard() {\r\n+    await loadDashboardSummary();\r\n+    await loadAccessChart();\r\n+})();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763747705937,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -78,25 +78,25 @@\n // ================================\r\n // DASHBOARD SUMMARY\r\n // ================================\r\n async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n+  try {\r\n+    const res = await fetch(\"http://localhost:4050/api/dashboard/summary\", {\r\n+      headers: { \"Authorization\": \"Bearer \" + token }\r\n+    });\r\n+    if (res.ok) {\r\n+      const data = await res.json();\r\n+      console.log(data);\r\n+      // update DOM\r\n+    } else {\r\n+      console.error(\"Summary fetch failed\", res.status);\r\n     }\r\n+  } catch (err) {\r\n+    console.error(err);\r\n+  }\r\n }\r\n \r\n+\r\n // ================================\r\n // ACCESS CHART\r\n // ================================\r\n async function loadAccessChart() {\r\n"
                },
                {
                    "date": 1763747737690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,24 +77,8 @@\n \r\n // ================================\r\n // DASHBOARD SUMMARY\r\n // ================================\r\n-async function loadDashboardSummary() {\r\n-  try {\r\n-    const res = await fetch(\"http://localhost:4050/api/dashboard/summary\", {\r\n-      headers: { \"Authorization\": \"Bearer \" + token }\r\n-    });\r\n-    if (res.ok) {\r\n-      const data = await res.json();\r\n-      console.log(data);\r\n-      // update DOM\r\n-    } else {\r\n-      console.error(\"Summary fetch failed\", res.status);\r\n-    }\r\n-  } catch (err) {\r\n-    console.error(err);\r\n-  }\r\n-}\r\n \r\n \r\n // ================================\r\n // ACCESS CHART\r\n"
                },
                {
                    "date": 1763747760594,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,10 +77,26 @@\n \r\n // ================================\r\n // DASHBOARD SUMMARY\r\n // ================================\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n+    }\r\n+}\r\n+\r\n // ================================\r\n // ACCESS CHART\r\n // ================================\r\n async function loadAccessChart() {\r\n"
                },
                {
                    "date": 1763781353045,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,87 +1,392 @@\n+// adminsdashboard.js\r\n+// NOTE: This file assumes the full body of the original membershiprecords.js \r\n+// (which includes loadPendingRequests, handleApproveClick, etc.) \r\n+// has been moved into this file for dynamic loading to work.\r\n+\r\n // ================================\r\n-// AUTH & LOGOUT\r\n+// 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n // ================================\r\n-const token = localStorage.getItem(\"accessToken\");\r\n+// Ensure these variables are correctly set up or imported from a config file.\r\n+const API_HOST = \"http://api.estate-management.com\"; \r\n+const token = localStorage.getItem(\"accessToken\"); \r\n+\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n+// Define API Endpoints\r\n+const ENDPOINTS = {\r\n+    // Dashboard Overview Endpoints (using http://localhost:4050 as seen in your code)\r\n+    DASHBOARD_SUMMARY: \"http://localhost:4050/api/residents/dashboard/summary\",\r\n+    DASHBOARD_CHART: \"http://localhost:4050/api/residents/admin/accesschart\",\r\n+\r\n+    // Membership Endpoints (using the general API_HOST for core admin actions)\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+};\r\n+\r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+// ================================\r\n document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n     window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n-// SIDEBAR PAGE LOADING\r\n+// UTILITIES AND HELPERS\r\n // ================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-async function loadPageIntoMainContent(url) {\r\n+/**\r\n+ * Creates and returns the standard headers needed for authenticated API calls.\r\n+ */\r\n+function getAuthHeaders() {\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n+}\r\n+\r\n+/**\r\n+ * Handles error display in a non-alert manner.\r\n+ */\r\n+function displayMessage(message, isError = false) {\r\n+    // Find the message element dynamically on the current page\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Formats a timestamp (string or number) into a readable date string.\r\n+ */\r\n+function formatTimestamp(timestamp) {\r\n     try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html;\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n+}\r\n \r\n-        // For subsequent (non-initial) dashboard loads (via button click), \r\n-        // we call the functions directly after innerHTML.\r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            // NOTE: We don't need setTimeout here for subsequent clicks, \r\n-            // as the initial load issue is bypassed.\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n+/**\r\n+ * Safely updates a DOM element's text content.\r\n+ */\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    } else {\r\n+        // Suppress warning if called when the element isn't in the DOM (i.e., we are on a different page)\r\n+        // console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n+    }\r\n+};\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🟢 CORE MEMBERSHIP LOGIC (MOVED FROM membershiprecords.js)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Sends an approval request to the backend API.\r\n+ */\r\n+async function handleApproveClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n         }\r\n+        \r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        \r\n+        // Reload data after a successful action\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Sends a rejection request to the backend API.\r\n+ */\r\n+async function handleRejectClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Sends a deletion request to the backend API.\r\n+ */\r\n+async function handleDeleteClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Executes a real API call to trigger server-side data synchronization.\r\n+ */\r\n+async function handleSyncClick(event) {\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n+\r\n+    // 1. Set Loading State\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { \r\n+            method: 'POST',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+        }\r\n+\r\n+        // 2. Set Success State\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+        // Reload data after a successful sync\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+        \r\n     } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+        // 3. Set Failure State\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+    } finally {\r\n+        // 4. Reset Button State after a short delay\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n     }\r\n }\r\n \r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+/**\r\n+ * Fetches and renders pending membership requests from the backend API.\r\n+ */\r\n+async function loadPendingRequests() {\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    \r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n \r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        \r\n+        const requests = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n \r\n-// *** REMOVED: loadPageIntoMainContent(\"sections/dashboardoverview.html\"); ***\r\n-// The initial page load is handled by the index.html content itself.\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n \r\n-// ================================\r\n-// VISITOR MANAGEMENT TOGGLE\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID; \r\n \r\n-visitorToggle.addEventListener(\"click\", () => {\r\n-    visitorSubMenu.classList.toggle(\"hidden\");\r\n-    visitorArrow.classList.toggle(\"rotate-90\");\r\n-});\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Approve\r\n+                        </button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Reject\r\n+                        </button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Delete\r\n+                        </button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            \r\n+            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n+}\r\n \r\n-// ================================\r\n-// SAFE UPDATE HELPER\r\n-// ================================\r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    } else {\r\n-        // This warning should now only appear if an ID is misspelled \r\n-        // or a sidebar page is missing the element.\r\n-        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n+/**\r\n+ * Fetches and renders approved residents from the backend API.\r\n+ */\r\n+async function loadApprovedResidents() {\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    \r\n+    if (!tableBody || !noResidentsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading approved residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents from API.\", true);\r\n     }\r\n-};\r\n+}\r\n \r\n-// ================================\r\n-// DASHBOARD SUMMARY\r\n-// ================================\r\n+/**\r\n+ * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+ */\r\n+function attachMembershipListeners() {\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC\r\n+// ====================================================================\r\n+\r\n async function loadDashboardSummary() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n         const data = await res.json();\r\n@@ -95,14 +400,11 @@\n         console.error(\"Error loading summary:\", err);\r\n     }\r\n }\r\n \r\n-// ================================\r\n-// ACCESS CHART\r\n-// ================================\r\n async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n         const data = await res.json();\r\n@@ -132,16 +434,72 @@\n         console.error(\"Error loading chart:\", err);\r\n     }\r\n }\r\n \r\n+\r\n // ================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIX)\r\n+// ================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n+\r\n+async function loadPageIntoMainContent(url) {\r\n+    // Show a loading state instantly\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html; // Inject HTML first\r\n+\r\n+        // 🟢 Execute data loading functions based on the page loaded \r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n+        } else if (url.includes(\"membershiprecords.html\") || url.includes(\"membership.html\")) {\r\n+            // Wait for the HTML structure to be in the DOM, then attach listeners and load data\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+            await loadApprovedResidents();\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    }\r\n+}\r\n+\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n+\r\n+\r\n+// ================================\r\n+// MISC UI TOGGLES\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+});\r\n+\r\n+// ================================\r\n // INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n /**\r\n- * Run this function once on initial page load.\r\n- * Since the Dashboard Overview content is ALREADY present in index.html, \r\n- * we can call the data functions directly without a wrapper or delay.\r\n+ * Run this function once on initial page load for the content that is ALREADY present \r\n+ * in the index.html (the Dashboard Overview).\r\n  */\r\n (async function initializeDashboard() {\r\n+    safeUpdate('year', new Date().getFullYear()); // Update copyright year if span exists\r\n     await loadDashboardSummary();\r\n     await loadAccessChart();\r\n })();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763781606645,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -501,5 +501,123 @@\n (async function initializeDashboard() {\r\n     safeUpdate('year', new Date().getFullYear()); // Update copyright year if span exists\r\n     await loadDashboardSummary();\r\n     await loadAccessChart();\r\n-})();\n\\ No newline at end of file\n+})();\r\n+// adminsdashboard.js\r\n+// ... (existing Membership logic: loadPendingRequests, handleApproveClick, etc.)\r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadPaymentsRecords() {\r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return;\r\n+    \r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading Payments Records...</td></tr>';\r\n+    \r\n+    try {\r\n+        // ❗ Implement API call to fetch payment data\r\n+        // Example: const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        // Example: const payments = await resp.json();\r\n+\r\n+        // ❗ Implement logic to loop through payments and populate paymentsTableBody\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-green-500 italic\">Payments data loaded. (Implement rendering logic here)</td></tr>';\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading payment records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading payments data.</td></tr>';\r\n+    }\r\n+}\r\n+\r\n+function attachPaymentsListeners() {\r\n+    // ❗ Attach listeners for any Verify/Archive buttons or filters on the payments page\r\n+}\r\n+\r\n+// ====================================================================\r\n+// 🧑 RESIDENTS LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadAllResidents() {\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-blue-500 italic\">Loading All Residents...</td></tr>';\r\n+\r\n+    try {\r\n+        // ❗ Implement API call to fetch all resident data\r\n+        // Example: const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        \r\n+        // ❗ Implement logic to populate allResidentsTableBody\r\n+        tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-green-500 italic\">All Residents data loaded. (Implement rendering logic here)</td></tr>';\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-red-500 italic\">Error loading all residents data.</td></tr>';\r\n+    }\r\n+}\r\n+\r\n+// ====================================================================\r\n+// 🚪 VISITORS MANAGEMENT LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadVisitorPassOverview() {\r\n+    const overviewContainer = document.getElementById('visitorOverviewStats');\r\n+    if (!overviewContainer) return;\r\n+\r\n+    // ❗ Implement API call to fetch visitor statistics (e.g., today's visitors, pending approvals)\r\n+    overviewContainer.innerHTML = '<p class=\"text-center py-4 text-green-500 italic\">Visitor overview data loaded. (Implement stats logic here)</p>';\r\n+}\r\n+\r\n+async function loadPendingVisitorApprovals() {\r\n+    const tableBody = document.getElementById('visitorApprovalTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading Pending Visitor Approvals...</td></tr>';\r\n+\r\n+    // ❗ Implement API call and table rendering for visitor approvals\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-green-500 italic\">Visitor Approvals loaded. (Implement rendering logic here)</td></tr>';\r\n+}\r\n+\r\n+function attachVisitorListeners() {\r\n+    // ❗ Attach listeners for Approve/Deny buttons, or date/time filters\r\n+}\r\n+\r\n+// ====================================================================\r\n+// 📈 CHARTS AND REPORTS LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+    const chartContainer = document.getElementById('mainReportsChart');\r\n+    if (!chartContainer) return;\r\n+    \r\n+    // ❗ Implement API calls for any required reports (e.g., annual revenue, resident growth)\r\n+    // ❗ Implement Chart.js initialization logic here for the reports\r\n+    chartContainer.innerHTML = '<p class=\"text-center py-4 text-green-500 italic\">Reports charts initialized. (Implement chart drawing here)</p>';\r\n+}\r\n+\r\n+// ====================================================================\r\n+// 🔑 MANUAL OVERRIDES LOGIC\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+    const formContainer = document.getElementById('overrideForm');\r\n+    const logsBody = document.getElementById('overrideLogsBody');\r\n+    if (!formContainer || !logsBody) return;\r\n+\r\n+    // ❗ Implement API call to fetch recent override logs\r\n+    logsBody.innerHTML = '<tr><td colspan=\"5\" class=\"text-center py-4 text-blue-500 italic\">Loading Override Logs...</td></tr>';\r\n+    logsBody.innerHTML = '<tr><td colspan=\"5\" class=\"text-center py-4 text-green-500 italic\">Override Logs loaded. (Implement logs rendering here)</td></tr>';\r\n+}\r\n+\r\n+function attachOverrideListeners() {\r\n+    const overrideForm = document.getElementById('overrideForm');\r\n+    if (overrideForm) {\r\n+        // ❗ Attach listener for form submission to execute the manual override API call\r\n+        overrideForm.addEventListener('submit', (e) => {\r\n+            e.preventDefault();\r\n+            // Implement logic to send override request...\r\n+            displayMessage(\"Manual Override attempt sent. (Implement API call here)\", false);\r\n+        });\r\n+    }\r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763781879951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -441,8 +441,11 @@\n // ================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+// adminsdashboard.js\r\n+// ... (existing sidebarButtons and mainContentArea definitions)\r\n+\r\n async function loadPageIntoMainContent(url) {\r\n     // Show a loading state instantly\r\n     mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n \r\n@@ -455,20 +458,58 @@\n         // 🟢 Execute data loading functions based on the page loaded \r\n         if (url.includes(\"dashboardoverview.html\")) {\r\n             await loadDashboardSummary(); \r\n             await loadAccessChart();\r\n-        } else if (url.includes(\"membershiprecords.html\") || url.includes(\"membership.html\")) {\r\n-            // Wait for the HTML structure to be in the DOM, then attach listeners and load data\r\n+        } \r\n+        \r\n+        // --- MEMBERSHIP PAGES ---\r\n+        else if (url.includes(\"membershiprecords.html\")) {\r\n+            // This page typically holds the Sync button and Approved Residents table\r\n             attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            // Assuming membership.html holds the Pending Requests table\r\n+            attachMembershipListeners();\r\n             await loadPendingRequests();\r\n-            await loadApprovedResidents();\r\n         }\r\n+        \r\n+        // --- PAYMENTS RECORDS ---\r\n+        else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } \r\n+        \r\n+        // --- RESIDENTS ---\r\n+        else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } \r\n+        \r\n+        // --- VISITORS MANAGEMENT ---\r\n+        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\") || url.includes(\"visitor/\")) {\r\n+            // Group all visitor sub-pages together for listener and data loading\r\n+            attachVisitorListeners();\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        }\r\n+        \r\n+        // --- CHARTS AND REPORTS ---\r\n+        else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } \r\n+        \r\n+        // --- MANUAL OVERRIDES ---\r\n+        else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n     } catch (err) {\r\n         console.error(\"Error loading page:\", err);\r\n         mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n     }\r\n }\r\n \r\n+// ... (remaining code, including sidebarButtons.forEach loop)\r\n+\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n         sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n         btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n"
                },
                {
                    "date": 1763784296748,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,8 +24,15 @@\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n     REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n     DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n"
                },
                {
                    "date": 1763784449377,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -563,16 +563,30 @@\n     if (!tableBody) return;\r\n     \r\n     tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading Payments Records...</td></tr>';\r\n     \r\n-    try {\r\n-        // ❗ Implement API call to fetch payment data\r\n-        // Example: const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        // Example: const payments = await resp.json();\r\n+   try {\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+        \r\n+        const payments = await resp.json();\r\n \r\n-        // ❗ Implement logic to loop through payments and populate paymentsTableBody\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-green-500 italic\">Payments data loaded. (Implement rendering logic here)</td></tr>';\r\n+        if (payments.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500 italic\">No payment records found.</td></tr>';\r\n+            return;\r\n+        }\r\n \r\n+        tableBody.innerHTML = payments.map(p => `\r\n+            <tr class=\"hover:bg-gray-50\">\r\n+                <td class=\"px-4 py-3\">${p.TransactionID || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${p.ResidentName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${p.HouseNumber || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">Ksh ${p.Amount.toFixed(2)}</td>\r\n+                <td class=\"px-4 py-3\">${formatTimestamp(p.PaymentDate)}</td>\r\n+                <td class=\"px-4 py-3\"><span class=\"bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-xs\">${p.Status || 'Complete'}</span></td>\r\n+                <td class=\"px-4 py-3\">${p.PaymentMethod || 'N/A'}</td>\r\n+            </tr>\r\n+        `).join('');\r\n     } catch (error) {\r\n         console.error(\"Error loading payment records:\", error);\r\n         tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading payments data.</td></tr>';\r\n     }\r\n"
                },
                {
                    "date": 1763784547824,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -606,14 +606,29 @@\n \r\n     tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-blue-500 italic\">Loading All Residents...</td></tr>';\r\n \r\n     try {\r\n-        // ❗ Implement API call to fetch all resident data\r\n-        // Example: const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n         \r\n-        // ❗ Implement logic to populate allResidentsTableBody\r\n-        tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-green-500 italic\">All Residents data loaded. (Implement rendering logic here)</td></tr>';\r\n+        const residents = await resp.json();\r\n \r\n+        if (residents.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-gray-500 italic\">No resident records found.</td></tr>';\r\n+            return;\r\n+        }\r\n+\r\n+        tableBody.innerHTML = residents.map(r => `\r\n+            <tr class=\"hover:bg-gray-50\">\r\n+                <td class=\"px-4 py-3\">${r.ResidentName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${r.NationalID || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${r.Email || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${r.HouseNumber || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${r.CourtName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\"><span class=\"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs\">${r.RoleName || 'Resident'}</span></td>\r\n+            </tr>\r\n+        `).join('');\r\n+\r\n     } catch (error) {\r\n         console.error(\"Error loading all residents:\", error);\r\n         tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-red-500 italic\">Error loading all residents data.</td></tr>';\r\n     }\r\n"
                },
                {
                    "date": 1763784665802,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -637,28 +637,91 @@\n // ====================================================================\r\n // 🚪 VISITORS MANAGEMENT LOGIC\r\n // ====================================================================\r\n \r\n+// ... (inside loadVisitorPassOverview)\r\n+\r\n async function loadVisitorPassOverview() {\r\n     const overviewContainer = document.getElementById('visitorOverviewStats');\r\n     if (!overviewContainer) return;\r\n \r\n-    // ❗ Implement API call to fetch visitor statistics (e.g., today's visitors, pending approvals)\r\n-    overviewContainer.innerHTML = '<p class=\"text-center py-4 text-green-500 italic\">Visitor overview data loaded. (Implement stats logic here)</p>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch visitor overview.\");\r\n+\r\n+        const stats = await resp.json();\r\n+        \r\n+        // Assuming the stats object has properties like 'todayVisitors', 'pendingApprovals', 'activePasses'\r\n+        overviewContainer.innerHTML = `\r\n+            <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n+                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n+                    <p class=\"text-2xl font-bold text-blue-600\">${stats.todayVisitors || 0}</p>\r\n+                    <p class=\"text-sm text-gray-500\">Visitors Today</p>\r\n+                </div>\r\n+                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n+                    <p class=\"text-2xl font-bold text-yellow-600\">${stats.pendingApprovals || 0}</p>\r\n+                    <p class=\"text-sm text-gray-500\">Pending Approvals</p>\r\n+                </div>\r\n+                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n+                    <p class=\"text-2xl font-bold text-green-600\">${stats.activePasses || 0}</p>\r\n+                    <p class=\"text-sm text-gray-500\">Active Passes</p>\r\n+                </div>\r\n+            </div>\r\n+        `;\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading visitor overview:\", error);\r\n+        overviewContainer.innerHTML = '<p class=\"text-center py-4 text-red-500 italic\">Error loading visitor overview data.</p>';\r\n+        displayMessage(\"Failed to load visitor overview stats.\", true);\r\n+    }\r\n }\r\n \r\n async function loadPendingVisitorApprovals() {\r\n     const tableBody = document.getElementById('visitorApprovalTableBody');\r\n     if (!tableBody) return;\r\n \r\n     tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading Pending Visitor Approvals...</td></tr>';\r\n \r\n-    // ❗ Implement API call and table rendering for visitor approvals\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-green-500 italic\">Visitor Approvals loaded. (Implement rendering logic here)</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_VISITOR_APPROVALS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending visitor approvals.\");\r\n+\r\n+        const approvals = await resp.json();\r\n+\r\n+        if (approvals.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500 italic\">No pending visitor approvals.</td></tr>';\r\n+            return;\r\n+        }\r\n+\r\n+        tableBody.innerHTML = approvals.map(a => `\r\n+            <tr class=\"hover:bg-gray-50\">\r\n+                <td class=\"px-4 py-3\">${a.VisitorName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${a.HostName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${formatTimestamp(a.ScheduledEntry)}</td>\r\n+                <td class=\"px-4 py-3\">${a.VehiclePlate || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${a.AccessCode || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">\r\n+                    <button class=\"approve-visitor-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs\" data-id=\"${a.ID}\">Approve</button>\r\n+                    <button class=\"reject-visitor-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs\" data-id=\"${a.ID}\">Reject</button>\r\n+                </td>\r\n+            </tr>\r\n+        `).join('');\r\n+\r\n+        // 💡 Listener attachment placeholder (Assuming a handleVisitorAction function exists)\r\n+        tableBody.querySelectorAll('.approve-visitor-btn').forEach(btn => btn.addEventListener('click', () => {\r\n+            // handleVisitorAction(btn.dataset.id, 'approve'); \r\n+            displayMessage(`Approving visitor ${btn.dataset.id}... (Action required in attachVisitorListeners)`, false);\r\n+        }));\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending visitor approvals:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading visitor approvals.</td></tr>';\r\n+        displayMessage(\"Failed to load pending visitor approvals.\", true);\r\n+    }\r\n }\r\n \r\n function attachVisitorListeners() {\r\n-    // ❗ Attach listeners for Approve/Deny buttons, or date/time filters\r\n+    // Add logic for filtering, or handleVisitorAction(id, action) if implemented.\r\n }\r\n \r\n // ====================================================================\r\n // 📈 CHARTS AND REPORTS LOGIC\r\n"
                },
                {
                    "date": 1763784724150,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -725,18 +725,43 @@\n \r\n // ====================================================================\r\n // 📈 CHARTS AND REPORTS LOGIC\r\n // ====================================================================\r\n+// ... (inside loadReportsData)\r\n \r\n async function loadReportsData() {\r\n     const chartContainer = document.getElementById('mainReportsChart');\r\n     if (!chartContainer) return;\r\n     \r\n-    // ❗ Implement API calls for any required reports (e.g., annual revenue, resident growth)\r\n-    // ❗ Implement Chart.js initialization logic here for the reports\r\n-    chartContainer.innerHTML = '<p class=\"text-center py-4 text-green-500 italic\">Reports charts initialized. (Implement chart drawing here)</p>';\r\n+    chartContainer.innerHTML = '<p class=\"text-center py-4 text-blue-500 italic\">Fetching reports data...</p>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch reports data.\");\r\n+\r\n+        const reportData = await resp.json();\r\n+        \r\n+        // 💡 Assuming reportData contains { labels: [], residentGrowth: [], paymentVolume: [] }\r\n+        const ctx = chartContainer.getContext(\"2d\");\r\n+        new Chart(ctx, {\r\n+            type: \"bar\",\r\n+            data: {\r\n+                labels: reportData.labels || ['Jan', 'Feb', 'Mar'], \r\n+                datasets: [{\r\n+                    label: \"Resident Growth (New Members)\",\r\n+                    data: reportData.residentGrowth || [10, 15, 8],\r\n+                    backgroundColor: '#10b981', // Emerald green\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Error loading reports data:\", error);\r\n+        chartContainer.innerHTML = '<p class=\"text-center py-4 text-red-500 italic\">Error loading reports data.</p>';\r\n+        displayMessage(\"Failed to load charts and reports data.\", true);\r\n+    }\r\n }\r\n-\r\n // ====================================================================\r\n // 🔑 MANUAL OVERRIDES LOGIC\r\n // ====================================================================\r\n \r\n"
                },
                {
                    "date": 1763785220109,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n // ================================\r\n // Ensure these variables are correctly set up or imported from a config file.\r\n-const API_HOST = \"http://api.estate-management.com\"; \r\n+const API_HOST = \"https://api.estate-management.com\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n"
                },
                {
                    "date": 1763785832014,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n // ================================\r\n // Ensure these variables are correctly set up or imported from a config file.\r\n-const API_HOST = \"https://api.estate-management.com\"; \r\n+const API_HOST = \"http://api.estate-management.com\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n"
                },
                {
                    "date": 1763785929208,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,11 +6,10 @@\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n // ================================\r\n // Ensure these variables are correctly set up or imported from a config file.\r\n-const API_HOST = \"http://api.estate-management.com\"; \r\n+const API_HOST =  \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n-\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n"
                },
                {
                    "date": 1763837270205,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,30 +1,29 @@\n // adminsdashboard.js\r\n-// NOTE: This file assumes the full body of the original membershiprecords.js \r\n-// (which includes loadPendingRequests, handleApproveClick, etc.) \r\n-// has been moved into this file for dynamic loading to work.\r\n+// NOTE: This file now includes placeholder implementations for all pages referenced in index.html\r\n \r\n // ================================\r\n-// 🔑 ENVIRONMENT & AUTH SETUP (Placeholder)\r\n+// 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-// Ensure these variables are correctly set up or imported from a config file.\r\n const API_HOST =  \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints (using http://localhost:4050 as seen in your code)\r\n-    DASHBOARD_SUMMARY: \"http://localhost:4050/api/residents/dashboard/summary\",\r\n-    DASHBOARD_CHART: \"http://localhost:4050/api/residents/admin/accesschart\",\r\n+    // Dashboard Overview Endpoints\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n     // Membership Endpoints (using the general API_HOST for core admin actions)\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n     PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n     REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n     DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    \r\n+    // 🟢 MISSING ENDPOINTS ADDED\r\n     PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n     ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n     VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n@@ -58,9 +57,8 @@\n /**\r\n  * Handles error display in a non-alert manner.\r\n  */\r\n function displayMessage(message, isError = false) {\r\n-    // Find the message element dynamically on the current page\r\n     const msgElement = document.getElementById('msg');\r\n     if (msgElement) {\r\n         msgElement.textContent = message;\r\n         msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n@@ -90,368 +88,260 @@\n const safeUpdate = (id, value, suffix = '') => {\r\n     const element = document.getElementById(id);\r\n     if (element) {\r\n         element.textContent = value + suffix;\r\n-    } else {\r\n-        // Suppress warning if called when the element isn't in the DOM (i.e., we are on a different page)\r\n-        // console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n     }\r\n };\r\n \r\n \r\n // ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (MOVED FROM membershiprecords.js)\r\n+// 🟢 CORE MEMBERSHIP LOGIC (Existing - membership.html & membershiprecords.html)\r\n // ====================================================================\r\n \r\n-/**\r\n- * Sends an approval request to the backend API.\r\n- */\r\n+// (handleApproveClick, handleRejectClick, handleDeleteClick, handleSyncClick, loadPendingRequests, loadApprovedResidents)\r\n+// Your existing functions for Membership are kept here for brevity, \r\n+// but they should remain in the file exactly as you provided them.\r\n+\r\n+// [START OF EXISTING MEMBERSHIP FUNCTIONS]\r\n async function handleApproveClick(requestId) {\r\n     safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-        \r\n-        // Reload data after a successful action\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Approval Operation Failed:\", e);\r\n-        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    // ... (rest of approval logic)\r\n }\r\n \r\n-/**\r\n- * Sends a rejection request to the backend API.\r\n- */\r\n async function handleRejectClick(requestId) {\r\n     safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-            method: 'PUT', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Operation Failed:\", e);\r\n-        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    // ... (rest of rejection logic)\r\n }\r\n \r\n-/**\r\n- * Sends a deletion request to the backend API.\r\n- */\r\n async function handleDeleteClick(requestId) {\r\n     safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+    // ... (rest of deletion logic)\r\n+}\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-            method: 'DELETE', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n+async function handleSyncClick(event) {\r\n+    // ... (rest of sync logic)\r\n+}\r\n \r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n+async function loadPendingRequests() {\r\n+    // ... (rest of load pending requests logic)\r\n+}\r\n \r\n-    } catch (e) {\r\n-        console.error(\"Deletion Operation Failed:\", e);\r\n-        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+async function loadApprovedResidents() {\r\n+    // ... (rest of load approved residents logic)\r\n }\r\n \r\n-/**\r\n- * Executes a real API call to trigger server-side data synchronization.\r\n- */\r\n-async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n+function attachMembershipListeners() {\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n+}\r\n+// [END OF EXISTING MEMBERSHIP FUNCTIONS]\r\n \r\n-    // 1. Set Loading State\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n \r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (Existing - dashboardoverview.html)\r\n+// ====================================================================\r\n+\r\n+// (loadDashboardSummary, loadAccessChart)\r\n+// Your existing Dashboard functions are kept here.\r\n+\r\n+// [START OF EXISTING DASHBOARD FUNCTIONS]\r\n+async function loadDashboardSummary() {\r\n+    // ... (rest of dashboard summary logic)\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { \r\n-            method: 'POST',\r\n-            headers: getAuthHeaders(),\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-        }\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n-        // 2. Set Success State\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-        // Reload data after a successful sync\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-        \r\n     } catch (err) {\r\n-        // 3. Set Failure State\r\n-        console.error(\"Synchronization Error:\", err.message);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n-    } finally {\r\n-        // 4. Reset Button State after a short delay\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n+        console.error(\"Error loading summary:\", err);\r\n     }\r\n }\r\n \r\n+async function loadAccessChart() {\r\n+    // ... (rest of access chart logic)\r\n+}\r\n+// [END OF EXISTING DASHBOARD FUNCTIONS]\r\n+\r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC (NEW - payments.html)\r\n+// ====================================================================\r\n+\r\n /**\r\n- * Fetches and renders pending membership requests from the backend API.\r\n+ * Fetches and renders payments records.\r\n  */\r\n-async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    \r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+async function loadPaymentsRecords() {\r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return; \r\n \r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n     \r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n         \r\n-        const requests = await resp.json();\r\n+        const records = await resp.json();\r\n         \r\n         tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n \r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n+        if (records.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n         } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n+            records.forEach(record => {\r\n                 const row = tableBody.insertRow();\r\n                 row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-\r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID; \r\n-\r\n                 row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${requestId}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Approve\r\n-                        </button>\r\n-                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Reject\r\n-                        </button>\r\n-                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Delete\r\n-                        </button>\r\n-                    </td>\r\n+                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">Ksh ${record.Amount.toFixed(2) || '0.00'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n                 `;\r\n             });\r\n-            \r\n-            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n         }\r\n     } catch (error) {\r\n-        console.error(\"Error loading pending requests:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+        console.error(\"Error loading payments records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load payments records from API.\", true);\r\n     }\r\n }\r\n \r\n /**\r\n- * Fetches and renders approved residents from the backend API.\r\n+ * Attaches event listeners for payments-specific elements.\r\n  */\r\n-async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-    \r\n-    if (!tableBody || !noResidentsMsg) return;\r\n+function attachPaymentsListeners() {\r\n+    // Example: Attaching listener for a filter or refresh button specific to payments\r\n+    // document.getElementById(\"paymentsFilterBtn\")?.addEventListener(\"click\", filterPayments);\r\n+}\r\n \r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n \r\n+// ====================================================================\r\n+// 👥 RESIDENTS LOGIC (NEW - residents.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Fetches and renders all resident details.\r\n+ */\r\n+async function loadAllResidents() {\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n         \r\n         const residents = await resp.json();\r\n-\r\n+        \r\n         tableBody.innerHTML = '';\r\n         \r\n         if (residents.length === 0) {\r\n-            noResidentsMsg.classList.remove('hidden');\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n         } else {\r\n-            noResidentsMsg.classList.add('hidden');\r\n             residents.forEach(resident => {\r\n                 const row = tableBody.insertRow();\r\n                 row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n                 row.innerHTML = `\r\n                     <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n                     <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n                     <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n                     <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n                     <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n                     <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n                 `;\r\n             });\r\n         }\r\n     } catch (error) {\r\n-        console.error(\"Error loading approved residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents from API.\", true);\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load all residents from API.\", true);\r\n     }\r\n }\r\n \r\n-/**\r\n- * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n- */\r\n-function attachMembershipListeners() {\r\n-    // Attach listener for the Sync button\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    \r\n-    // Attach listener for Clear Filters button\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-    });\r\n-}\r\n \r\n-\r\n // ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (NEW - visitorsaccess.html, etc.)\r\n // ====================================================================\r\n \r\n-async function loadDashboardSummary() {\r\n+async function loadVisitorPassOverview() {\r\n+    const overviewSection = document.getElementById('visitorOverviewSection');\r\n+    if (!overviewSection) return;\r\n+\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n+        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n         const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n+        \r\n+        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', etc.\r\n+        safeUpdate(\"todayVisitors\", data.today || 0);\r\n+        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+        \r\n     } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n+        console.error(\"Error loading visitor overview:\", err);\r\n     }\r\n }\r\n \r\n-async function loadAccessChart() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n+async function loadPendingVisitorApprovals() {\r\n+    // Placeholder function to load the table of pending visitor requests\r\n+    // Similar implementation to loadPendingRequests, but for visitors\r\n+}\r\n \r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n+function attachVisitorListeners() {\r\n+    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+}\r\n \r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n-    }\r\n+// ====================================================================\r\n+// 📈 CHARTS & REPORTS LOGIC (NEW - chartsandreports.html)\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+    // Placeholder function to fetch and render specific reports data (e.g., charts, tables)\r\n+    // Similar implementation to loadAccessChart but for other reports\r\n }\r\n \r\n \r\n-// ================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIX)\r\n-// ================================\r\n+// ====================================================================\r\n+// 🚨 MANUAL OVERRIDES LOGIC (NEW - manualoverride.html)\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+    // Placeholder function to load a log of all manual gate overrides\r\n+}\r\n+\r\n+function attachOverrideListeners() {\r\n+    // Attach listener for the 'Perform Manual Override' button\r\n+    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+        // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+    });\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIX - Updated to call new functions)\r\n+// ====================================================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-// adminsdashboard.js\r\n-// ... (existing sidebarButtons and mainContentArea definitions)\r\n-\r\n async function loadPageIntoMainContent(url) {\r\n     // Show a loading state instantly\r\n     mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n \r\n@@ -468,43 +358,47 @@\n         } \r\n         \r\n         // --- MEMBERSHIP PAGES ---\r\n         else if (url.includes(\"membershiprecords.html\")) {\r\n-            // This page typically holds the Sync button and Approved Residents table\r\n+            // Approved Residents\r\n             attachMembershipListeners();\r\n             await loadApprovedResidents();\r\n         } else if (url.includes(\"membership.html\")) {\r\n-            // Assuming membership.html holds the Pending Requests table\r\n+            // Pending Requests\r\n             attachMembershipListeners();\r\n             await loadPendingRequests();\r\n         }\r\n         \r\n         // --- PAYMENTS RECORDS ---\r\n         else if (url.includes(\"payments.html\")) {\r\n+            // ✅ FIX: Added function calls\r\n             attachPaymentsListeners();\r\n             await loadPaymentsRecords();\r\n         } \r\n         \r\n         // --- RESIDENTS ---\r\n         else if (url.includes(\"residents.html\")) {\r\n+            // ✅ FIX: Added function call\r\n             await loadAllResidents();\r\n         } \r\n         \r\n         // --- VISITORS MANAGEMENT ---\r\n         else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\") || url.includes(\"visitor/\")) {\r\n-            // Group all visitor sub-pages together for listener and data loading\r\n+            // ✅ FIX: Added function calls\r\n             attachVisitorListeners();\r\n             await loadVisitorPassOverview();\r\n             await loadPendingVisitorApprovals();\r\n         }\r\n         \r\n         // --- CHARTS AND REPORTS ---\r\n         else if (url.includes(\"chartsandreports.html\")) {\r\n+            // ✅ FIX: Added function call\r\n             await loadReportsData();\r\n         } \r\n         \r\n         // --- MANUAL OVERRIDES ---\r\n         else if (url.includes(\"manualoverride.html\")) {\r\n+            // ✅ FIX: Added function calls\r\n             attachOverrideListeners();\r\n             await loadManualOverrides();\r\n         }\r\n     } catch (err) {\r\n@@ -512,15 +406,24 @@\n         mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n     }\r\n }\r\n \r\n-// ... (remaining code, including sidebarButtons.forEach loop)\r\n+// ... (existing sidebar button loop and visitor toggle logic)\r\n \r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        sidebarButtons.forEach(b => {\r\n+            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+            // Also ensure sub-menu items are correctly reset if needed\r\n+            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+        });\r\n+        \r\n         btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        if (btn.closest('#visitorSubMenu')) {\r\n+            btn.classList.remove(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+        }\r\n \r\n+\r\n         const page = btn.dataset.target;\r\n         if (page) loadPageIntoMainContent(page);\r\n     });\r\n });\r\n@@ -540,248 +443,9 @@\n \r\n // ================================\r\n // INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n-/**\r\n- * Run this function once on initial page load for the content that is ALREADY present \r\n- * in the index.html (the Dashboard Overview).\r\n- */\r\n-(async function initializeDashboard() {\r\n-    safeUpdate('year', new Date().getFullYear()); // Update copyright year if span exists\r\n-    await loadDashboardSummary();\r\n-    await loadAccessChart();\r\n-})();\r\n-// adminsdashboard.js\r\n-// ... (existing Membership logic: loadPendingRequests, handleApproveClick, etc.)\r\n \r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC\r\n-// ====================================================================\r\n-\r\n-async function loadPaymentsRecords() {\r\n-    const tableBody = document.getElementById('paymentsTableBody');\r\n-    if (!tableBody) return;\r\n-    \r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading Payments Records...</td></tr>';\r\n-    \r\n-   try {\r\n-        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-        \r\n-        const payments = await resp.json();\r\n-\r\n-        if (payments.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500 italic\">No payment records found.</td></tr>';\r\n-            return;\r\n-        }\r\n-\r\n-        tableBody.innerHTML = payments.map(p => `\r\n-            <tr class=\"hover:bg-gray-50\">\r\n-                <td class=\"px-4 py-3\">${p.TransactionID || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${p.ResidentName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${p.HouseNumber || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">Ksh ${p.Amount.toFixed(2)}</td>\r\n-                <td class=\"px-4 py-3\">${formatTimestamp(p.PaymentDate)}</td>\r\n-                <td class=\"px-4 py-3\"><span class=\"bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-xs\">${p.Status || 'Complete'}</span></td>\r\n-                <td class=\"px-4 py-3\">${p.PaymentMethod || 'N/A'}</td>\r\n-            </tr>\r\n-        `).join('');\r\n-    } catch (error) {\r\n-        console.error(\"Error loading payment records:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading payments data.</td></tr>';\r\n-    }\r\n-}\r\n-\r\n-function attachPaymentsListeners() {\r\n-    // ❗ Attach listeners for any Verify/Archive buttons or filters on the payments page\r\n-}\r\n-\r\n-// ====================================================================\r\n-// 🧑 RESIDENTS LOGIC\r\n-// ====================================================================\r\n-\r\n-async function loadAllResidents() {\r\n-    const tableBody = document.getElementById('allResidentsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-blue-500 italic\">Loading All Residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-\r\n-        if (residents.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-gray-500 italic\">No resident records found.</td></tr>';\r\n-            return;\r\n-        }\r\n-\r\n-        tableBody.innerHTML = residents.map(r => `\r\n-            <tr class=\"hover:bg-gray-50\">\r\n-                <td class=\"px-4 py-3\">${r.ResidentName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${r.NationalID || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${r.Email || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${r.HouseNumber || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${r.CourtName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\"><span class=\"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs\">${r.RoleName || 'Resident'}</span></td>\r\n-            </tr>\r\n-        `).join('');\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"Error loading all residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center py-4 text-red-500 italic\">Error loading all residents data.</td></tr>';\r\n-    }\r\n-}\r\n-\r\n-// ====================================================================\r\n-// 🚪 VISITORS MANAGEMENT LOGIC\r\n-// ====================================================================\r\n-\r\n-// ... (inside loadVisitorPassOverview)\r\n-\r\n-async function loadVisitorPassOverview() {\r\n-    const overviewContainer = document.getElementById('visitorOverviewStats');\r\n-    if (!overviewContainer) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch visitor overview.\");\r\n-\r\n-        const stats = await resp.json();\r\n-        \r\n-        // Assuming the stats object has properties like 'todayVisitors', 'pendingApprovals', 'activePasses'\r\n-        overviewContainer.innerHTML = `\r\n-            <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n-                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n-                    <p class=\"text-2xl font-bold text-blue-600\">${stats.todayVisitors || 0}</p>\r\n-                    <p class=\"text-sm text-gray-500\">Visitors Today</p>\r\n-                </div>\r\n-                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n-                    <p class=\"text-2xl font-bold text-yellow-600\">${stats.pendingApprovals || 0}</p>\r\n-                    <p class=\"text-sm text-gray-500\">Pending Approvals</p>\r\n-                </div>\r\n-                <div class=\"bg-white p-4 rounded-lg shadow-md text-center\">\r\n-                    <p class=\"text-2xl font-bold text-green-600\">${stats.activePasses || 0}</p>\r\n-                    <p class=\"text-sm text-gray-500\">Active Passes</p>\r\n-                </div>\r\n-            </div>\r\n-        `;\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"Error loading visitor overview:\", error);\r\n-        overviewContainer.innerHTML = '<p class=\"text-center py-4 text-red-500 italic\">Error loading visitor overview data.</p>';\r\n-        displayMessage(\"Failed to load visitor overview stats.\", true);\r\n-    }\r\n-}\r\n-\r\n-async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorApprovalTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading Pending Visitor Approvals...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_VISITOR_APPROVALS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending visitor approvals.\");\r\n-\r\n-        const approvals = await resp.json();\r\n-\r\n-        if (approvals.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500 italic\">No pending visitor approvals.</td></tr>';\r\n-            return;\r\n-        }\r\n-\r\n-        tableBody.innerHTML = approvals.map(a => `\r\n-            <tr class=\"hover:bg-gray-50\">\r\n-                <td class=\"px-4 py-3\">${a.VisitorName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${a.HostName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${formatTimestamp(a.ScheduledEntry)}</td>\r\n-                <td class=\"px-4 py-3\">${a.VehiclePlate || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${a.AccessCode || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">\r\n-                    <button class=\"approve-visitor-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs\" data-id=\"${a.ID}\">Approve</button>\r\n-                    <button class=\"reject-visitor-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs\" data-id=\"${a.ID}\">Reject</button>\r\n-                </td>\r\n-            </tr>\r\n-        `).join('');\r\n-\r\n-        // 💡 Listener attachment placeholder (Assuming a handleVisitorAction function exists)\r\n-        tableBody.querySelectorAll('.approve-visitor-btn').forEach(btn => btn.addEventListener('click', () => {\r\n-            // handleVisitorAction(btn.dataset.id, 'approve'); \r\n-            displayMessage(`Approving visitor ${btn.dataset.id}... (Action required in attachVisitorListeners)`, false);\r\n-        }));\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"Error loading pending visitor approvals:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading visitor approvals.</td></tr>';\r\n-        displayMessage(\"Failed to load pending visitor approvals.\", true);\r\n-    }\r\n-}\r\n-\r\n-function attachVisitorListeners() {\r\n-    // Add logic for filtering, or handleVisitorAction(id, action) if implemented.\r\n-}\r\n-\r\n-// ====================================================================\r\n-// 📈 CHARTS AND REPORTS LOGIC\r\n-// ====================================================================\r\n-// ... (inside loadReportsData)\r\n-\r\n-async function loadReportsData() {\r\n-    const chartContainer = document.getElementById('mainReportsChart');\r\n-    if (!chartContainer) return;\r\n-    \r\n-    chartContainer.innerHTML = '<p class=\"text-center py-4 text-blue-500 italic\">Fetching reports data...</p>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch reports data.\");\r\n-\r\n-        const reportData = await resp.json();\r\n-        \r\n-        // 💡 Assuming reportData contains { labels: [], residentGrowth: [], paymentVolume: [] }\r\n-        const ctx = chartContainer.getContext(\"2d\");\r\n-        new Chart(ctx, {\r\n-            type: \"bar\",\r\n-            data: {\r\n-                labels: reportData.labels || ['Jan', 'Feb', 'Mar'], \r\n-                datasets: [{\r\n-                    label: \"Resident Growth (New Members)\",\r\n-                    data: reportData.residentGrowth || [10, 15, 8],\r\n-                    backgroundColor: '#10b981', // Emerald green\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"Error loading reports data:\", error);\r\n-        chartContainer.innerHTML = '<p class=\"text-center py-4 text-red-500 italic\">Error loading reports data.</p>';\r\n-        displayMessage(\"Failed to load charts and reports data.\", true);\r\n-    }\r\n-}\r\n-// ====================================================================\r\n-// 🔑 MANUAL OVERRIDES LOGIC\r\n-// ====================================================================\r\n-\r\n-async function loadManualOverrides() {\r\n-    const formContainer = document.getElementById('overrideForm');\r\n-    const logsBody = document.getElementById('overrideLogsBody');\r\n-    if (!formContainer || !logsBody) return;\r\n-\r\n-    // ❗ Implement API call to fetch recent override logs\r\n-    logsBody.innerHTML = '<tr><td colspan=\"5\" class=\"text-center py-4 text-blue-500 italic\">Loading Override Logs...</td></tr>';\r\n-    logsBody.innerHTML = '<tr><td colspan=\"5\" class=\"text-center py-4 text-green-500 italic\">Override Logs loaded. (Implement logs rendering here)</td></tr>';\r\n-}\r\n-\r\n-function attachOverrideListeners() {\r\n-    const overrideForm = document.getElementById('overrideForm');\r\n-    if (overrideForm) {\r\n-        // ❗ Attach listener for form submission to execute the manual override API call\r\n-        overrideForm.addEventListener('submit', (e) => {\r\n-            e.preventDefault();\r\n-            // Implement logic to send override request...\r\n-            displayMessage(\"Manual Override attempt sent. (Implement API call here)\", false);\r\n-        });\r\n-    }\r\n-}\n\\ No newline at end of file\n+document.addEventListener('DOMContentLoaded', () => {\r\n+    // Load the initial dashboard view when the admin page first loads\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+});\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763837496693,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,432 +1,753 @@\n // adminsdashboard.js\r\n-// NOTE: This file now includes placeholder implementations for all pages referenced in index.html\r\n+// This file now includes ALL necessary data loading logic (including Membership)\r\n+// to handle dynamic page loading in the Admin Dashboard.\r\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-const API_HOST =  \"http://localhost:4050\"; \r\n+const API_HOST =  \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    // Dashboard Overview Endpoints\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-    // Membership Endpoints (using the general API_HOST for core admin actions)\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    \r\n-    // 🟢 MISSING ENDPOINTS ADDED\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    // Membership Endpoints\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    \r\n+    // General Admin Endpoints\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n // UTILITIES AND HELPERS\r\n // ================================\r\n \r\n /**\r\n- * Creates and returns the standard headers needed for authenticated API calls.\r\n- */\r\n+ * Creates and returns the standard headers needed for authenticated API calls.\r\n+ */\r\n function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n }\r\n \r\n /**\r\n- * Handles error display in a non-alert manner.\r\n- */\r\n+ * Handles error display in a non-alert manner.\r\n+ */\r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-        \r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n }\r\n \r\n /**\r\n- * Formats a timestamp (string or number) into a readable date string.\r\n- */\r\n+ * Formats a timestamp (string or number) into a readable date string.\r\n+ */\r\n function formatTimestamp(timestamp) {\r\n-    try {\r\n-        if (!timestamp) return 'N/A';\r\n-        return new Date(timestamp).toLocaleString();\r\n-    } catch (e) {\r\n-        return 'N/A';\r\n-    }\r\n+    try {\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n }\r\n \r\n /**\r\n- * Safely updates a DOM element's text content.\r\n- */\r\n+ * Safely updates a DOM element's text content.\r\n+ */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    }\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    }\r\n };\r\n \r\n \r\n // ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (Existing - membership.html & membershiprecords.html)\r\n+// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n // ====================================================================\r\n \r\n-// (handleApproveClick, handleRejectClick, handleDeleteClick, handleSyncClick, loadPendingRequests, loadApprovedResidents)\r\n-// Your existing functions for Membership are kept here for brevity, \r\n-// but they should remain in the file exactly as you provided them.\r\n+/**\r\n+ * Sends an approval request to the backend API.\r\n+ */\r\n+async function handleApproveClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n \r\n-// [START OF EXISTING MEMBERSHIP FUNCTIONS]\r\n-async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-    // ... (rest of approval logic)\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        \r\n+        // Reload data after a successful action\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Sends a rejection request to the backend API.\r\n+ */\r\n async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    // ... (rest of rejection logic)\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Sends a deletion request to the backend API.\r\n+ */\r\n async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    // ... (rest of deletion logic)\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Executes a real API call to trigger server-side data synchronization.\r\n+ */\r\n async function handleSyncClick(event) {\r\n-    // ... (rest of sync logic)\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n+\r\n+    // 1. Set Loading State\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { \r\n+            method: 'POST',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+        }\r\n+\r\n+        // 2. Set Success State\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+        // Reload data after a successful sync\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+        \r\n+    } catch (err) {\r\n+        // 3. Set Failure State\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+    } finally {\r\n+        // 4. Reset Button State after a short delay\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Fetches and renders pending membership requests from the backend API.\r\n+ */\r\n async function loadPendingRequests() {\r\n-    // ... (rest of load pending requests logic)\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    \r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        \r\n+        const requests = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n+\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID; \r\n+\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Approve\r\n+                        </button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Reject\r\n+                        </button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Delete\r\n+                        </button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            \r\n+            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Fetches and renders approved residents from the backend API.\r\n+ */\r\n async function loadApprovedResidents() {\r\n-    // ... (rest of load approved residents logic)\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    \r\n+    if (!tableBody || !noResidentsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading approved residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents from API.\", true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+ */\r\n function attachMembershipListeners() {\r\n-    // Attach listener for the Sync button\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    \r\n-    // Attach listener for Clear Filters button\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-    });\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n }\r\n-// [END OF EXISTING MEMBERSHIP FUNCTIONS]\r\n \r\n \r\n // ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (Existing - dashboardoverview.html)\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n // ====================================================================\r\n \r\n-// (loadDashboardSummary, loadAccessChart)\r\n-// Your existing Dashboard functions are kept here.\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-// [START OF EXISTING DASHBOARD FUNCTIONS]\r\n-async function loadDashboardSummary() {\r\n-    // ... (rest of dashboard summary logic)\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n+    }\r\n+}\r\n+\r\n+async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n             headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n         if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n         const data = await res.json();\r\n \r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n \r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        // Destroy existing chart instance if it exists before creating a new one\r\n+        if (window.accessChartInstance) {\r\n+            window.accessChartInstance.destroy();\r\n+        }\r\n+        \r\n+        window.accessChartInstance = new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+\r\n     } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n+        console.error(\"Error loading chart:\", err);\r\n     }\r\n }\r\n \r\n-async function loadAccessChart() {\r\n-    // ... (rest of access chart logic)\r\n-}\r\n-// [END OF EXISTING DASHBOARD FUNCTIONS]\r\n \r\n-\r\n // ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (NEW - payments.html)\r\n+// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n // ====================================================================\r\n \r\n /**\r\n- * Fetches and renders payments records.\r\n- */\r\n+ * Fetches and renders payments records.\r\n+ */\r\n async function loadPaymentsRecords() {\r\n-    const tableBody = document.getElementById('paymentsTableBody');\r\n-    if (!tableBody) return; \r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return; \r\n \r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-        \r\n-        const records = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+        \r\n+        const records = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n \r\n-        if (records.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-        } else {\r\n-            records.forEach(record => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">Ksh ${record.Amount.toFixed(2) || '0.00'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading payments records:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load payments records from API.\", true);\r\n-    }\r\n+        if (records.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+        } else {\r\n+            records.forEach(record => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading payments records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load payments records from API.\", true);\r\n+    }\r\n }\r\n \r\n /**\r\n- * Attaches event listeners for payments-specific elements.\r\n- */\r\n+ * Attaches event listeners for payments-specific elements.\r\n+ */\r\n function attachPaymentsListeners() {\r\n-    // Example: Attaching listener for a filter or refresh button specific to payments\r\n-    // document.getElementById(\"paymentsFilterBtn\")?.addEventListener(\"click\", filterPayments);\r\n+    // Add any payments-specific listeners here\r\n }\r\n \r\n \r\n // ====================================================================\r\n-// 👥 RESIDENTS LOGIC (NEW - residents.html)\r\n+// 👥 RESIDENTS LOGIC (residents.html)\r\n // ====================================================================\r\n \r\n /**\r\n- * Fetches and renders all resident details.\r\n- */\r\n+ * Fetches and renders all resident details.\r\n+ */\r\n async function loadAllResidents() {\r\n-    const tableBody = document.getElementById('allResidentsTableBody');\r\n-    if (!tableBody) return;\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n \r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-        } else {\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading all residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load all residents from API.\", true);\r\n-    }\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n+        } else {\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load all residents from API.\", true);\r\n+    }\r\n }\r\n \r\n \r\n // ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (NEW - visitorsaccess.html, etc.)\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n // ====================================================================\r\n \r\n async function loadVisitorPassOverview() {\r\n-    const overviewSection = document.getElementById('visitorOverviewSection');\r\n-    if (!overviewSection) return;\r\n+    const overviewSection = document.getElementById('visitorOverviewSection');\r\n+    if (!overviewSection) return;\r\n \r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', etc.\r\n-        safeUpdate(\"todayVisitors\", data.today || 0);\r\n-        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-        \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitor overview:\", err);\r\n-    }\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+        safeUpdate(\"todayVisitors\", data.today || 0);\r\n+        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+        \r\n+    } catch (err) {\r\n+        console.error(\"Error loading visitor overview:\", err);\r\n+    }\r\n }\r\n \r\n async function loadPendingVisitorApprovals() {\r\n-    // Placeholder function to load the table of pending visitor requests\r\n-    // Similar implementation to loadPendingRequests, but for visitors\r\n+    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+    \r\n+    // Implementation details would be similar to loadPendingRequests()\r\n }\r\n \r\n function attachVisitorListeners() {\r\n-    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n }\r\n \r\n \r\n // ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (NEW - chartsandreports.html)\r\n+// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n // ====================================================================\r\n \r\n async function loadReportsData() {\r\n-    // Placeholder function to fetch and render specific reports data (e.g., charts, tables)\r\n-    // Similar implementation to loadAccessChart but for other reports\r\n+    // Placeholder implementation\r\n+    const reportsContainer = document.getElementById('reportsContainer');\r\n+    if (!reportsContainer) return;\r\n+    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n+        // For simplicity, we just display a success message:\r\n+        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading reports data:\", err);\r\n+        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+    }\r\n }\r\n \r\n \r\n // ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (NEW - manualoverride.html)\r\n+// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n // ====================================================================\r\n \r\n async function loadManualOverrides() {\r\n-    // Placeholder function to load a log of all manual gate overrides\r\n+    const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    if (!logTableBody) return;\r\n+\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+        const logs = await resp.json();\r\n+\r\n+        logTableBody.innerHTML = '';\r\n+        if (logs.length === 0) {\r\n+            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+        } else {\r\n+            // Populate table rows with logs\r\n+        }\r\n+    } catch (error) {\r\n+        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+    }\r\n }\r\n \r\n function attachOverrideListeners() {\r\n-    // Attach listener for the 'Perform Manual Override' button\r\n-    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-    });\r\n+    // Attach listener for the 'Perform Manual Override' button\r\n+    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+        \r\n+        try {\r\n+            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n+                method: 'POST',\r\n+                headers: getAuthHeaders(),\r\n+                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n+            });\r\n+            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+\r\n+            displayMessage(\"Manual override successful!\", false);\r\n+            await loadManualOverrides(); // Reload logs\r\n+\r\n+        } catch (e) {\r\n+            displayMessage(`Manual override failed: ${e.message}`, true);\r\n+        }\r\n+    });\r\n }\r\n \r\n \r\n // ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIX - Updated to call new functions)\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n // ====================================================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n async function loadPageIntoMainContent(url) {\r\n-    // Show a loading state instantly\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+    // Show a loading state instantly\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n \r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html; // Inject HTML first\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html; // Inject HTML first\r\n \r\n-        // 🟢 Execute data loading functions based on the page loaded \r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n-        } \r\n-        \r\n-        // --- MEMBERSHIP PAGES ---\r\n-        else if (url.includes(\"membershiprecords.html\")) {\r\n-            // Approved Residents\r\n-            attachMembershipListeners();\r\n-            await loadApprovedResidents();\r\n-        } else if (url.includes(\"membership.html\")) {\r\n-            // Pending Requests\r\n-            attachMembershipListeners();\r\n-            await loadPendingRequests();\r\n-        }\r\n-        \r\n-        // --- PAYMENTS RECORDS ---\r\n-        else if (url.includes(\"payments.html\")) {\r\n-            // ✅ FIX: Added function calls\r\n-            attachPaymentsListeners();\r\n-            await loadPaymentsRecords();\r\n-        } \r\n-        \r\n-        // --- RESIDENTS ---\r\n-        else if (url.includes(\"residents.html\")) {\r\n-            // ✅ FIX: Added function call\r\n-            await loadAllResidents();\r\n-        } \r\n-        \r\n-        // --- VISITORS MANAGEMENT ---\r\n-        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\") || url.includes(\"visitor/\")) {\r\n-            // ✅ FIX: Added function calls\r\n-            attachVisitorListeners();\r\n-            await loadVisitorPassOverview();\r\n-            await loadPendingVisitorApprovals();\r\n-        }\r\n-        \r\n-        // --- CHARTS AND REPORTS ---\r\n-        else if (url.includes(\"chartsandreports.html\")) {\r\n-            // ✅ FIX: Added function call\r\n-            await loadReportsData();\r\n-        } \r\n-        \r\n-        // --- MANUAL OVERRIDES ---\r\n-        else if (url.includes(\"manualoverride.html\")) {\r\n-            // ✅ FIX: Added function calls\r\n-            attachOverrideListeners();\r\n-            await loadManualOverrides();\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n-    }\r\n+        // 🟢 Execute data loading functions based on the page loaded \r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n+        } \r\n+        \r\n+        // --- MEMBERSHIP PAGES ---\r\n+        else if (url.includes(\"membershiprecords.html\")) {\r\n+            // Approved Residents\r\n+            attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+        }\r\n+        \r\n+        // --- PAYMENTS RECORDS ---\r\n+        else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } \r\n+        \r\n+        // --- RESIDENTS ---\r\n+        else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } \r\n+        \r\n+        // --- VISITORS MANAGEMENT ---\r\n+        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+            attachVisitorListeners();\r\n+            // Load data relevant to the main visitor pages\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        }\r\n+        \r\n+        // --- CHARTS AND REPORTS ---\r\n+        else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } \r\n+        \r\n+        // --- MANUAL OVERRIDES ---\r\n+        else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    }\r\n }\r\n \r\n // ... (existing sidebar button loop and visitor toggle logic)\r\n \r\n sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => {\r\n-            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-            // Also ensure sub-menu items are correctly reset if needed\r\n-            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-        });\r\n-        \r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        if (btn.closest('#visitorSubMenu')) {\r\n-            btn.classList.remove(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-        }\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => {\r\n+            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+            // Also ensure sub-menu items are correctly reset if needed\r\n+            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n+            \r\n+            // Re-apply specific default styles for sub-menu items if needed\r\n+            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n+                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            }\r\n+        });\r\n+        \r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n \r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n });\r\n \r\n \r\n // ================================\r\n@@ -436,16 +757,16 @@\n const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n });\r\n \r\n // ================================\r\n // INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n \r\n document.addEventListener('DOMContentLoaded', () => {\r\n-    // Load the initial dashboard view when the admin page first loads\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+    // Load the initial dashboard view when the admin page first loads\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763842399653,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,772 +1,125 @@\n-// adminsdashboard.js\r\n-// This file now includes ALL necessary data loading logic (including Membership)\r\n-// to handle dynamic page loading in the Admin Dashboard.\r\n+// public/js/adminsdashboard.js\r\n \r\n-// ================================\r\n-// 🔑 ENVIRONMENT & AUTH SETUP\r\n-// ================================\r\n-const API_HOST =  \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"accessToken\"); \r\n-if (!token) window.location.href = \"/login.html\";\r\n+// Make sure you have <canvas id=\"accessChart\"></canvas> in your HTML\r\n \r\n-// Define API Endpoints\r\n-const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+const API_HOST = \"http://localhost:4050/api/admin\"; // Base API URL\r\n+const token = localStorage.getItem(\"token\"); // JWT stored in localStorage\r\n \r\n-    // Membership Endpoints\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    \r\n-    // General Admin Endpoints\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-};\r\n+// Utility function for authorized fetch\r\n+async function fetchAPI(endpoint, options = {}) {\r\n+    options.headers = {\r\n+        ...options.headers,\r\n+        \"Authorization\": `Bearer ${token}`,\r\n+        \"Content-Type\": \"application/json\"\r\n+    };\r\n \r\n-// ================================\r\n-// AUTH & LOGOUT\r\n-// ================================\r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n-});\r\n-\r\n-// ================================\r\n-// UTILITIES AND HELPERS\r\n-// ================================\r\n-\r\n-/**\r\n- * Creates and returns the standard headers needed for authenticated API calls.\r\n- */\r\n-function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n+    const response = await fetch(`${API_HOST}${endpoint}`, options);\r\n+    if (!response.ok) {\r\n+        const err = await response.json().catch(() => ({ message: response.statusText }));\r\n+        throw new Error(err.message || \"API request failed\");\r\n+    }\r\n+    return response.json();\r\n }\r\n \r\n-/**\r\n- * Handles error display in a non-alert manner.\r\n- */\r\n-function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-        \r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n-}\r\n+// -------------------------\r\n+// 1. Sync Data\r\n+// -------------------------\r\n+async function handleSyncClick() {\r\n+    const btn = document.getElementById(\"syncBtn\");\r\n+    btn.disabled = true;\r\n+    btn.textContent = \"Syncing...\";\r\n \r\n-/**\r\n- * Formats a timestamp (string or number) into a readable date string.\r\n- */\r\n-function formatTimestamp(timestamp) {\r\n-    try {\r\n-        if (!timestamp) return 'N/A';\r\n-        return new Date(timestamp).toLocaleString();\r\n-    } catch (e) {\r\n-        return 'N/A';\r\n-    }\r\n+    try {\r\n+        const data = await fetchAPI(\"/sync\", { method: \"POST\" });\r\n+        console.log(\"Sync result:\", data);\r\n+        alert(\"Sync completed successfully!\");\r\n+        await loadDashboardSummary(); // Refresh summary after sync\r\n+    } catch (error) {\r\n+        console.error(\"Sync Error:\", error);\r\n+        alert(\"Sync failed: \" + error.message);\r\n+    } finally {\r\n+        btn.disabled = false;\r\n+        btn.textContent = \"Sync Data\";\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Safely updates a DOM element's text content.\r\n- */\r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    }\r\n-};\r\n+// -------------------------\r\n+// 2. Load Dashboard Summary\r\n+// -------------------------\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const summary = await fetchAPI(\"/summary\");\r\n \r\n+        document.getElementById(\"totalResidents\").textContent = summary.residents;\r\n+        document.getElementById(\"pendingPayments\").textContent = summary.pendingPayments;\r\n+        document.getElementById(\"compliancePct\").textContent = summary.compliance + \"%\";\r\n+        document.getElementById(\"overrideCount\").textContent = summary.overrides;\r\n \r\n-// ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Sends an approval request to the backend API.\r\n- */\r\n-async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-        \r\n-        // Reload data after a successful action\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Approval Operation Failed:\", e);\r\n-        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    } catch (error) {\r\n+        console.error(\"Summary Load Error:\", error);\r\n+        alert(\"Failed to load dashboard summary: \" + error.message);\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Sends a rejection request to the backend API.\r\n- */\r\n-async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+// -------------------------\r\n+// 3. Load Access Chart\r\n+// -------------------------\r\n+let accessChartInstance;\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-            method: 'PUT', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Operation Failed:\", e);\r\n-        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Sends a deletion request to the backend API.\r\n- */\r\n-async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-            method: 'DELETE', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Deletion Operation Failed:\", e);\r\n-        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Executes a real API call to trigger server-side data synchronization.\r\n- */\r\n-async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n-\r\n-    // 1. Set Loading State\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { \r\n-            method: 'POST',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-        }\r\n-\r\n-        // 2. Set Success State\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-        // Reload data after a successful sync\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-        \r\n-    } catch (err) {\r\n-        // 3. Set Failure State\r\n-        console.error(\"Synchronization Error:\", err.message);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n-    } finally {\r\n-        // 4. Reset Button State after a short delay\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Fetches and renders pending membership requests from the backend API.\r\n- */\r\n-async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    \r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-        \r\n-        const requests = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n-\r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-\r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID; \r\n-\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${requestId}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Approve\r\n-                        </button>\r\n-                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Reject\r\n-                        </button>\r\n-                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Delete\r\n-                        </button>\r\n-                    </td>\r\n-                `;\r\n-            });\r\n-            \r\n-            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading pending requests:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Fetches and renders approved residents from the backend API.\r\n- */\r\n-async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-    \r\n-    if (!tableBody || !noResidentsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-\r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            noResidentsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noResidentsMsg.classList.add('hidden');\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading approved residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n- */\r\n-function attachMembershipListeners() {\r\n-    // Attach listener for the Sync button\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    \r\n-    // Attach listener for Clear Filters button\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-    });\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n-// ====================================================================\r\n-\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n-    }\r\n-}\r\n-\r\n async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n+        const chartData = await fetchAPI(\"/accesschart\");\r\n \r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n+        const ctx = document.getElementById(\"accessChart\").getContext(\"2d\");\r\n \r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        // Destroy existing chart instance if it exists before creating a new one\r\n-        if (window.accessChartInstance) {\r\n-            window.accessChartInstance.destroy();\r\n+        if (accessChartInstance) {\r\n+            accessChartInstance.destroy();\r\n         }\r\n-        \r\n-        window.accessChartInstance = new Chart(ctx, {\r\n+\r\n+        accessChartInstance = new Chart(ctx, {\r\n             type: \"line\",\r\n             data: {\r\n-                labels: data.days || [],\r\n+                labels: chartData.days,\r\n                 datasets: [{\r\n                     label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n+                    data: chartData.counts,\r\n+                    borderColor: \"#007bff\",\r\n+                    backgroundColor: \"rgba(0,123,255,0.2)\",\r\n+                    tension: 0.3,\r\n+                    fill: true,\r\n                 }]\r\n             },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n+            options: {\r\n+                responsive: true,\r\n+                plugins: {\r\n+                    legend: { display: true },\r\n+                    tooltip: { mode: 'index', intersect: false }\r\n+                },\r\n+                scales: {\r\n+                    x: { title: { display: true, text: \"Date\" } },\r\n+                    y: { title: { display: true, text: \"Attempts\" }, beginAtZero: true }\r\n+                }\r\n+            }\r\n         });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Fetches and renders payments records.\r\n- */\r\n-async function loadPaymentsRecords() {\r\n-    const tableBody = document.getElementById('paymentsTableBody');\r\n-    if (!tableBody) return; \r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-        \r\n-        const records = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-\r\n-        if (records.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-        } else {\r\n-            records.forEach(record => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading payments records:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load payments records from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Attaches event listeners for payments-specific elements.\r\n- */\r\n-function attachPaymentsListeners() {\r\n-    // Add any payments-specific listeners here\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 👥 RESIDENTS LOGIC (residents.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Fetches and renders all resident details.\r\n- */\r\n-async function loadAllResidents() {\r\n-    const tableBody = document.getElementById('allResidentsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-        } else {\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading all residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load all residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n-// ====================================================================\r\n-\r\n-async function loadVisitorPassOverview() {\r\n-    const overviewSection = document.getElementById('visitorOverviewSection');\r\n-    if (!overviewSection) return;\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n-        safeUpdate(\"todayVisitors\", data.today || 0);\r\n-        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-        \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitor overview:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n-    \r\n-    // Implementation details would be similar to loadPendingRequests()\r\n-}\r\n-\r\n-function attachVisitorListeners() {\r\n-    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n-// ====================================================================\r\n-\r\n-async function loadReportsData() {\r\n-    // Placeholder implementation\r\n-    const reportsContainer = document.getElementById('reportsContainer');\r\n-    if (!reportsContainer) return;\r\n-    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n-        // For simplicity, we just display a success message:\r\n-        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading reports data:\", err);\r\n-        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n-// ====================================================================\r\n-\r\n-async function loadManualOverrides() {\r\n-    const logTableBody = document.getElementById('overrideLogTableBody');\r\n-    if (!logTableBody) return;\r\n-\r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-        const logs = await resp.json();\r\n-\r\n-        logTableBody.innerHTML = '';\r\n-        if (logs.length === 0) {\r\n-            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n-        } else {\r\n-            // Populate table rows with logs\r\n-        }\r\n     } catch (error) {\r\n-        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+        console.error(\"Access Chart Load Error:\", error);\r\n+        alert(\"Failed to load access chart: \" + error.message);\r\n     }\r\n }\r\n \r\n-function attachOverrideListeners() {\r\n-    // Attach listener for the 'Perform Manual Override' button\r\n-    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-        \r\n-        try {\r\n-            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n-                method: 'POST',\r\n-                headers: getAuthHeaders(),\r\n-                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n-            });\r\n-            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+// -------------------------\r\n+// 4. Initialize Dashboard\r\n+// -------------------------\r\n+async function initializeDashboard() {\r\n+    await loadDashboardSummary();\r\n+    await loadAccessChart();\r\n \r\n-            displayMessage(\"Manual override successful!\", false);\r\n-            await loadManualOverrides(); // Reload logs\r\n-\r\n-        } catch (e) {\r\n-            displayMessage(`Manual override failed: ${e.message}`, true);\r\n-        }\r\n-    });\r\n+    const syncBtn = document.getElementById(\"syncBtn\");\r\n+    if (syncBtn) syncBtn.addEventListener(\"click\", handleSyncClick);\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n-// ====================================================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n-\r\n-async function loadPageIntoMainContent(url) {\r\n-    // Show a loading state instantly\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n-\r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html; // Inject HTML first\r\n-\r\n-        // 🟢 Execute data loading functions based on the page loaded \r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n-        } \r\n-        \r\n-        // --- MEMBERSHIP PAGES ---\r\n-        else if (url.includes(\"membershiprecords.html\")) {\r\n-            // Approved Residents\r\n-            attachMembershipListeners();\r\n-            await loadApprovedResidents();\r\n\\ No newline at end of file\n-        } else if (url.includes(\"membership.html\")) {\r\n-            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n-            attachMembershipListeners();\r\n-            await loadPendingRequests();\r\n-        }\r\n-        \r\n-        // --- PAYMENTS RECORDS ---\r\n-        else if (url.includes(\"payments.html\")) {\r\n-            attachPaymentsListeners();\r\n-            await loadPaymentsRecords();\r\n-        } \r\n-        \r\n-        // --- RESIDENTS ---\r\n-        else if (url.includes(\"residents.html\")) {\r\n-            await loadAllResidents();\r\n-        } \r\n-        \r\n-        // --- VISITORS MANAGEMENT ---\r\n-        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-            attachVisitorListeners();\r\n-            // Load data relevant to the main visitor pages\r\n-            await loadVisitorPassOverview();\r\n-            await loadPendingVisitorApprovals();\r\n-        }\r\n-        \r\n-        // --- CHARTS AND REPORTS ---\r\n-        else if (url.includes(\"chartsandreports.html\")) {\r\n-            await loadReportsData();\r\n-        } \r\n-        \r\n-        // --- MANUAL OVERRIDES ---\r\n-        else if (url.includes(\"manualoverride.html\")) {\r\n-            attachOverrideListeners();\r\n-            await loadManualOverrides();\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n-    }\r\n-}\r\n-\r\n-// ... (existing sidebar button loop and visitor toggle logic)\r\n-\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => {\r\n-            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-            // Also ensure sub-menu items are correctly reset if needed\r\n-            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n-            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n-            \r\n-            // Re-apply specific default styles for sub-menu items if needed\r\n-            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n-                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            }\r\n-        });\r\n-        \r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n-\r\n-\r\n-// ================================\r\n-// MISC UI TOGGLES\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n-});\r\n-\r\n-// ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n-// ================================\r\n-\r\n-document.addEventListener('DOMContentLoaded', () => {\r\n-    // Load the initial dashboard view when the admin page first loads\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\n+// -------------------------\r\n+// On DOM load\r\n+// -------------------------\r\n+document.addEventListener(\"DOMContentLoaded\", initializeDashboard);\r\n"
                },
                {
                    "date": 1763842804201,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,125 +1,772 @@\n-// public/js/adminsdashboard.js\r\n+// adminsdashboard.js\r\n+// This file now includes ALL necessary data loading logic (including Membership)\r\n+// to handle dynamic page loading in the Admin Dashboard.\r\n \r\n-// Make sure you have <canvas id=\"accessChart\"></canvas> in your HTML\r\n+// ================================\r\n+// 🔑 ENVIRONMENT & AUTH SETUP\r\n+// ================================\r\n+const API_HOST =  \"http://localhost:4050\"; \r\n+const token = localStorage.getItem(\"accessToken\"); \r\n+if (!token) window.location.href = \"/login.html\";\r\n \r\n-const API_HOST = \"http://localhost:4050/api/admin\"; // Base API URL\r\n-const token = localStorage.getItem(\"token\"); // JWT stored in localStorage\r\n+// Define API Endpoints\r\n+const ENDPOINTS = {\r\n+    // Dashboard Overview Endpoints\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-// Utility function for authorized fetch\r\n-async function fetchAPI(endpoint, options = {}) {\r\n-    options.headers = {\r\n-        ...options.headers,\r\n-        \"Authorization\": `Bearer ${token}`,\r\n-        \"Content-Type\": \"application/json\"\r\n-    };\r\n+    // Membership Endpoints\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    \r\n+    // General Admin Endpoints\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+};\r\n \r\n-    const response = await fetch(`${API_HOST}${endpoint}`, options);\r\n-    if (!response.ok) {\r\n-        const err = await response.json().catch(() => ({ message: response.statusText }));\r\n-        throw new Error(err.message || \"API request failed\");\r\n-    }\r\n-    return response.json();\r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+// ================================\r\n+document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n+});\r\n+\r\n+// ================================\r\n+// UTILITIES AND HELPERS\r\n+// ================================\r\n+\r\n+/**\r\n+ * Creates and returns the standard headers needed for authenticated API calls.\r\n+ */\r\n+function getAuthHeaders() {\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n }\r\n \r\n-// -------------------------\r\n-// 1. Sync Data\r\n-// -------------------------\r\n-async function handleSyncClick() {\r\n-    const btn = document.getElementById(\"syncBtn\");\r\n-    btn.disabled = true;\r\n-    btn.textContent = \"Syncing...\";\r\n+/**\r\n+ * Handles error display in a non-alert manner.\r\n+ */\r\n+function displayMessage(message, isError = false) {\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n+}\r\n \r\n-    try {\r\n-        const data = await fetchAPI(\"/sync\", { method: \"POST\" });\r\n-        console.log(\"Sync result:\", data);\r\n-        alert(\"Sync completed successfully!\");\r\n-        await loadDashboardSummary(); // Refresh summary after sync\r\n-    } catch (error) {\r\n-        console.error(\"Sync Error:\", error);\r\n-        alert(\"Sync failed: \" + error.message);\r\n-    } finally {\r\n-        btn.disabled = false;\r\n-        btn.textContent = \"Sync Data\";\r\n-    }\r\n+/**\r\n+ * Formats a timestamp (string or number) into a readable date string.\r\n+ */\r\n+function formatTimestamp(timestamp) {\r\n+    try {\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n }\r\n \r\n-// -------------------------\r\n-// 2. Load Dashboard Summary\r\n-// -------------------------\r\n+/**\r\n+ * Safely updates a DOM element's text content.\r\n+ */\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    }\r\n+};\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Sends an approval request to the backend API.\r\n+ */\r\n+async function handleApproveClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        \r\n+        // Reload data after a successful action\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Sends a rejection request to the backend API.\r\n+ */\r\n+async function handleRejectClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Sends a deletion request to the backend API.\r\n+ */\r\n+async function handleDeleteClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Executes a real API call to trigger server-side data synchronization.\r\n+ */\r\n+async function handleSyncClick(event) {\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n+\r\n+    // 1. Set Loading State\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { \r\n+            method: 'POST',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+        }\r\n+\r\n+        // 2. Set Success State\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+        // Reload data after a successful sync\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+        \r\n+    } catch (err) {\r\n+        // 3. Set Failure State\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+    } finally {\r\n+        // 4. Reset Button State after a short delay\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Fetches and renders pending membership requests from the backend API.\r\n+ */\r\n+async function loadPendingRequests() {\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    \r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        \r\n+        const requests = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n+\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID; \r\n+\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Approve\r\n+                        </button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Reject\r\n+                        </button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Delete\r\n+                        </button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            \r\n+            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Fetches and renders approved residents from the backend API.\r\n+ */\r\n+async function loadApprovedResidents() {\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    \r\n+    if (!tableBody || !noResidentsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading approved residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+ */\r\n+function attachMembershipListeners() {\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n+// ====================================================================\r\n+\r\n async function loadDashboardSummary() {\r\n-    try {\r\n-        const summary = await fetchAPI(\"/summary\");\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-        document.getElementById(\"totalResidents\").textContent = summary.residents;\r\n-        document.getElementById(\"pendingPayments\").textContent = summary.pendingPayments;\r\n-        document.getElementById(\"compliancePct\").textContent = summary.compliance + \"%\";\r\n-        document.getElementById(\"overrideCount\").textContent = summary.overrides;\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n-    } catch (error) {\r\n-        console.error(\"Summary Load Error:\", error);\r\n-        alert(\"Failed to load dashboard summary: \" + error.message);\r\n-    }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n+    }\r\n }\r\n \r\n-// -------------------------\r\n-// 3. Load Access Chart\r\n-// -------------------------\r\n-let accessChartInstance;\r\n-\r\n async function loadAccessChart() {\r\n     try {\r\n-        const chartData = await fetchAPI(\"/accesschart\");\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-        const ctx = document.getElementById(\"accessChart\").getContext(\"2d\");\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n \r\n-        if (accessChartInstance) {\r\n-            accessChartInstance.destroy();\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        // Destroy existing chart instance if it exists before creating a new one\r\n+        if (window.accessChartInstance) {\r\n+            window.accessChartInstance.destroy();\r\n         }\r\n-\r\n-        accessChartInstance = new Chart(ctx, {\r\n+        \r\n+        window.accessChartInstance = new Chart(ctx, {\r\n             type: \"line\",\r\n             data: {\r\n-                labels: chartData.days,\r\n+                labels: data.days || [],\r\n                 datasets: [{\r\n                     label: \"Access Attempts\",\r\n-                    data: chartData.counts,\r\n-                    borderColor: \"#007bff\",\r\n-                    backgroundColor: \"rgba(0,123,255,0.2)\",\r\n-                    tension: 0.3,\r\n-                    fill: true,\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n                 }]\r\n             },\r\n-            options: {\r\n-                responsive: true,\r\n-                plugins: {\r\n-                    legend: { display: true },\r\n-                    tooltip: { mode: 'index', intersect: false }\r\n-                },\r\n-                scales: {\r\n-                    x: { title: { display: true, text: \"Date\" } },\r\n-                    y: { title: { display: true, text: \"Attempts\" }, beginAtZero: true }\r\n-                }\r\n-            }\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n         });\r\n \r\n+    } catch (err) {\r\n+        console.error(\"Error loading chart:\", err);\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Fetches and renders payments records.\r\n+ */\r\n+async function loadPaymentsRecords() {\r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return; \r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+        \r\n+        const records = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+\r\n+        if (records.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+        } else {\r\n+            records.forEach(record => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading payments records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load payments records from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Attaches event listeners for payments-specific elements.\r\n+ */\r\n+function attachPaymentsListeners() {\r\n+    // Add any payments-specific listeners here\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 👥 RESIDENTS LOGIC (residents.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Fetches and renders all resident details.\r\n+ */\r\n+async function loadAllResidents() {\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n+        } else {\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load all residents from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n+// ====================================================================\r\n+\r\n+async function loadVisitorPassOverview() {\r\n+    const overviewSection = document.getElementById('visitorOverviewSection');\r\n+    if (!overviewSection) return;\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+        safeUpdate(\"todayVisitors\", data.today || 0);\r\n+        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+        \r\n+    } catch (err) {\r\n+        console.error(\"Error loading visitor overview:\", err);\r\n+    }\r\n+}\r\n+\r\n+async function loadPendingVisitorApprovals() {\r\n+    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+    \r\n+    // Implementation details would be similar to loadPendingRequests()\r\n+}\r\n+\r\n+function attachVisitorListeners() {\r\n+    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+    // Placeholder implementation\r\n+    const reportsContainer = document.getElementById('reportsContainer');\r\n+    if (!reportsContainer) return;\r\n+    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n+        // For simplicity, we just display a success message:\r\n+        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading reports data:\", err);\r\n+        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+    const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    if (!logTableBody) return;\r\n+\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+        const logs = await resp.json();\r\n+\r\n+        logTableBody.innerHTML = '';\r\n+        if (logs.length === 0) {\r\n+            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+        } else {\r\n+            // Populate table rows with logs\r\n+        }\r\n     } catch (error) {\r\n-        console.error(\"Access Chart Load Error:\", error);\r\n-        alert(\"Failed to load access chart: \" + error.message);\r\n+        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n     }\r\n }\r\n \r\n-// -------------------------\r\n-// 4. Initialize Dashboard\r\n-// -------------------------\r\n-async function initializeDashboard() {\r\n-    await loadDashboardSummary();\r\n-    await loadAccessChart();\r\n+function attachOverrideListeners() {\r\n+    // Attach listener for the 'Perform Manual Override' button\r\n+    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+        \r\n+        try {\r\n+            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n+                method: 'POST',\r\n+                headers: getAuthHeaders(),\r\n+                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n+            });\r\n+            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n \r\n-    const syncBtn = document.getElementById(\"syncBtn\");\r\n-    if (syncBtn) syncBtn.addEventListener(\"click\", handleSyncClick);\r\n+            displayMessage(\"Manual override successful!\", false);\r\n+            await loadManualOverrides(); // Reload logs\r\n+\r\n+        } catch (e) {\r\n+            displayMessage(`Manual override failed: ${e.message}`, true);\r\n+        }\r\n+    });\r\n }\r\n \r\n-// -------------------------\r\n-// On DOM load\r\n-// -------------------------\r\n-document.addEventListener(\"DOMContentLoaded\", initializeDashboard);\r\n+\r\n+// ====================================================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n+// ====================================================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n+\r\n+async function loadPageIntoMainContent(url) {\r\n+    // Show a loading state instantly\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html; // Inject HTML first\r\n+\r\n+        // 🟢 Execute data loading functions based on the page loaded \r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n+        } \r\n+        \r\n+        // --- MEMBERSHIP PAGES ---\r\n+        else if (url.includes(\"membershiprecords.html\")) {\r\n+            // Approved Residents\r\n+            attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+        }\r\n+        \r\n+        // --- PAYMENTS RECORDS ---\r\n+        else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } \r\n+        \r\n+        // --- RESIDENTS ---\r\n+        else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } \r\n+        \r\n+        // --- VISITORS MANAGEMENT ---\r\n+        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+            attachVisitorListeners();\r\n+            // Load data relevant to the main visitor pages\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        }\r\n+        \r\n+        // --- CHARTS AND REPORTS ---\r\n+        else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } \r\n+        \r\n+        // --- MANUAL OVERRIDES ---\r\n+        else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    }\r\n+}\r\n+\r\n+// ... (existing sidebar button loop and visitor toggle logic)\r\n+\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => {\r\n+            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+            // Also ensure sub-menu items are correctly reset if needed\r\n+            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n+            \r\n+            // Re-apply specific default styles for sub-menu items if needed\r\n+            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n+                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            }\r\n+        });\r\n+        \r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n+\r\n+\r\n+// ================================\r\n+// MISC UI TOGGLES\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+});\r\n+\r\n+// ================================\r\n+// INITIALIZATION ON PAGE LOAD\r\n+// ================================\r\n+\r\n+document.addEventListener('DOMContentLoaded', () => {\r\n+    // Load the initial dashboard view when the admin page first loads\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+});\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763877198427,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,772 +1,203 @@\n-// adminsdashboard.js\r\n-// This file now includes ALL necessary data loading logic (including Membership)\r\n-// to handle dynamic page loading in the Admin Dashboard.\r\n+// =========================================================\r\n+// GLOBAL SETTINGS & INITIALIZATION\r\n+// =========================================================\r\n \r\n-// ================================\r\n-// 🔑 ENVIRONMENT & AUTH SETUP\r\n-// ================================\r\n-const API_HOST =  \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"accessToken\"); \r\n-if (!token) window.location.href = \"/login.html\";\r\n+// Placeholder for API host (adjust as necessary)\r\n+const API_HOST = \"http://localhost:4050\"; \r\n+const token = localStorage.getItem(\"adminToken\"); // Assumes admin token is stored here\r\n \r\n-// Define API Endpoints\r\n-const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+document.addEventListener(\"DOMContentLoaded\", init);\r\n \r\n-    // Membership Endpoints\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    \r\n-    // General Admin Endpoints\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-};\r\n+function init() {\r\n+    // 1. Setup Navigation Listeners\r\n+    setupSidebarNavigation();\r\n \r\n-// ================================\r\n-// AUTH & LOGOUT\r\n-// ================================\r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n-});\r\n+    // 2. Setup Dropdown\r\n+    document.getElementById(\"visitorManagementToggle\").addEventListener(\"click\", toggleVisitorSubMenu);\r\n \r\n-// ================================\r\n-// UTILITIES AND HELPERS\r\n-// ================================\r\n+    // 3. Load Initial Content (Dashboard Overview)\r\n+    const initialButton = document.querySelector('.sidebarBtn[data-target=\"sections/dashboardoverview.html\"]');\r\n+    if (initialButton) {\r\n+        loadSidebarContent(initialButton.dataset.target, initialButton);\r\n+    }\r\n \r\n-/**\r\n- * Creates and returns the standard headers needed for authenticated API calls.\r\n- */\r\n-function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n-}\r\n+    // 4. Load Dashboard Metrics and Chart\r\n+    loadDashboardMetrics();\r\n+    renderAccessChart();\r\n \r\n-/**\r\n- * Handles error display in a non-alert manner.\r\n- */\r\n-function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-        \r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n+    // 5. Logout Listener\r\n+    document.getElementById(\"logoutBtn\").addEventListener(\"click\", handleLogout);\r\n }\r\n \r\n-/**\r\n- * Formats a timestamp (string or number) into a readable date string.\r\n- */\r\n-function formatTimestamp(timestamp) {\r\n-    try {\r\n-        if (!timestamp) return 'N/A';\r\n-        return new Date(timestamp).toLocaleString();\r\n-    } catch (e) {\r\n-        return 'N/A';\r\n-    }\r\n-}\r\n+// =========================================================\r\n+// NAVIGATION & CONTENT LOADING\r\n+// =========================================================\r\n \r\n-/**\r\n- * Safely updates a DOM element's text content.\r\n- */\r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    }\r\n-};\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Sends an approval request to the backend API.\r\n- */\r\n-async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-        \r\n-        // Reload data after a successful action\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Approval Operation Failed:\", e);\r\n-        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+function setupSidebarNavigation() {\r\n+    const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+    sidebarButtons.forEach(button => {\r\n+        button.addEventListener(\"click\", (e) => {\r\n+            const targetUrl = e.currentTarget.dataset.target;\r\n+            loadSidebarContent(targetUrl, e.currentTarget);\r\n+        });\r\n+    });\r\n }\r\n \r\n /**\r\n- * Sends a rejection request to the backend API.\r\n- */\r\n-async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+ * Fetches and injects HTML content into the main content area.\r\n+ * @param {string} url - The URL of the HTML fragment to load.\r\n+ * @param {HTMLElement} activeBtn - The button that was clicked.\r\n+ */\r\n+async function loadSidebarContent(url, activeBtn) {\r\n+    const contentArea = document.getElementById(\"dynamic-section-content\");\r\n+    \r\n+    // Clear previous content\r\n+    contentArea.innerHTML = '<div class=\"text-center p-8 text-gray-500\">Loading content...</div>';\r\n+    \r\n+    // Set active class on the sidebar button\r\n+    setActiveButton(activeBtn);\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-            method: 'PUT', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Operation Failed:\", e);\r\n-        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Sends a deletion request to the backend API.\r\n- */\r\n-async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-            method: 'DELETE', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Deletion Operation Failed:\", e);\r\n-        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Executes a real API call to trigger server-side data synchronization.\r\n- */\r\n-async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n-\r\n-    // 1. Set Loading State\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { \r\n-            method: 'POST',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-        }\r\n-\r\n-        // 2. Set Success State\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-        // Reload data after a successful sync\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-        \r\n-    } catch (err) {\r\n-        // 3. Set Failure State\r\n-        console.error(\"Synchronization Error:\", err.message);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n-    } finally {\r\n-        // 4. Reset Button State after a short delay\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Fetches and renders pending membership requests from the backend API.\r\n- */\r\n-async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    \r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-        \r\n-        const requests = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n-\r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-\r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID; \r\n-\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${requestId}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Approve\r\n-                        </button>\r\n-                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Reject\r\n-                        </button>\r\n-                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Delete\r\n-                        </button>\r\n-                    </td>\r\n-                `;\r\n-            });\r\n-            \r\n-            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading pending requests:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Fetches and renders approved residents from the backend API.\r\n- */\r\n-async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-    \r\n-    if (!tableBody || !noResidentsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-\r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            noResidentsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noResidentsMsg.classList.add('hidden');\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading approved residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n- */\r\n-function attachMembershipListeners() {\r\n-    // Attach listener for the Sync button\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    \r\n-    // Attach listener for Clear Filters button\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-    });\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n-// ====================================================================\r\n-\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n+        // In a real environment, these paths would need to be served statically.\r\n+        // We use a placeholder path here.\r\n+        const response = await fetch(url); \r\n \r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n-\r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        // Destroy existing chart instance if it exists before creating a new one\r\n-        if (window.accessChartInstance) {\r\n-            window.accessChartInstance.destroy();\r\n+        if (!response.ok) {\r\n+            throw new Error(`Failed to load: ${url}. Status: ${response.status}`);\r\n         }\r\n-        \r\n-        window.accessChartInstance = new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n+        const htmlContent = await response.text();\r\n+        contentArea.innerHTML = htmlContent;\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Content loading failed:\", error);\r\n+        contentArea.innerHTML = `\r\n+            <div class=\"p-8 bg-red-100 border border-red-400 text-red-700 rounded-lg\">\r\n+                <p class=\"font-bold\">Error loading content:</p>\r\n+                <p>${error.message}. Please check the file path: ${url}</p>\r\n+            </div>\r\n+        `;\r\n     }\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n-// ====================================================================\r\n-\r\n /**\r\n- * Fetches and renders payments records.\r\n- */\r\n-async function loadPaymentsRecords() {\r\n-    const tableBody = document.getElementById('paymentsTableBody');\r\n-    if (!tableBody) return; \r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-        \r\n-        const records = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-\r\n-        if (records.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-        } else {\r\n-            records.forEach(record => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading payments records:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load payments records from API.\", true);\r\n-    }\r\n+ * Manages the visual active state of sidebar buttons.\r\n+ * @param {HTMLElement} activeBtn - The button to mark as active.\r\n+ */\r\n+function setActiveButton(activeBtn) {\r\n+    // Remove active styles from all buttons\r\n+    document.querySelectorAll(\".sidebarBtn\").forEach(btn => {\r\n+        btn.classList.remove(\"bg-blue-600\", \"shadow-inner\");\r\n+        btn.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+    });\r\n+    \r\n+    // Apply active styles to the selected button\r\n+    activeBtn.classList.add(\"bg-blue-600\", \"shadow-inner\");\r\n+    activeBtn.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n }\r\n \r\n /**\r\n- * Attaches event listeners for payments-specific elements.\r\n- */\r\n-function attachPaymentsListeners() {\r\n-    // Add any payments-specific listeners here\r\n+ * Toggles the visibility of the Visitor Management submenu.\r\n+ */\r\n+function toggleVisitorSubMenu() {\r\n+    const subMenu = document.getElementById(\"visitorSubMenu\");\r\n+    const arrow = document.getElementById(\"visitorArrow\");\r\n+    \r\n+    subMenu.classList.toggle(\"hidden\");\r\n+    arrow.classList.toggle(\"rotate-90\"); // Rotate arrow for better UX\r\n }\r\n \r\n+// =========================================================\r\n+// DASHBOARD METRICS & CHARTING\r\n+// =========================================================\r\n \r\n-// ====================================================================\r\n-// 👥 RESIDENTS LOGIC (residents.html)\r\n-// ====================================================================\r\n-\r\n /**\r\n- * Fetches and renders all resident details.\r\n- */\r\n-async function loadAllResidents() {\r\n-    const tableBody = document.getElementById('allResidentsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-        } else {\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading all residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load all residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n-// ====================================================================\r\n-\r\n-async function loadVisitorPassOverview() {\r\n-    const overviewSection = document.getElementById('visitorOverviewSection');\r\n-    if (!overviewSection) return;\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n-        safeUpdate(\"todayVisitors\", data.today || 0);\r\n-        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-        \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitor overview:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+ * Placeholder function to fetch and update dashboard metrics (KPIs).\r\n+ */\r\n+async function loadDashboardMetrics() {\r\n+    // --- Mock Data Simulation ---\r\n+    // In a real app, you would fetch these from endpoints like:\r\n+    // fetch(`${API_HOST}/api/admin/metrics`, { headers: { 'Authorization': `Bearer ${token}` }})\r\n     \r\n-    // Implementation details would be similar to loadPendingRequests()\r\n-}\r\n+    const mockMetrics = {\r\n+        totalResidents: 752,\r\n+        pendingPayments: 14,\r\n+        compliancePct: 95,\r\n+        overrideCount: 3,\r\n+    };\r\n \r\n-function attachVisitorListeners() {\r\n-    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+    // Update the DOM elements with the mock data\r\n+    document.getElementById(\"totalResidents\").textContent = mockMetrics.totalResidents;\r\n+    document.getElementById(\"pendingPayments\").textContent = mockMetrics.pendingPayments;\r\n+    document.getElementById(\"compliancePct\").textContent = `${mockMetrics.compliancePct}%`;\r\n+    document.getElementById(\"overrideCount\").textContent = mockMetrics.overrideCount;\r\n }\r\n \r\n+/**\r\n+ * Renders the Chart.js graph for access attempts.\r\n+ */\r\n+function renderAccessChart() {\r\n+    const ctx = document.getElementById(\"accessChart\");\r\n+    if (!ctx) return; // Ensure the canvas exists\r\n \r\n-// ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n-// ====================================================================\r\n-\r\n-async function loadReportsData() {\r\n-    // Placeholder implementation\r\n-    const reportsContainer = document.getElementById('reportsContainer');\r\n-    if (!reportsContainer) return;\r\n-    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n-        // For simplicity, we just display a success message:\r\n-        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading reports data:\", err);\r\n-        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n-// ====================================================================\r\n-\r\n-async function loadManualOverrides() {\r\n-    const logTableBody = document.getElementById('overrideLogTableBody');\r\n-    if (!logTableBody) return;\r\n-\r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-        const logs = await resp.json();\r\n-\r\n-        logTableBody.innerHTML = '';\r\n-        if (logs.length === 0) {\r\n-            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n-        } else {\r\n-            // Populate table rows with logs\r\n+    new Chart(ctx, {\r\n+        type: 'line',\r\n+        data: {\r\n+            labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10', 'Day 11', 'Day 12', 'Day 13', 'Day 14'],\r\n+            datasets: [{\r\n+                label: 'Successful Access Attempts',\r\n+                data: [350, 410, 390, 450, 480, 520, 500, 550, 530, 600, 580, 620, 650, 680],\r\n+                borderColor: '#3b82f6', // blue-500\r\n+                backgroundColor: 'rgba(59, 130, 246, 0.1)',\r\n+                fill: true,\r\n+                tension: 0.4,\r\n+                pointRadius: 3\r\n+            },\r\n+            {\r\n+                label: 'Denied Access Attempts',\r\n+                data: [15, 12, 20, 10, 18, 5, 25, 17, 10, 8, 22, 11, 14, 9],\r\n+                borderColor: '#ef4444', // red-500\r\n+                backgroundColor: 'rgba(239, 68, 68, 0.1)',\r\n+                fill: false,\r\n+                tension: 0.4,\r\n+                pointRadius: 3\r\n+            }]\r\n+        },\r\n+        options: {\r\n+            responsive: true,\r\n+            maintainAspectRatio: false,\r\n+            scales: {\r\n+                y: {\r\n+                    beginAtZero: true,\r\n+                    title: {\r\n+                        display: true,\r\n+                        text: 'Number of Attempts'\r\n+                    }\r\n+                }\r\n+            },\r\n+            plugins: {\r\n\\ No newline at end of file\n+                legend: {\r\n+                    position: 'top',\r\n+                },\r\n+                tooltip: {\r\n+                    mode: 'index',\r\n+                    intersect: false,\r\n+                }\r\n+            }\r\n         }\r\n-    } catch (error) {\r\n-        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n-    }\r\n+    });\r\n }\r\n \r\n-function attachOverrideListeners() {\r\n-    // Attach listener for the 'Perform Manual Override' button\r\n-    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-        \r\n-        try {\r\n-            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n-                method: 'POST',\r\n-                headers: getAuthHeaders(),\r\n-                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n-            });\r\n-            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+// =========================================================\r\n+// AUTHENTICATION\r\n+// =========================================================\r\n \r\n-            displayMessage(\"Manual override successful!\", false);\r\n-            await loadManualOverrides(); // Reload logs\r\n-\r\n-        } catch (e) {\r\n-            displayMessage(`Manual override failed: ${e.message}`, true);\r\n-        }\r\n-    });\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n-// ====================================================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n-\r\n-async function loadPageIntoMainContent(url) {\r\n-    // Show a loading state instantly\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n-\r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html; // Inject HTML first\r\n-\r\n-        // 🟢 Execute data loading functions based on the page loaded \r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n-        } \r\n-        \r\n-        // --- MEMBERSHIP PAGES ---\r\n-        else if (url.includes(\"membershiprecords.html\")) {\r\n-            // Approved Residents\r\n-            attachMembershipListeners();\r\n-            await loadApprovedResidents();\r\n-        } else if (url.includes(\"membership.html\")) {\r\n-            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n-            attachMembershipListeners();\r\n-            await loadPendingRequests();\r\n-        }\r\n-        \r\n-        // --- PAYMENTS RECORDS ---\r\n-        else if (url.includes(\"payments.html\")) {\r\n-            attachPaymentsListeners();\r\n-            await loadPaymentsRecords();\r\n-        } \r\n-        \r\n-        // --- RESIDENTS ---\r\n-        else if (url.includes(\"residents.html\")) {\r\n-            await loadAllResidents();\r\n-        } \r\n-        \r\n-        // --- VISITORS MANAGEMENT ---\r\n-        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-            attachVisitorListeners();\r\n-            // Load data relevant to the main visitor pages\r\n-            await loadVisitorPassOverview();\r\n-            await loadPendingVisitorApprovals();\r\n-        }\r\n-        \r\n-        // --- CHARTS AND REPORTS ---\r\n-        else if (url.includes(\"chartsandreports.html\")) {\r\n-            await loadReportsData();\r\n-        } \r\n-        \r\n-        // --- MANUAL OVERRIDES ---\r\n-        else if (url.includes(\"manualoverride.html\")) {\r\n-            attachOverrideListeners();\r\n-            await loadManualOverrides();\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n-    }\r\n-}\r\n-\r\n-// ... (existing sidebar button loop and visitor toggle logic)\r\n-\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => {\r\n-            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-            // Also ensure sub-menu items are correctly reset if needed\r\n-            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n-            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n-            \r\n-            // Re-apply specific default styles for sub-menu items if needed\r\n-            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n-                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            }\r\n-        });\r\n-        \r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n-\r\n-\r\n-// ================================\r\n-// MISC UI TOGGLES\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n-});\r\n-\r\n-// ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n-// ================================\r\n-\r\n-document.addEventListener('DOMContentLoaded', () => {\r\n-    // Load the initial dashboard view when the admin page first loads\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\n+/**\r\n+ * Handles the user logout action.\r\n+ */\r\n+function handleLogout() {\r\n+    localStorage.removeItem(\"adminToken\");\r\n+    alert(\"Logged out successfully.\");\r\n+    // In a real app, this would redirect to the login page\r\n+    // window.location.href = '/login.html'; \r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763877400245,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,203 +1,772 @@\n-// =========================================================\r\n-// GLOBAL SETTINGS & INITIALIZATION\r\n-// =========================================================\r\n+// adminsdashboard.js\r\n+// This file now includes ALL necessary data loading logic (including Membership)\r\n+// to handle dynamic page loading in the Admin Dashboard.\r\n \r\n-// Placeholder for API host (adjust as necessary)\r\n-const API_HOST = \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"adminToken\"); // Assumes admin token is stored here\r\n+// ================================\r\n+// 🔑 ENVIRONMENT & AUTH SETUP\r\n+// ================================\r\n+const API_HOST =  \"http://localhost:4050\"; \r\n+const token = localStorage.getItem(\"accessToken\"); \r\n+if (!token) window.location.href = \"/login.html\";\r\n \r\n-document.addEventListener(\"DOMContentLoaded\", init);\r\n+// Define API Endpoints\r\n+const ENDPOINTS = {\r\n+    // Dashboard Overview Endpoints\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-function init() {\r\n-    // 1. Setup Navigation Listeners\r\n-    setupSidebarNavigation();\r\n+    // Membership Endpoints\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    \r\n+    // General Admin Endpoints\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+};\r\n \r\n-    // 2. Setup Dropdown\r\n-    document.getElementById(\"visitorManagementToggle\").addEventListener(\"click\", toggleVisitorSubMenu);\r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+// ================================\r\n+document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n+});\r\n \r\n-    // 3. Load Initial Content (Dashboard Overview)\r\n-    const initialButton = document.querySelector('.sidebarBtn[data-target=\"sections/dashboardoverview.html\"]');\r\n-    if (initialButton) {\r\n-        loadSidebarContent(initialButton.dataset.target, initialButton);\r\n-    }\r\n+// ================================\r\n+// UTILITIES AND HELPERS\r\n+// ================================\r\n \r\n-    // 4. Load Dashboard Metrics and Chart\r\n-    loadDashboardMetrics();\r\n-    renderAccessChart();\r\n+/**\r\n+ * Creates and returns the standard headers needed for authenticated API calls.\r\n+ */\r\n+function getAuthHeaders() {\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n+}\r\n \r\n-    // 5. Logout Listener\r\n-    document.getElementById(\"logoutBtn\").addEventListener(\"click\", handleLogout);\r\n+/**\r\n+ * Handles error display in a non-alert manner.\r\n+ */\r\n+function displayMessage(message, isError = false) {\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n }\r\n \r\n-// =========================================================\r\n-// NAVIGATION & CONTENT LOADING\r\n-// =========================================================\r\n+/**\r\n+ * Formats a timestamp (string or number) into a readable date string.\r\n+ */\r\n+function formatTimestamp(timestamp) {\r\n+    try {\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n+}\r\n \r\n-function setupSidebarNavigation() {\r\n-    const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-    sidebarButtons.forEach(button => {\r\n-        button.addEventListener(\"click\", (e) => {\r\n-            const targetUrl = e.currentTarget.dataset.target;\r\n-            loadSidebarContent(targetUrl, e.currentTarget);\r\n-        });\r\n-    });\r\n+/**\r\n+ * Safely updates a DOM element's text content.\r\n+ */\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    }\r\n+};\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Sends an approval request to the backend API.\r\n+ */\r\n+async function handleApproveClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        \r\n+        // Reload data after a successful action\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n /**\r\n- * Fetches and injects HTML content into the main content area.\r\n- * @param {string} url - The URL of the HTML fragment to load.\r\n- * @param {HTMLElement} activeBtn - The button that was clicked.\r\n- */\r\n-async function loadSidebarContent(url, activeBtn) {\r\n-    const contentArea = document.getElementById(\"dynamic-section-content\");\r\n-    \r\n-    // Clear previous content\r\n-    contentArea.innerHTML = '<div class=\"text-center p-8 text-gray-500\">Loading content...</div>';\r\n-    \r\n-    // Set active class on the sidebar button\r\n-    setActiveButton(activeBtn);\r\n+ * Sends a rejection request to the backend API.\r\n+ */\r\n+async function handleRejectClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n\\ No newline at end of file\n+}\r\n+\r\n+/**\r\n+ * Sends a deletion request to the backend API.\r\n+ */\r\n+async function handleDeleteClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Executes a real API call to trigger server-side data synchronization.\r\n+ */\r\n+async function handleSyncClick(event) {\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n+\r\n+    // 1. Set Loading State\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { \r\n+            method: 'POST',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+        }\r\n+\r\n+        // 2. Set Success State\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+        // Reload data after a successful sync\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+        \r\n+    } catch (err) {\r\n+        // 3. Set Failure State\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+    } finally {\r\n+        // 4. Reset Button State after a short delay\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Fetches and renders pending membership requests from the backend API.\r\n+ */\r\n+async function loadPendingRequests() {\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    \r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        \r\n+        const requests = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n+\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID; \r\n+\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Approve\r\n+                        </button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Reject\r\n+                        </button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Delete\r\n+                        </button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            \r\n+            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Fetches and renders approved residents from the backend API.\r\n+ */\r\n+async function loadApprovedResidents() {\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    \r\n+    if (!tableBody || !noResidentsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading approved residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+ */\r\n+function attachMembershipListeners() {\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n+// ====================================================================\r\n+\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n+    }\r\n+}\r\n+\r\n+async function loadAccessChart() {\r\n     try {\r\n-        // In a real environment, these paths would need to be served statically.\r\n-        // We use a placeholder path here.\r\n-        const response = await fetch(url); \r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-        if (!response.ok) {\r\n-            throw new Error(`Failed to load: ${url}. Status: ${response.status}`);\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n+\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        // Destroy existing chart instance if it exists before creating a new one\r\n+        if (window.accessChartInstance) {\r\n+            window.accessChartInstance.destroy();\r\n         }\r\n+        \r\n+        window.accessChartInstance = new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n \r\n-        const htmlContent = await response.text();\r\n-        contentArea.innerHTML = htmlContent;\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"Content loading failed:\", error);\r\n-        contentArea.innerHTML = `\r\n-            <div class=\"p-8 bg-red-100 border border-red-400 text-red-700 rounded-lg\">\r\n-                <p class=\"font-bold\">Error loading content:</p>\r\n-                <p>${error.message}. Please check the file path: ${url}</p>\r\n-            </div>\r\n-        `;\r\n+    } catch (err) {\r\n+        console.error(\"Error loading chart:\", err);\r\n     }\r\n }\r\n \r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n+// ====================================================================\r\n+\r\n /**\r\n- * Manages the visual active state of sidebar buttons.\r\n- * @param {HTMLElement} activeBtn - The button to mark as active.\r\n- */\r\n-function setActiveButton(activeBtn) {\r\n-    // Remove active styles from all buttons\r\n-    document.querySelectorAll(\".sidebarBtn\").forEach(btn => {\r\n-        btn.classList.remove(\"bg-blue-600\", \"shadow-inner\");\r\n-        btn.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-    });\r\n-    \r\n-    // Apply active styles to the selected button\r\n-    activeBtn.classList.add(\"bg-blue-600\", \"shadow-inner\");\r\n-    activeBtn.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+ * Fetches and renders payments records.\r\n+ */\r\n+async function loadPaymentsRecords() {\r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return; \r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+        \r\n+        const records = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+\r\n+        if (records.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+        } else {\r\n+            records.forEach(record => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading payments records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load payments records from API.\", true);\r\n+    }\r\n }\r\n \r\n /**\r\n- * Toggles the visibility of the Visitor Management submenu.\r\n- */\r\n-function toggleVisitorSubMenu() {\r\n-    const subMenu = document.getElementById(\"visitorSubMenu\");\r\n-    const arrow = document.getElementById(\"visitorArrow\");\r\n-    \r\n-    subMenu.classList.toggle(\"hidden\");\r\n-    arrow.classList.toggle(\"rotate-90\"); // Rotate arrow for better UX\r\n+ * Attaches event listeners for payments-specific elements.\r\n+ */\r\n+function attachPaymentsListeners() {\r\n+    // Add any payments-specific listeners here\r\n }\r\n \r\n-// =========================================================\r\n-// DASHBOARD METRICS & CHARTING\r\n-// =========================================================\r\n \r\n+// ====================================================================\r\n+// 👥 RESIDENTS LOGIC (residents.html)\r\n+// ====================================================================\r\n+\r\n /**\r\n- * Placeholder function to fetch and update dashboard metrics (KPIs).\r\n- */\r\n-async function loadDashboardMetrics() {\r\n-    // --- Mock Data Simulation ---\r\n-    // In a real app, you would fetch these from endpoints like:\r\n-    // fetch(`${API_HOST}/api/admin/metrics`, { headers: { 'Authorization': `Bearer ${token}` }})\r\n+ * Fetches and renders all resident details.\r\n+ */\r\n+async function loadAllResidents() {\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n+        } else {\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load all residents from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n+// ====================================================================\r\n+\r\n+async function loadVisitorPassOverview() {\r\n+    const overviewSection = document.getElementById('visitorOverviewSection');\r\n+    if (!overviewSection) return;\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+        safeUpdate(\"todayVisitors\", data.today || 0);\r\n+        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+        \r\n+    } catch (err) {\r\n+        console.error(\"Error loading visitor overview:\", err);\r\n+    }\r\n+}\r\n+\r\n+async function loadPendingVisitorApprovals() {\r\n+    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n     \r\n-    const mockMetrics = {\r\n-        totalResidents: 752,\r\n-        pendingPayments: 14,\r\n-        compliancePct: 95,\r\n-        overrideCount: 3,\r\n-    };\r\n+    // Implementation details would be similar to loadPendingRequests()\r\n+}\r\n \r\n-    // Update the DOM elements with the mock data\r\n-    document.getElementById(\"totalResidents\").textContent = mockMetrics.totalResidents;\r\n-    document.getElementById(\"pendingPayments\").textContent = mockMetrics.pendingPayments;\r\n-    document.getElementById(\"compliancePct\").textContent = `${mockMetrics.compliancePct}%`;\r\n-    document.getElementById(\"overrideCount\").textContent = mockMetrics.overrideCount;\r\n+function attachVisitorListeners() {\r\n+    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n }\r\n \r\n-/**\r\n- * Renders the Chart.js graph for access attempts.\r\n- */\r\n-function renderAccessChart() {\r\n-    const ctx = document.getElementById(\"accessChart\");\r\n-    if (!ctx) return; // Ensure the canvas exists\r\n \r\n-    new Chart(ctx, {\r\n-        type: 'line',\r\n-        data: {\r\n-            labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10', 'Day 11', 'Day 12', 'Day 13', 'Day 14'],\r\n-            datasets: [{\r\n-                label: 'Successful Access Attempts',\r\n-                data: [350, 410, 390, 450, 480, 520, 500, 550, 530, 600, 580, 620, 650, 680],\r\n-                borderColor: '#3b82f6', // blue-500\r\n-                backgroundColor: 'rgba(59, 130, 246, 0.1)',\r\n-                fill: true,\r\n-                tension: 0.4,\r\n-                pointRadius: 3\r\n-            },\r\n-            {\r\n-                label: 'Denied Access Attempts',\r\n-                data: [15, 12, 20, 10, 18, 5, 25, 17, 10, 8, 22, 11, 14, 9],\r\n-                borderColor: '#ef4444', // red-500\r\n-                backgroundColor: 'rgba(239, 68, 68, 0.1)',\r\n-                fill: false,\r\n-                tension: 0.4,\r\n-                pointRadius: 3\r\n-            }]\r\n-        },\r\n-        options: {\r\n-            responsive: true,\r\n-            maintainAspectRatio: false,\r\n-            scales: {\r\n-                y: {\r\n-                    beginAtZero: true,\r\n-                    title: {\r\n-                        display: true,\r\n-                        text: 'Number of Attempts'\r\n-                    }\r\n-                }\r\n-            },\r\n-            plugins: {\r\n-                legend: {\r\n-                    position: 'top',\r\n-                },\r\n-                tooltip: {\r\n-                    mode: 'index',\r\n-                    intersect: false,\r\n-                }\r\n-            }\r\n+// ====================================================================\r\n+// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+    // Placeholder implementation\r\n+    const reportsContainer = document.getElementById('reportsContainer');\r\n+    if (!reportsContainer) return;\r\n+    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n+        // For simplicity, we just display a success message:\r\n+        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading reports data:\", err);\r\n+        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+    const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    if (!logTableBody) return;\r\n+\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+        const logs = await resp.json();\r\n+\r\n+        logTableBody.innerHTML = '';\r\n+        if (logs.length === 0) {\r\n+            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+        } else {\r\n+            // Populate table rows with logs\r\n         }\r\n-    });\r\n+    } catch (error) {\r\n+        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+    }\r\n }\r\n \r\n-// =========================================================\r\n-// AUTHENTICATION\r\n-// =========================================================\r\n+function attachOverrideListeners() {\r\n+    // Attach listener for the 'Perform Manual Override' button\r\n+    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+        \r\n+        try {\r\n+            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n+                method: 'POST',\r\n+                headers: getAuthHeaders(),\r\n+                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n+            });\r\n+            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n \r\n-/**\r\n- * Handles the user logout action.\r\n- */\r\n-function handleLogout() {\r\n-    localStorage.removeItem(\"adminToken\");\r\n-    alert(\"Logged out successfully.\");\r\n-    // In a real app, this would redirect to the login page\r\n-    // window.location.href = '/login.html'; \r\n-}\n+            displayMessage(\"Manual override successful!\", false);\r\n+            await loadManualOverrides(); // Reload logs\r\n+\r\n+        } catch (e) {\r\n+            displayMessage(`Manual override failed: ${e.message}`, true);\r\n+        }\r\n+    });\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n+// ====================================================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n+\r\n+async function loadPageIntoMainContent(url) {\r\n+    // Show a loading state instantly\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html; // Inject HTML first\r\n+\r\n+        // 🟢 Execute data loading functions based on the page loaded \r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n+        } \r\n+        \r\n+        // --- MEMBERSHIP PAGES ---\r\n+        else if (url.includes(\"membershiprecords.html\")) {\r\n+            // Approved Residents\r\n+            attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+        }\r\n+        \r\n+        // --- PAYMENTS RECORDS ---\r\n+        else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } \r\n+        \r\n+        // --- RESIDENTS ---\r\n+        else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } \r\n+        \r\n+        // --- VISITORS MANAGEMENT ---\r\n+        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+            attachVisitorListeners();\r\n+            // Load data relevant to the main visitor pages\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        }\r\n+        \r\n+        // --- CHARTS AND REPORTS ---\r\n+        else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } \r\n+        \r\n+        // --- MANUAL OVERRIDES ---\r\n+        else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    }\r\n+}\r\n+\r\n+// ... (existing sidebar button loop and visitor toggle logic)\r\n+\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => {\r\n+            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+            // Also ensure sub-menu items are correctly reset if needed\r\n+            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n+            \r\n+            // Re-apply specific default styles for sub-menu items if needed\r\n+            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n+                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            }\r\n+        });\r\n+        \r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n+\r\n+\r\n+// ================================\r\n+// MISC UI TOGGLES\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+});\r\n+\r\n+// ================================\r\n+// INITIALIZATION ON PAGE LOAD\r\n+// ================================\r\n+\r\n+document.addEventListener('DOMContentLoaded', () => {\r\n+    // Load the initial dashboard view when the admin page first loads\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+});\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763877766367,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,772 +1,237 @@\n-// adminsdashboard.js\r\n-// This file now includes ALL necessary data loading logic (including Membership)\r\n-// to handle dynamic page loading in the Admin Dashboard.\r\n+// =========================================================\r\n+// GLOBAL SETTINGS & INITIALIZATION\r\n+// =========================================================\r\n \r\n-// ================================\r\n-// 🔑 ENVIRONMENT & AUTH SETUP\r\n-// ================================\r\n-const API_HOST =  \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"accessToken\"); \r\n-if (!token) window.location.href = \"/login.html\";\r\n+// Placeholder for API host (adjust as necessary)\r\n+const API_HOST = \"http://localhost:4050\"; \r\n+const token = localStorage.getItem(\"adminToken\"); // Assumes admin token is stored here\r\n \r\n-// Define API Endpoints\r\n-const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+document.addEventListener(\"DOMContentLoaded\", init);\r\n \r\n-    // Membership Endpoints\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    \r\n-    // General Admin Endpoints\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-};\r\n+function init() {\r\n+    // 1. Setup Navigation Listeners\r\n+    setupSidebarNavigation();\r\n \r\n-// ================================\r\n-// AUTH & LOGOUT\r\n-// ================================\r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n-});\r\n+    // 2. Setup Dropdown\r\n+    document.getElementById(\"visitorManagementToggle\").addEventListener(\"click\", toggleVisitorSubMenu);\r\n \r\n-// ================================\r\n-// UTILITIES AND HELPERS\r\n-// ================================\r\n+    // 3. Load Initial Content (Dashboard Overview)\r\n+    const initialButton = document.querySelector('.sidebarBtn[data-target=\"sections/dashboardoverview.html\"]');\r\n+    if (initialButton) {\r\n+        loadSidebarContent(initialButton.dataset.target, initialButton);\r\n+    }\r\n \r\n-/**\r\n- * Creates and returns the standard headers needed for authenticated API calls.\r\n- */\r\n-function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n-}\r\n+    // 4. Load Dashboard Metrics and Chart (Refactored to load data)\r\n+    loadDashboardMetrics();\r\n+    loadAndRenderAccessChart(); // ⬅️ NEW FUNCTION NAME\r\n \r\n-/**\r\n- * Handles error display in a non-alert manner.\r\n- */\r\n-function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-        \r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n+    // 5. Logout Listener\r\n+    document.getElementById(\"logoutBtn\").addEventListener(\"click\", handleLogout);\r\n }\r\n \r\n-/**\r\n- * Formats a timestamp (string or number) into a readable date string.\r\n- */\r\n-function formatTimestamp(timestamp) {\r\n-    try {\r\n-        if (!timestamp) return 'N/A';\r\n-        return new Date(timestamp).toLocaleString();\r\n-    } catch (e) {\r\n-        return 'N/A';\r\n-    }\r\n-}\r\n+// =========================================================\r\n+// NAVIGATION & CONTENT LOADING\r\n+// =========================================================\r\n \r\n-/**\r\n- * Safely updates a DOM element's text content.\r\n- */\r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    }\r\n-};\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Sends an approval request to the backend API.\r\n- */\r\n-async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-        \r\n-        // Reload data after a successful action\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Approval Operation Failed:\", e);\r\n-        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+function setupSidebarNavigation() {\r\n+    const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+    sidebarButtons.forEach(button => {\r\n+        button.addEventListener(\"click\", (e) => {\r\n+            const targetUrl = e.currentTarget.dataset.target;\r\n+            loadSidebarContent(targetUrl, e.currentTarget);\r\n+        });\r\n+    });\r\n }\r\n \r\n /**\r\n- * Sends a rejection request to the backend API.\r\n- */\r\n-async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+ * Fetches and injects HTML content into the main content area.\r\n+ * @param {string} url - The URL of the HTML fragment to load.\r\n+ * @param {HTMLElement} activeBtn - The button that was clicked.\r\n+ */\r\n+async function loadSidebarContent(url, activeBtn) {\r\n+    const contentArea = document.getElementById(\"dynamic-section-content\");\r\n+    \r\n+    // Clear previous content\r\n+    contentArea.innerHTML = '<div class=\"text-center p-8 text-gray-500\">Loading content...</div>';\r\n+    \r\n+    // Set active class on the sidebar button\r\n+    setActiveButton(activeBtn);\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-            method: 'PUT', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Operation Failed:\", e);\r\n-        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Sends a deletion request to the backend API.\r\n- */\r\n-async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-            method: 'DELETE', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Deletion Operation Failed:\", e);\r\n-        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Executes a real API call to trigger server-side data synchronization.\r\n- */\r\n-async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n-\r\n-    // 1. Set Loading State\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { \r\n-            method: 'POST',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-        }\r\n-\r\n-        // 2. Set Success State\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-        // Reload data after a successful sync\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-        \r\n-    } catch (err) {\r\n-        // 3. Set Failure State\r\n-        console.error(\"Synchronization Error:\", err.message);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n-    } finally {\r\n-        // 4. Reset Button State after a short delay\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Fetches and renders pending membership requests from the backend API.\r\n- */\r\n-async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    \r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-        \r\n-        const requests = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n-\r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-\r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID; \r\n-\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${requestId}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Approve\r\n-                        </button>\r\n-                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Reject\r\n-                        </button>\r\n-                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Delete\r\n-                        </button>\r\n-                    </td>\r\n-                `;\r\n-            });\r\n-            \r\n-            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading pending requests:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Fetches and renders approved residents from the backend API.\r\n- */\r\n-async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-    \r\n-    if (!tableBody || !noResidentsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-\r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            noResidentsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noResidentsMsg.classList.add('hidden');\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading approved residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n- */\r\n-function attachMembershipListeners() {\r\n-    // Attach listener for the Sync button\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    \r\n-    // Attach listener for Clear Filters button\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-    });\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n-// ====================================================================\r\n-\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n+        // In a real environment, these paths would need to be served statically.\r\n+        const response = await fetch(url); \r\n \r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n-\r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        // Destroy existing chart instance if it exists before creating a new one\r\n-        if (window.accessChartInstance) {\r\n-            window.accessChartInstance.destroy();\r\n+        if (!response.ok) {\r\n+            // Log a specific error for the file loading issue\r\n+            console.error(`HTML Content Load Error: Failed to load ${url}. Status: ${response.status}. Check if the file path is correct on the server.`);\r\n+            throw new Error(`Failed to load: ${url}. Status: ${response.status}`);\r\n         }\r\n-        \r\n-        window.accessChartInstance = new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n+        const htmlContent = await response.text();\r\n+        contentArea.innerHTML = htmlContent;\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"Content loading failed:\", error);\r\n+        contentArea.innerHTML = `\r\n+            <div class=\"p-8 bg-red-100 border border-red-400 text-red-700 rounded-lg\">\r\n+                <p class=\"font-bold\">Error loading content:</p>\r\n+                <p>${error.message}. Please check the file path: ${url}</p>\r\n+            </div>\r\n+        `;\r\n     }\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n-// ====================================================================\r\n-\r\n /**\r\n- * Fetches and renders payments records.\r\n- */\r\n-async function loadPaymentsRecords() {\r\n-    const tableBody = document.getElementById('paymentsTableBody');\r\n-    if (!tableBody) return; \r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-        \r\n-        const records = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-\r\n-        if (records.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-        } else {\r\n-            records.forEach(record => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading payments records:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load payments records from API.\", true);\r\n-    }\r\n+ * Manages the visual active state of sidebar buttons.\r\n+ * @param {HTMLElement} activeBtn - The button to mark as active.\r\n+ */\r\n+function setActiveButton(activeBtn) {\r\n+    // Remove active styles from all buttons\r\n+    document.querySelectorAll(\".sidebarBtn\").forEach(btn => {\r\n+        btn.classList.remove(\"bg-blue-600\", \"shadow-inner\");\r\n+        btn.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+    });\r\n+    \r\n+    // Apply active styles to the selected button\r\n+    activeBtn.classList.add(\"bg-blue-600\", \"shadow-inner\");\r\n+    activeBtn.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n }\r\n \r\n /**\r\n- * Attaches event listeners for payments-specific elements.\r\n- */\r\n-function attachPaymentsListeners() {\r\n-    // Add any payments-specific listeners here\r\n+ * Toggles the visibility of the Visitor Management submenu.\r\n+ */\r\n+function toggleVisitorSubMenu() {\r\n+    const subMenu = document.getElementById(\"visitorSubMenu\");\r\n+    const arrow = document.getElementById(\"visitorArrow\");\r\n+    \r\n+    subMenu.classList.toggle(\"hidden\");\r\n+    arrow.classList.toggle(\"rotate-90\"); // Rotate arrow for better UX\r\n }\r\n \r\n+// =========================================================\r\n+// DASHBOARD METRICS & CHARTING\r\n+// =========================================================\r\n \r\n-// ====================================================================\r\n-// 👥 RESIDENTS LOGIC (residents.html)\r\n-// ====================================================================\r\n-\r\n /**\r\n- * Fetches and renders all resident details.\r\n- */\r\n-async function loadAllResidents() {\r\n-    const tableBody = document.getElementById('allResidentsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-        } else {\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading all residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load all residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n-// ====================================================================\r\n-\r\n-async function loadVisitorPassOverview() {\r\n-    const overviewSection = document.getElementById('visitorOverviewSection');\r\n-    if (!overviewSection) return;\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n-        safeUpdate(\"todayVisitors\", data.today || 0);\r\n-        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-        \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitor overview:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+ * Placeholder function to fetch and update dashboard metrics (KPIs).\r\n+ */\r\n+async function loadDashboardMetrics() {\r\n+    // --- Mock Data Simulation ---\r\n+    // In a real app, you would fetch these from endpoints like:\r\n+    // fetch(`${API_HOST}/api/admin/metrics`, { headers: { 'Authorization': `Bearer ${token}` }})\r\n     \r\n-    // Implementation details would be similar to loadPendingRequests()\r\n-}\r\n+    const mockMetrics = {\r\n+        totalResidents: 752,\r\n+        pendingPayments: 14,\r\n+        compliancePct: 95,\r\n+        overrideCount: 3,\r\n+    };\r\n \r\n-function attachVisitorListeners() {\r\n-    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+    // Update the DOM elements with the mock data\r\n+    document.getElementById(\"totalResidents\").textContent = mockMetrics.totalResidents;\r\n+    document.getElementById(\"pendingPayments\").textContent = mockMetrics.pendingPayments;\r\n+    document.getElementById(\"compliancePct\").textContent = `${mockMetrics.compliancePct}%`;\r\n+    document.getElementById(\"overrideCount\").textContent = mockMetrics.overrideCount;\r\n }\r\n \r\n+/**\r\n+ * Renders the Chart.js graph for access attempts, loading data from API or using mock data.\r\n+ */\r\n+async function loadAndRenderAccessChart() {\r\n+    const ctx = document.getElementById(\"accessChart\");\r\n+    if (!ctx) return; // Ensure the canvas exists\r\n \r\n-// ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n-// ====================================================================\r\n+    // 1. Define Mock Data (Fallback)\r\n+    const getMockChartData = () => ({\r\n+        labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10', 'Day 11', 'Day 12', 'Day 13', 'Day 14'],\r\n+        successful: [350, 410, 390, 450, 480, 520, 500, 550, 530, 600, 580, 620, 650, 680],\r\n+        denied: [15, 12, 20, 10, 18, 5, 25, 17, 10, 8, 22, 11, 14, 9]\r\n+    });\r\n \r\n-async function loadReportsData() {\r\n-    // Placeholder implementation\r\n-    const reportsContainer = document.getElementById('reportsContainer');\r\n-    if (!reportsContainer) return;\r\n-    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+    let chartData = getMockChartData();\r\n \r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n+    // 2. Attempt to Fetch Real Data\r\n+    try {\r\n+        // Using a more generalized API endpoint guess, as the user's original one failed with 404\r\n+        const apiUrl = `${API_HOST}/api/dashboard/access-chart-data`; \r\n+        const response = await fetch(apiUrl, {\r\n+            headers: { 'Authorization': `Bearer ${token}` }\r\n+        });\r\n         \r\n-        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n-        // For simplicity, we just display a success message:\r\n-        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading reports data:\", err);\r\n-        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n-// ====================================================================\r\n-\r\n-async function loadManualOverrides() {\r\n-    const logTableBody = document.getElementById('overrideLogTableBody');\r\n-    if (!logTableBody) return;\r\n-\r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-        const logs = await resp.json();\r\n-\r\n-        logTableBody.innerHTML = '';\r\n-        if (logs.length === 0) {\r\n-            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+        if (response.ok) {\r\n+            const realData = await response.json();\r\n+            // Assuming realData structure is { labels: [], successful: [], denied: [] }\r\n+            chartData = realData;\r\n         } else {\r\n-            // Populate table rows with logs\r\n+            console.warn(`Failed to fetch chart data (Status: ${response.status}). Using mock data.`);\r\n+            // chartData remains mock data\r\n         }\r\n+\r\n     } catch (error) {\r\n-        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+        // This catches network errors or JSON parsing failures\r\n+        console.error(\"Error fetching chart data. Using mock data.\", error);\r\n+        // chartData remains mock data\r\n     }\r\n-}\r\n-\r\n-function attachOverrideListeners() {\r\n-    // Attach listener for the 'Perform Manual Override' button\r\n-    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-        \r\n\\ No newline at end of file\n-        try {\r\n-            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n-                method: 'POST',\r\n-                headers: getAuthHeaders(),\r\n-                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n-            });\r\n-            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n-\r\n-            displayMessage(\"Manual override successful!\", false);\r\n-            await loadManualOverrides(); // Reload logs\r\n-\r\n-        } catch (e) {\r\n-            displayMessage(`Manual override failed: ${e.message}`, true);\r\n+    \r\n+    // 3. Render the Chart\r\n+    new Chart(ctx, {\r\n+        type: 'line',\r\n+        data: {\r\n+            labels: chartData.labels,\r\n+            datasets: [{\r\n+                label: 'Successful Access Attempts',\r\n+                data: chartData.successful,\r\n+                borderColor: '#3b82f6', // blue-500\r\n+                backgroundColor: 'rgba(59, 130, 246, 0.1)',\r\n+                fill: true,\r\n+                tension: 0.4,\r\n+                pointRadius: 3\r\n+            },\r\n+            {\r\n+                label: 'Denied Access Attempts',\r\n+                data: chartData.denied,\r\n+                borderColor: '#ef4444', // red-500\r\n+                backgroundColor: 'rgba(239, 68, 68, 0.1)',\r\n+                fill: false,\r\n+                tension: 0.4,\r\n+                pointRadius: 3\r\n+            }]\r\n+        },\r\n+        options: {\r\n+            responsive: true,\r\n+            maintainAspectRatio: false,\r\n+            scales: {\r\n+                y: {\r\n+                    beginAtZero: true,\r\n+                    title: {\r\n+                        display: true,\r\n+                        text: 'Number of Attempts'\r\n+                    }\r\n+                }\r\n+            },\r\n+            plugins: {\r\n+                legend: {\r\n+                    position: 'top',\r\n+                },\r\n+                tooltip: {\r\n+                    mode: 'index',\r\n+                    intersect: false,\r\n+                }\r\n+            }\r\n         }\r\n-    });\r\n+    });\r\n }\r\n \r\n+// =========================================================\r\n+// AUTHENTICATION\r\n+// =========================================================\r\n \r\n-// ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n-// ====================================================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n-\r\n-async function loadPageIntoMainContent(url) {\r\n-    // Show a loading state instantly\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n-\r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html; // Inject HTML first\r\n-\r\n-        // 🟢 Execute data loading functions based on the page loaded \r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n-        } \r\n-        \r\n-        // --- MEMBERSHIP PAGES ---\r\n-        else if (url.includes(\"membershiprecords.html\")) {\r\n-            // Approved Residents\r\n-            attachMembershipListeners();\r\n-            await loadApprovedResidents();\r\n-        } else if (url.includes(\"membership.html\")) {\r\n-            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n-            attachMembershipListeners();\r\n-            await loadPendingRequests();\r\n-        }\r\n-        \r\n-        // --- PAYMENTS RECORDS ---\r\n-        else if (url.includes(\"payments.html\")) {\r\n-            attachPaymentsListeners();\r\n-            await loadPaymentsRecords();\r\n-        } \r\n-        \r\n-        // --- RESIDENTS ---\r\n-        else if (url.includes(\"residents.html\")) {\r\n-            await loadAllResidents();\r\n-        } \r\n-        \r\n-        // --- VISITORS MANAGEMENT ---\r\n-        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-            attachVisitorListeners();\r\n-            // Load data relevant to the main visitor pages\r\n-            await loadVisitorPassOverview();\r\n-            await loadPendingVisitorApprovals();\r\n-        }\r\n-        \r\n-        // --- CHARTS AND REPORTS ---\r\n-        else if (url.includes(\"chartsandreports.html\")) {\r\n-            await loadReportsData();\r\n-        } \r\n-        \r\n-        // --- MANUAL OVERRIDES ---\r\n-        else if (url.includes(\"manualoverride.html\")) {\r\n-            attachOverrideListeners();\r\n-            await loadManualOverrides();\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n-    }\r\n-}\r\n-\r\n-// ... (existing sidebar button loop and visitor toggle logic)\r\n-\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => {\r\n-            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-            // Also ensure sub-menu items are correctly reset if needed\r\n-            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n-            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n-            \r\n-            // Re-apply specific default styles for sub-menu items if needed\r\n-            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n-                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            }\r\n-        });\r\n-        \r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n-\r\n-\r\n-// ================================\r\n-// MISC UI TOGGLES\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n-});\r\n-\r\n-// ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n-// ================================\r\n-\r\n-document.addEventListener('DOMContentLoaded', () => {\r\n-    // Load the initial dashboard view when the admin page first loads\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\n+/**\r\n+ * Handles the user logout action.\r\n+ */\r\n+function handleLogout() {\r\n+    localStorage.removeItem(\"adminToken\");\r\n+    alert(\"Logged out successfully.\");\r\n+    // In a real app, this would redirect to the login page\r\n+    // window.location.href = '/login.html'; \r\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763878211977,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,237 +1,772 @@\n-// =========================================================\r\n-// GLOBAL SETTINGS & INITIALIZATION\r\n-// =========================================================\r\n+// adminsdashboard.js\r\n+// This file now includes ALL necessary data loading logic (including Membership)\r\n+// to handle dynamic page loading in the Admin Dashboard.\r\n \r\n-// Placeholder for API host (adjust as necessary)\r\n+// ================================\r\n+// 🔑 ENVIRONMENT & AUTH SETUP\r\n+// ================================\r\n const API_HOST = \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"adminToken\"); // Assumes admin token is stored here\r\n+const token = localStorage.getItem(\"accessToken\"); \r\n+if (!token) window.location.href = \"/login.html\";\r\n \r\n-document.addEventListener(\"DOMContentLoaded\", init);\r\n+// Define API Endpoints\r\n+const ENDPOINTS = {\r\n+  // Dashboard Overview Endpoints\r\n+  DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+  DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-function init() {\r\n-    // 1. Setup Navigation Listeners\r\n-    setupSidebarNavigation();\r\n+  // Membership Endpoints\r\n+  SYNC: `${API_HOST}/api/admin/sync`,\r\n+  PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+  APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+  APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+  REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+  DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+ \r\n+  // General Admin Endpoints\r\n+  PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+  ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+  VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+  PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+  REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+  MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+  MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+};\r\n \r\n-    // 2. Setup Dropdown\r\n-    document.getElementById(\"visitorManagementToggle\").addEventListener(\"click\", toggleVisitorSubMenu);\r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+// ================================\r\n+document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+  localStorage.removeItem(\"accessToken\");\r\n+  window.location.href = \"/login.html\";\r\n+});\r\n \r\n-    // 3. Load Initial Content (Dashboard Overview)\r\n-    const initialButton = document.querySelector('.sidebarBtn[data-target=\"sections/dashboardoverview.html\"]');\r\n-    if (initialButton) {\r\n-        loadSidebarContent(initialButton.dataset.target, initialButton);\r\n-    }\r\n+// ================================\r\n+// UTILITIES AND HELPERS\r\n+// ================================\r\n \r\n-    // 4. Load Dashboard Metrics and Chart (Refactored to load data)\r\n-    loadDashboardMetrics();\r\n-    loadAndRenderAccessChart(); // ⬅️ NEW FUNCTION NAME\r\n+/**\r\n+* Creates and returns the standard headers needed for authenticated API calls.\r\n+*/\r\n+function getAuthHeaders() {\r\n+  return {\r\n+    'Content-Type': 'application/json',\r\n+    'Authorization': `Bearer ${token}`\r\n+  };\r\n+}\r\n \r\n-    // 5. Logout Listener\r\n-    document.getElementById(\"logoutBtn\").addEventListener(\"click\", handleLogout);\r\n+/**\r\n+* Handles error display in a non-alert manner.\r\n+*/\r\n+function displayMessage(message, isError = false) {\r\n+  const msgElement = document.getElementById('msg');\r\n+  if (msgElement) {\r\n+    msgElement.textContent = message;\r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+   \r\n+    setTimeout(() => {\r\n+      msgElement.textContent = '';\r\n+      msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+    }, 5000);\r\n+  }\r\n }\r\n \r\n-// =========================================================\r\n-// NAVIGATION & CONTENT LOADING\r\n-// =========================================================\r\n+/**\r\n+* Formats a timestamp (string or number) into a readable date string.\r\n+*/\r\n+function formatTimestamp(timestamp) {\r\n+  try {\r\n+    if (!timestamp) return 'N/A';\r\n+    return new Date(timestamp).toLocaleString();\r\n+  } catch (e) {\r\n+    return 'N/A';\r\n+  }\r\n+}\r\n \r\n-function setupSidebarNavigation() {\r\n-    const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-    sidebarButtons.forEach(button => {\r\n-        button.addEventListener(\"click\", (e) => {\r\n-            const targetUrl = e.currentTarget.dataset.target;\r\n-            loadSidebarContent(targetUrl, e.currentTarget);\r\n-        });\r\n+/**\r\n+* Safely updates a DOM element's text content.\r\n+*/\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+  const element = document.getElementById(id);\r\n+  if (element) {\r\n+    element.textContent = value + suffix;\r\n+  }\r\n+};\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+* Sends an approval request to the backend API.\r\n+*/\r\n+async function handleApproveClick(requestId) {\r\n+  safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+      method: 'PUT',\r\n+      headers: getAuthHeaders(),\r\n     });\r\n+\r\n+    if (!resp.ok) {\r\n+      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+      throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n+    }\r\n+    \r\n+    safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+    displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+    \r\n+    // Reload data after a successful action\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+\r\n+  } catch (e) {\r\n+    console.error(\"Approval Operation Failed:\", e);\r\n+    displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n /**\r\n- * Fetches and injects HTML content into the main content area.\r\n- * @param {string} url - The URL of the HTML fragment to load.\r\n- * @param {HTMLElement} activeBtn - The button that was clicked.\r\n- */\r\n-async function loadSidebarContent(url, activeBtn) {\r\n-    const contentArea = document.getElementById(\"dynamic-section-content\");\r\n+* Sends a rejection request to the backend API.\r\n+*/\r\n+async function handleRejectClick(requestId) {\r\n+  safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+  if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+      method: 'PUT', \r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+\r\n+    if (!resp.ok) {\r\n+      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+      throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+    }\r\n     \r\n-    // Clear previous content\r\n-    contentArea.innerHTML = '<div class=\"text-center p-8 text-gray-500\">Loading content...</div>';\r\n+    safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+    displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n     \r\n-    // Set active class on the sidebar button\r\n-    setActiveButton(activeBtn);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n \r\n-    try {\r\n-        // In a real environment, these paths would need to be served statically.\r\n-        const response = await fetch(url); \r\n+  } catch (e) {\r\n+    console.error(\"Rejection Operation Failed:\", e);\r\n+    displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+  }\r\n+}\r\n \r\n-        if (!response.ok) {\r\n-            // Log a specific error for the file loading issue\r\n-            console.error(`HTML Content Load Error: Failed to load ${url}. Status: ${response.status}. Check if the file path is correct on the server.`);\r\n-            throw new Error(`Failed to load: ${url}. Status: ${response.status}`);\r\n-        }\r\n+/**\r\n+* Sends a deletion request to the backend API.\r\n+*/\r\n+async function handleDeleteClick(requestId) {\r\n+  safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+  if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n \r\n-        const htmlContent = await response.text();\r\n-        contentArea.innerHTML = htmlContent;\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+      method: 'DELETE', \r\n+      headers: getAuthHeaders(),\r\n+    });\r\n \r\n-    } catch (error) {\r\n-        console.error(\"Content loading failed:\", error);\r\n-        contentArea.innerHTML = `\r\n-            <div class=\"p-8 bg-red-100 border border-red-400 text-red-700 rounded-lg\">\r\n-                <p class=\"font-bold\">Error loading content:</p>\r\n-                <p>${error.message}. Please check the file path: ${url}</p>\r\n-            </div>\r\n-        `;\r\n+    if (!resp.ok) {\r\n+      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+      throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n     }\r\n+    \r\n\\ No newline at end of file\n+    safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+    displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+    \r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+\r\n+  } catch (e) {\r\n+    console.error(\"Deletion Operation Failed:\", e);\r\n+    displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n /**\r\n- * Manages the visual active state of sidebar buttons.\r\n- * @param {HTMLElement} activeBtn - The button to mark as active.\r\n- */\r\n-function setActiveButton(activeBtn) {\r\n-    // Remove active styles from all buttons\r\n-    document.querySelectorAll(\".sidebarBtn\").forEach(btn => {\r\n-        btn.classList.remove(\"bg-blue-600\", \"shadow-inner\");\r\n-        btn.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+* Executes a real API call to trigger server-side data synchronization.\r\n+*/\r\n+async function handleSyncClick(event) {\r\n+  const btn = event.currentTarget;\r\n+  const originalText = btn.textContent;\r\n+  const originalClasses = btn.className;\r\n+\r\n+  // 1. Set Loading State\r\n+  btn.disabled = true;\r\n+  btn.textContent = 'Syncing...';\r\n+  btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.SYNC, { \r\n+      method: 'POST',\r\n+      headers: getAuthHeaders(),\r\n     });\r\n+\r\n+    if (!resp.ok) {\r\n+      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+      throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+    }\r\n+\r\n+    // 2. Set Success State\r\n+    btn.textContent = 'Sync Complete! ✔️';\r\n+    btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+    displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+    // Reload data after a successful sync\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n     \r\n-    // Apply active styles to the selected button\r\n-    activeBtn.classList.add(\"bg-blue-600\", \"shadow-inner\");\r\n-    activeBtn.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+  } catch (err) {\r\n+    // 3. Set Failure State\r\n+    console.error(\"Synchronization Error:\", err.message);\r\n+    btn.textContent = 'Sync Failed ❌';\r\n+    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+    displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+  } finally {\r\n+    // 4. Reset Button State after a short delay\r\n+    setTimeout(() => {\r\n+      btn.disabled = false;\r\n+      btn.textContent = originalText;\r\n+      btn.className = originalClasses;\r\n+    }, 3000);\r\n+  }\r\n }\r\n \r\n /**\r\n- * Toggles the visibility of the Visitor Management submenu.\r\n- */\r\n-function toggleVisitorSubMenu() {\r\n-    const subMenu = document.getElementById(\"visitorSubMenu\");\r\n-    const arrow = document.getElementById(\"visitorArrow\");\r\n+* Fetches and renders pending membership requests from the backend API.\r\n+*/\r\n+async function loadPendingRequests() {\r\n+  const tableBody = document.getElementById('membershipTableBody');\r\n+  const countElement = document.getElementById('membershipCount');\r\n+  const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+  \r\n+  if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+\r\n+  // Show loading state\r\n+  tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+  \r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n     \r\n-    subMenu.classList.toggle(\"hidden\");\r\n-    arrow.classList.toggle(\"rotate-90\"); // Rotate arrow for better UX\r\n+    const requests = await resp.json();\r\n+    \r\n+    tableBody.innerHTML = '';\r\n+    countElement.textContent = requests.length;\r\n+\r\n+    if (requests.length === 0) {\r\n+      noRequestsMsg.classList.remove('hidden');\r\n+    } else {\r\n+      noRequestsMsg.classList.add('hidden');\r\n+      requests.forEach(request => {\r\n+        const row = tableBody.insertRow();\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+\r\n+        const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+        const requestId = request.id || request.RequestID; \r\n+\r\n+        row.innerHTML = `\r\n+          <td class=\"px-4 py-3\">${requestId}</td>\r\n+          <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+          <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+          <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+            <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+              Approve\r\n+            </button>\r\n+            <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+              Reject\r\n+            </button>\r\n+            <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+              Delete\r\n+            </button>\r\n+          </td>\r\n+        `;\r\n+      });\r\n+      \r\n+      // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+      tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+        });\r\n+      });\r\n+      tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+        });\r\n+      });\r\n+      tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+        });\r\n+      });\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Error loading pending requests:\", error);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    displayMessage(\"Failed to load pending requests from API.\", true);\r\n+  }\r\n }\r\n \r\n-// =========================================================\r\n-// DASHBOARD METRICS & CHARTING\r\n-// =========================================================\r\n+/**\r\n+* Fetches and renders approved residents from the backend API.\r\n+*/\r\n+async function loadApprovedResidents() {\r\n+  const tableBody = document.getElementById('residentsTableBody');\r\n+  const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+  \r\n+  if (!tableBody || !noResidentsMsg) return;\r\n \r\n-/**\r\n- * Placeholder function to fetch and update dashboard metrics (KPIs).\r\n- */\r\n-async function loadDashboardMetrics() {\r\n-    // --- Mock Data Simulation ---\r\n-    // In a real app, you would fetch these from endpoints like:\r\n-    // fetch(`${API_HOST}/api/admin/metrics`, { headers: { 'Authorization': `Bearer ${token}` }})\r\n+  // Show loading state\r\n+  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n     \r\n-    const mockMetrics = {\r\n-        totalResidents: 752,\r\n-        pendingPayments: 14,\r\n-        compliancePct: 95,\r\n-        overrideCount: 3,\r\n-    };\r\n+    const residents = await resp.json();\r\n \r\n-    // Update the DOM elements with the mock data\r\n-    document.getElementById(\"totalResidents\").textContent = mockMetrics.totalResidents;\r\n-    document.getElementById(\"pendingPayments\").textContent = mockMetrics.pendingPayments;\r\n-    document.getElementById(\"compliancePct\").textContent = `${mockMetrics.compliancePct}%`;\r\n-    document.getElementById(\"overrideCount\").textContent = mockMetrics.overrideCount;\r\n+    tableBody.innerHTML = '';\r\n+    \r\n+    if (residents.length === 0) {\r\n+      noResidentsMsg.classList.remove('hidden');\r\n+    } else {\r\n+      noResidentsMsg.classList.add('hidden');\r\n+      residents.forEach(resident => {\r\n+        const row = tableBody.insertRow();\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.innerHTML = `\r\n+          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+        `;\r\n+      });\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Error loading approved residents:\", error);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    displayMessage(\"Failed to load approved residents from API.\", true);\r\n+  }\r\n }\r\n \r\n /**\r\n- * Renders the Chart.js graph for access attempts, loading data from API or using mock data.\r\n- */\r\n-async function loadAndRenderAccessChart() {\r\n-    const ctx = document.getElementById(\"accessChart\");\r\n-    if (!ctx) return; // Ensure the canvas exists\r\n+* Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+*/\r\n+function attachMembershipListeners() {\r\n+  // Attach listener for the Sync button\r\n+  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+ \r\n+  // Attach listener for Clear Filters button\r\n+  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+    // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+    document.getElementById('requestIdFilter').value = \"\";\r\n+    document.getElementById('residentFilter').value = \"\";\r\n+    displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+  });\r\n+}\r\n \r\n-    // 1. Define Mock Data (Fallback)\r\n-    const getMockChartData = () => ({\r\n-        labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10', 'Day 11', 'Day 12', 'Day 13', 'Day 14'],\r\n-        successful: [350, 410, 390, 450, 480, 520, 500, 550, 530, 600, 580, 620, 650, 680],\r\n-        denied: [15, 12, 20, 10, 18, 5, 25, 17, 10, 8, 22, 11, 14, 9]\r\n+\r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n+// ====================================================================\r\n+\r\n+async function loadDashboardSummary() {\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+      headers: { \"Authorization\": `Bearer ${token}` }\r\n     });\r\n+    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    const data = await res.json();\r\n \r\n-    let chartData = getMockChartData();\r\n+    safeUpdate(\"totalResidents\", data.residents || 0);\r\n+    safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+    safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+    safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n-    // 2. Attempt to Fetch Real Data\r\n+  } catch (err) {\r\n+    console.error(\"Error loading summary:\", err);\r\n+  }\r\n+}\r\n+\r\n+async function loadAccessChart() {\r\n     try {\r\n-        // Using a more generalized API endpoint guess, as the user's original one failed with 404\r\n-        const apiUrl = `${API_HOST}/api/dashboard/access-chart-data`; \r\n-        const response = await fetch(apiUrl, {\r\n-            headers: { 'Authorization': `Bearer ${token}` }\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n         });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n+\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        // Destroy existing chart instance if it exists before creating a new one\r\n+        if (window.accessChartInstance) {\r\n+            window.accessChartInstance.destroy();\r\n+        }\r\n         \r\n-        if (response.ok) {\r\n-            const realData = await response.json();\r\n-            // Assuming realData structure is { labels: [], successful: [], denied: [] }\r\n-            chartData = realData;\r\n+        window.accessChartInstance = new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading chart:\", err);\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+* Fetches and renders payments records.\r\n+*/\r\n+async function loadPaymentsRecords() {\r\n+  const tableBody = document.getElementById('paymentsTableBody');\r\n+  if (!tableBody) return;\r\n+\r\n+  tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+ \r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+   \r\n+    const records = await resp.json();\r\n+   \r\n+    tableBody.innerHTML = '';\r\n+\r\n+    if (records.length === 0) {\r\n+      tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+    } else {\r\n+      records.forEach(record => {\r\n+        const row = tableBody.insertRow();\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.innerHTML = `\r\n+          <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n+          <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+          <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n+        `;\r\n+      });\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Error loading payments records:\", error);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    displayMessage(\"Failed to load payments records from API.\", true);\r\n+  }\r\n+}\r\n+\r\n+/**\r\n+* Attaches event listeners for payments-specific elements.\r\n+*/\r\n+function attachPaymentsListeners() {\r\n+  // Add any payments-specific listeners here\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 👥 RESIDENTS LOGIC (residents.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+* Fetches and renders all resident details.\r\n+*/\r\n+async function loadAllResidents() {\r\n+  const tableBody = document.getElementById('allResidentsTableBody');\r\n+  if (!tableBody) return;\r\n+\r\n+  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n+   \r\n+    const residents = await resp.json();\r\n+   \r\n+    tableBody.innerHTML = '';\r\n+   \r\n+    if (residents.length === 0) {\r\n+      tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n+    } else {\r\n+      residents.forEach(resident => {\r\n+        const row = tableBody.insertRow();\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.innerHTML = `\r\n+          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n+        `;\r\n+      });\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Error loading all residents:\", error);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    displayMessage(\"Failed to load all residents from API.\", true);\r\n+  }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n+// ====================================================================\r\n+\r\n+async function loadVisitorPassOverview() {\r\n+  const overviewSection = document.getElementById('visitorOverviewSection');\r\n+  if (!overviewSection) return;\r\n+\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    const data = await res.json();\r\n+   \r\n+    // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+    safeUpdate(\"todayVisitors\", data.today || 0);\r\n+    safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+    safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+   \r\n+  } catch (err) {\r\n+    console.error(\"Error loading visitor overview:\", err);\r\n+  }\r\n+}\r\n+\r\n+async function loadPendingVisitorApprovals() {\r\n+    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+    \r\n+    // Implementation details would be similar to loadPendingRequests()\r\n+}\r\n+\r\n+function attachVisitorListeners() {\r\n+  // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+  // Placeholder implementation\r\n+    const reportsContainer = document.getElementById('reportsContainer');\r\n+    if (!reportsContainer) return;\r\n+    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    const data = await res.json();\r\n+        \r\n+        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n+        // For simplicity, we just display a success message:\r\n+        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n+\r\n+  } catch (err) {\r\n+    console.error(\"Error loading reports data:\", err);\r\n+        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+  }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+  const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    if (!logTableBody) return;\r\n+\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+        const logs = await resp.json();\r\n+\r\n+        logTableBody.innerHTML = '';\r\n+        if (logs.length === 0) {\r\n+            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n         } else {\r\n-            console.warn(`Failed to fetch chart data (Status: ${response.status}). Using mock data.`);\r\n-            // chartData remains mock data\r\n+            // Populate table rows with logs\r\n         }\r\n-\r\n     } catch (error) {\r\n-        // This catches network errors or JSON parsing failures\r\n-        console.error(\"Error fetching chart data. Using mock data.\", error);\r\n-        // chartData remains mock data\r\n+        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n     }\r\n-    \r\n-    // 3. Render the Chart\r\n-    new Chart(ctx, {\r\n-        type: 'line',\r\n-        data: {\r\n-            labels: chartData.labels,\r\n-            datasets: [{\r\n-                label: 'Successful Access Attempts',\r\n-                data: chartData.successful,\r\n-                borderColor: '#3b82f6', // blue-500\r\n-                backgroundColor: 'rgba(59, 130, 246, 0.1)',\r\n-                fill: true,\r\n-                tension: 0.4,\r\n-                pointRadius: 3\r\n-            },\r\n-            {\r\n-                label: 'Denied Access Attempts',\r\n-                data: chartData.denied,\r\n-                borderColor: '#ef4444', // red-500\r\n-                backgroundColor: 'rgba(239, 68, 68, 0.1)',\r\n-                fill: false,\r\n-                tension: 0.4,\r\n-                pointRadius: 3\r\n-            }]\r\n-        },\r\n-        options: {\r\n-            responsive: true,\r\n-            maintainAspectRatio: false,\r\n-            scales: {\r\n-                y: {\r\n-                    beginAtZero: true,\r\n-                    title: {\r\n-                        display: true,\r\n-                        text: 'Number of Attempts'\r\n-                    }\r\n-                }\r\n-            },\r\n-            plugins: {\r\n-                legend: {\r\n-                    position: 'top',\r\n-                },\r\n-                tooltip: {\r\n-                    mode: 'index',\r\n-                    intersect: false,\r\n-                }\r\n-            }\r\n+}\r\n+\r\n+function attachOverrideListeners() {\r\n+  // Attach listener for the 'Perform Manual Override' button\r\n+  document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+        \r\n+        try {\r\n+            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n+                method: 'POST',\r\n+                headers: getAuthHeaders(),\r\n+                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n+            });\r\n+            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+\r\n+            displayMessage(\"Manual override successful!\", false);\r\n+            await loadManualOverrides(); // Reload logs\r\n+\r\n+        } catch (e) {\r\n+            displayMessage(`Manual override failed: ${e.message}`, true);\r\n         }\r\n-    });\r\n+  });\r\n }\r\n \r\n-// =========================================================\r\n-// AUTHENTICATION\r\n-// =========================================================\r\n \r\n-/**\r\n- * Handles the user logout action.\r\n- */\r\n-function handleLogout() {\r\n-    localStorage.removeItem(\"adminToken\");\r\n-    alert(\"Logged out successfully.\");\r\n-    // In a real app, this would redirect to the login page\r\n-    // window.location.href = '/login.html'; \r\n-}\n+// ====================================================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n+// ====================================================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n+\r\n+async function loadPageIntoMainContent(url) {\r\n+  // Show a loading state instantly\r\n+  mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+\r\n+  try {\r\n+    const res = await fetch(url);\r\n+    if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+    const html = await res.text();\r\n+    mainContentArea.innerHTML = html; // Inject HTML first\r\n+\r\n+    // 🟢 Execute data loading functions based on the page loaded\r\n+    if (url.includes(\"dashboardoverview.html\")) {\r\n+      await loadDashboardSummary();\r\n+      await loadAccessChart();\r\n+    }\r\n+   \r\n+    // --- MEMBERSHIP PAGES ---\r\n+    else if (url.includes(\"membershiprecords.html\")) {\r\n+      // Approved Residents\r\n+      attachMembershipListeners();\r\n+      await loadApprovedResidents();\r\n+    } else if (url.includes(\"membership.html\")) {\r\n+      // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n+      attachMembershipListeners();\r\n+      await loadPendingRequests();\r\n+    }\r\n+   \r\n+    // --- PAYMENTS RECORDS ---\r\n+    else if (url.includes(\"payments.html\")) {\r\n+      attachPaymentsListeners();\r\n+      await loadPaymentsRecords();\r\n+    }\r\n+   \r\n+    // --- RESIDENTS ---\r\n+    else if (url.includes(\"residents.html\")) {\r\n+      await loadAllResidents();\r\n+    }\r\n+   \r\n+    // --- VISITORS MANAGEMENT ---\r\n+    else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+      attachVisitorListeners();\r\n+      // Load data relevant to the main visitor pages\r\n+      await loadVisitorPassOverview();\r\n+      await loadPendingVisitorApprovals();\r\n+    }\r\n+   \r\n+    // --- CHARTS AND REPORTS ---\r\n+    else if (url.includes(\"chartsandreports.html\")) {\r\n+      await loadReportsData();\r\n+    }\r\n+   \r\n+    // --- MANUAL OVERRIDES ---\r\n+    else if (url.includes(\"manualoverride.html\")) {\r\n+      attachOverrideListeners();\r\n+      await loadManualOverrides();\r\n+    }\r\n+  } catch (err) {\r\n+    console.error(\"Error loading page:\", err);\r\n+    mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+  }\r\n+}\r\n+\r\n+// ... (existing sidebar button loop and visitor toggle logic)\r\n+\r\n+sidebarButtons.forEach(btn => {\r\n+  btn.addEventListener(\"click\", async () => {\r\n+    sidebarButtons.forEach(b => {\r\n+      b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+      // Also ensure sub-menu items are correctly reset if needed\r\n+      if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n+            \r\n+            // Re-apply specific default styles for sub-menu items if needed\r\n+            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n+                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            }\r\n+    });\r\n+   \r\n+    btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+\r\n+    const page = btn.dataset.target;\r\n+    if (page) loadPageIntoMainContent(page);\r\n+  });\r\n+});\r\n+\r\n+\r\n+// ================================\r\n+// MISC UI TOGGLES\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+  visitorSubMenu?.classList.toggle(\"hidden\");\r\n+  visitorArrow?.classList.toggle(\"rotate-90\");\r\n+});\r\n+\r\n+// ================================\r\n+// INITIALIZATION ON PAGE LOAD\r\n+// ================================\r\n+\r\n+document.addEventListener('DOMContentLoaded', () => {\r\n+  // Load the initial dashboard view when the admin page first loads\r\n+  loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+});\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763879515387,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -653,8 +653,24 @@\n             displayMessage(`Manual override failed: ${e.message}`, true);\r\n         }\r\n   });\r\n }\r\n+// Example loader\r\n+document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n+    btn.addEventListener('click', async () => {\r\n+        const target = btn.getAttribute('data-target');\r\n+        const contentDiv = document.getElementById('dynamic-section-content');\r\n+        \r\n+        try {\r\n+            const res = await fetch(target);\r\n+            const html = await res.text();\r\n+            contentDiv.innerHTML = html;\r\n+        } catch (err) {\r\n+            contentDiv.innerHTML = '<p class=\"text-red-500\">Error loading content.</p>';\r\n+            console.error(err);\r\n+        }\r\n+    });\r\n+});\r\n \r\n \r\n // ====================================================================\r\n // 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n"
                },
                {
                    "date": 1763879580442,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -653,22 +653,21 @@\n             displayMessage(`Manual override failed: ${e.message}`, true);\r\n         }\r\n   });\r\n }\r\n-// Example loader\r\n document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n     btn.addEventListener('click', async () => {\r\n+        // Remove active styling from all\r\n+        document.querySelectorAll('.sidebarBtn').forEach(b => b.classList.remove('bg-blue-600', 'shadow-inner'));\r\n+        \r\n+        // Add active styling to current\r\n+        btn.classList.add('bg-blue-600', 'shadow-inner');\r\n+        \r\n+        // Load content\r\n         const target = btn.getAttribute('data-target');\r\n         const contentDiv = document.getElementById('dynamic-section-content');\r\n-        \r\n-        try {\r\n-            const res = await fetch(target);\r\n-            const html = await res.text();\r\n-            contentDiv.innerHTML = html;\r\n-        } catch (err) {\r\n-            contentDiv.innerHTML = '<p class=\"text-red-500\">Error loading content.</p>';\r\n-            console.error(err);\r\n-        }\r\n+        const res = await fetch(target);\r\n+        contentDiv.innerHTML = await res.text();\r\n     });\r\n });\r\n \r\n \r\n"
                },
                {
                    "date": 1763880555141,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,13 @@\n // adminsdashboard.js\r\n-// This file now includes ALL necessary data loading logic (including Membership)\r\n-// to handle dynamic page loading in the Admin Dashboard.\r\n+// This file includes ALL necessary data loading logic and now supports\r\n+// a nested Security Dashboard sub-sidebar (Option B).\r\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-const API_HOST = \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"accessToken\"); \r\n+const API_HOST = \"http://localhost:4050\";\r\n+const token = localStorage.getItem(\"accessToken\");\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n@@ -21,256 +21,223 @@\n   APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n   APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n   REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n   DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n- \r\n+\r\n   // General Admin Endpoints\r\n   PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n   ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n   VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n   PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n   REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n   MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n   MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+\r\n+  // Security endpoints (example names - adjust if your backend differs)\r\n+  SECURITY_OVERVIEW: `${API_HOST}/api/security/overview`,\r\n+  SECURITY_GUARDS: `${API_HOST}/api/security/guards`,\r\n+  SECURITY_INCIDENTS: `${API_HOST}/api/security/incidents`,\r\n+  SECURITY_ACCESSLOGS: `${API_HOST}/api/security/accesslogs`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n   localStorage.removeItem(\"accessToken\");\r\n   window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n // UTILITIES AND HELPERS\r\n // ================================\r\n-\r\n-/**\r\n-* Creates and returns the standard headers needed for authenticated API calls.\r\n-*/\r\n function getAuthHeaders() {\r\n   return {\r\n-    'Content-Type': 'application/json',\r\n-    'Authorization': `Bearer ${token}`\r\n+    \"Content-Type\": \"application/json\",\r\n+    Authorization: `Bearer ${token}`,\r\n   };\r\n }\r\n \r\n-/**\r\n-* Handles error display in a non-alert manner.\r\n-*/\r\n function displayMessage(message, isError = false) {\r\n-  const msgElement = document.getElementById('msg');\r\n+  const msgElement = document.getElementById(\"msg\");\r\n   if (msgElement) {\r\n     msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-   \r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n+      isError ? \"bg-red-100 text-red-800\" : \"bg-green-100 text-green-800\"\r\n+    }`;\r\n+\r\n     setTimeout(() => {\r\n-      msgElement.textContent = '';\r\n-      msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+      msgElement.textContent = \"\";\r\n+      msgElement.className = \"text-sm text-gray-700 mb-3\";\r\n     }, 5000);\r\n+  } else {\r\n+    // fallback to console if msg element not present\r\n+    console[isError ? \"error\" : \"log\"](message);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Formats a timestamp (string or number) into a readable date string.\r\n-*/\r\n function formatTimestamp(timestamp) {\r\n   try {\r\n-    if (!timestamp) return 'N/A';\r\n+    if (!timestamp) return \"N/A\";\r\n     return new Date(timestamp).toLocaleString();\r\n   } catch (e) {\r\n-    return 'N/A';\r\n+    return \"N/A\";\r\n   }\r\n }\r\n \r\n-/**\r\n-* Safely updates a DOM element's text content.\r\n-*/\r\n-const safeUpdate = (id, value, suffix = '') => {\r\n+const safeUpdate = (id, value, suffix = \"\") => {\r\n   const element = document.getElementById(id);\r\n   if (element) {\r\n     element.textContent = value + suffix;\r\n   }\r\n };\r\n \r\n+// Small helper: fetch text content and return string, with error handling\r\n+async function fetchText(url) {\r\n+  const res = await fetch(url, { headers: getAuthHeaders() });\r\n+  if (!res.ok) throw new Error(`Failed to fetch ${url} (${res.status})`);\r\n+  return await res.text();\r\n+}\r\n \r\n-// ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n-// ====================================================================\r\n+// ================================\r\n+// 🟢 MEMBERSHIP / PAYMENTS / RESIDENTS / VISITORS / REPORTS etc.\r\n+// (All your earlier functions are preserved — truncated comment header)\r\n+// ================================\r\n \r\n-/**\r\n-* Sends an approval request to the backend API.\r\n-*/\r\n+// --- Membership functions (unchanged) ---\r\n async function handleApproveClick(requestId) {\r\n-  safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-\r\n+  safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-      method: 'PUT',\r\n+      method: \"PUT\",\r\n       headers: getAuthHeaders(),\r\n     });\r\n-\r\n     if (!resp.ok) {\r\n       const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n       throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n     }\r\n-    \r\n-    safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+    safeUpdate(\"actionText\", `Approved Request ${requestId}`);\r\n     displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-    \r\n-    // Reload data after a successful action\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-\r\n   } catch (e) {\r\n     console.error(\"Approval Operation Failed:\", e);\r\n     displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Sends a rejection request to the backend API.\r\n-*/\r\n async function handleRejectClick(requestId) {\r\n-  safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+  safeUpdate(\"actionText\", `Processing Rejection for ${requestId}...`);\r\n   if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n-\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-      method: 'PUT', \r\n+      method: \"PUT\",\r\n       headers: getAuthHeaders(),\r\n     });\r\n-\r\n     if (!resp.ok) {\r\n       const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n       throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n     }\r\n-    \r\n-    safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+    safeUpdate(\"actionText\", `Rejected Request ${requestId}`);\r\n     displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-    \r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-\r\n   } catch (e) {\r\n     console.error(\"Rejection Operation Failed:\", e);\r\n     displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Sends a deletion request to the backend API.\r\n-*/\r\n async function handleDeleteClick(requestId) {\r\n-  safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+  safeUpdate(\"actionText\", `Processing Deletion for ${requestId}...`);\r\n   if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-      method: 'DELETE', \r\n+      method: \"DELETE\",\r\n       headers: getAuthHeaders(),\r\n     });\r\n-\r\n     if (!resp.ok) {\r\n       const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n       throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n     }\r\n-    \r\n-    safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+    safeUpdate(\"actionText\", `Deleted Request ${requestId}`);\r\n     displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-    \r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-\r\n   } catch (e) {\r\n     console.error(\"Deletion Operation Failed:\", e);\r\n     displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Executes a real API call to trigger server-side data synchronization.\r\n-*/\r\n async function handleSyncClick(event) {\r\n   const btn = event.currentTarget;\r\n   const originalText = btn.textContent;\r\n   const originalClasses = btn.className;\r\n-\r\n-  // 1. Set Loading State\r\n   btn.disabled = true;\r\n-  btn.textContent = 'Syncing...';\r\n-  btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n-\r\n+  btn.textContent = \"Syncing...\";\r\n+  btn.className =\r\n+    \"bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]\";\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.SYNC, { \r\n-      method: 'POST',\r\n+    const resp = await fetch(ENDPOINTS.SYNC, {\r\n+      method: \"POST\",\r\n       headers: getAuthHeaders(),\r\n     });\r\n-\r\n     if (!resp.ok) {\r\n       const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n       throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n     }\r\n-\r\n-    // 2. Set Success State\r\n-    btn.textContent = 'Sync Complete! ✔️';\r\n-    btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+    btn.textContent = \"Sync Complete! ✔️\";\r\n+    btn.className =\r\n+      \"bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]\";\r\n     displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-    // Reload data after a successful sync\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-    \r\n   } catch (err) {\r\n-    // 3. Set Failure State\r\n     console.error(\"Synchronization Error:\", err.message);\r\n-    btn.textContent = 'Sync Failed ❌';\r\n-    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+    btn.textContent = \"Sync Failed ❌\";\r\n+    btn.className =\r\n+      \"bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]\";\r\n     displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n   } finally {\r\n-    // 4. Reset Button State after a short delay\r\n     setTimeout(() => {\r\n       btn.disabled = false;\r\n       btn.textContent = originalText;\r\n       btn.className = originalClasses;\r\n     }, 3000);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Fetches and renders pending membership requests from the backend API.\r\n-*/\r\n+// --- loadPendingRequests & loadApprovedResidents (unchanged) ---\r\n async function loadPendingRequests() {\r\n-  const tableBody = document.getElementById('membershipTableBody');\r\n-  const countElement = document.getElementById('membershipCount');\r\n-  const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-  \r\n+  const tableBody = document.getElementById(\"membershipTableBody\");\r\n+  const countElement = document.getElementById(\"membershipCount\");\r\n+  const noRequestsMsg = document.getElementById(\"noPendingRequests\");\r\n+\r\n   if (!tableBody || !countElement || !noRequestsMsg) return;\r\n \r\n-  // Show loading state\r\n-  tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-  \r\n+  tableBody.innerHTML =\r\n+    '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-    \r\n+\r\n     const requests = await resp.json();\r\n-    \r\n-    tableBody.innerHTML = '';\r\n+\r\n+    tableBody.innerHTML = \"\";\r\n     countElement.textContent = requests.length;\r\n \r\n     if (requests.length === 0) {\r\n-      noRequestsMsg.classList.remove('hidden');\r\n+      noRequestsMsg.classList.remove(\"hidden\");\r\n     } else {\r\n-      noRequestsMsg.classList.add('hidden');\r\n-      requests.forEach(request => {\r\n+      noRequestsMsg.classList.add(\"hidden\");\r\n+      requests.forEach((request) => {\r\n         const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.className = \"hover:bg-blue-50 transition-colors duration-100\";\r\n \r\n         const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-        const requestId = request.id || request.RequestID; \r\n+        const requestId = request.id || request.RequestID;\r\n \r\n         row.innerHTML = `\r\n           <td class=\"px-4 py-3\">${requestId}</td>\r\n           <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n@@ -294,184 +261,175 @@\n             </button>\r\n           </td>\r\n         `;\r\n       });\r\n-      \r\n-      // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-      tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+\r\n+      // Attach listeners\r\n+      tableBody.querySelectorAll(\".approve-btn\").forEach((button) => {\r\n+        button.addEventListener(\"click\", (e) => {\r\n+          handleApproveClick(e.target.getAttribute(\"data-request-id\"));\r\n         });\r\n       });\r\n-      tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+      tableBody.querySelectorAll(\".reject-btn\").forEach((button) => {\r\n+        button.addEventListener(\"click\", (e) => {\r\n+          handleRejectClick(e.target.getAttribute(\"data-request-id\"));\r\n         });\r\n       });\r\n-      tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+      tableBody.querySelectorAll(\".delete-btn\").forEach((button) => {\r\n+        button.addEventListener(\"click\", (e) => {\r\n+          handleDeleteClick(e.target.getAttribute(\"data-request-id\"));\r\n         });\r\n       });\r\n     }\r\n   } catch (error) {\r\n     console.error(\"Error loading pending requests:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    tableBody.innerHTML =\r\n+      '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n     displayMessage(\"Failed to load pending requests from API.\", true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Fetches and renders approved residents from the backend API.\r\n-*/\r\n async function loadApprovedResidents() {\r\n-  const tableBody = document.getElementById('residentsTableBody');\r\n-  const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-  \r\n+  const tableBody = document.getElementById(\"residentsTableBody\");\r\n+  const noResidentsMsg = document.getElementById(\"noApprovedResidents\");\r\n+\r\n   if (!tableBody || !noResidentsMsg) return;\r\n \r\n-  // Show loading state\r\n-  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+  tableBody.innerHTML =\r\n+    '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-    \r\n+\r\n     const residents = await resp.json();\r\n \r\n-    tableBody.innerHTML = '';\r\n-    \r\n+    tableBody.innerHTML = \"\";\r\n+\r\n     if (residents.length === 0) {\r\n-      noResidentsMsg.classList.remove('hidden');\r\n+      noResidentsMsg.classList.remove(\"hidden\");\r\n     } else {\r\n-      noResidentsMsg.classList.add('hidden');\r\n-      residents.forEach(resident => {\r\n+      noResidentsMsg.classList.add(\"hidden\");\r\n+      residents.forEach((resident) => {\r\n         const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.className = \"hover:bg-blue-50 transition-colors duration-100\";\r\n         row.innerHTML = `\r\n-          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || \"N/A\"}</td>\r\n+          <td class=\"px-4 py-3\">${resident.NationalID || \"N/A\"}</td>\r\n+          <td class=\"px-4 py-3\">${resident.PhoneNumber || \"N/A\"}</td>\r\n+          <td class=\"px-4 py-3\">${resident.Email || \"N/A\"}</td>\r\n+          <td class=\"px-4 py-3\">${resident.HouseNumber || \"N/A\"}</td>\r\n+          <td class=\"px-4 py-3\">${resident.CourtName || \"N/A\"}</td>\r\n+          <td class=\"px-4 py-3\">${resident.RoleName || \"N/A\"}</td>\r\n         `;\r\n       });\r\n     }\r\n   } catch (error) {\r\n     console.error(\"Error loading approved residents:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    tableBody.innerHTML =\r\n+      '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n     displayMessage(\"Failed to load approved residents from API.\", true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Attaches event listeners for membership-specific elements (Sync, Filters)\r\n-*/\r\n function attachMembershipListeners() {\r\n-  // Attach listener for the Sync button\r\n   document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n- \r\n-  // Attach listener for Clear Filters button\r\n+\r\n   document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-    // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n-    document.getElementById('requestIdFilter').value = \"\";\r\n-    document.getElementById('residentFilter').value = \"\";\r\n+    const el1 = document.getElementById(\"requestIdFilter\");\r\n+    const el2 = document.getElementById(\"residentFilter\");\r\n+    if (el1) el1.value = \"\";\r\n+    if (el2) el2.value = \"\";\r\n     displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n   });\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n-// ====================================================================\r\n-\r\n+// ================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC\r\n+// ================================\r\n async function loadDashboardSummary() {\r\n   try {\r\n     const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-      headers: { \"Authorization\": `Bearer ${token}` }\r\n+      headers: { Authorization: `Bearer ${token}` },\r\n     });\r\n     if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n     const data = await res.json();\r\n \r\n     safeUpdate(\"totalResidents\", data.residents || 0);\r\n     safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-    safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+    safeUpdate(\"compliancePct\", data.compliance || 0, \"%\");\r\n     safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n   } catch (err) {\r\n     console.error(\"Error loading summary:\", err);\r\n   }\r\n }\r\n \r\n async function loadAccessChart() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n+      headers: { Authorization: `Bearer ${token}` },\r\n+    });\r\n+    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    const data = await res.json();\r\n \r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n+    const accessChartElement = document.getElementById(\"accessChart\");\r\n+    if (!accessChartElement) return;\r\n \r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        // Destroy existing chart instance if it exists before creating a new one\r\n-        if (window.accessChartInstance) {\r\n-            window.accessChartInstance.destroy();\r\n-        }\r\n-        \r\n-        window.accessChartInstance = new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n+    const ctx = accessChartElement.getContext(\"2d\");\r\n+    if (window.accessChartInstance) {\r\n+      window.accessChartInstance.destroy();\r\n+    }\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n-    }\r\n+    window.accessChartInstance = new Chart(ctx, {\r\n+      type: \"line\",\r\n+      data: {\r\n+        labels: data.days || [],\r\n+        datasets: [\r\n+          {\r\n+            label: \"Access Attempts\",\r\n+            data: data.counts || [],\r\n+            borderWidth: 2,\r\n+            tension: 0.4,\r\n+            borderColor: \"#2563eb\",\r\n+            backgroundColor: \"rgba(37,99,235,0.2)\",\r\n+            fill: true,\r\n+          },\r\n+        ],\r\n+      },\r\n+      options: { responsive: true, maintainAspectRatio: false },\r\n+    });\r\n+  } catch (err) {\r\n+    console.error(\"Error loading chart:\", err);\r\n+  }\r\n }\r\n \r\n+// ================================\r\n+// PAYMENTS / RESIDENTS / VISITORS / REPORTS / MANUAL OVERRIDES\r\n+// (kept as-is from your original file; omitted extra comments here for brevity)\r\n+// ================================\r\n \r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n-* Fetches and renders payments records.\r\n-*/\r\n async function loadPaymentsRecords() {\r\n-  const tableBody = document.getElementById('paymentsTableBody');\r\n+  const tableBody = document.getElementById(\"paymentsTableBody\");\r\n   if (!tableBody) return;\r\n \r\n-  tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n- \r\n+  tableBody.innerHTML =\r\n+    '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-   \r\n+\r\n     const records = await resp.json();\r\n-   \r\n-    tableBody.innerHTML = '';\r\n \r\n+    tableBody.innerHTML = \"\";\r\n+\r\n     if (records.length === 0) {\r\n-      tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+      tableBody.innerHTML =\r\n+        '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n     } else {\r\n-      records.forEach(record => {\r\n+      records.forEach((record) => {\r\n         const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.className = \"hover:bg-blue-50 transition-colors duration-100\";\r\n         row.innerHTML = `\r\n           <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n           <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n           <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n@@ -483,48 +441,39 @@\n       });\r\n     }\r\n   } catch (error) {\r\n     console.error(\"Error loading payments records:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    tableBody.innerHTML =\r\n+      '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n     displayMessage(\"Failed to load payments records from API.\", true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Attaches event listeners for payments-specific elements.\r\n-*/\r\n function attachPaymentsListeners() {\r\n   // Add any payments-specific listeners here\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 👥 RESIDENTS LOGIC (residents.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n-* Fetches and renders all resident details.\r\n-*/\r\n async function loadAllResidents() {\r\n-  const tableBody = document.getElementById('allResidentsTableBody');\r\n+  const tableBody = document.getElementById(\"allResidentsTableBody\");\r\n   if (!tableBody) return;\r\n \r\n-  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+  tableBody.innerHTML =\r\n+    '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-   \r\n+\r\n     const residents = await resp.json();\r\n-   \r\n-    tableBody.innerHTML = '';\r\n-   \r\n+\r\n+    tableBody.innerHTML = \"\";\r\n+\r\n     if (residents.length === 0) {\r\n       tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n     } else {\r\n-      residents.forEach(resident => {\r\n+      residents.forEach((resident) => {\r\n         const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.className = \"hover:bg-blue-50 transition-colors duration-100\";\r\n         row.innerHTML = `\r\n           <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n           <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n           <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n@@ -536,145 +485,106 @@\n       });\r\n     }\r\n   } catch (error) {\r\n     console.error(\"Error loading all residents:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    tableBody.innerHTML =\r\n+      '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n     displayMessage(\"Failed to load all residents from API.\", true);\r\n   }\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n-// ====================================================================\r\n-\r\n+// Visitors\r\n async function loadVisitorPassOverview() {\r\n-  const overviewSection = document.getElementById('visitorOverviewSection');\r\n+  const overviewSection = document.getElementById(\"visitorOverviewSection\");\r\n   if (!overviewSection) return;\r\n \r\n   try {\r\n     const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n     if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n     const data = await res.json();\r\n-   \r\n-    // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+\r\n     safeUpdate(\"todayVisitors\", data.today || 0);\r\n     safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n     safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-   \r\n   } catch (err) {\r\n     console.error(\"Error loading visitor overview:\", err);\r\n   }\r\n }\r\n \r\n async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n-    if (!tableBody) return;\r\n+  const tableBody = document.getElementById(\"visitorRequestsTableBody\");\r\n+  if (!tableBody) return;\r\n \r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n-    \r\n-    // Implementation details would be similar to loadPendingRequests()\r\n+  tableBody.innerHTML =\r\n+    '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n }\r\n \r\n function attachVisitorListeners() {\r\n   // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n-// ====================================================================\r\n-\r\n async function loadReportsData() {\r\n-  // Placeholder implementation\r\n-    const reportsContainer = document.getElementById('reportsContainer');\r\n-    if (!reportsContainer) return;\r\n-    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+  const reportsContainer = document.getElementById(\"reportsContainer\");\r\n+  if (!reportsContainer) return;\r\n+  reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n \r\n   try {\r\n     const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n     if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n     const data = await res.json();\r\n-        \r\n-        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n-        // For simplicity, we just display a success message:\r\n-        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n \r\n+    reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n   } catch (err) {\r\n     console.error(\"Error loading reports data:\", err);\r\n-        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+    reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n   }\r\n }\r\n \r\n+// Manual overrides\r\n+async function loadManualOverrides() {\r\n+  const logTableBody = document.getElementById(\"overrideLogTableBody\");\r\n+  if (!logTableBody) return;\r\n \r\n-// ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n-// ====================================================================\r\n+  logTableBody.innerHTML =\r\n+    '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n \r\n-async function loadManualOverrides() {\r\n-  const logTableBody = document.getElementById('overrideLogTableBody');\r\n-    if (!logTableBody) return;\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+    const logs = await resp.json();\r\n \r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-        const logs = await resp.json();\r\n-\r\n-        logTableBody.innerHTML = '';\r\n-        if (logs.length === 0) {\r\n-            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n-        } else {\r\n-            // Populate table rows with logs\r\n-        }\r\n-    } catch (error) {\r\n-        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+    logTableBody.innerHTML = \"\";\r\n+    if (logs.length === 0) {\r\n+      logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+    } else {\r\n+      // Populate table rows with logs\r\n     }\r\n+  } catch (error) {\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+  }\r\n }\r\n \r\n function attachOverrideListeners() {\r\n-  // Attach listener for the 'Perform Manual Override' button\r\n   document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-        \r\n-        try {\r\n-            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n-                method: 'POST',\r\n-                headers: getAuthHeaders(),\r\n-                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n-            });\r\n-            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n-\r\n-            displayMessage(\"Manual override successful!\", false);\r\n-            await loadManualOverrides(); // Reload logs\r\n-\r\n-        } catch (e) {\r\n-            displayMessage(`Manual override failed: ${e.message}`, true);\r\n-        }\r\n+    if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+    try {\r\n+      const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, {\r\n+        method: \"POST\",\r\n+        headers: getAuthHeaders(),\r\n+        body: JSON.stringify({ action: \"open_gate\" }),\r\n+      });\r\n+      if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+      displayMessage(\"Manual override successful!\", false);\r\n+      await loadManualOverrides();\r\n+    } catch (e) {\r\n+      displayMessage(`Manual override failed: ${e.message}`, true);\r\n+    }\r\n   });\r\n }\r\n-document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n-    btn.addEventListener('click', async () => {\r\n-        // Remove active styling from all\r\n-        document.querySelectorAll('.sidebarBtn').forEach(b => b.classList.remove('bg-blue-600', 'shadow-inner'));\r\n-        \r\n-        // Add active styling to current\r\n-        btn.classList.add('bg-blue-600', 'shadow-inner');\r\n-        \r\n-        // Load content\r\n-        const target = btn.getAttribute('data-target');\r\n-        const contentDiv = document.getElementById('dynamic-section-content');\r\n-        const res = await fetch(target);\r\n-        contentDiv.innerHTML = await res.text();\r\n-    });\r\n-});\r\n \r\n-\r\n-// ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n-// ====================================================================\r\n+// ================================\r\n+// 🧭 SIDEBAR PAGE LOADING (MAIN)\r\n+// ================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n async function loadPageIntoMainContent(url) {\r\n@@ -686,89 +596,278 @@\n     if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n     const html = await res.text();\r\n     mainContentArea.innerHTML = html; // Inject HTML first\r\n \r\n-    // 🟢 Execute data loading functions based on the page loaded\r\n+    // Run page-specific initializers\r\n     if (url.includes(\"dashboardoverview.html\")) {\r\n       await loadDashboardSummary();\r\n       await loadAccessChart();\r\n-    }\r\n-   \r\n-    // --- MEMBERSHIP PAGES ---\r\n-    else if (url.includes(\"membershiprecords.html\")) {\r\n-      // Approved Residents\r\n+    } else if (url.includes(\"membershiprecords.html\")) {\r\n       attachMembershipListeners();\r\n       await loadApprovedResidents();\r\n     } else if (url.includes(\"membership.html\")) {\r\n-      // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n       attachMembershipListeners();\r\n       await loadPendingRequests();\r\n-    }\r\n-   \r\n-    // --- PAYMENTS RECORDS ---\r\n-    else if (url.includes(\"payments.html\")) {\r\n+    } else if (url.includes(\"payments.html\")) {\r\n       attachPaymentsListeners();\r\n       await loadPaymentsRecords();\r\n-    }\r\n-   \r\n-    // --- RESIDENTS ---\r\n-    else if (url.includes(\"residents.html\")) {\r\n+    } else if (url.includes(\"residents.html\")) {\r\n       await loadAllResidents();\r\n-    }\r\n-   \r\n-    // --- VISITORS MANAGEMENT ---\r\n-    else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+    } else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n       attachVisitorListeners();\r\n-      // Load data relevant to the main visitor pages\r\n       await loadVisitorPassOverview();\r\n       await loadPendingVisitorApprovals();\r\n-    }\r\n-   \r\n-    // --- CHARTS AND REPORTS ---\r\n-    else if (url.includes(\"chartsandreports.html\")) {\r\n+    } else if (url.includes(\"chartsandreports.html\")) {\r\n       await loadReportsData();\r\n-    }\r\n-   \r\n-    // --- MANUAL OVERRIDES ---\r\n-    else if (url.includes(\"manualoverride.html\")) {\r\n+    } else if (url.includes(\"manualoverride.html\")) {\r\n       attachOverrideListeners();\r\n       await loadManualOverrides();\r\n     }\r\n+\r\n+    // --- NEW: Security Dashboard container loaded (top-level page) ---\r\n+    // If the security module was loaded, wire up its sub-sidebar and default subpage.\r\n+    if (url.includes(\"securitydashboards.html\")) {\r\n+      try {\r\n+        // Wait a tick for DOM to render the security module\r\n+        await Promise.resolve();\r\n+\r\n+        // Toggle button inside security page (if present) - this is local to the security module\r\n+        // NOTE: securitydashboards.html should include:\r\n+        // 1) a sub-sidebar with buttons that have class 'security-sub-btn' and data-targets pointing\r\n+        //    to the sub-pages (e.g. sections/securitydashboards/guardstatus.html)\r\n+        // 2) a content container with id 'security-main-content' where subpages will be injected.\r\n+        const securitySubMenu = document.getElementById(\"securitySubMenu\");\r\n+        const securityToggle = document.getElementById(\"securityDashboardToggle\");\r\n+        const securityArrow = document.getElementById(\"securityArrow\");\r\n+\r\n+        // If the admin-level security toggle exists in the global sidebar, we keep its behavior as well\r\n+        // (That toggle is part of the main sidebar; we still want it to expand/close on click.)\r\n+        // For the nested sub-sidebar inside the loaded page, we'll select sub-buttons by a class.\r\n+\r\n+        // Attach click handlers to sub-menu items INSIDE the loaded security page.\r\n+        // We expect the injected HTML to render buttons with class 'security-sub-btn'.\r\n+        const subButtons = mainContentArea.querySelectorAll(\".security-sub-btn\");\r\n+        subButtons.forEach((subBtn) => {\r\n+          subBtn.addEventListener(\"click\", async (e) => {\r\n+            // Clear active state on all security sub buttons\r\n+            subButtons.forEach((b) => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+            // Apply active to clicked\r\n+            subBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n+            const subPage = subBtn.dataset.target;\r\n+            if (subPage) await loadSecuritySubpage(subPage);\r\n+          });\r\n+        });\r\n+\r\n+        // If there's a default subpage (data-default on container or first subBtn), load it:\r\n+        const defaultBtn = mainContentArea.querySelector(\".security-sub-btn[data-default='true']\") || subButtons[0];\r\n+        if (defaultBtn) {\r\n+          // mark active visually then load\r\n+          defaultBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+          const defaultPage = defaultBtn.dataset.target;\r\n+          if (defaultPage) await loadSecuritySubpage(defaultPage);\r\n+        } else {\r\n+          // No sub-buttons found - nothing to load\r\n+        }\r\n+      } catch (secErr) {\r\n+        console.error(\"Error initializing security module:\", secErr);\r\n+      }\r\n+    }\r\n   } catch (err) {\r\n     console.error(\"Error loading page:\", err);\r\n     mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n   }\r\n }\r\n \r\n-// ... (existing sidebar button loop and visitor toggle logic)\r\n+// Helper: load internal security subpages into #security-main-content\r\n+async function loadSecuritySubpage(url) {\r\n+  const container = document.getElementById(\"security-main-content\");\r\n+  if (!container) {\r\n+    console.warn(\"Security subpage container #security-main-content not found.\");\r\n+    return;\r\n+  }\r\n \r\n-sidebarButtons.forEach(btn => {\r\n+  container.innerHTML = '<div class=\"text-center p-8 text-gray-500 italic\">Loading security content...</div>';\r\n+\r\n+  try {\r\n+    // We fetch subpage as text (subpage will be standalone fragment HTML)\r\n+    const res = await fetch(url, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(`Failed to load security subpage: ${res.status}`);\r\n+    const html = await res.text();\r\n+    container.innerHTML = html;\r\n+\r\n+    // Optionally wire up dynamic data for specific subpages (by url)\r\n+    if (url.includes(\"guardstatus.html\")) {\r\n+      // If guardstatus.html requires dynamic API data, call loadGuardStatus()\r\n+      await loadGuardStatus();\r\n+    } else if (url.includes(\"incidentreports.html\")) {\r\n+      await loadIncidentReports();\r\n+    } else if (url.includes(\"accesslogs.html\")) {\r\n+      await loadSecurityAccessLogs();\r\n+    }\r\n+  } catch (err) {\r\n+    console.error(\"Error loading security subpage:\", err);\r\n+    container.innerHTML = `<div class=\"p-4 text-red-600 font-semibold\">Failed to load security content.</div>`;\r\n+  }\r\n+}\r\n+\r\n+// ================================\r\n+// SECURITY MODULE: data loaders for sub-pages\r\n+// (these call your endpoints and populate elements within the subpage)\r\n+// ================================\r\n+async function loadGuardStatus() {\r\n+  // Example: expects the guardstatus.html fragment to have a container with id 'guardStatusContainer'\r\n+  const container = document.getElementById(\"guardStatusContainer\");\r\n+  if (!container) return;\r\n+\r\n+  container.innerHTML = '<p class=\"italic text-gray-500\">Loading guard status...</p>';\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.SECURITY_GUARDS, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(`Failed to fetch guard status (${res.status})`);\r\n+    const data = await res.json();\r\n+\r\n+    container.innerHTML = data.length\r\n+      ? data\r\n+          .map(\r\n+            (g) => `\r\n+        <div class=\"p-4 rounded-lg bg-white mb-2 shadow-sm flex justify-between items-center\">\r\n+          <div>\r\n+            <div class=\"font-semibold\">${g.name || \"Unknown\"}</div>\r\n+            <div class=\"text-sm text-gray-500\">${g.shift || \"N/A\"} • ${g.location || \"N/A\"}</div>\r\n+          </div>\r\n+          <div class=\"text-sm\">\r\n+            <span class=\"px-3 py-1 rounded-full ${g.status === \"active\" ? \"bg-green-100 text-green-800\" : \"bg-gray-100 text-gray-800\"}\">\r\n+              ${g.status || \"unknown\"}\r\n+            </span>\r\n+          </div>\r\n+        </div>\r\n+      `\r\n+          )\r\n+          .join(\"\")\r\n+      : '<p class=\"text-gray-600\">No guard records found.</p>';\r\n+  } catch (err) {\r\n+    console.error(\"Error loading guard status:\", err);\r\n+    container.innerHTML = `<p class=\"text-red-600\">Failed to load guard status.</p>`;\r\n+  }\r\n+}\r\n+\r\n+async function loadIncidentReports() {\r\n+  const container = document.getElementById(\"incidentReportsContainer\");\r\n+  if (!container) return;\r\n+  container.innerHTML = '<p class=\"italic text-gray-500\">Loading incidents...</p>';\r\n+\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.SECURITY_INCIDENTS, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(`Failed to fetch incidents (${res.status})`);\r\n+    const incidents = await res.json();\r\n+\r\n+    if (!incidents.length) {\r\n+      container.innerHTML = \"<p class='text-gray-600'>No incidents found.</p>\";\r\n+      return;\r\n+    }\r\n+\r\n+    container.innerHTML = incidents\r\n+      .map(\r\n+        (it) => `\r\n+      <div class=\"p-3 bg-white rounded-lg mb-3 shadow-sm\">\r\n+        <div class=\"flex justify-between items-start\">\r\n+          <div>\r\n+            <div class=\"font-semibold\">${it.title || \"Untitled\"}</div>\r\n+            <div class=\"text-xs text-gray-500\">${formatTimestamp(it.timestamp) || \"\"} • ${it.reportedBy || \"Unknown\"}</div>\r\n+            <p class=\"mt-2 text-sm text-gray-700\">${it.description || \"\"}</p>\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    `\r\n+      )\r\n+      .join(\"\");\r\n+  } catch (err) {\r\n+    console.error(\"Error loading incidents:\", err);\r\n+    container.innerHTML = `<p class=\"text-red-600\">Failed to load incidents.</p>`;\r\n+  }\r\n+}\r\n+\r\n+async function loadSecurityAccessLogs() {\r\n+  const container = document.getElementById(\"securityAccessLogsContainer\");\r\n+  if (!container) return;\r\n+  container.innerHTML = '<p class=\"italic text-gray-500\">Loading access logs...</p>';\r\n+\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.SECURITY_ACCESSLOGS, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(`Failed to fetch access logs (${res.status})`);\r\n+    const logs = await res.json();\r\n+\r\n+    if (!logs.length) {\r\n+      container.innerHTML = \"<p class='text-gray-600'>No access logs found.</p>\";\r\n+      return;\r\n+    }\r\n+\r\n+    container.innerHTML = `\r\n+      <div class=\"overflow-x-auto\">\r\n+        <table class=\"min-w-full bg-white rounded-lg\">\r\n+          <thead class=\"bg-gray-100 text-left\">\r\n+            <tr>\r\n+              <th class=\"px-4 py-2\">Timestamp</th>\r\n+              <th class=\"px-4 py-2\">Gate</th>\r\n+              <th class=\"px-4 py-2\">Resident/Visitor</th>\r\n+              <th class=\"px-4 py-2\">Status</th>\r\n+            </tr>\r\n+          </thead>\r\n+          <tbody>\r\n+            ${logs\r\n+              .map(\r\n+                (l) => `\r\n+              <tr class=\"border-t\">\r\n+                <td class=\"px-4 py-2 text-sm\">${formatTimestamp(l.timestamp)}</td>\r\n+                <td class=\"px-4 py-2 text-sm\">${l.gate || \"N/A\"}</td>\r\n+                <td class=\"px-4 py-2 text-sm\">${l.subject || \"N/A\"}</td>\r\n+                <td class=\"px-4 py-2 text-sm\">${l.status || \"N/A\"}</td>\r\n+              </tr>\r\n+            `\r\n+              )\r\n+              .join(\"\")}\r\n+          </tbody>\r\n+        </table>\r\n+      </div>\r\n+    `;\r\n+  } catch (err) {\r\n+    console.error(\"Error loading access logs:\", err);\r\n+    container.innerHTML = `<p class=\"text-red-600\">Failed to load access logs.</p>`;\r\n+  }\r\n+}\r\n+\r\n+// ================================\r\n+// UI: Sidebar interactions (main sidebar + visitor toggle + security sidebar toggle)\r\n+// ================================\r\n+function resetSidebarActiveStates() {\r\n+  document.querySelectorAll(\".sidebarBtn\").forEach((b) => {\r\n+    b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+    // revert submenu item defaults if inside visitor/security submenus\r\n+    if (b.closest(\"#visitorSubMenu\")) {\r\n+      b.classList.remove(\"bg-blue-600\");\r\n+      b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+    }\r\n+    if (b.closest(\"#securitySubMenu\")) {\r\n+      b.classList.remove(\"bg-blue-600\");\r\n+      b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+    }\r\n+  });\r\n+}\r\n+\r\n+// Attach a global listener to the sidebar main buttons (these are present in the main HTML)\r\n+sidebarButtons.forEach((btn) => {\r\n   btn.addEventListener(\"click\", async () => {\r\n-    sidebarButtons.forEach(b => {\r\n-      b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-      // Also ensure sub-menu items are correctly reset if needed\r\n-      if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n-            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n-            \r\n-            // Re-apply specific default styles for sub-menu items if needed\r\n-            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n-                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            }\r\n-    });\r\n-   \r\n+    resetSidebarActiveStates();\r\n+\r\n     btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+    btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n \r\n     const page = btn.dataset.target;\r\n-    if (page) loadPageIntoMainContent(page);\r\n+    if (page) await loadPageIntoMainContent(page);\r\n   });\r\n });\r\n \r\n-\r\n-// ================================\r\n-// MISC UI TOGGLES\r\n-// ================================\r\n+// Visitor toggle (main sidebar)\r\n const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n@@ -776,12 +875,22 @@\n   visitorSubMenu?.classList.toggle(\"hidden\");\r\n   visitorArrow?.classList.toggle(\"rotate-90\");\r\n });\r\n \r\n+// Security toggle in main sidebar (keeps the same behavior - expands the small submenu we added earlier in HTML)\r\n+const securityToggleMain = document.getElementById(\"securityDashboardToggle\");\r\n+const securitySubMenuMain = document.getElementById(\"securitySubMenu\");\r\n+const securityArrowMain = document.getElementById(\"securityArrow\");\r\n+\r\n+securityToggleMain?.addEventListener(\"click\", () => {\r\n+  // Expand/Collapse the small admin-level security sub-menu (only for quick links if any)\r\n+  securitySubMenuMain?.classList.toggle(\"hidden\");\r\n\\ No newline at end of file\n+  securityArrowMain?.classList.toggle(\"rotate-90\");\r\n+});\r\n+\r\n // ================================\r\n // INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n-\r\n-document.addEventListener('DOMContentLoaded', () => {\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n   // Load the initial dashboard view when the admin page first loads\r\n-  loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\n+  loadPageIntoMainContent(\"sections/dashboardoverview.html\");\r\n+});\r\n"
                },
                {
                    "date": 1763881836921,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,13 @@\n // adminsdashboard.js\r\n-// This file includes ALL necessary data loading logic and now supports\r\n-// a nested Security Dashboard sub-sidebar (Option B).\r\n+// This file now includes ALL necessary data loading logic (including Membership)\r\n+// to handle dynamic page loading in the Admin Dashboard.\r\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-const API_HOST = \"http://localhost:4050\";\r\n-const token = localStorage.getItem(\"accessToken\");\r\n+const API_HOST = \"http://localhost:4050\"; \r\n+const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n@@ -21,223 +21,256 @@\n   APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n   APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n   REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n   DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-\r\n+ \r\n   // General Admin Endpoints\r\n   PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n   ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n   VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n   PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n   REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n   MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n   MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-\r\n-  // Security endpoints (example names - adjust if your backend differs)\r\n-  SECURITY_OVERVIEW: `${API_HOST}/api/security/overview`,\r\n-  SECURITY_GUARDS: `${API_HOST}/api/security/guards`,\r\n-  SECURITY_INCIDENTS: `${API_HOST}/api/security/incidents`,\r\n-  SECURITY_ACCESSLOGS: `${API_HOST}/api/security/accesslogs`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n-document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n   localStorage.removeItem(\"accessToken\");\r\n   window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n // UTILITIES AND HELPERS\r\n // ================================\r\n+\r\n+/**\r\n+* Creates and returns the standard headers needed for authenticated API calls.\r\n+*/\r\n function getAuthHeaders() {\r\n   return {\r\n-    \"Content-Type\": \"application/json\",\r\n-    Authorization: `Bearer ${token}`,\r\n+    'Content-Type': 'application/json',\r\n+    'Authorization': `Bearer ${token}`\r\n   };\r\n }\r\n \r\n+/**\r\n+* Handles error display in a non-alert manner.\r\n+*/\r\n function displayMessage(message, isError = false) {\r\n-  const msgElement = document.getElementById(\"msg\");\r\n+  const msgElement = document.getElementById('msg');\r\n   if (msgElement) {\r\n     msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n-      isError ? \"bg-red-100 text-red-800\" : \"bg-green-100 text-green-800\"\r\n-    }`;\r\n-\r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+   \r\n     setTimeout(() => {\r\n-      msgElement.textContent = \"\";\r\n-      msgElement.className = \"text-sm text-gray-700 mb-3\";\r\n+      msgElement.textContent = '';\r\n+      msgElement.className = 'text-sm text-gray-700 mb-3';\r\n     }, 5000);\r\n-  } else {\r\n-    // fallback to console if msg element not present\r\n-    console[isError ? \"error\" : \"log\"](message);\r\n   }\r\n }\r\n \r\n+/**\r\n+* Formats a timestamp (string or number) into a readable date string.\r\n+*/\r\n function formatTimestamp(timestamp) {\r\n   try {\r\n-    if (!timestamp) return \"N/A\";\r\n+    if (!timestamp) return 'N/A';\r\n     return new Date(timestamp).toLocaleString();\r\n   } catch (e) {\r\n-    return \"N/A\";\r\n+    return 'N/A';\r\n   }\r\n }\r\n \r\n-const safeUpdate = (id, value, suffix = \"\") => {\r\n+/**\r\n+* Safely updates a DOM element's text content.\r\n+*/\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n   const element = document.getElementById(id);\r\n   if (element) {\r\n     element.textContent = value + suffix;\r\n   }\r\n };\r\n \r\n-// Small helper: fetch text content and return string, with error handling\r\n-async function fetchText(url) {\r\n-  const res = await fetch(url, { headers: getAuthHeaders() });\r\n-  if (!res.ok) throw new Error(`Failed to fetch ${url} (${res.status})`);\r\n-  return await res.text();\r\n-}\r\n \r\n-// ================================\r\n-// 🟢 MEMBERSHIP / PAYMENTS / RESIDENTS / VISITORS / REPORTS etc.\r\n-// (All your earlier functions are preserved — truncated comment header)\r\n-// ================================\r\n+// ====================================================================\r\n+// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n+// ====================================================================\r\n \r\n-// --- Membership functions (unchanged) ---\r\n+/**\r\n+* Sends an approval request to the backend API.\r\n+*/\r\n async function handleApproveClick(requestId) {\r\n-  safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n+  safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-      method: \"PUT\",\r\n+      method: 'PUT',\r\n       headers: getAuthHeaders(),\r\n     });\r\n+\r\n     if (!resp.ok) {\r\n       const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n       throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n     }\r\n-    safeUpdate(\"actionText\", `Approved Request ${requestId}`);\r\n+    \r\n+    safeUpdate('actionText', `Approved Request ${requestId}`);\r\n     displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+    \r\n+    // Reload data after a successful action\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n+\r\n   } catch (e) {\r\n     console.error(\"Approval Operation Failed:\", e);\r\n     displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n+/**\r\n+* Sends a rejection request to the backend API.\r\n+*/\r\n async function handleRejectClick(requestId) {\r\n-  safeUpdate(\"actionText\", `Processing Rejection for ${requestId}...`);\r\n+  safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n   if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-      method: \"PUT\",\r\n+      method: 'PUT', \r\n       headers: getAuthHeaders(),\r\n     });\r\n+\r\n     if (!resp.ok) {\r\n       const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n       throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n     }\r\n-    safeUpdate(\"actionText\", `Rejected Request ${requestId}`);\r\n+    \r\n+    safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n     displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+    \r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n+\r\n   } catch (e) {\r\n     console.error(\"Rejection Operation Failed:\", e);\r\n     displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n+/**\r\n+* Sends a deletion request to the backend API.\r\n+*/\r\n async function handleDeleteClick(requestId) {\r\n-  safeUpdate(\"actionText\", `Processing Deletion for ${requestId}...`);\r\n+  safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n   if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-      method: \"DELETE\",\r\n+      method: 'DELETE', \r\n       headers: getAuthHeaders(),\r\n     });\r\n+\r\n     if (!resp.ok) {\r\n       const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n       throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n     }\r\n-    safeUpdate(\"actionText\", `Deleted Request ${requestId}`);\r\n+    \r\n+    safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n     displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+    \r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n+\r\n   } catch (e) {\r\n     console.error(\"Deletion Operation Failed:\", e);\r\n     displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n+/**\r\n+* Executes a real API call to trigger server-side data synchronization.\r\n+*/\r\n async function handleSyncClick(event) {\r\n   const btn = event.currentTarget;\r\n   const originalText = btn.textContent;\r\n   const originalClasses = btn.className;\r\n+\r\n+  // 1. Set Loading State\r\n   btn.disabled = true;\r\n-  btn.textContent = \"Syncing...\";\r\n-  btn.className =\r\n-    \"bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]\";\r\n+  btn.textContent = 'Syncing...';\r\n+  btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.SYNC, {\r\n-      method: \"POST\",\r\n+    const resp = await fetch(ENDPOINTS.SYNC, { \r\n+      method: 'POST',\r\n       headers: getAuthHeaders(),\r\n     });\r\n+\r\n     if (!resp.ok) {\r\n       const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n       throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n     }\r\n-    btn.textContent = \"Sync Complete! ✔️\";\r\n-    btn.className =\r\n-      \"bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]\";\r\n+\r\n+    // 2. Set Success State\r\n+    btn.textContent = 'Sync Complete! ✔️';\r\n+    btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n     displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+    // Reload data after a successful sync\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n+    \r\n   } catch (err) {\r\n+    // 3. Set Failure State\r\n     console.error(\"Synchronization Error:\", err.message);\r\n-    btn.textContent = \"Sync Failed ❌\";\r\n-    btn.className =\r\n-      \"bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]\";\r\n+    btn.textContent = 'Sync Failed ❌';\r\n+    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n     displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n   } finally {\r\n+    // 4. Reset Button State after a short delay\r\n     setTimeout(() => {\r\n       btn.disabled = false;\r\n       btn.textContent = originalText;\r\n       btn.className = originalClasses;\r\n     }, 3000);\r\n   }\r\n }\r\n \r\n-// --- loadPendingRequests & loadApprovedResidents (unchanged) ---\r\n+/**\r\n+* Fetches and renders pending membership requests from the backend API.\r\n+*/\r\n async function loadPendingRequests() {\r\n-  const tableBody = document.getElementById(\"membershipTableBody\");\r\n-  const countElement = document.getElementById(\"membershipCount\");\r\n-  const noRequestsMsg = document.getElementById(\"noPendingRequests\");\r\n-\r\n+  const tableBody = document.getElementById('membershipTableBody');\r\n+  const countElement = document.getElementById('membershipCount');\r\n+  const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+  \r\n   if (!tableBody || !countElement || !noRequestsMsg) return;\r\n \r\n-  tableBody.innerHTML =\r\n-    '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-\r\n+  // Show loading state\r\n+  tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+  \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-\r\n+    \r\n     const requests = await resp.json();\r\n-\r\n-    tableBody.innerHTML = \"\";\r\n+    \r\n+    tableBody.innerHTML = '';\r\n     countElement.textContent = requests.length;\r\n \r\n     if (requests.length === 0) {\r\n-      noRequestsMsg.classList.remove(\"hidden\");\r\n+      noRequestsMsg.classList.remove('hidden');\r\n     } else {\r\n-      noRequestsMsg.classList.add(\"hidden\");\r\n-      requests.forEach((request) => {\r\n+      noRequestsMsg.classList.add('hidden');\r\n+      requests.forEach(request => {\r\n         const row = tableBody.insertRow();\r\n-        row.className = \"hover:bg-blue-50 transition-colors duration-100\";\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n \r\n         const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-        const requestId = request.id || request.RequestID;\r\n+        const requestId = request.id || request.RequestID; \r\n \r\n         row.innerHTML = `\r\n           <td class=\"px-4 py-3\">${requestId}</td>\r\n           <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n@@ -261,175 +294,184 @@\n             </button>\r\n           </td>\r\n         `;\r\n       });\r\n-\r\n-      // Attach listeners\r\n-      tableBody.querySelectorAll(\".approve-btn\").forEach((button) => {\r\n-        button.addEventListener(\"click\", (e) => {\r\n-          handleApproveClick(e.target.getAttribute(\"data-request-id\"));\r\n+      \r\n+      // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+      tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleApproveClick(e.target.getAttribute('data-request-id'));\r\n         });\r\n       });\r\n-      tableBody.querySelectorAll(\".reject-btn\").forEach((button) => {\r\n-        button.addEventListener(\"click\", (e) => {\r\n-          handleRejectClick(e.target.getAttribute(\"data-request-id\"));\r\n+      tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleRejectClick(e.target.getAttribute('data-request-id'));\r\n         });\r\n       });\r\n-      tableBody.querySelectorAll(\".delete-btn\").forEach((button) => {\r\n-        button.addEventListener(\"click\", (e) => {\r\n-          handleDeleteClick(e.target.getAttribute(\"data-request-id\"));\r\n+      tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n         });\r\n       });\r\n     }\r\n   } catch (error) {\r\n     console.error(\"Error loading pending requests:\", error);\r\n-    tableBody.innerHTML =\r\n-      '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n     displayMessage(\"Failed to load pending requests from API.\", true);\r\n   }\r\n }\r\n \r\n+/**\r\n+* Fetches and renders approved residents from the backend API.\r\n+*/\r\n async function loadApprovedResidents() {\r\n-  const tableBody = document.getElementById(\"residentsTableBody\");\r\n-  const noResidentsMsg = document.getElementById(\"noApprovedResidents\");\r\n-\r\n+  const tableBody = document.getElementById('residentsTableBody');\r\n+  const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+  \r\n   if (!tableBody || !noResidentsMsg) return;\r\n \r\n-  tableBody.innerHTML =\r\n-    '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+  // Show loading state\r\n+  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-\r\n+    \r\n     const residents = await resp.json();\r\n \r\n-    tableBody.innerHTML = \"\";\r\n-\r\n+    tableBody.innerHTML = '';\r\n+    \r\n     if (residents.length === 0) {\r\n-      noResidentsMsg.classList.remove(\"hidden\");\r\n+      noResidentsMsg.classList.remove('hidden');\r\n     } else {\r\n-      noResidentsMsg.classList.add(\"hidden\");\r\n-      residents.forEach((resident) => {\r\n+      noResidentsMsg.classList.add('hidden');\r\n+      residents.forEach(resident => {\r\n         const row = tableBody.insertRow();\r\n-        row.className = \"hover:bg-blue-50 transition-colors duration-100\";\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n         row.innerHTML = `\r\n-          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || \"N/A\"}</td>\r\n-          <td class=\"px-4 py-3\">${resident.NationalID || \"N/A\"}</td>\r\n-          <td class=\"px-4 py-3\">${resident.PhoneNumber || \"N/A\"}</td>\r\n-          <td class=\"px-4 py-3\">${resident.Email || \"N/A\"}</td>\r\n-          <td class=\"px-4 py-3\">${resident.HouseNumber || \"N/A\"}</td>\r\n-          <td class=\"px-4 py-3\">${resident.CourtName || \"N/A\"}</td>\r\n-          <td class=\"px-4 py-3\">${resident.RoleName || \"N/A\"}</td>\r\n+          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n         `;\r\n       });\r\n     }\r\n   } catch (error) {\r\n     console.error(\"Error loading approved residents:\", error);\r\n-    tableBody.innerHTML =\r\n-      '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n     displayMessage(\"Failed to load approved residents from API.\", true);\r\n   }\r\n }\r\n \r\n+/**\r\n+* Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+*/\r\n function attachMembershipListeners() {\r\n+  // Attach listener for the Sync button\r\n   document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-\r\n+ \r\n+  // Attach listener for Clear Filters button\r\n   document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-    const el1 = document.getElementById(\"requestIdFilter\");\r\n-    const el2 = document.getElementById(\"residentFilter\");\r\n-    if (el1) el1.value = \"\";\r\n-    if (el2) el2.value = \"\";\r\n+    // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+    document.getElementById('requestIdFilter').value = \"\";\r\n+    document.getElementById('residentFilter').value = \"\";\r\n     displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n   });\r\n }\r\n \r\n-// ================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC\r\n-// ================================\r\n+\r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n+// ====================================================================\r\n+\r\n async function loadDashboardSummary() {\r\n   try {\r\n     const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-      headers: { Authorization: `Bearer ${token}` },\r\n+      headers: { \"Authorization\": `Bearer ${token}` }\r\n     });\r\n     if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n     const data = await res.json();\r\n \r\n     safeUpdate(\"totalResidents\", data.residents || 0);\r\n     safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-    safeUpdate(\"compliancePct\", data.compliance || 0, \"%\");\r\n+    safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n     safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n   } catch (err) {\r\n     console.error(\"Error loading summary:\", err);\r\n   }\r\n }\r\n \r\n async function loadAccessChart() {\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-      headers: { Authorization: `Bearer ${token}` },\r\n-    });\r\n-    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-    const data = await res.json();\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-    const accessChartElement = document.getElementById(\"accessChart\");\r\n-    if (!accessChartElement) return;\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n \r\n-    const ctx = accessChartElement.getContext(\"2d\");\r\n-    if (window.accessChartInstance) {\r\n-      window.accessChartInstance.destroy();\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        // Destroy existing chart instance if it exists before creating a new one\r\n+        if (window.accessChartInstance) {\r\n+            window.accessChartInstance.destroy();\r\n+        }\r\n+        \r\n+        window.accessChartInstance = new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading chart:\", err);\r\n     }\r\n-\r\n-    window.accessChartInstance = new Chart(ctx, {\r\n-      type: \"line\",\r\n-      data: {\r\n-        labels: data.days || [],\r\n-        datasets: [\r\n-          {\r\n-            label: \"Access Attempts\",\r\n-            data: data.counts || [],\r\n-            borderWidth: 2,\r\n-            tension: 0.4,\r\n-            borderColor: \"#2563eb\",\r\n-            backgroundColor: \"rgba(37,99,235,0.2)\",\r\n-            fill: true,\r\n-          },\r\n-        ],\r\n-      },\r\n-      options: { responsive: true, maintainAspectRatio: false },\r\n-    });\r\n-  } catch (err) {\r\n-    console.error(\"Error loading chart:\", err);\r\n-  }\r\n }\r\n \r\n-// ================================\r\n-// PAYMENTS / RESIDENTS / VISITORS / REPORTS / MANUAL OVERRIDES\r\n-// (kept as-is from your original file; omitted extra comments here for brevity)\r\n-// ================================\r\n \r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+* Fetches and renders payments records.\r\n+*/\r\n async function loadPaymentsRecords() {\r\n-  const tableBody = document.getElementById(\"paymentsTableBody\");\r\n+  const tableBody = document.getElementById('paymentsTableBody');\r\n   if (!tableBody) return;\r\n \r\n-  tableBody.innerHTML =\r\n-    '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n-\r\n+  tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+ \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-\r\n+   \r\n     const records = await resp.json();\r\n+   \r\n+    tableBody.innerHTML = '';\r\n \r\n-    tableBody.innerHTML = \"\";\r\n-\r\n     if (records.length === 0) {\r\n-      tableBody.innerHTML =\r\n-        '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+      tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n     } else {\r\n-      records.forEach((record) => {\r\n+      records.forEach(record => {\r\n         const row = tableBody.insertRow();\r\n-        row.className = \"hover:bg-blue-50 transition-colors duration-100\";\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n         row.innerHTML = `\r\n           <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n           <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n           <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n@@ -441,39 +483,48 @@\n       });\r\n     }\r\n   } catch (error) {\r\n     console.error(\"Error loading payments records:\", error);\r\n-    tableBody.innerHTML =\r\n-      '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n     displayMessage(\"Failed to load payments records from API.\", true);\r\n   }\r\n }\r\n \r\n+/**\r\n+* Attaches event listeners for payments-specific elements.\r\n+*/\r\n function attachPaymentsListeners() {\r\n   // Add any payments-specific listeners here\r\n }\r\n \r\n+\r\n+// ====================================================================\r\n+// 👥 RESIDENTS LOGIC (residents.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+* Fetches and renders all resident details.\r\n+*/\r\n async function loadAllResidents() {\r\n-  const tableBody = document.getElementById(\"allResidentsTableBody\");\r\n+  const tableBody = document.getElementById('allResidentsTableBody');\r\n   if (!tableBody) return;\r\n \r\n-  tableBody.innerHTML =\r\n-    '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-\r\n+   \r\n     const residents = await resp.json();\r\n-\r\n-    tableBody.innerHTML = \"\";\r\n-\r\n+   \r\n+    tableBody.innerHTML = '';\r\n+   \r\n     if (residents.length === 0) {\r\n       tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n     } else {\r\n-      residents.forEach((resident) => {\r\n+      residents.forEach(resident => {\r\n         const row = tableBody.insertRow();\r\n-        row.className = \"hover:bg-blue-50 transition-colors duration-100\";\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n         row.innerHTML = `\r\n           <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n           <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n           <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n@@ -485,106 +536,145 @@\n       });\r\n     }\r\n   } catch (error) {\r\n     console.error(\"Error loading all residents:\", error);\r\n-    tableBody.innerHTML =\r\n-      '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n     displayMessage(\"Failed to load all residents from API.\", true);\r\n   }\r\n }\r\n \r\n-// Visitors\r\n+\r\n+// ====================================================================\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n+// ====================================================================\r\n+\r\n async function loadVisitorPassOverview() {\r\n-  const overviewSection = document.getElementById(\"visitorOverviewSection\");\r\n+  const overviewSection = document.getElementById('visitorOverviewSection');\r\n   if (!overviewSection) return;\r\n \r\n   try {\r\n     const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n     if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n     const data = await res.json();\r\n-\r\n+   \r\n+    // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n     safeUpdate(\"todayVisitors\", data.today || 0);\r\n     safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n     safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+   \r\n   } catch (err) {\r\n     console.error(\"Error loading visitor overview:\", err);\r\n   }\r\n }\r\n \r\n async function loadPendingVisitorApprovals() {\r\n-  const tableBody = document.getElementById(\"visitorRequestsTableBody\");\r\n-  if (!tableBody) return;\r\n+    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n+    if (!tableBody) return;\r\n \r\n-  tableBody.innerHTML =\r\n-    '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+    \r\n+    // Implementation details would be similar to loadPendingRequests()\r\n }\r\n \r\n function attachVisitorListeners() {\r\n   // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n }\r\n \r\n+\r\n+// ====================================================================\r\n+// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n+// ====================================================================\r\n+\r\n async function loadReportsData() {\r\n-  const reportsContainer = document.getElementById(\"reportsContainer\");\r\n-  if (!reportsContainer) return;\r\n-  reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+  // Placeholder implementation\r\n+    const reportsContainer = document.getElementById('reportsContainer');\r\n+    if (!reportsContainer) return;\r\n+    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n \r\n   try {\r\n     const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n     if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n     const data = await res.json();\r\n+        \r\n+        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n+        // For simplicity, we just display a success message:\r\n+        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n \r\n-    reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n   } catch (err) {\r\n     console.error(\"Error loading reports data:\", err);\r\n-    reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n   }\r\n }\r\n \r\n-// Manual overrides\r\n+\r\n+// ====================================================================\r\n+// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n+// ====================================================================\r\n+\r\n async function loadManualOverrides() {\r\n-  const logTableBody = document.getElementById(\"overrideLogTableBody\");\r\n-  if (!logTableBody) return;\r\n+  const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    if (!logTableBody) return;\r\n \r\n-  logTableBody.innerHTML =\r\n-    '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+        const logs = await resp.json();\r\n \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-    const logs = await resp.json();\r\n-\r\n-    logTableBody.innerHTML = \"\";\r\n-    if (logs.length === 0) {\r\n-      logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n-    } else {\r\n-      // Populate table rows with logs\r\n+        logTableBody.innerHTML = '';\r\n+        if (logs.length === 0) {\r\n+            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+        } else {\r\n+            // Populate table rows with logs\r\n+        }\r\n+    } catch (error) {\r\n+        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n     }\r\n-  } catch (error) {\r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n-  }\r\n }\r\n \r\n function attachOverrideListeners() {\r\n+  // Attach listener for the 'Perform Manual Override' button\r\n   document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-    if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-    try {\r\n-      const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, {\r\n-        method: \"POST\",\r\n-        headers: getAuthHeaders(),\r\n-        body: JSON.stringify({ action: \"open_gate\" }),\r\n-      });\r\n-      if (!resp.ok) throw new Error(\"Override API failed.\");\r\n-      displayMessage(\"Manual override successful!\", false);\r\n-      await loadManualOverrides();\r\n-    } catch (e) {\r\n-      displayMessage(`Manual override failed: ${e.message}`, true);\r\n-    }\r\n+        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+        \r\n+        try {\r\n+            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n+                method: 'POST',\r\n+                headers: getAuthHeaders(),\r\n+                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n+            });\r\n+            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+\r\n+            displayMessage(\"Manual override successful!\", false);\r\n+            await loadManualOverrides(); // Reload logs\r\n+\r\n+        } catch (e) {\r\n+            displayMessage(`Manual override failed: ${e.message}`, true);\r\n+        }\r\n   });\r\n }\r\n+document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n+    btn.addEventListener('click', async () => {\r\n+        // Remove active styling from all\r\n+        document.querySelectorAll('.sidebarBtn').forEach(b => b.classList.remove('bg-blue-600', 'shadow-inner'));\r\n+        \r\n+        // Add active styling to current\r\n+        btn.classList.add('bg-blue-600', 'shadow-inner');\r\n+        \r\n+        // Load content\r\n+        const target = btn.getAttribute('data-target');\r\n+        const contentDiv = document.getElementById('dynamic-section-content');\r\n+        const res = await fetch(target);\r\n+        contentDiv.innerHTML = await res.text();\r\n+    });\r\n+});\r\n \r\n-// ================================\r\n-// 🧭 SIDEBAR PAGE LOADING (MAIN)\r\n-// ================================\r\n+\r\n+// ====================================================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n+// ====================================================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n async function loadPageIntoMainContent(url) {\r\n@@ -596,278 +686,89 @@\n     if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n     const html = await res.text();\r\n     mainContentArea.innerHTML = html; // Inject HTML first\r\n \r\n-    // Run page-specific initializers\r\n+    // 🟢 Execute data loading functions based on the page loaded\r\n     if (url.includes(\"dashboardoverview.html\")) {\r\n       await loadDashboardSummary();\r\n       await loadAccessChart();\r\n-    } else if (url.includes(\"membershiprecords.html\")) {\r\n+    }\r\n+   \r\n+    // --- MEMBERSHIP PAGES ---\r\n+    else if (url.includes(\"membershiprecords.html\")) {\r\n+      // Approved Residents\r\n       attachMembershipListeners();\r\n       await loadApprovedResidents();\r\n     } else if (url.includes(\"membership.html\")) {\r\n+      // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n       attachMembershipListeners();\r\n       await loadPendingRequests();\r\n-    } else if (url.includes(\"payments.html\")) {\r\n+    }\r\n+   \r\n+    // --- PAYMENTS RECORDS ---\r\n+    else if (url.includes(\"payments.html\")) {\r\n       attachPaymentsListeners();\r\n       await loadPaymentsRecords();\r\n-    } else if (url.includes(\"residents.html\")) {\r\n+    }\r\n+   \r\n+    // --- RESIDENTS ---\r\n+    else if (url.includes(\"residents.html\")) {\r\n       await loadAllResidents();\r\n-    } else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+    }\r\n+   \r\n+    // --- VISITORS MANAGEMENT ---\r\n+    else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n       attachVisitorListeners();\r\n+      // Load data relevant to the main visitor pages\r\n       await loadVisitorPassOverview();\r\n       await loadPendingVisitorApprovals();\r\n-    } else if (url.includes(\"chartsandreports.html\")) {\r\n+    }\r\n+   \r\n+    // --- CHARTS AND REPORTS ---\r\n+    else if (url.includes(\"chartsandreports.html\")) {\r\n       await loadReportsData();\r\n-    } else if (url.includes(\"manualoverride.html\")) {\r\n+    }\r\n+   \r\n+    // --- MANUAL OVERRIDES ---\r\n+    else if (url.includes(\"manualoverride.html\")) {\r\n       attachOverrideListeners();\r\n       await loadManualOverrides();\r\n     }\r\n-\r\n-    // --- NEW: Security Dashboard container loaded (top-level page) ---\r\n-    // If the security module was loaded, wire up its sub-sidebar and default subpage.\r\n-    if (url.includes(\"securitydashboards.html\")) {\r\n-      try {\r\n-        // Wait a tick for DOM to render the security module\r\n-        await Promise.resolve();\r\n-\r\n-        // Toggle button inside security page (if present) - this is local to the security module\r\n-        // NOTE: securitydashboards.html should include:\r\n-        // 1) a sub-sidebar with buttons that have class 'security-sub-btn' and data-targets pointing\r\n-        //    to the sub-pages (e.g. sections/securitydashboards/guardstatus.html)\r\n-        // 2) a content container with id 'security-main-content' where subpages will be injected.\r\n-        const securitySubMenu = document.getElementById(\"securitySubMenu\");\r\n-        const securityToggle = document.getElementById(\"securityDashboardToggle\");\r\n-        const securityArrow = document.getElementById(\"securityArrow\");\r\n-\r\n-        // If the admin-level security toggle exists in the global sidebar, we keep its behavior as well\r\n-        // (That toggle is part of the main sidebar; we still want it to expand/close on click.)\r\n-        // For the nested sub-sidebar inside the loaded page, we'll select sub-buttons by a class.\r\n-\r\n-        // Attach click handlers to sub-menu items INSIDE the loaded security page.\r\n-        // We expect the injected HTML to render buttons with class 'security-sub-btn'.\r\n-        const subButtons = mainContentArea.querySelectorAll(\".security-sub-btn\");\r\n-        subButtons.forEach((subBtn) => {\r\n-          subBtn.addEventListener(\"click\", async (e) => {\r\n-            // Clear active state on all security sub buttons\r\n-            subButtons.forEach((b) => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-            // Apply active to clicked\r\n-            subBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n-            const subPage = subBtn.dataset.target;\r\n-            if (subPage) await loadSecuritySubpage(subPage);\r\n-          });\r\n-        });\r\n-\r\n-        // If there's a default subpage (data-default on container or first subBtn), load it:\r\n-        const defaultBtn = mainContentArea.querySelector(\".security-sub-btn[data-default='true']\") || subButtons[0];\r\n-        if (defaultBtn) {\r\n-          // mark active visually then load\r\n-          defaultBtn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-          const defaultPage = defaultBtn.dataset.target;\r\n-          if (defaultPage) await loadSecuritySubpage(defaultPage);\r\n-        } else {\r\n-          // No sub-buttons found - nothing to load\r\n-        }\r\n-      } catch (secErr) {\r\n-        console.error(\"Error initializing security module:\", secErr);\r\n-      }\r\n-    }\r\n   } catch (err) {\r\n     console.error(\"Error loading page:\", err);\r\n     mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n   }\r\n }\r\n \r\n-// Helper: load internal security subpages into #security-main-content\r\n-async function loadSecuritySubpage(url) {\r\n-  const container = document.getElementById(\"security-main-content\");\r\n-  if (!container) {\r\n-    console.warn(\"Security subpage container #security-main-content not found.\");\r\n-    return;\r\n-  }\r\n+// ... (existing sidebar button loop and visitor toggle logic)\r\n \r\n-  container.innerHTML = '<div class=\"text-center p-8 text-gray-500 italic\">Loading security content...</div>';\r\n-\r\n-  try {\r\n-    // We fetch subpage as text (subpage will be standalone fragment HTML)\r\n-    const res = await fetch(url, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(`Failed to load security subpage: ${res.status}`);\r\n-    const html = await res.text();\r\n-    container.innerHTML = html;\r\n-\r\n-    // Optionally wire up dynamic data for specific subpages (by url)\r\n-    if (url.includes(\"guardstatus.html\")) {\r\n-      // If guardstatus.html requires dynamic API data, call loadGuardStatus()\r\n-      await loadGuardStatus();\r\n-    } else if (url.includes(\"incidentreports.html\")) {\r\n-      await loadIncidentReports();\r\n-    } else if (url.includes(\"accesslogs.html\")) {\r\n-      await loadSecurityAccessLogs();\r\n-    }\r\n-  } catch (err) {\r\n-    console.error(\"Error loading security subpage:\", err);\r\n-    container.innerHTML = `<div class=\"p-4 text-red-600 font-semibold\">Failed to load security content.</div>`;\r\n-  }\r\n-}\r\n-\r\n-// ================================\r\n-// SECURITY MODULE: data loaders for sub-pages\r\n-// (these call your endpoints and populate elements within the subpage)\r\n-// ================================\r\n-async function loadGuardStatus() {\r\n-  // Example: expects the guardstatus.html fragment to have a container with id 'guardStatusContainer'\r\n-  const container = document.getElementById(\"guardStatusContainer\");\r\n-  if (!container) return;\r\n-\r\n-  container.innerHTML = '<p class=\"italic text-gray-500\">Loading guard status...</p>';\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.SECURITY_GUARDS, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(`Failed to fetch guard status (${res.status})`);\r\n-    const data = await res.json();\r\n-\r\n-    container.innerHTML = data.length\r\n-      ? data\r\n-          .map(\r\n-            (g) => `\r\n-        <div class=\"p-4 rounded-lg bg-white mb-2 shadow-sm flex justify-between items-center\">\r\n-          <div>\r\n-            <div class=\"font-semibold\">${g.name || \"Unknown\"}</div>\r\n-            <div class=\"text-sm text-gray-500\">${g.shift || \"N/A\"} • ${g.location || \"N/A\"}</div>\r\n-          </div>\r\n-          <div class=\"text-sm\">\r\n-            <span class=\"px-3 py-1 rounded-full ${g.status === \"active\" ? \"bg-green-100 text-green-800\" : \"bg-gray-100 text-gray-800\"}\">\r\n-              ${g.status || \"unknown\"}\r\n-            </span>\r\n-          </div>\r\n-        </div>\r\n-      `\r\n-          )\r\n-          .join(\"\")\r\n-      : '<p class=\"text-gray-600\">No guard records found.</p>';\r\n-  } catch (err) {\r\n-    console.error(\"Error loading guard status:\", err);\r\n-    container.innerHTML = `<p class=\"text-red-600\">Failed to load guard status.</p>`;\r\n-  }\r\n-}\r\n-\r\n-async function loadIncidentReports() {\r\n-  const container = document.getElementById(\"incidentReportsContainer\");\r\n-  if (!container) return;\r\n-  container.innerHTML = '<p class=\"italic text-gray-500\">Loading incidents...</p>';\r\n-\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.SECURITY_INCIDENTS, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(`Failed to fetch incidents (${res.status})`);\r\n-    const incidents = await res.json();\r\n-\r\n-    if (!incidents.length) {\r\n-      container.innerHTML = \"<p class='text-gray-600'>No incidents found.</p>\";\r\n-      return;\r\n-    }\r\n-\r\n-    container.innerHTML = incidents\r\n-      .map(\r\n-        (it) => `\r\n-      <div class=\"p-3 bg-white rounded-lg mb-3 shadow-sm\">\r\n-        <div class=\"flex justify-between items-start\">\r\n-          <div>\r\n-            <div class=\"font-semibold\">${it.title || \"Untitled\"}</div>\r\n-            <div class=\"text-xs text-gray-500\">${formatTimestamp(it.timestamp) || \"\"} • ${it.reportedBy || \"Unknown\"}</div>\r\n-            <p class=\"mt-2 text-sm text-gray-700\">${it.description || \"\"}</p>\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    `\r\n-      )\r\n-      .join(\"\");\r\n-  } catch (err) {\r\n-    console.error(\"Error loading incidents:\", err);\r\n-    container.innerHTML = `<p class=\"text-red-600\">Failed to load incidents.</p>`;\r\n-  }\r\n-}\r\n-\r\n-async function loadSecurityAccessLogs() {\r\n-  const container = document.getElementById(\"securityAccessLogsContainer\");\r\n-  if (!container) return;\r\n-  container.innerHTML = '<p class=\"italic text-gray-500\">Loading access logs...</p>';\r\n-\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.SECURITY_ACCESSLOGS, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(`Failed to fetch access logs (${res.status})`);\r\n-    const logs = await res.json();\r\n-\r\n-    if (!logs.length) {\r\n-      container.innerHTML = \"<p class='text-gray-600'>No access logs found.</p>\";\r\n-      return;\r\n-    }\r\n-\r\n-    container.innerHTML = `\r\n-      <div class=\"overflow-x-auto\">\r\n-        <table class=\"min-w-full bg-white rounded-lg\">\r\n-          <thead class=\"bg-gray-100 text-left\">\r\n-            <tr>\r\n-              <th class=\"px-4 py-2\">Timestamp</th>\r\n-              <th class=\"px-4 py-2\">Gate</th>\r\n-              <th class=\"px-4 py-2\">Resident/Visitor</th>\r\n-              <th class=\"px-4 py-2\">Status</th>\r\n-            </tr>\r\n-          </thead>\r\n-          <tbody>\r\n-            ${logs\r\n-              .map(\r\n-                (l) => `\r\n-              <tr class=\"border-t\">\r\n-                <td class=\"px-4 py-2 text-sm\">${formatTimestamp(l.timestamp)}</td>\r\n-                <td class=\"px-4 py-2 text-sm\">${l.gate || \"N/A\"}</td>\r\n-                <td class=\"px-4 py-2 text-sm\">${l.subject || \"N/A\"}</td>\r\n-                <td class=\"px-4 py-2 text-sm\">${l.status || \"N/A\"}</td>\r\n-              </tr>\r\n-            `\r\n-              )\r\n-              .join(\"\")}\r\n-          </tbody>\r\n-        </table>\r\n-      </div>\r\n-    `;\r\n-  } catch (err) {\r\n-    console.error(\"Error loading access logs:\", err);\r\n-    container.innerHTML = `<p class=\"text-red-600\">Failed to load access logs.</p>`;\r\n-  }\r\n-}\r\n-\r\n-// ================================\r\n-// UI: Sidebar interactions (main sidebar + visitor toggle + security sidebar toggle)\r\n-// ================================\r\n-function resetSidebarActiveStates() {\r\n-  document.querySelectorAll(\".sidebarBtn\").forEach((b) => {\r\n-    b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-    // revert submenu item defaults if inside visitor/security submenus\r\n-    if (b.closest(\"#visitorSubMenu\")) {\r\n-      b.classList.remove(\"bg-blue-600\");\r\n-      b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-    }\r\n-    if (b.closest(\"#securitySubMenu\")) {\r\n-      b.classList.remove(\"bg-blue-600\");\r\n-      b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-    }\r\n-  });\r\n-}\r\n-\r\n-// Attach a global listener to the sidebar main buttons (these are present in the main HTML)\r\n-sidebarButtons.forEach((btn) => {\r\n+sidebarButtons.forEach(btn => {\r\n   btn.addEventListener(\"click\", async () => {\r\n-    resetSidebarActiveStates();\r\n-\r\n+    sidebarButtons.forEach(b => {\r\n+      b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+      // Also ensure sub-menu items are correctly reset if needed\r\n+      if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n+            \r\n+            // Re-apply specific default styles for sub-menu items if needed\r\n+            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n+                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            }\r\n+    });\r\n+   \r\n     btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-    btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n \r\n     const page = btn.dataset.target;\r\n-    if (page) await loadPageIntoMainContent(page);\r\n+    if (page) loadPageIntoMainContent(page);\r\n   });\r\n });\r\n \r\n-// Visitor toggle (main sidebar)\r\n+\r\n+// ================================\r\n+// MISC UI TOGGLES\r\n+// ================================\r\n const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n@@ -875,22 +776,12 @@\n   visitorSubMenu?.classList.toggle(\"hidden\");\r\n   visitorArrow?.classList.toggle(\"rotate-90\");\r\n });\r\n \r\n-// Security toggle in main sidebar (keeps the same behavior - expands the small submenu we added earlier in HTML)\r\n-const securityToggleMain = document.getElementById(\"securityDashboardToggle\");\r\n-const securitySubMenuMain = document.getElementById(\"securitySubMenu\");\r\n-const securityArrowMain = document.getElementById(\"securityArrow\");\r\n-\r\n-securityToggleMain?.addEventListener(\"click\", () => {\r\n-  // Expand/Collapse the small admin-level security sub-menu (only for quick links if any)\r\n-  securitySubMenuMain?.classList.toggle(\"hidden\");\r\n-  securityArrowMain?.classList.toggle(\"rotate-90\");\r\n-});\r\n-\r\n // ================================\r\n // INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n+\r\n+document.addEventListener('DOMContentLoaded', () => {\r\n   // Load the initial dashboard view when the admin page first loads\r\n-  loadPageIntoMainContent(\"sections/dashboardoverview.html\");\r\n+  loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763882345150,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -783,5 +783,32 @@\n \r\n document.addEventListener('DOMContentLoaded', () => {\r\n   // Load the initial dashboard view when the admin page first loads\r\n   loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\n\\ No newline at end of file\n+});\r\n+\r\n+document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n+  btn.addEventListener('click', async () => {\r\n+    // Remove active styles from ALL sidebar & sub-menu buttons\r\n+    document.querySelectorAll('.sidebarBtn').forEach(b => {\r\n+      b.classList.remove('bg-blue-600', 'text-white', 'shadow-inner');\r\n+      // Reset sub-menu button styles\r\n+      if (b.closest('#visitorSubMenu')) {\r\n+        b.classList.add('bg-gray-600', 'hover:bg-blue-500/50', 'text-white');\r\n+        b.classList.remove('bg-gray-700', 'hover:bg-gray-600');\r\n+      } else {\r\n+        b.classList.add('bg-gray-700', 'hover:bg-gray-600', 'text-white');\r\n+      }\r\n+    });\r\n+\r\n+    // Add active styles to clicked button\r\n+    btn.classList.add('bg-blue-600', 'text-white', 'shadow-inner');\r\n+    if (btn.closest('#visitorSubMenu')) {\r\n+      // Optionally highlight parent submenu button too\r\n+      document.getElementById('visitorManagementToggle').classList.add('bg-blue-600', 'text-white');\r\n+    }\r\n+\r\n+    // Load content\r\n+    const target = btn.dataset.target;\r\n+    if (target) await loadPageIntoMainContent(target);\r\n+  });\r\n+});\r\n"
                },
                {
                    "date": 1763883159007,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -653,25 +653,51 @@\n             displayMessage(`Manual override failed: ${e.message}`, true);\r\n         }\r\n   });\r\n }\r\n+// Sidebar button click handler\r\n document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n-    btn.addEventListener('click', async () => {\r\n-        // Remove active styling from all\r\n-        document.querySelectorAll('.sidebarBtn').forEach(b => b.classList.remove('bg-blue-600', 'shadow-inner'));\r\n-        \r\n-        // Add active styling to current\r\n-        btn.classList.add('bg-blue-600', 'shadow-inner');\r\n-        \r\n-        // Load content\r\n-        const target = btn.getAttribute('data-target');\r\n-        const contentDiv = document.getElementById('dynamic-section-content');\r\n-        const res = await fetch(target);\r\n-        contentDiv.innerHTML = await res.text();\r\n+  btn.addEventListener('click', async () => {\r\n+    // Remove active styles from ALL top-level buttons\r\n+    document.querySelectorAll('.sidebarBtn').forEach(b => {\r\n+      b.classList.remove('bg-blue-600', 'text-white', 'shadow-inner');\r\n+      if (b.closest('#visitorSubMenu')) {\r\n+        // Reset sub-menu item styles\r\n+        b.classList.add('bg-gray-600', 'hover:bg-blue-500/50', 'text-white');\r\n+        b.classList.remove('bg-gray-700', 'hover:bg-gray-600');\r\n+      } else {\r\n+        b.classList.add('bg-gray-700', 'hover:bg-gray-600', 'text-white');\r\n+      }\r\n     });\r\n+\r\n+    // Highlight clicked button\r\n+    btn.classList.add('bg-blue-600', 'text-white', 'shadow-inner');\r\n+    if (btn.closest('#visitorSubMenu')) {\r\n+      // Keep the parent menu active\r\n+      const parentToggle = document.getElementById('visitorManagementToggle');\r\n+      parentToggle.classList.add('bg-blue-600', 'text-white');\r\n+      // Ensure submenu is visible\r\n+      document.getElementById('visitorSubMenu').classList.remove('hidden');\r\n+      document.getElementById('visitorArrow').classList.add('rotate-90');\r\n+    }\r\n+\r\n+    // Load content\r\n+    const target = btn.dataset.target;\r\n+    if (target) await loadPageIntoMainContent(target);\r\n+  });\r\n });\r\n \r\n+// Visitor toggle arrow click\r\n+const visitorToggle = document.getElementById('visitorManagementToggle');\r\n+visitorToggle?.addEventListener('click', () => {\r\n+  const submenu = document.getElementById('visitorSubMenu');\r\n+  const arrow = document.getElementById('visitorArrow');\r\n+  submenu.classList.toggle('hidden');\r\n+  arrow.classList.toggle('rotate-90');\r\n+});\r\n \r\n+\r\n+\r\n // ====================================================================\r\n // 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n // ====================================================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n"
                },
                {
                    "date": 1763883447675,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,8 @@\n+// =========================================================\r\n // adminsdashboard.js\r\n-// This file now includes ALL necessary data loading logic (including Membership)\r\n-// to handle dynamic page loading in the Admin Dashboard.\r\n+// Complete Admin Dashboard JS with all logic & sidebar handling\r\n+// =========================================================\r\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n@@ -21,9 +22,9 @@\n   APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n   APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n   REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n   DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n- \r\n+\r\n   // General Admin Endpoints\r\n   PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n   ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n   VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n@@ -35,806 +36,300 @@\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n   localStorage.removeItem(\"accessToken\");\r\n   window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n-// UTILITIES AND HELPERS\r\n+// UTILITIES & HELPERS\r\n // ================================\r\n-\r\n-/**\r\n-* Creates and returns the standard headers needed for authenticated API calls.\r\n-*/\r\n function getAuthHeaders() {\r\n   return {\r\n     'Content-Type': 'application/json',\r\n     'Authorization': `Bearer ${token}`\r\n   };\r\n }\r\n \r\n-/**\r\n-* Handles error display in a non-alert manner.\r\n-*/\r\n function displayMessage(message, isError = false) {\r\n   const msgElement = document.getElementById('msg');\r\n   if (msgElement) {\r\n     msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-   \r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n+      isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'\r\n+    }`;\r\n     setTimeout(() => {\r\n       msgElement.textContent = '';\r\n       msgElement.className = 'text-sm text-gray-700 mb-3';\r\n     }, 5000);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Formats a timestamp (string or number) into a readable date string.\r\n-*/\r\n function formatTimestamp(timestamp) {\r\n-  try {\r\n-    if (!timestamp) return 'N/A';\r\n-    return new Date(timestamp).toLocaleString();\r\n-  } catch (e) {\r\n-    return 'N/A';\r\n-  }\r\n+  if (!timestamp) return 'N/A';\r\n+  try { return new Date(timestamp).toLocaleString(); }\r\n+  catch { return 'N/A'; }\r\n }\r\n \r\n-/**\r\n-* Safely updates a DOM element's text content.\r\n-*/\r\n const safeUpdate = (id, value, suffix = '') => {\r\n   const element = document.getElementById(id);\r\n-  if (element) {\r\n-    element.textContent = value + suffix;\r\n-  }\r\n+  if (element) element.textContent = value + suffix;\r\n };\r\n \r\n-\r\n-// ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n-* Sends an approval request to the backend API.\r\n-*/\r\n+// ================================\r\n+// 🟢 MEMBERSHIP LOGIC\r\n+// ================================\r\n async function handleApproveClick(requestId) {\r\n   safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-      method: 'PUT',\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-\r\n-    if (!resp.ok) {\r\n-      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-      throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-    }\r\n-    \r\n+    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error((await resp.json()).message || `Approval failed`);\r\n     safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-    displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-    \r\n-    // Reload data after a successful action\r\n+    displayMessage(`Successfully approved membership request ${requestId}.`);\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-\r\n   } catch (e) {\r\n-    console.error(\"Approval Operation Failed:\", e);\r\n+    console.error(e);\r\n     displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Sends a rejection request to the backend API.\r\n-*/\r\n async function handleRejectClick(requestId) {\r\n   safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n   if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n-\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-      method: 'PUT', \r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-\r\n-    if (!resp.ok) {\r\n-      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-      throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-    }\r\n-    \r\n+    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error((await resp.json()).message || `Rejection failed`);\r\n     safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-    displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-    \r\n+    displayMessage(`Successfully rejected membership request ${requestId}.`);\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-\r\n   } catch (e) {\r\n-    console.error(\"Rejection Operation Failed:\", e);\r\n+    console.error(e);\r\n     displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Sends a deletion request to the backend API.\r\n-*/\r\n async function handleDeleteClick(requestId) {\r\n   safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-  if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-\r\n+  if (!confirm(`Are you sure you want to DELETE request ${requestId}?`)) return;\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-      method: 'DELETE', \r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-\r\n-    if (!resp.ok) {\r\n-      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-      throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-    }\r\n-    \r\n+    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method: 'DELETE', headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error((await resp.json()).message || `Deletion failed`);\r\n     safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-    displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-    \r\n+    displayMessage(`Successfully deleted membership request ${requestId}.`);\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-\r\n   } catch (e) {\r\n-    console.error(\"Deletion Operation Failed:\", e);\r\n+    console.error(e);\r\n     displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Executes a real API call to trigger server-side data synchronization.\r\n-*/\r\n async function handleSyncClick(event) {\r\n   const btn = event.currentTarget;\r\n   const originalText = btn.textContent;\r\n   const originalClasses = btn.className;\r\n-\r\n-  // 1. Set Loading State\r\n   btn.disabled = true;\r\n   btn.textContent = 'Syncing...';\r\n-  btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n-\r\n+  btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md animate-pulse min-w-[100px]';\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.SYNC, { \r\n-      method: 'POST',\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-\r\n-    if (!resp.ok) {\r\n-      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-      throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-    }\r\n-\r\n-    // 2. Set Success State\r\n+    const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error((await resp.json()).message || `Sync failed`);\r\n     btn.textContent = 'Sync Complete! ✔️';\r\n-    btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-    displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-    // Reload data after a successful sync\r\n+    btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md min-w-[100px]';\r\n+    displayMessage(\"Data synchronization successful.\");\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-    \r\n   } catch (err) {\r\n-    // 3. Set Failure State\r\n-    console.error(\"Synchronization Error:\", err.message);\r\n+    console.error(err);\r\n     btn.textContent = 'Sync Failed ❌';\r\n-    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md min-w-[100px]';\r\n     displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n   } finally {\r\n-    // 4. Reset Button State after a short delay\r\n     setTimeout(() => {\r\n       btn.disabled = false;\r\n       btn.textContent = originalText;\r\n       btn.className = originalClasses;\r\n     }, 3000);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Fetches and renders pending membership requests from the backend API.\r\n-*/\r\n async function loadPendingRequests() {\r\n   const tableBody = document.getElementById('membershipTableBody');\r\n   const countElement = document.getElementById('membershipCount');\r\n   const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-  \r\n   if (!tableBody || !countElement || !noRequestsMsg) return;\r\n-\r\n-  // Show loading state\r\n   tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-  \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-    \r\n     const requests = await resp.json();\r\n-    \r\n     tableBody.innerHTML = '';\r\n     countElement.textContent = requests.length;\r\n-\r\n-    if (requests.length === 0) {\r\n-      noRequestsMsg.classList.remove('hidden');\r\n-    } else {\r\n-      noRequestsMsg.classList.add('hidden');\r\n-      requests.forEach(request => {\r\n-        const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-\r\n-        const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-        const requestId = request.id || request.RequestID; \r\n-\r\n-        row.innerHTML = `\r\n-          <td class=\"px-4 py-3\">${requestId}</td>\r\n-          <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-          <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-          <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-            <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-              Approve\r\n-            </button>\r\n-            <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-              Reject\r\n-            </button>\r\n-            <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-              Delete\r\n-            </button>\r\n-          </td>\r\n-        `;\r\n-      });\r\n-      \r\n-      // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-      tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-        });\r\n-      });\r\n-      tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-        });\r\n-      });\r\n-      tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-        });\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Error loading pending requests:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-    displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    noRequestsMsg.classList.toggle('hidden', requests.length > 0);\r\n+    requests.forEach(request => {\r\n+      const row = tableBody.insertRow();\r\n+      row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+      const requestedAt = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+      const requestId = request.id || request.RequestID;\r\n+      row.innerHTML = `\r\n+        <td>${requestId}</td>\r\n+        <td>${request.ResidentName || 'N/A'}</td>\r\n+        <td>${request.NationalID || 'N/A'}</td>\r\n+        <td>${request.PhoneNumber || 'N/A'}</td>\r\n+        <td>${request.Email || 'N/A'}</td>\r\n+        <td>${request.HouseNumber || 'N/A'}</td>\r\n+        <td>${request.CourtName || 'N/A'}</td>\r\n+        <td>${request.RoleName || 'N/A'}</td>\r\n+        <td><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+        <td>${requestedAt}</td>\r\n+        <td class=\"flex space-x-2 justify-center\">\r\n+          <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Approve</button>\r\n+          <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Reject</button>\r\n+          <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Delete</button>\r\n+        </td>\r\n+      `;\r\n+    });\r\n+    tableBody.querySelectorAll('.approve-btn').forEach(b => b.addEventListener('click', e => handleApproveClick(e.target.dataset.requestId)));\r\n+    tableBody.querySelectorAll('.reject-btn').forEach(b => b.addEventListener('click', e => handleRejectClick(e.target.dataset.requestId)));\r\n+    tableBody.querySelectorAll('.delete-btn').forEach(b => b.addEventListener('click', e => handleDeleteClick(e.target.dataset.requestId)));\r\n+  } catch (err) {\r\n+    console.error(err);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center text-red-500\">Error loading requests.</td></tr>';\r\n+    displayMessage(\"Failed to load pending requests.\", true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Fetches and renders approved residents from the backend API.\r\n-*/\r\n async function loadApprovedResidents() {\r\n   const tableBody = document.getElementById('residentsTableBody');\r\n   const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-  \r\n   if (!tableBody || !noResidentsMsg) return;\r\n-\r\n-  // Show loading state\r\n   tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n-\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-    \r\n     const residents = await resp.json();\r\n-\r\n     tableBody.innerHTML = '';\r\n-    \r\n-    if (residents.length === 0) {\r\n-      noResidentsMsg.classList.remove('hidden');\r\n-    } else {\r\n-      noResidentsMsg.classList.add('hidden');\r\n-      residents.forEach(resident => {\r\n-        const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-        row.innerHTML = `\r\n-          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-        `;\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Error loading approved residents:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-    displayMessage(\"Failed to load approved residents from API.\", true);\r\n+    noResidentsMsg.classList.toggle('hidden', residents.length > 0);\r\n+    residents.forEach(r => {\r\n+      const row = tableBody.insertRow();\r\n+      row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+      row.innerHTML = `\r\n+        <td>${r.ResidentName || 'N/A'}</td>\r\n+        <td>${r.NationalID || 'N/A'}</td>\r\n+        <td>${r.PhoneNumber || 'N/A'}</td>\r\n+        <td>${r.Email || 'N/A'}</td>\r\n+        <td>${r.HouseNumber || 'N/A'}</td>\r\n+        <td>${r.CourtName || 'N/A'}</td>\r\n+        <td>${r.RoleName || 'N/A'}</td>\r\n+      `;\r\n+    });\r\n+  } catch (err) {\r\n+    console.error(err);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center text-red-500\">Error loading approved residents.</td></tr>';\r\n+    displayMessage(\"Failed to load approved residents.\", true);\r\n   }\r\n }\r\n \r\n-/**\r\n-* Attaches event listeners for membership-specific elements (Sync, Filters)\r\n-*/\r\n function attachMembershipListeners() {\r\n-  // Attach listener for the Sync button\r\n   document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n- \r\n-  // Attach listener for Clear Filters button\r\n   document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-    // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n     document.getElementById('requestIdFilter').value = \"\";\r\n     document.getElementById('residentFilter').value = \"\";\r\n-    displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    displayMessage(\"Filters cleared.\", false);\r\n   });\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n-// ====================================================================\r\n-\r\n+// ================================\r\n+// 🚀 DASHBOARD LOGIC\r\n+// ================================\r\n async function loadDashboardSummary() {\r\n   try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-      headers: { \"Authorization\": `Bearer ${token}` }\r\n-    });\r\n-    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(res.statusText);\r\n     const data = await res.json();\r\n-\r\n     safeUpdate(\"totalResidents\", data.residents || 0);\r\n     safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n     safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n     safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-  } catch (err) {\r\n-    console.error(\"Error loading summary:\", err);\r\n-  }\r\n+  } catch (err) { console.error(err); }\r\n }\r\n \r\n async function loadAccessChart() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n-\r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        // Destroy existing chart instance if it exists before creating a new one\r\n-        if (window.accessChartInstance) {\r\n-            window.accessChartInstance.destroy();\r\n-        }\r\n-        \r\n-        window.accessChartInstance = new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n-* Fetches and renders payments records.\r\n-*/\r\n-async function loadPaymentsRecords() {\r\n-  const tableBody = document.getElementById('paymentsTableBody');\r\n-  if (!tableBody) return;\r\n-\r\n-  tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n- \r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-   \r\n-    const records = await resp.json();\r\n-   \r\n-    tableBody.innerHTML = '';\r\n-\r\n-    if (records.length === 0) {\r\n-      tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-    } else {\r\n-      records.forEach(record => {\r\n-        const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-        row.innerHTML = `\r\n-          <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n-          <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-          <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-        `;\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Error loading payments records:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-    displayMessage(\"Failed to load payments records from API.\", true);\r\n-  }\r\n-}\r\n-\r\n-/**\r\n-* Attaches event listeners for payments-specific elements.\r\n-*/\r\n-function attachPaymentsListeners() {\r\n-  // Add any payments-specific listeners here\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 👥 RESIDENTS LOGIC (residents.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n-* Fetches and renders all resident details.\r\n-*/\r\n-async function loadAllResidents() {\r\n-  const tableBody = document.getElementById('allResidentsTableBody');\r\n-  if (!tableBody) return;\r\n-\r\n-  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n-\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-   \r\n-    const residents = await resp.json();\r\n-   \r\n-    tableBody.innerHTML = '';\r\n-   \r\n-    if (residents.length === 0) {\r\n-      tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-    } else {\r\n-      residents.forEach(resident => {\r\n-        const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-        row.innerHTML = `\r\n-          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-        `;\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Error loading all residents:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-    displayMessage(\"Failed to load all residents from API.\", true);\r\n-  }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n-// ====================================================================\r\n-\r\n-async function loadVisitorPassOverview() {\r\n-  const overviewSection = document.getElementById('visitorOverviewSection');\r\n-  if (!overviewSection) return;\r\n-\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(res.statusText);\r\n     const data = await res.json();\r\n-   \r\n-    // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n-    safeUpdate(\"todayVisitors\", data.today || 0);\r\n-    safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-    safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-   \r\n-  } catch (err) {\r\n-    console.error(\"Error loading visitor overview:\", err);\r\n-  }\r\n+    const ctx = document.getElementById(\"accessChart\")?.getContext(\"2d\");\r\n+    if (!ctx) return;\r\n+    if (window.accessChartInstance) window.accessChartInstance.destroy();\r\n+    window.accessChartInstance = new Chart(ctx, {\r\n+      type: \"line\",\r\n+      data: { labels: data.days || [], datasets: [{ label: \"Access Attempts\", data: data.counts || [], borderWidth: 2, tension: 0.4, borderColor: '#2563eb', backgroundColor: 'rgba(37,99,235,0.2)', fill: true }] },\r\n+      options: { responsive: true, maintainAspectRatio: false }\r\n+    });\r\n+  } catch (err) { console.error(err); }\r\n }\r\n \r\n-async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n-    \r\n-    // Implementation details would be similar to loadPendingRequests()\r\n-}\r\n-\r\n-function attachVisitorListeners() {\r\n-  // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n-// ====================================================================\r\n-\r\n-async function loadReportsData() {\r\n-  // Placeholder implementation\r\n-    const reportsContainer = document.getElementById('reportsContainer');\r\n-    if (!reportsContainer) return;\r\n-    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n-\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-    const data = await res.json();\r\n-        \r\n-        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n-        // For simplicity, we just display a success message:\r\n-        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n-\r\n-  } catch (err) {\r\n-    console.error(\"Error loading reports data:\", err);\r\n-        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n-  }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n-// ====================================================================\r\n-\r\n-async function loadManualOverrides() {\r\n-  const logTableBody = document.getElementById('overrideLogTableBody');\r\n-    if (!logTableBody) return;\r\n-\r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-        const logs = await resp.json();\r\n-\r\n-        logTableBody.innerHTML = '';\r\n-        if (logs.length === 0) {\r\n-            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n-        } else {\r\n-            // Populate table rows with logs\r\n-        }\r\n-    } catch (error) {\r\n-        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n-    }\r\n-}\r\n-\r\n-function attachOverrideListeners() {\r\n-  // Attach listener for the 'Perform Manual Override' button\r\n-  document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-        \r\n-        try {\r\n-            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n-                method: 'POST',\r\n-                headers: getAuthHeaders(),\r\n-                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n-            });\r\n-            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n-\r\n-            displayMessage(\"Manual override successful!\", false);\r\n-            await loadManualOverrides(); // Reload logs\r\n-\r\n-        } catch (e) {\r\n-            displayMessage(`Manual override failed: ${e.message}`, true);\r\n-        }\r\n-  });\r\n-}\r\n-// Sidebar button click handler\r\n-document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n-  btn.addEventListener('click', async () => {\r\n-    // Remove active styles from ALL top-level buttons\r\n-    document.querySelectorAll('.sidebarBtn').forEach(b => {\r\n-      b.classList.remove('bg-blue-600', 'text-white', 'shadow-inner');\r\n-      if (b.closest('#visitorSubMenu')) {\r\n-        // Reset sub-menu item styles\r\n-        b.classList.add('bg-gray-600', 'hover:bg-blue-500/50', 'text-white');\r\n-        b.classList.remove('bg-gray-700', 'hover:bg-gray-600');\r\n-      } else {\r\n-        b.classList.add('bg-gray-700', 'hover:bg-gray-600', 'text-white');\r\n-      }\r\n-    });\r\n-\r\n-    // Highlight clicked button\r\n-    btn.classList.add('bg-blue-600', 'text-white', 'shadow-inner');\r\n-    if (btn.closest('#visitorSubMenu')) {\r\n-      // Keep the parent menu active\r\n-      const parentToggle = document.getElementById('visitorManagementToggle');\r\n-      parentToggle.classList.add('bg-blue-600', 'text-white');\r\n-      // Ensure submenu is visible\r\n-      document.getElementById('visitorSubMenu').classList.remove('hidden');\r\n-      document.getElementById('visitorArrow').classList.add('rotate-90');\r\n-    }\r\n-\r\n-    // Load content\r\n-    const target = btn.dataset.target;\r\n-    if (target) await loadPageIntoMainContent(target);\r\n-  });\r\n-});\r\n-\r\n-// Visitor toggle arrow click\r\n-const visitorToggle = document.getElementById('visitorManagementToggle');\r\n-visitorToggle?.addEventListener('click', () => {\r\n-  const submenu = document.getElementById('visitorSubMenu');\r\n-  const arrow = document.getElementById('visitorArrow');\r\n-  submenu.classList.toggle('hidden');\r\n-  arrow.classList.toggle('rotate-90');\r\n-});\r\n-\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n-// ====================================================================\r\n+// ================================\r\n+// 🧭 SIDEBAR & PAGE LOADING\r\n+// ================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n async function loadPageIntoMainContent(url) {\r\n-  // Show a loading state instantly\r\n   mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n-\r\n   try {\r\n     const res = await fetch(url);\r\n     if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n     const html = await res.text();\r\n-    mainContentArea.innerHTML = html; // Inject HTML first\r\n+    mainContentArea.innerHTML = html;\r\n \r\n-    // 🟢 Execute data loading functions based on the page loaded\r\n     if (url.includes(\"dashboardoverview.html\")) {\r\n-      await loadDashboardSummary();\r\n-      await loadAccessChart();\r\n-    }\r\n-   \r\n-    // --- MEMBERSHIP PAGES ---\r\n-    else if (url.includes(\"membershiprecords.html\")) {\r\n-      // Approved Residents\r\n-      attachMembershipListeners();\r\n-      await loadApprovedResidents();\r\n+      await loadDashboardSummary(); await loadAccessChart();\r\n+    } else if (url.includes(\"membershiprecords.html\")) {\r\n+      attachMembershipListeners(); await loadApprovedResidents();\r\n     } else if (url.includes(\"membership.html\")) {\r\n-      // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n-      attachMembershipListeners();\r\n-      await loadPendingRequests();\r\n-    }\r\n-   \r\n-    // --- PAYMENTS RECORDS ---\r\n-    else if (url.includes(\"payments.html\")) {\r\n-      attachPaymentsListeners();\r\n-      await loadPaymentsRecords();\r\n-    }\r\n-   \r\n-    // --- RESIDENTS ---\r\n-    else if (url.includes(\"residents.html\")) {\r\n-      await loadAllResidents();\r\n-    }\r\n-   \r\n-    // --- VISITORS MANAGEMENT ---\r\n-    else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-      attachVisitorListeners();\r\n-      // Load data relevant to the main visitor pages\r\n-      await loadVisitorPassOverview();\r\n-      await loadPendingVisitorApprovals();\r\n-    }\r\n-   \r\n-    // --- CHARTS AND REPORTS ---\r\n-    else if (url.includes(\"chartsandreports.html\")) {\r\n-      await loadReportsData();\r\n-    }\r\n-   \r\n-    // --- MANUAL OVERRIDES ---\r\n-    else if (url.includes(\"manualoverride.html\")) {\r\n-      attachOverrideListeners();\r\n-      await loadManualOverrides();\r\n-    }\r\n+      attachMembershipListeners(); await loadPendingRequests();\r\n+    } \r\n+    // Additional page-specific loaders can go here...\r\n   } catch (err) {\r\n-    console.error(\"Error loading page:\", err);\r\n-    mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    console.error(err);\r\n+    mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n   }\r\n }\r\n \r\n-// ... (existing sidebar button loop and visitor toggle logic)\r\n-\r\n sidebarButtons.forEach(btn => {\r\n   btn.addEventListener(\"click\", async () => {\r\n     sidebarButtons.forEach(b => {\r\n-      b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-      // Also ensure sub-menu items are correctly reset if needed\r\n-      if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n-            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n-            \r\n-            // Re-apply specific default styles for sub-menu items if needed\r\n-            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n-                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            }\r\n+      b.classList.remove(\"bg-blue-600\",\"text-white\",\"shadow-inner\");\r\n+      if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-600\",\"hover:bg-blue-500/50\",\"text-white\");\r\n+      else b.classList.add(\"bg-gray-700\",\"hover:bg-gray-600\",\"text-white\");\r\n     });\r\n-   \r\n-    btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-\r\n+    btn.classList.add(\"bg-blue-600\",\"text-white\",\"shadow-inner\");\r\n+    if (btn.closest('#visitorSubMenu')) {\r\n+      visitorToggle?.classList.add(\"bg-blue-600\",\"text-white\");\r\n+      visitorSubMenu?.classList.remove(\"hidden\");\r\n+      visitorArrow?.classList.add(\"rotate-90\");\r\n+    }\r\n     const page = btn.dataset.target;\r\n-    if (page) loadPageIntoMainContent(page);\r\n+    if (page) await loadPageIntoMainContent(page);\r\n   });\r\n });\r\n \r\n-\r\n-// ================================\r\n-// MISC UI TOGGLES\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n visitorToggle?.addEventListener(\"click\", () => {\r\n   visitorSubMenu?.classList.toggle(\"hidden\");\r\n   visitorArrow?.classList.toggle(\"rotate-90\");\r\n });\r\n \r\n // ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n+// INITIAL LOAD\r\n // ================================\r\n-\r\n document.addEventListener('DOMContentLoaded', () => {\r\n-  // Load the initial dashboard view when the admin page first loads\r\n   loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n-\r\n-document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n-  btn.addEventListener('click', async () => {\r\n-    // Remove active styles from ALL sidebar & sub-menu buttons\r\n-    document.querySelectorAll('.sidebarBtn').forEach(b => {\r\n-      b.classList.remove('bg-blue-600', 'text-white', 'shadow-inner');\r\n-      // Reset sub-menu button styles\r\n-      if (b.closest('#visitorSubMenu')) {\r\n-        b.classList.add('bg-gray-600', 'hover:bg-blue-500/50', 'text-white');\r\n-        b.classList.remove('bg-gray-700', 'hover:bg-gray-600');\r\n-      } else {\r\n-        b.classList.add('bg-gray-700', 'hover:bg-gray-600', 'text-white');\r\n-      }\r\n-    });\r\n-\r\n-    // Add active styles to clicked button\r\n-    btn.classList.add('bg-blue-600', 'text-white', 'shadow-inner');\r\n-    if (btn.closest('#visitorSubMenu')) {\r\n-      // Optionally highlight parent submenu button too\r\n-      document.getElementById('visitorManagementToggle').classList.add('bg-blue-600', 'text-white');\r\n-    }\r\n-\r\n-    // Load content\r\n-    const target = btn.dataset.target;\r\n-    if (target) await loadPageIntoMainContent(target);\r\n-  });\r\n-});\r\n"
                },
                {
                    "date": 1763883648444,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,23 +9,18 @@\n const API_HOST = \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n-// Define API Endpoints\r\n+// API Endpoints\r\n const ENDPOINTS = {\r\n-  // Dashboard Overview Endpoints\r\n   DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n   DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n-\r\n-  // Membership Endpoints\r\n   SYNC: `${API_HOST}/api/admin/sync`,\r\n   PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n   APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n   APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n   REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n   DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-\r\n-  // General Admin Endpoints\r\n   PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n   ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n   VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n   PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n@@ -42,90 +37,77 @@\n   window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n-// UTILITIES & HELPERS\r\n+// UTILITIES\r\n // ================================\r\n function getAuthHeaders() {\r\n-  return {\r\n-    'Content-Type': 'application/json',\r\n-    'Authorization': `Bearer ${token}`\r\n-  };\r\n+  return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };\r\n }\r\n \r\n function displayMessage(message, isError = false) {\r\n   const msgElement = document.getElementById('msg');\r\n-  if (msgElement) {\r\n-    msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n-      isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'\r\n-    }`;\r\n-    setTimeout(() => {\r\n-      msgElement.textContent = '';\r\n-      msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-    }, 5000);\r\n-  }\r\n+  if (!msgElement) return;\r\n+  msgElement.textContent = message;\r\n+  msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n+    isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'\r\n+  }`;\r\n+  setTimeout(() => {\r\n+    msgElement.textContent = '';\r\n+    msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+  }, 5000);\r\n }\r\n \r\n function formatTimestamp(timestamp) {\r\n   if (!timestamp) return 'N/A';\r\n-  try { return new Date(timestamp).toLocaleString(); }\r\n+  try { return new Date(timestamp).toLocaleString(); } \r\n   catch { return 'N/A'; }\r\n }\r\n \r\n const safeUpdate = (id, value, suffix = '') => {\r\n-  const element = document.getElementById(id);\r\n-  if (element) element.textContent = value + suffix;\r\n+  const el = document.getElementById(id);\r\n+  if (el) el.textContent = value + suffix;\r\n };\r\n \r\n // ================================\r\n-// 🟢 MEMBERSHIP LOGIC\r\n+// MEMBERSHIP LOGIC\r\n // ================================\r\n async function handleApproveClick(requestId) {\r\n   safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json()).message || `Approval failed`);\r\n+    if (!resp.ok) throw new Error((await resp.json()).message || 'Approval failed');\r\n     safeUpdate('actionText', `Approved Request ${requestId}`);\r\n     displayMessage(`Successfully approved membership request ${requestId}.`);\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    console.error(e);\r\n-    displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-  }\r\n+  } catch (e) { console.error(e); displayMessage(`Approval failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleRejectClick(requestId) {\r\n   safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n   if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json()).message || `Rejection failed`);\r\n+    if (!resp.ok) throw new Error((await resp.json()).message || 'Rejection failed');\r\n     safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n     displayMessage(`Successfully rejected membership request ${requestId}.`);\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    console.error(e);\r\n-    displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-  }\r\n+  } catch (e) { console.error(e); displayMessage(`Rejection failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleDeleteClick(requestId) {\r\n   safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n   if (!confirm(`Are you sure you want to DELETE request ${requestId}?`)) return;\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method: 'DELETE', headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json()).message || `Deletion failed`);\r\n+    if (!resp.ok) throw new Error((await resp.json()).message || 'Deletion failed');\r\n     safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n     displayMessage(`Successfully deleted membership request ${requestId}.`);\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    console.error(e);\r\n-    displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-  }\r\n+  } catch (e) { console.error(e); displayMessage(`Deletion failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleSyncClick(event) {\r\n   const btn = event.currentTarget;\r\n@@ -135,85 +117,79 @@\n   btn.textContent = 'Syncing...';\r\n   btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md animate-pulse min-w-[100px]';\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json()).message || `Sync failed`);\r\n+    if (!resp.ok) throw new Error((await resp.json()).message || 'Sync failed');\r\n     btn.textContent = 'Sync Complete! ✔️';\r\n     btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md min-w-[100px]';\r\n     displayMessage(\"Data synchronization successful.\");\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-  } catch (err) {\r\n-    console.error(err);\r\n-    btn.textContent = 'Sync Failed ❌';\r\n-    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md min-w-[100px]';\r\n-    displayMessage(`Sync failed: ${err.message}`, true);\r\n-  } finally {\r\n-    setTimeout(() => {\r\n-      btn.disabled = false;\r\n-      btn.textContent = originalText;\r\n-      btn.className = originalClasses;\r\n-    }, 3000);\r\n-  }\r\n+  } catch (err) { console.error(err); btn.textContent = 'Sync Failed ❌'; btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md min-w-[100px]'; displayMessage(`Sync failed: ${err.message}`, true); }\r\n+  finally { setTimeout(() => { btn.disabled = false; btn.textContent = originalText; btn.className = originalClasses; }, 3000); }\r\n }\r\n \r\n async function loadPendingRequests() {\r\n   const tableBody = document.getElementById('membershipTableBody');\r\n   const countElement = document.getElementById('membershipCount');\r\n   const noRequestsMsg = document.getElementById('noPendingRequests');\r\n   if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+\r\n   tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n     const requests = await resp.json();\r\n     tableBody.innerHTML = '';\r\n     countElement.textContent = requests.length;\r\n     noRequestsMsg.classList.toggle('hidden', requests.length > 0);\r\n-    requests.forEach(request => {\r\n+\r\n+    requests.forEach(r => {\r\n       const row = tableBody.insertRow();\r\n       row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-      const requestedAt = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-      const requestId = request.id || request.RequestID;\r\n+      const requestedAt = formatTimestamp(r.RequestedAt || r.requestedAt);\r\n+      const requestId = r.id || r.RequestID;\r\n       row.innerHTML = `\r\n         <td>${requestId}</td>\r\n-        <td>${request.ResidentName || 'N/A'}</td>\r\n-        <td>${request.NationalID || 'N/A'}</td>\r\n-        <td>${request.PhoneNumber || 'N/A'}</td>\r\n-        <td>${request.Email || 'N/A'}</td>\r\n-        <td>${request.HouseNumber || 'N/A'}</td>\r\n-        <td>${request.CourtName || 'N/A'}</td>\r\n-        <td>${request.RoleName || 'N/A'}</td>\r\n-        <td><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+        <td>${r.ResidentName || 'N/A'}</td>\r\n+        <td>${r.NationalID || 'N/A'}</td>\r\n+        <td>${r.PhoneNumber || 'N/A'}</td>\r\n+        <td>${r.Email || 'N/A'}</td>\r\n+        <td>${r.HouseNumber || 'N/A'}</td>\r\n+        <td>${r.CourtName || 'N/A'}</td>\r\n+        <td>${r.RoleName || 'N/A'}</td>\r\n+        <td><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${r.Status || 'Pending'}</span></td>\r\n         <td>${requestedAt}</td>\r\n         <td class=\"flex space-x-2 justify-center\">\r\n           <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Approve</button>\r\n           <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Reject</button>\r\n           <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Delete</button>\r\n         </td>\r\n       `;\r\n     });\r\n+\r\n     tableBody.querySelectorAll('.approve-btn').forEach(b => b.addEventListener('click', e => handleApproveClick(e.target.dataset.requestId)));\r\n     tableBody.querySelectorAll('.reject-btn').forEach(b => b.addEventListener('click', e => handleRejectClick(e.target.dataset.requestId)));\r\n     tableBody.querySelectorAll('.delete-btn').forEach(b => b.addEventListener('click', e => handleDeleteClick(e.target.dataset.requestId)));\r\n-  } catch (err) {\r\n-    console.error(err);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center text-red-500\">Error loading requests.</td></tr>';\r\n-    displayMessage(\"Failed to load pending requests.\", true);\r\n-  }\r\n+\r\n+  } catch (err) { console.error(err); tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center text-red-500\">Error loading requests.</td></tr>'; displayMessage(\"Failed to load pending requests.\", true); }\r\n }\r\n \r\n async function loadApprovedResidents() {\r\n   const tableBody = document.getElementById('residentsTableBody');\r\n   const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n   if (!tableBody || !noResidentsMsg) return;\r\n+\r\n   tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n   try {\r\n     const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n     const residents = await resp.json();\r\n     tableBody.innerHTML = '';\r\n     noResidentsMsg.classList.toggle('hidden', residents.length > 0);\r\n+\r\n     residents.forEach(r => {\r\n       const row = tableBody.insertRow();\r\n       row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n       row.innerHTML = `\r\n@@ -225,26 +201,14 @@\n         <td>${r.CourtName || 'N/A'}</td>\r\n         <td>${r.RoleName || 'N/A'}</td>\r\n       `;\r\n     });\r\n-  } catch (err) {\r\n-    console.error(err);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center text-red-500\">Error loading approved residents.</td></tr>';\r\n-    displayMessage(\"Failed to load approved residents.\", true);\r\n-  }\r\n-}\r\n \r\n-function attachMembershipListeners() {\r\n-  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-    document.getElementById('requestIdFilter').value = \"\";\r\n-    document.getElementById('residentFilter').value = \"\";\r\n-    displayMessage(\"Filters cleared.\", false);\r\n-  });\r\n+  } catch (err) { console.error(err); tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center text-red-500\">Error loading approved residents.</td></tr>'; displayMessage(\"Failed to load approved residents.\", true); }\r\n }\r\n \r\n // ================================\r\n-// 🚀 DASHBOARD LOGIC\r\n+// DASHBOARD LOGIC\r\n // ================================\r\n async function loadDashboardSummary() {\r\n   try {\r\n     const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, { headers: getAuthHeaders() });\r\n@@ -273,15 +237,15 @@\n   } catch (err) { console.error(err); }\r\n }\r\n \r\n // ================================\r\n-// 🧭 SIDEBAR & PAGE LOADING\r\n+// SIDEBAR LOGIC\r\n // ================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+const sidebarButtons = document.querySelectorAll('.sidebarBtn');\r\n+const visitorToggle = document.getElementById('visitorManagementToggle');\r\n+const visitorSubMenu = document.getElementById('visitorSubMenu');\r\n+const visitorArrow = document.getElementById('visitorArrow');\r\n+const mainContentArea = document.getElementById('main-content-area');\r\n \r\n async function loadPageIntoMainContent(url) {\r\n   mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n   try {\r\n@@ -289,43 +253,40 @@\n     if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n     const html = await res.text();\r\n     mainContentArea.innerHTML = html;\r\n \r\n-    if (url.includes(\"dashboardoverview.html\")) {\r\n-      await loadDashboardSummary(); await loadAccessChart();\r\n-    } else if (url.includes(\"membershiprecords.html\")) {\r\n-      attachMembershipListeners(); await loadApprovedResidents();\r\n-    } else if (url.includes(\"membership.html\")) {\r\n-      attachMembershipListeners(); await loadPendingRequests();\r\n-    } \r\n-    // Additional page-specific loaders can go here...\r\n-  } catch (err) {\r\n-    console.error(err);\r\n-    mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n-  }\r\n+    // Page-specific loaders\r\n+    if (url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n+    else if (url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n+    else if (url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n+    // ... Add other page loaders as needed\r\n+  } catch (err) { console.error(\"Error loading page:\", err); mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`; }\r\n }\r\n \r\n sidebarButtons.forEach(btn => {\r\n-  btn.addEventListener(\"click\", async () => {\r\n+  btn.addEventListener('click', async () => {\r\n     sidebarButtons.forEach(b => {\r\n-      b.classList.remove(\"bg-blue-600\",\"text-white\",\"shadow-inner\");\r\n-      if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-600\",\"hover:bg-blue-500/50\",\"text-white\");\r\n-      else b.classList.add(\"bg-gray-700\",\"hover:bg-gray-600\",\"text-white\");\r\n+      b.classList.remove('bg-blue-600', 'text-white', 'shadow-inner');\r\n+      if (b.closest('#visitorSubMenu')) { b.classList.add('bg-gray-600','hover:bg-blue-500/50','text-white'); b.classList.remove('bg-gray-700','hover:bg-gray-600'); }\r\n+      else { b.classList.add('bg-gray-700','hover:bg-gray-600','text-white'); }\r\n     });\r\n-    btn.classList.add(\"bg-blue-600\",\"text-white\",\"shadow-inner\");\r\n-    if (btn.closest('#visitorSubMenu')) {\r\n-      visitorToggle?.classList.add(\"bg-blue-600\",\"text-white\");\r\n-      visitorSubMenu?.classList.remove(\"hidden\");\r\n-      visitorArrow?.classList.add(\"rotate-90\");\r\n-    }\r\n-    const page = btn.dataset.target;\r\n-    if (page) await loadPageIntoMainContent(page);\r\n+\r\n+    btn.classList.add('bg-blue-600','text-white','shadow-inner');\r\n+    btn.classList.remove('bg-gray-600','bg-gray-700','hover:bg-gray-600','hover:bg-blue-500/50');\r\n+\r\n+    if (btn.closest('#visitorSubMenu')) { visitorToggle.classList.add('bg-blue-600','text-white'); visitorSubMenu.classList.remove('hidden'); visitorArrow.classList.add('rotate-90'); }\r\n+    else { if (btn !== visitorToggle) { visitorSubMenu.classList.add('hidden'); visitorArrow.classList.remove('rotate-90'); visitorToggle.classList.remove('bg-blue-600','text-white'); } }\r\n+\r\n+    const target = btn.dataset.target;\r\n+    if (target) await loadPageIntoMainContent(target);\r\n   });\r\n });\r\n \r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-  visitorSubMenu?.classList.toggle(\"hidden\");\r\n-  visitorArrow?.classList.toggle(\"rotate-90\");\r\n+visitorToggle?.addEventListener('click', () => {\r\n+  visitorSubMenu?.classList.toggle('hidden');\r\n+  visitorArrow?.classList.toggle('rotate-90');\r\n+  visitorToggle.classList.toggle('bg-blue-600');\r\n+  visitorToggle.classList.toggle('text-white');\r\n });\r\n \r\n // ================================\r\n // INITIAL LOAD\r\n"
                },
                {
                    "date": 1763883686024,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,26 +1,30 @@\n-// =========================================================\r\n // adminsdashboard.js\r\n-// Complete Admin Dashboard JS with all logic & sidebar handling\r\n-// =========================================================\r\n+// This file now includes ALL necessary data loading logic (including Membership)\r\n+// to handle dynamic page loading in the Admin Dashboard.\r\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n const API_HOST = \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n-// API Endpoints\r\n+// Define API Endpoints\r\n const ENDPOINTS = {\r\n+  // Dashboard Overview Endpoints\r\n   DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n   DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+\r\n+  // Membership Endpoints\r\n   SYNC: `${API_HOST}/api/admin/sync`,\r\n   PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n   APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n   APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n   REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n   DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+ \r\n+  // General Admin Endpoints\r\n   PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n   ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n   VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n   PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n@@ -31,266 +35,754 @@\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n-document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n   localStorage.removeItem(\"accessToken\");\r\n   window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n-// UTILITIES\r\n+// UTILITIES AND HELPERS\r\n // ================================\r\n+\r\n+/**\r\n+* Creates and returns the standard headers needed for authenticated API calls.\r\n+*/\r\n function getAuthHeaders() {\r\n-  return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };\r\n+  return {\r\n+    'Content-Type': 'application/json',\r\n+    'Authorization': `Bearer ${token}`\r\n+  };\r\n }\r\n \r\n+/**\r\n+* Handles error display in a non-alert manner.\r\n+*/\r\n function displayMessage(message, isError = false) {\r\n   const msgElement = document.getElementById('msg');\r\n-  if (!msgElement) return;\r\n-  msgElement.textContent = message;\r\n-  msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n-    isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'\r\n-  }`;\r\n-  setTimeout(() => {\r\n-    msgElement.textContent = '';\r\n-    msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-  }, 5000);\r\n+  if (msgElement) {\r\n+    msgElement.textContent = message;\r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+   \r\n+    setTimeout(() => {\r\n+      msgElement.textContent = '';\r\n+      msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+    }, 5000);\r\n+  }\r\n }\r\n \r\n+/**\r\n+* Formats a timestamp (string or number) into a readable date string.\r\n+*/\r\n function formatTimestamp(timestamp) {\r\n-  if (!timestamp) return 'N/A';\r\n-  try { return new Date(timestamp).toLocaleString(); } \r\n-  catch { return 'N/A'; }\r\n+  try {\r\n+    if (!timestamp) return 'N/A';\r\n+    return new Date(timestamp).toLocaleString();\r\n+  } catch (e) {\r\n+    return 'N/A';\r\n+  }\r\n }\r\n \r\n+/**\r\n+* Safely updates a DOM element's text content.\r\n+*/\r\n const safeUpdate = (id, value, suffix = '') => {\r\n-  const el = document.getElementById(id);\r\n-  if (el) el.textContent = value + suffix;\r\n+  const element = document.getElementById(id);\r\n+  if (element) {\r\n+    element.textContent = value + suffix;\r\n+  }\r\n };\r\n \r\n-// ================================\r\n-// MEMBERSHIP LOGIC\r\n-// ================================\r\n+\r\n+// ====================================================================\r\n+// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+* Sends an approval request to the backend API.\r\n+*/\r\n async function handleApproveClick(requestId) {\r\n   safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json()).message || 'Approval failed');\r\n+    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+      method: 'PUT',\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+\r\n+    if (!resp.ok) {\r\n+      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+      throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n+    }\r\n+    \r\n     safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-    displayMessage(`Successfully approved membership request ${requestId}.`);\r\n+    displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+    \r\n+    // Reload data after a successful action\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-  } catch (e) { console.error(e); displayMessage(`Approval failed: ${e.message}`, true); }\r\n+\r\n+  } catch (e) {\r\n+    console.error(\"Approval Operation Failed:\", e);\r\n+    displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n+/**\r\n+* Sends a rejection request to the backend API.\r\n+*/\r\n async function handleRejectClick(requestId) {\r\n   safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n   if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json()).message || 'Rejection failed');\r\n+    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+      method: 'PUT', \r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+\r\n+    if (!resp.ok) {\r\n+      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+      throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+    }\r\n+    \r\n     safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-    displayMessage(`Successfully rejected membership request ${requestId}.`);\r\n+    displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+    \r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-  } catch (e) { console.error(e); displayMessage(`Rejection failed: ${e.message}`, true); }\r\n+\r\n+  } catch (e) {\r\n+    console.error(\"Rejection Operation Failed:\", e);\r\n+    displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n+/**\r\n+* Sends a deletion request to the backend API.\r\n+*/\r\n async function handleDeleteClick(requestId) {\r\n   safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-  if (!confirm(`Are you sure you want to DELETE request ${requestId}?`)) return;\r\n+  if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method: 'DELETE', headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json()).message || 'Deletion failed');\r\n+    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+      method: 'DELETE', \r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+\r\n+    if (!resp.ok) {\r\n+      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+      throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+    }\r\n+    \r\n     safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-    displayMessage(`Successfully deleted membership request ${requestId}.`);\r\n+    displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+    \r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-  } catch (e) { console.error(e); displayMessage(`Deletion failed: ${e.message}`, true); }\r\n+\r\n+  } catch (e) {\r\n+    console.error(\"Deletion Operation Failed:\", e);\r\n+    displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n+/**\r\n+* Executes a real API call to trigger server-side data synchronization.\r\n+*/\r\n async function handleSyncClick(event) {\r\n   const btn = event.currentTarget;\r\n   const originalText = btn.textContent;\r\n   const originalClasses = btn.className;\r\n+\r\n+  // 1. Set Loading State\r\n   btn.disabled = true;\r\n   btn.textContent = 'Syncing...';\r\n-  btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md animate-pulse min-w-[100px]';\r\n+  btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n   try {\r\n-    const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json()).message || 'Sync failed');\r\n+    const resp = await fetch(ENDPOINTS.SYNC, { \r\n+      method: 'POST',\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+\r\n+    if (!resp.ok) {\r\n+      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+      throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+    }\r\n+\r\n+    // 2. Set Success State\r\n     btn.textContent = 'Sync Complete! ✔️';\r\n-    btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md min-w-[100px]';\r\n-    displayMessage(\"Data synchronization successful.\");\r\n+    btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+    displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+    // Reload data after a successful sync\r\n     await loadPendingRequests();\r\n     await loadApprovedResidents();\r\n-  } catch (err) { console.error(err); btn.textContent = 'Sync Failed ❌'; btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md min-w-[100px]'; displayMessage(`Sync failed: ${err.message}`, true); }\r\n-  finally { setTimeout(() => { btn.disabled = false; btn.textContent = originalText; btn.className = originalClasses; }, 3000); }\r\n+    \r\n+  } catch (err) {\r\n+    // 3. Set Failure State\r\n+    console.error(\"Synchronization Error:\", err.message);\r\n+    btn.textContent = 'Sync Failed ❌';\r\n+    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+    displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+  } finally {\r\n+    // 4. Reset Button State after a short delay\r\n+    setTimeout(() => {\r\n+      btn.disabled = false;\r\n+      btn.textContent = originalText;\r\n+      btn.className = originalClasses;\r\n+    }, 3000);\r\n+  }\r\n }\r\n \r\n+/**\r\n+* Fetches and renders pending membership requests from the backend API.\r\n+*/\r\n async function loadPendingRequests() {\r\n   const tableBody = document.getElementById('membershipTableBody');\r\n   const countElement = document.getElementById('membershipCount');\r\n   const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+  \r\n   if (!tableBody || !countElement || !noRequestsMsg) return;\r\n \r\n+  // Show loading state\r\n   tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-\r\n+  \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+    \r\n     const requests = await resp.json();\r\n+    \r\n     tableBody.innerHTML = '';\r\n     countElement.textContent = requests.length;\r\n-    noRequestsMsg.classList.toggle('hidden', requests.length > 0);\r\n \r\n-    requests.forEach(r => {\r\n-      const row = tableBody.insertRow();\r\n-      row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-      const requestedAt = formatTimestamp(r.RequestedAt || r.requestedAt);\r\n-      const requestId = r.id || r.RequestID;\r\n-      row.innerHTML = `\r\n-        <td>${requestId}</td>\r\n-        <td>${r.ResidentName || 'N/A'}</td>\r\n-        <td>${r.NationalID || 'N/A'}</td>\r\n-        <td>${r.PhoneNumber || 'N/A'}</td>\r\n-        <td>${r.Email || 'N/A'}</td>\r\n-        <td>${r.HouseNumber || 'N/A'}</td>\r\n-        <td>${r.CourtName || 'N/A'}</td>\r\n-        <td>${r.RoleName || 'N/A'}</td>\r\n-        <td><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${r.Status || 'Pending'}</span></td>\r\n-        <td>${requestedAt}</td>\r\n-        <td class=\"flex space-x-2 justify-center\">\r\n-          <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Approve</button>\r\n-          <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Reject</button>\r\n-          <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Delete</button>\r\n-        </td>\r\n-      `;\r\n-    });\r\n+    if (requests.length === 0) {\r\n+      noRequestsMsg.classList.remove('hidden');\r\n+    } else {\r\n+      noRequestsMsg.classList.add('hidden');\r\n+      requests.forEach(request => {\r\n+        const row = tableBody.insertRow();\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n \r\n-    tableBody.querySelectorAll('.approve-btn').forEach(b => b.addEventListener('click', e => handleApproveClick(e.target.dataset.requestId)));\r\n-    tableBody.querySelectorAll('.reject-btn').forEach(b => b.addEventListener('click', e => handleRejectClick(e.target.dataset.requestId)));\r\n-    tableBody.querySelectorAll('.delete-btn').forEach(b => b.addEventListener('click', e => handleDeleteClick(e.target.dataset.requestId)));\r\n+        const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+        const requestId = request.id || request.RequestID; \r\n \r\n-  } catch (err) { console.error(err); tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center text-red-500\">Error loading requests.</td></tr>'; displayMessage(\"Failed to load pending requests.\", true); }\r\n+        row.innerHTML = `\r\n+          <td class=\"px-4 py-3\">${requestId}</td>\r\n+          <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+          <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+          <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+            <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+              Approve\r\n+            </button>\r\n+            <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+              Reject\r\n+            </button>\r\n+            <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+              Delete\r\n+            </button>\r\n+          </td>\r\n+        `;\r\n+      });\r\n+      \r\n+      // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+      tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+        });\r\n+      });\r\n+      tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+        });\r\n+      });\r\n+      tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+        button.addEventListener('click', (e) => {\r\n+          handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+        });\r\n+      });\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Error loading pending requests:\", error);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    displayMessage(\"Failed to load pending requests from API.\", true);\r\n+  }\r\n }\r\n \r\n+/**\r\n+* Fetches and renders approved residents from the backend API.\r\n+*/\r\n async function loadApprovedResidents() {\r\n   const tableBody = document.getElementById('residentsTableBody');\r\n   const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+  \r\n   if (!tableBody || !noResidentsMsg) return;\r\n \r\n+  // Show loading state\r\n   tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n \r\n   try {\r\n     const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n     if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+    \r\n     const residents = await resp.json();\r\n+\r\n     tableBody.innerHTML = '';\r\n-    noResidentsMsg.classList.toggle('hidden', residents.length > 0);\r\n+    \r\n+    if (residents.length === 0) {\r\n+      noResidentsMsg.classList.remove('hidden');\r\n+    } else {\r\n+      noResidentsMsg.classList.add('hidden');\r\n+      residents.forEach(resident => {\r\n+        const row = tableBody.insertRow();\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.innerHTML = `\r\n+          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+        `;\r\n+      });\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Error loading approved residents:\", error);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    displayMessage(\"Failed to load approved residents from API.\", true);\r\n+  }\r\n+}\r\n \r\n-    residents.forEach(r => {\r\n-      const row = tableBody.insertRow();\r\n-      row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-      row.innerHTML = `\r\n-        <td>${r.ResidentName || 'N/A'}</td>\r\n-        <td>${r.NationalID || 'N/A'}</td>\r\n-        <td>${r.PhoneNumber || 'N/A'}</td>\r\n-        <td>${r.Email || 'N/A'}</td>\r\n-        <td>${r.HouseNumber || 'N/A'}</td>\r\n-        <td>${r.CourtName || 'N/A'}</td>\r\n-        <td>${r.RoleName || 'N/A'}</td>\r\n-      `;\r\n-    });\r\n-\r\n-  } catch (err) { console.error(err); tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center text-red-500\">Error loading approved residents.</td></tr>'; displayMessage(\"Failed to load approved residents.\", true); }\r\n+/**\r\n+* Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+*/\r\n+function attachMembershipListeners() {\r\n+  // Attach listener for the Sync button\r\n+  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+ \r\n+  // Attach listener for Clear Filters button\r\n+  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+    // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+    document.getElementById('requestIdFilter').value = \"\";\r\n+    document.getElementById('residentFilter').value = \"\";\r\n+    displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+  });\r\n }\r\n \r\n-// ================================\r\n-// DASHBOARD LOGIC\r\n-// ================================\r\n+\r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n+// ====================================================================\r\n+\r\n async function loadDashboardSummary() {\r\n   try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(res.statusText);\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+      headers: { \"Authorization\": `Bearer ${token}` }\r\n+    });\r\n+    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n     const data = await res.json();\r\n+\r\n     safeUpdate(\"totalResidents\", data.residents || 0);\r\n     safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n     safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n     safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-  } catch (err) { console.error(err); }\r\n+\r\n+  } catch (err) {\r\n+    console.error(\"Error loading summary:\", err);\r\n+  }\r\n }\r\n \r\n async function loadAccessChart() {\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n+\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        // Destroy existing chart instance if it exists before creating a new one\r\n+        if (window.accessChartInstance) {\r\n+            window.accessChartInstance.destroy();\r\n+        }\r\n+        \r\n+        window.accessChartInstance = new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading chart:\", err);\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+* Fetches and renders payments records.\r\n+*/\r\n+async function loadPaymentsRecords() {\r\n+  const tableBody = document.getElementById('paymentsTableBody');\r\n+  if (!tableBody) return;\r\n+\r\n+  tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+ \r\n   try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(res.statusText);\r\n+    const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+   \r\n+    const records = await resp.json();\r\n+   \r\n+    tableBody.innerHTML = '';\r\n+\r\n+    if (records.length === 0) {\r\n+      tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+    } else {\r\n+      records.forEach(record => {\r\n+        const row = tableBody.insertRow();\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.innerHTML = `\r\n+          <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n+          <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+          <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n+        `;\r\n+      });\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Error loading payments records:\", error);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    displayMessage(\"Failed to load payments records from API.\", true);\r\n+  }\r\n+}\r\n+\r\n+/**\r\n+* Attaches event listeners for payments-specific elements.\r\n+*/\r\n+function attachPaymentsListeners() {\r\n+  // Add any payments-specific listeners here\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 👥 RESIDENTS LOGIC (residents.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+* Fetches and renders all resident details.\r\n+*/\r\n+async function loadAllResidents() {\r\n+  const tableBody = document.getElementById('allResidentsTableBody');\r\n+  if (!tableBody) return;\r\n+\r\n+  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n+   \r\n+    const residents = await resp.json();\r\n+   \r\n+    tableBody.innerHTML = '';\r\n+   \r\n+    if (residents.length === 0) {\r\n+      tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n+    } else {\r\n+      residents.forEach(resident => {\r\n+        const row = tableBody.insertRow();\r\n+        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        row.innerHTML = `\r\n+          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+          <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n+        `;\r\n+      });\r\n+    }\r\n+  } catch (error) {\r\n+    console.error(\"Error loading all residents:\", error);\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+    displayMessage(\"Failed to load all residents from API.\", true);\r\n+  }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n+// ====================================================================\r\n+\r\n+async function loadVisitorPassOverview() {\r\n+  const overviewSection = document.getElementById('visitorOverviewSection');\r\n+  if (!overviewSection) return;\r\n+\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n     const data = await res.json();\r\n-    const ctx = document.getElementById(\"accessChart\")?.getContext(\"2d\");\r\n-    if (!ctx) return;\r\n-    if (window.accessChartInstance) window.accessChartInstance.destroy();\r\n-    window.accessChartInstance = new Chart(ctx, {\r\n-      type: \"line\",\r\n-      data: { labels: data.days || [], datasets: [{ label: \"Access Attempts\", data: data.counts || [], borderWidth: 2, tension: 0.4, borderColor: '#2563eb', backgroundColor: 'rgba(37,99,235,0.2)', fill: true }] },\r\n-      options: { responsive: true, maintainAspectRatio: false }\r\n-    });\r\n-  } catch (err) { console.error(err); }\r\n+   \r\n+    // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+    safeUpdate(\"todayVisitors\", data.today || 0);\r\n+    safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+    safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+   \r\n+  } catch (err) {\r\n+    console.error(\"Error loading visitor overview:\", err);\r\n+  }\r\n }\r\n \r\n-// ================================\r\n-// SIDEBAR LOGIC\r\n-// ================================\r\n-const sidebarButtons = document.querySelectorAll('.sidebarBtn');\r\n-const visitorToggle = document.getElementById('visitorManagementToggle');\r\n-const visitorSubMenu = document.getElementById('visitorSubMenu');\r\n-const visitorArrow = document.getElementById('visitorArrow');\r\n-const mainContentArea = document.getElementById('main-content-area');\r\n+async function loadPendingVisitorApprovals() {\r\n+    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n+    if (!tableBody) return;\r\n \r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+    \r\n+    // Implementation details would be similar to loadPendingRequests()\r\n+}\r\n+\r\n+function attachVisitorListeners() {\r\n+  // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+  // Placeholder implementation\r\n+    const reportsContainer = document.getElementById('reportsContainer');\r\n+    if (!reportsContainer) return;\r\n+    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+    const data = await res.json();\r\n+        \r\n+        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n+        // For simplicity, we just display a success message:\r\n+        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n+\r\n+  } catch (err) {\r\n+    console.error(\"Error loading reports data:\", err);\r\n+        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+  }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+  const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    if (!logTableBody) return;\r\n+\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+        const logs = await resp.json();\r\n+\r\n+        logTableBody.innerHTML = '';\r\n+        if (logs.length === 0) {\r\n+            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+        } else {\r\n+            // Populate table rows with logs\r\n+        }\r\n+    } catch (error) {\r\n+        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+    }\r\n+}\r\n+\r\n+function attachOverrideListeners() {\r\n+  // Attach listener for the 'Perform Manual Override' button\r\n+  document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+        \r\n+        try {\r\n+            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n+                method: 'POST',\r\n+                headers: getAuthHeaders(),\r\n+                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n+            });\r\n+            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+\r\n+            displayMessage(\"Manual override successful!\", false);\r\n+            await loadManualOverrides(); // Reload logs\r\n+\r\n+        } catch (e) {\r\n+            displayMessage(`Manual override failed: ${e.message}`, true);\r\n+        }\r\n+  });\r\n+}\r\n+document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n+    btn.addEventListener('click', async () => {\r\n+        // Remove active styling from all\r\n+        document.querySelectorAll('.sidebarBtn').forEach(b => b.classList.remove('bg-blue-600', 'shadow-inner'));\r\n+        \r\n+        // Add active styling to current\r\n+        btn.classList.add('bg-blue-600', 'shadow-inner');\r\n+        \r\n+        // Load content\r\n+        const target = btn.getAttribute('data-target');\r\n+        const contentDiv = document.getElementById('dynamic-section-content');\r\n+        const res = await fetch(target);\r\n+        contentDiv.innerHTML = await res.text();\r\n+    });\r\n+});\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n+// ====================================================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n+\r\n async function loadPageIntoMainContent(url) {\r\n+  // Show a loading state instantly\r\n   mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+\r\n   try {\r\n     const res = await fetch(url);\r\n     if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n     const html = await res.text();\r\n-    mainContentArea.innerHTML = html;\r\n+    mainContentArea.innerHTML = html; // Inject HTML first\r\n \r\n-    // Page-specific loaders\r\n-    if (url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n-    else if (url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n-    else if (url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n-    // ... Add other page loaders as needed\r\n-  } catch (err) { console.error(\"Error loading page:\", err); mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`; }\r\n+    // 🟢 Execute data loading functions based on the page loaded\r\n+    if (url.includes(\"dashboardoverview.html\")) {\r\n+      await loadDashboardSummary();\r\n+      await loadAccessChart();\r\n+    }\r\n+   \r\n+    // --- MEMBERSHIP PAGES ---\r\n+    else if (url.includes(\"membershiprecords.html\")) {\r\n+      // Approved Residents\r\n+      attachMembershipListeners();\r\n+      await loadApprovedResidents();\r\n+    } else if (url.includes(\"membership.html\")) {\r\n+      // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n+      attachMembershipListeners();\r\n+      await loadPendingRequests();\r\n+    }\r\n+   \r\n+    // --- PAYMENTS RECORDS ---\r\n+    else if (url.includes(\"payments.html\")) {\r\n+      attachPaymentsListeners();\r\n+      await loadPaymentsRecords();\r\n+    }\r\n+   \r\n+    // --- RESIDENTS ---\r\n+    else if (url.includes(\"residents.html\")) {\r\n+      await loadAllResidents();\r\n+    }\r\n+   \r\n+    // --- VISITORS MANAGEMENT ---\r\n+    else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+      attachVisitorListeners();\r\n+      // Load data relevant to the main visitor pages\r\n+      await loadVisitorPassOverview();\r\n+      await loadPendingVisitorApprovals();\r\n+    }\r\n+   \r\n+    // --- CHARTS AND REPORTS ---\r\n+    else if (url.includes(\"chartsandreports.html\")) {\r\n+      await loadReportsData();\r\n+    }\r\n+   \r\n+    // --- MANUAL OVERRIDES ---\r\n+    else if (url.includes(\"manualoverride.html\")) {\r\n+      attachOverrideListeners();\r\n+      await loadManualOverrides();\r\n+    }\r\n+  } catch (err) {\r\n+    console.error(\"Error loading page:\", err);\r\n+    mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+  }\r\n }\r\n \r\n+// ... (existing sidebar button loop and visitor toggle logic)\r\n+\r\n sidebarButtons.forEach(btn => {\r\n-  btn.addEventListener('click', async () => {\r\n+  btn.addEventListener(\"click\", async () => {\r\n     sidebarButtons.forEach(b => {\r\n-      b.classList.remove('bg-blue-600', 'text-white', 'shadow-inner');\r\n-      if (b.closest('#visitorSubMenu')) { b.classList.add('bg-gray-600','hover:bg-blue-500/50','text-white'); b.classList.remove('bg-gray-700','hover:bg-gray-600'); }\r\n-      else { b.classList.add('bg-gray-700','hover:bg-gray-600','text-white'); }\r\n+      b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+      // Also ensure sub-menu items are correctly reset if needed\r\n+      if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n+            \r\n+            // Re-apply specific default styles for sub-menu items if needed\r\n+            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n+                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            }\r\n     });\r\n+   \r\n+    btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n \r\n-    btn.classList.add('bg-blue-600','text-white','shadow-inner');\r\n-    btn.classList.remove('bg-gray-600','bg-gray-700','hover:bg-gray-600','hover:bg-blue-500/50');\r\n-\r\n-    if (btn.closest('#visitorSubMenu')) { visitorToggle.classList.add('bg-blue-600','text-white'); visitorSubMenu.classList.remove('hidden'); visitorArrow.classList.add('rotate-90'); }\r\n-    else { if (btn !== visitorToggle) { visitorSubMenu.classList.add('hidden'); visitorArrow.classList.remove('rotate-90'); visitorToggle.classList.remove('bg-blue-600','text-white'); } }\r\n-\r\n-    const target = btn.dataset.target;\r\n-    if (target) await loadPageIntoMainContent(target);\r\n+    const page = btn.dataset.target;\r\n+    if (page) loadPageIntoMainContent(page);\r\n   });\r\n });\r\n \r\n-visitorToggle?.addEventListener('click', () => {\r\n-  visitorSubMenu?.classList.toggle('hidden');\r\n-  visitorArrow?.classList.toggle('rotate-90');\r\n-  visitorToggle.classList.toggle('bg-blue-600');\r\n-  visitorToggle.classList.toggle('text-white');\r\n+\r\n+// ================================\r\n+// MISC UI TOGGLES\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+  visitorSubMenu?.classList.toggle(\"hidden\");\r\n+  visitorArrow?.classList.toggle(\"rotate-90\");\r\n });\r\n \r\n // ================================\r\n-// INITIAL LOAD\r\n+// INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n+\r\n document.addEventListener('DOMContentLoaded', () => {\r\n+  // Load the initial dashboard view when the admin page first loads\r\n   loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n+\r\n"
                },
                {
                    "date": 1763883876089,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,405 +4,405 @@\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-const API_HOST = \"http://localhost:4050\"; \r\n+const API_HOST =  \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n-  // Dashboard Overview Endpoints\r\n-  DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-  DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    // Dashboard Overview Endpoints\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-  // Membership Endpoints\r\n-  SYNC: `${API_HOST}/api/admin/sync`,\r\n-  PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-  APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-  APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-  REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-  DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n- \r\n-  // General Admin Endpoints\r\n-  PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-  ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-  VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-  PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-  REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-  MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-  MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    // Membership Endpoints\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    \r\n+    // General Admin Endpoints\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-  localStorage.removeItem(\"accessToken\");\r\n-  window.location.href = \"/login.html\";\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n // UTILITIES AND HELPERS\r\n // ================================\r\n \r\n /**\r\n-* Creates and returns the standard headers needed for authenticated API calls.\r\n-*/\r\n+ * Creates and returns the standard headers needed for authenticated API calls.\r\n+ */\r\n function getAuthHeaders() {\r\n-  return {\r\n-    'Content-Type': 'application/json',\r\n-    'Authorization': `Bearer ${token}`\r\n-  };\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n }\r\n \r\n /**\r\n-* Handles error display in a non-alert manner.\r\n-*/\r\n+ * Handles error display in a non-alert manner.\r\n+ */\r\n function displayMessage(message, isError = false) {\r\n-  const msgElement = document.getElementById('msg');\r\n-  if (msgElement) {\r\n-    msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-   \r\n-    setTimeout(() => {\r\n-      msgElement.textContent = '';\r\n-      msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-    }, 5000);\r\n-  }\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n }\r\n \r\n /**\r\n-* Formats a timestamp (string or number) into a readable date string.\r\n-*/\r\n+ * Formats a timestamp (string or number) into a readable date string.\r\n+ */\r\n function formatTimestamp(timestamp) {\r\n-  try {\r\n-    if (!timestamp) return 'N/A';\r\n-    return new Date(timestamp).toLocaleString();\r\n-  } catch (e) {\r\n-    return 'N/A';\r\n-  }\r\n+    try {\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n }\r\n \r\n /**\r\n-* Safely updates a DOM element's text content.\r\n-*/\r\n+ * Safely updates a DOM element's text content.\r\n+ */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n-  const element = document.getElementById(id);\r\n-  if (element) {\r\n-    element.textContent = value + suffix;\r\n-  }\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    }\r\n };\r\n \r\n \r\n // ====================================================================\r\n // 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n // ====================================================================\r\n \r\n /**\r\n-* Sends an approval request to the backend API.\r\n-*/\r\n+ * Sends an approval request to the backend API.\r\n+ */\r\n async function handleApproveClick(requestId) {\r\n-  safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-      method: 'PUT',\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n \r\n-    if (!resp.ok) {\r\n-      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-      throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-    }\r\n-    \r\n-    safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-    displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-    \r\n-    // Reload data after a successful action\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        \r\n+        // Reload data after a successful action\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n \r\n-  } catch (e) {\r\n-    console.error(\"Approval Operation Failed:\", e);\r\n-    displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-  }\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n /**\r\n-* Sends a rejection request to the backend API.\r\n-*/\r\n+ * Sends a rejection request to the backend API.\r\n+ */\r\n async function handleRejectClick(requestId) {\r\n-  safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-  if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-      method: 'PUT', \r\n-      headers: getAuthHeaders(),\r\n-    });\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n \r\n-    if (!resp.ok) {\r\n-      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-      throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-    }\r\n-    \r\n-    safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-    displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-    \r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n \r\n-  } catch (e) {\r\n-    console.error(\"Rejection Operation Failed:\", e);\r\n-    displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-  }\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n /**\r\n-* Sends a deletion request to the backend API.\r\n-*/\r\n+ * Sends a deletion request to the backend API.\r\n+ */\r\n async function handleDeleteClick(requestId) {\r\n-  safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-  if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-      method: 'DELETE', \r\n-      headers: getAuthHeaders(),\r\n-    });\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n \r\n-    if (!resp.ok) {\r\n-      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-      throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-    }\r\n-    \r\n-    safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-    displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-    \r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n \r\n-  } catch (e) {\r\n-    console.error(\"Deletion Operation Failed:\", e);\r\n-    displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-  }\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n /**\r\n-* Executes a real API call to trigger server-side data synchronization.\r\n-*/\r\n+ * Executes a real API call to trigger server-side data synchronization.\r\n+ */\r\n async function handleSyncClick(event) {\r\n-  const btn = event.currentTarget;\r\n-  const originalText = btn.textContent;\r\n-  const originalClasses = btn.className;\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n \r\n-  // 1. Set Loading State\r\n-  btn.disabled = true;\r\n-  btn.textContent = 'Syncing...';\r\n-  btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+    // 1. Set Loading State\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.SYNC, { \r\n-      method: 'POST',\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { \r\n+            method: 'POST',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n \r\n-    if (!resp.ok) {\r\n-      const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-      throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-    }\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+        }\r\n \r\n-    // 2. Set Success State\r\n-    btn.textContent = 'Sync Complete! ✔️';\r\n-    btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-    displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+        // 2. Set Success State\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n \r\n-    // Reload data after a successful sync\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-    \r\n-  } catch (err) {\r\n-    // 3. Set Failure State\r\n-    console.error(\"Synchronization Error:\", err.message);\r\n-    btn.textContent = 'Sync Failed ❌';\r\n-    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-    displayMessage(`Sync failed: ${err.message}`, true);\r\n+        // Reload data after a successful sync\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+        \r\n+    } catch (err) {\r\n+        // 3. Set Failure State\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n \r\n-  } finally {\r\n-    // 4. Reset Button State after a short delay\r\n-    setTimeout(() => {\r\n-      btn.disabled = false;\r\n-      btn.textContent = originalText;\r\n-      btn.className = originalClasses;\r\n-    }, 3000);\r\n-  }\r\n+    } finally {\r\n+        // 4. Reset Button State after a short delay\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n+    }\r\n }\r\n \r\n /**\r\n-* Fetches and renders pending membership requests from the backend API.\r\n-*/\r\n+ * Fetches and renders pending membership requests from the backend API.\r\n+ */\r\n async function loadPendingRequests() {\r\n-  const tableBody = document.getElementById('membershipTableBody');\r\n-  const countElement = document.getElementById('membershipCount');\r\n-  const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-  \r\n-  if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    \r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n \r\n-  // Show loading state\r\n-  tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-  \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-    \r\n-    const requests = await resp.json();\r\n-    \r\n-    tableBody.innerHTML = '';\r\n-    countElement.textContent = requests.length;\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        \r\n+        const requests = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n \r\n-    if (requests.length === 0) {\r\n-      noRequestsMsg.classList.remove('hidden');\r\n-    } else {\r\n-      noRequestsMsg.classList.add('hidden');\r\n-      requests.forEach(request => {\r\n-        const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n \r\n-        const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-        const requestId = request.id || request.RequestID; \r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID; \r\n \r\n-        row.innerHTML = `\r\n-          <td class=\"px-4 py-3\">${requestId}</td>\r\n-          <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-          <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-          <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-            <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-              Approve\r\n-            </button>\r\n-            <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-              Reject\r\n-            </button>\r\n-            <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-              Delete\r\n-            </button>\r\n-          </td>\r\n-        `;\r\n-      });\r\n-      \r\n-      // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-      tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-        });\r\n-      });\r\n-      tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-        });\r\n-      });\r\n-      tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-        button.addEventListener('click', (e) => {\r\n-          handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-        });\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Error loading pending requests:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-    displayMessage(\"Failed to load pending requests from API.\", true);\r\n-  }\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Approve\r\n+                        </button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Reject\r\n+                        </button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Delete\r\n+                        </button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            \r\n+            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n }\r\n \r\n /**\r\n-* Fetches and renders approved residents from the backend API.\r\n-*/\r\n+ * Fetches and renders approved residents from the backend API.\r\n+ */\r\n async function loadApprovedResidents() {\r\n-  const tableBody = document.getElementById('residentsTableBody');\r\n-  const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-  \r\n-  if (!tableBody || !noResidentsMsg) return;\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    \r\n+    if (!tableBody || !noResidentsMsg) return;\r\n \r\n-  // Show loading state\r\n-  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-    \r\n-    const residents = await resp.json();\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n \r\n-    tableBody.innerHTML = '';\r\n-    \r\n-    if (residents.length === 0) {\r\n-      noResidentsMsg.classList.remove('hidden');\r\n-    } else {\r\n-      noResidentsMsg.classList.add('hidden');\r\n-      residents.forEach(resident => {\r\n-        const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-        row.innerHTML = `\r\n-          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-        `;\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Error loading approved residents:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-    displayMessage(\"Failed to load approved residents from API.\", true);\r\n-  }\r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading approved residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents from API.\", true);\r\n+    }\r\n }\r\n \r\n /**\r\n-* Attaches event listeners for membership-specific elements (Sync, Filters)\r\n-*/\r\n+ * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+ */\r\n function attachMembershipListeners() {\r\n-  // Attach listener for the Sync button\r\n-  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n- \r\n-  // Attach listener for Clear Filters button\r\n-  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-    // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n-    document.getElementById('requestIdFilter').value = \"\";\r\n-    document.getElementById('residentFilter').value = \"\";\r\n-    displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-  });\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n }\r\n \r\n \r\n // ====================================================================\r\n // 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n // ====================================================================\r\n \r\n async function loadDashboardSummary() {\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-      headers: { \"Authorization\": `Bearer ${token}` }\r\n-    });\r\n-    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-    const data = await res.json();\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-    safeUpdate(\"totalResidents\", data.residents || 0);\r\n-    safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-    safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-    safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n \r\n-  } catch (err) {\r\n-    console.error(\"Error loading summary:\", err);\r\n-  }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n+    }\r\n }\r\n \r\n async function loadAccessChart() {\r\n     try {\r\n@@ -448,123 +448,123 @@\n // 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n // ====================================================================\r\n \r\n /**\r\n-* Fetches and renders payments records.\r\n-*/\r\n+ * Fetches and renders payments records.\r\n+ */\r\n async function loadPaymentsRecords() {\r\n-  const tableBody = document.getElementById('paymentsTableBody');\r\n-  if (!tableBody) return;\r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return; \r\n \r\n-  tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n- \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-   \r\n-    const records = await resp.json();\r\n-   \r\n-    tableBody.innerHTML = '';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+        \r\n+        const records = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n \r\n-    if (records.length === 0) {\r\n-      tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-    } else {\r\n-      records.forEach(record => {\r\n-        const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-        row.innerHTML = `\r\n-          <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n-          <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-          <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-        `;\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Error loading payments records:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-    displayMessage(\"Failed to load payments records from API.\", true);\r\n-  }\r\n+        if (records.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+        } else {\r\n+            records.forEach(record => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading payments records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load payments records from API.\", true);\r\n+    }\r\n }\r\n \r\n /**\r\n-* Attaches event listeners for payments-specific elements.\r\n-*/\r\n+ * Attaches event listeners for payments-specific elements.\r\n+ */\r\n function attachPaymentsListeners() {\r\n-  // Add any payments-specific listeners here\r\n+    // Add any payments-specific listeners here\r\n }\r\n \r\n \r\n // ====================================================================\r\n // 👥 RESIDENTS LOGIC (residents.html)\r\n // ====================================================================\r\n \r\n /**\r\n-* Fetches and renders all resident details.\r\n-*/\r\n+ * Fetches and renders all resident details.\r\n+ */\r\n async function loadAllResidents() {\r\n-  const tableBody = document.getElementById('allResidentsTableBody');\r\n-  if (!tableBody) return;\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n \r\n-  tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n \r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-   \r\n-    const residents = await resp.json();\r\n-   \r\n-    tableBody.innerHTML = '';\r\n-   \r\n-    if (residents.length === 0) {\r\n-      tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-    } else {\r\n-      residents.forEach(resident => {\r\n-        const row = tableBody.insertRow();\r\n-        row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-        row.innerHTML = `\r\n-          <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-          <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-        `;\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    console.error(\"Error loading all residents:\", error);\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-    displayMessage(\"Failed to load all residents from API.\", true);\r\n-  }\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n+        } else {\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load all residents from API.\", true);\r\n+    }\r\n }\r\n \r\n \r\n // ====================================================================\r\n // 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n // ====================================================================\r\n \r\n async function loadVisitorPassOverview() {\r\n-  const overviewSection = document.getElementById('visitorOverviewSection');\r\n-  if (!overviewSection) return;\r\n+    const overviewSection = document.getElementById('visitorOverviewSection');\r\n+    if (!overviewSection) return;\r\n \r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-    const data = await res.json();\r\n-   \r\n-    // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n-    safeUpdate(\"todayVisitors\", data.today || 0);\r\n-    safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-    safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-   \r\n-  } catch (err) {\r\n-    console.error(\"Error loading visitor overview:\", err);\r\n-  }\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+        safeUpdate(\"todayVisitors\", data.today || 0);\r\n+        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+        \r\n+    } catch (err) {\r\n+        console.error(\"Error loading visitor overview:\", err);\r\n+    }\r\n }\r\n \r\n async function loadPendingVisitorApprovals() {\r\n     const tableBody = document.getElementById('visitorRequestsTableBody');\r\n@@ -575,44 +575,44 @@\n     // Implementation details would be similar to loadPendingRequests()\r\n }\r\n \r\n function attachVisitorListeners() {\r\n-  // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n }\r\n \r\n \r\n // ====================================================================\r\n // 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n // ====================================================================\r\n \r\n async function loadReportsData() {\r\n-  // Placeholder implementation\r\n+    // Placeholder implementation\r\n     const reportsContainer = document.getElementById('reportsContainer');\r\n     if (!reportsContainer) return;\r\n     reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n \r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-    const data = await res.json();\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n         \r\n         // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n         // For simplicity, we just display a success message:\r\n         reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n \r\n-  } catch (err) {\r\n-    console.error(\"Error loading reports data:\", err);\r\n+    } catch (err) {\r\n+        console.error(\"Error loading reports data:\", err);\r\n         reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n-  }\r\n+    }\r\n }\r\n \r\n \r\n // ====================================================================\r\n // 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n // ====================================================================\r\n \r\n async function loadManualOverrides() {\r\n-  const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    const logTableBody = document.getElementById('overrideLogTableBody');\r\n     if (!logTableBody) return;\r\n \r\n     logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n     \r\n@@ -632,10 +632,10 @@\n     }\r\n }\r\n \r\n function attachOverrideListeners() {\r\n-  // Attach listener for the 'Perform Manual Override' button\r\n-  document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+    // Attach listener for the 'Perform Manual Override' button\r\n+    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n         if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n         \r\n         try {\r\n             // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n@@ -651,25 +651,10 @@\n \r\n         } catch (e) {\r\n             displayMessage(`Manual override failed: ${e.message}`, true);\r\n         }\r\n-  });\r\n+    });\r\n }\r\n-document.querySelectorAll('.sidebarBtn').forEach(btn => {\r\n-    btn.addEventListener('click', async () => {\r\n-        // Remove active styling from all\r\n-        document.querySelectorAll('.sidebarBtn').forEach(b => b.classList.remove('bg-blue-600', 'shadow-inner'));\r\n-        \r\n-        // Add active styling to current\r\n-        btn.classList.add('bg-blue-600', 'shadow-inner');\r\n-        \r\n-        // Load content\r\n-        const target = btn.getAttribute('data-target');\r\n-        const contentDiv = document.getElementById('dynamic-section-content');\r\n-        const res = await fetch(target);\r\n-        contentDiv.innerHTML = await res.text();\r\n-    });\r\n-});\r\n \r\n \r\n // ====================================================================\r\n // 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n@@ -677,92 +662,92 @@\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n async function loadPageIntoMainContent(url) {\r\n-  // Show a loading state instantly\r\n-  mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+    // Show a loading state instantly\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n \r\n-  try {\r\n-    const res = await fetch(url);\r\n-    if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-    const html = await res.text();\r\n-    mainContentArea.innerHTML = html; // Inject HTML first\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html; // Inject HTML first\r\n \r\n-    // 🟢 Execute data loading functions based on the page loaded\r\n-    if (url.includes(\"dashboardoverview.html\")) {\r\n-      await loadDashboardSummary();\r\n-      await loadAccessChart();\r\n-    }\r\n-   \r\n-    // --- MEMBERSHIP PAGES ---\r\n-    else if (url.includes(\"membershiprecords.html\")) {\r\n-      // Approved Residents\r\n-      attachMembershipListeners();\r\n-      await loadApprovedResidents();\r\n-    } else if (url.includes(\"membership.html\")) {\r\n-      // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n-      attachMembershipListeners();\r\n-      await loadPendingRequests();\r\n-    }\r\n-   \r\n-    // --- PAYMENTS RECORDS ---\r\n-    else if (url.includes(\"payments.html\")) {\r\n-      attachPaymentsListeners();\r\n-      await loadPaymentsRecords();\r\n-    }\r\n-   \r\n-    // --- RESIDENTS ---\r\n-    else if (url.includes(\"residents.html\")) {\r\n-      await loadAllResidents();\r\n-    }\r\n-   \r\n-    // --- VISITORS MANAGEMENT ---\r\n-    else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-      attachVisitorListeners();\r\n-      // Load data relevant to the main visitor pages\r\n-      await loadVisitorPassOverview();\r\n-      await loadPendingVisitorApprovals();\r\n-    }\r\n-   \r\n-    // --- CHARTS AND REPORTS ---\r\n-    else if (url.includes(\"chartsandreports.html\")) {\r\n-      await loadReportsData();\r\n-    }\r\n-   \r\n-    // --- MANUAL OVERRIDES ---\r\n-    else if (url.includes(\"manualoverride.html\")) {\r\n-      attachOverrideListeners();\r\n-      await loadManualOverrides();\r\n-    }\r\n-  } catch (err) {\r\n-    console.error(\"Error loading page:\", err);\r\n-    mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n-  }\r\n+        // 🟢 Execute data loading functions based on the page loaded \r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n+        } \r\n+        \r\n+        // --- MEMBERSHIP PAGES ---\r\n+        else if (url.includes(\"membershiprecords.html\")) {\r\n+            // Approved Residents\r\n+            attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+        }\r\n+        \r\n+        // --- PAYMENTS RECORDS ---\r\n+        else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } \r\n+        \r\n+        // --- RESIDENTS ---\r\n+        else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } \r\n+        \r\n+        // --- VISITORS MANAGEMENT ---\r\n+        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+            attachVisitorListeners();\r\n+            // Load data relevant to the main visitor pages\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        }\r\n+        \r\n+        // --- CHARTS AND REPORTS ---\r\n+        else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } \r\n+        \r\n+        // --- MANUAL OVERRIDES ---\r\n+        else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    }\r\n }\r\n \r\n // ... (existing sidebar button loop and visitor toggle logic)\r\n \r\n sidebarButtons.forEach(btn => {\r\n-  btn.addEventListener(\"click\", async () => {\r\n-    sidebarButtons.forEach(b => {\r\n-      b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-      // Also ensure sub-menu items are correctly reset if needed\r\n-      if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => {\r\n+            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+            // Also ensure sub-menu items are correctly reset if needed\r\n+            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n             if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n             \r\n             // Re-apply specific default styles for sub-menu items if needed\r\n             if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n                  b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n                  b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n             }\r\n-    });\r\n-   \r\n-    btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        });\r\n+        \r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n         btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n \r\n-    const page = btn.dataset.target;\r\n-    if (page) loadPageIntoMainContent(page);\r\n-  });\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n });\r\n \r\n \r\n // ================================\r\n@@ -772,17 +757,16 @@\n const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n visitorToggle?.addEventListener(\"click\", () => {\r\n-  visitorSubMenu?.classList.toggle(\"hidden\");\r\n-  visitorArrow?.classList.toggle(\"rotate-90\");\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n });\r\n \r\n // ================================\r\n // INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n \r\n document.addEventListener('DOMContentLoaded', () => {\r\n-  // Load the initial dashboard view when the admin page first loads\r\n-  loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\r\n-\r\n+    // Load the initial dashboard view when the admin page first loads\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+});\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763886013130,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -768,5 +768,96 @@\n \r\n document.addEventListener('DOMContentLoaded', () => {\r\n     // Load the initial dashboard view when the admin page first loads\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\n\\ No newline at end of file\n+});\r\n+// ================================\r\n+// 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n+// ================================\r\n+\r\n+const logsTableBody = document.getElementById(\"logsTableBody\");\r\n+const filterInputs = document.querySelectorAll(\"#accessLogs .filterInput\");\r\n+const exportCsvBtn = document.getElementById(\"exportCsvBtn\");\r\n+const exportExcelBtn = document.getElementById(\"exportExcelBtn\");\r\n+\r\n+// Function to fetch and populate access logs\r\n+async function loadAccessLogs() {\r\n+  if (!logsTableBody) return;\r\n+  logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading access logs...</td></tr>`;\r\n+\r\n+  try {\r\n+    const res = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n+      headers: {\r\n+        \"Content-Type\": \"application/json\",\r\n+        \"Authorization\": `Bearer ${localStorage.getItem(\"accessToken\")}`\r\n+      }\r\n+    });\r\n+\r\n+    if (!res.ok) throw new Error(\"Failed to fetch access logs\");\r\n+\r\n+    const logs = await res.json();\r\n+\r\n+    if (!logs.length) {\r\n+      logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500 italic\">No access logs found.</td></tr>`;\r\n+      return;\r\n+    }\r\n+\r\n+    logsTableBody.innerHTML = \"\";\r\n+\r\n+    logs.forEach(log => {\r\n+      const row = document.createElement(\"tr\");\r\n+      row.className = \"hover:bg-gray-100 transition-colors duration-100\";\r\n+      row.innerHTML = `\r\n+        <td class=\"p-2 border-b border-gray-300\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+        <td class=\"p-2 border-b border-gray-300\">${log.userId}</td>\r\n+        <td class=\"p-2 border-b border-gray-300\">${log.action}</td>\r\n+        <td class=\"p-2 border-b border-gray-300\">${log.logType}</td>\r\n+      `;\r\n+      logsTableBody.appendChild(row);\r\n+    });\r\n+\r\n+  } catch (err) {\r\n+    console.error(err);\r\n+    logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500\">Error loading access logs</td></tr>`;\r\n+  }\r\n+}\r\n+\r\n+// ================================\r\n+// 🔹 FILTER LOGS\r\n+// ================================\r\n+filterInputs.forEach((input, colIndex) => {\r\n+  input.addEventListener(\"input\", () => {\r\n+    const filterValue = input.value.toLowerCase();\r\n+    const rows = logsTableBody.querySelectorAll(\"tr\");\r\n+    rows.forEach(row => {\r\n+      const cell = row.cells[colIndex];\r\n+      if (!cell) return;\r\n+      row.style.display = cell.textContent.toLowerCase().includes(filterValue) ? \"\" : \"none\";\r\n+    });\r\n+  });\r\n+});\r\n+\r\n+// ================================\r\n+// 🔹 EXPORT FUNCTIONS\r\n+// ================================\r\n+function downloadCSV() {\r\n+  const rows = Array.from(logsTableBody.querySelectorAll(\"tr\"))\r\n+    .filter(r => r.style.display !== \"none\")\r\n+    .map(r => Array.from(r.cells).map(cell => `\"${cell.textContent}\"`).join(\",\"))\r\n+    .join(\"\\n\");\r\n+\r\n+  const blob = new Blob([rows], { type: \"text/csv\" });\r\n+  const link = document.createElement(\"a\");\r\n+  link.href = URL.createObjectURL(blob);\r\n+  link.download = `access_logs_${Date.now()}.csv`;\r\n+  link.click();\r\n+}\r\n+\r\n+exportCsvBtn?.addEventListener(\"click\", downloadCSV);\r\n+exportExcelBtn?.addEventListener(\"click\", downloadCSV); // Quick export to CSV; can integrate Excel lib if needed\r\n+\r\n+// ================================\r\n+// 🔹 INITIAL LOAD\r\n+// ================================\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+  loadAccessLogs();\r\n+});\r\n"
                },
                {
                    "date": 1763886363660,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -860,4 +860,59 @@\n // ================================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n   loadAccessLogs();\r\n });\r\n+// adminsdashboard.js\r\n+\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+  const accesslogsTableBody = document.getElementById(\"logsTableBody\");\r\n+\r\n+  // Fetch Access Logs from backend\r\n+  async function loadaccesslogs() {\r\n+    try {\r\n+      const token = localStorage.getItem(\"accessToken\"); // if using JWT auth\r\n+      const response = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n+        headers: {\r\n+          \"Authorization\": `Bearer ${token}`,\r\n+        },\r\n+      });\r\n+\r\n+      if (!response.ok) throw new Error(\"Failed to fetch Access Logs\");\r\n+\r\n+      const logs = await response.json();\r\n+      renderaccesslogs(logs);\r\n+    } catch (err) {\r\n+      console.error(\"Error loading access logs:\", err);\r\n+      accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500 p-4\">Unable to load Access Logs</td></tr>`;\r\n+    }\r\n+  }\r\n+\r\n+  // Render table rows\r\n+  function renderaccesslogs(logs) {\r\n+    if (!logs || logs.length === 0) {\r\n+      accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center p-4\">No logs found</td></tr>`;\r\n+      return;\r\n+    }\r\n+\r\n+    accesslogsTableBody.innerHTML = logs\r\n+      .map(log => `\r\n+        <tr class=\"border-b\">\r\n+          <td class=\"p-2 border-r\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+          <td class=\"p-2 border-r\">${log.userId}</td>\r\n+          <td class=\"p-2 border-r\">${log.action}</td>\r\n+          <td class=\"p-2\">${log.type}</td>\r\n+        </tr>\r\n+      `).join(\"\");\r\n+  }\r\n+\r\n+  // Show Access Logs tab when sidebar button is clicked\r\n+  const accesslogsBtn = document.querySelector('.sidebarBtn[data-target=\"sections/accesslogs.html\"]');\r\n+  accesslogsBtn.addEventListener(\"click\", () => {\r\n+    // Hide all other dynamic sections\r\n+    document.querySelectorAll(\"#main-content-area > div\").forEach(div => div.classList.add(\"hidden\"));\r\n+    // Show Access Logs\r\n+    document.getElementById(\"accesslogs\").classList.remove(\"hidden\");\r\n+\r\n+    // Load logs\r\n+    loadaccesslogs();\r\n+  });\r\n+});\r\n"
                },
                {
                    "date": 1763886426373,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -774,14 +774,14 @@\n // 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n // ================================\r\n \r\n const logsTableBody = document.getElementById(\"logsTableBody\");\r\n-const filterInputs = document.querySelectorAll(\"#accessLogs .filterInput\");\r\n+const filterInputs = document.querySelectorAll(\"#accesslogs .filterInput\");\r\n const exportCsvBtn = document.getElementById(\"exportCsvBtn\");\r\n const exportExcelBtn = document.getElementById(\"exportExcelBtn\");\r\n \r\n // Function to fetch and populate access logs\r\n-async function loadAccessLogs() {\r\n+async function loadaccesslogs() {\r\n   if (!logsTableBody) return;\r\n   logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading access logs...</td></tr>`;\r\n \r\n   try {\r\n@@ -858,9 +858,9 @@\n // ================================\r\n // 🔹 INITIAL LOAD\r\n // ================================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n-  loadAccessLogs();\r\n+  loadaccesslogs();\r\n });\r\n // adminsdashboard.js\r\n \r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n"
                },
                {
                    "date": 1763886866145,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,806 +4,235 @@\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-const API_HOST =  \"http://localhost:4050\"; \r\n+const API_HOST =  \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    // Dashboard Overview Endpoints\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-    // Membership Endpoints\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    \r\n-    // General Admin Endpoints\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    // Membership Endpoints\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    \r\n+    // General Admin Endpoints\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n // UTILITIES AND HELPERS\r\n // ================================\r\n \r\n-/**\r\n- * Creates and returns the standard headers needed for authenticated API calls.\r\n- */\r\n function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n }\r\n \r\n-/**\r\n- * Handles error display in a non-alert manner.\r\n- */\r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-        \r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Formats a timestamp (string or number) into a readable date string.\r\n- */\r\n function formatTimestamp(timestamp) {\r\n-    try {\r\n-        if (!timestamp) return 'N/A';\r\n-        return new Date(timestamp).toLocaleString();\r\n-    } catch (e) {\r\n-        return 'N/A';\r\n-    }\r\n+    try {\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Safely updates a DOM element's text content.\r\n- */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    }\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    }\r\n };\r\n \r\n-\r\n // ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n+// 🟢 CORE MEMBERSHIP LOGIC\r\n // ====================================================================\r\n \r\n-/**\r\n- * Sends an approval request to the backend API.\r\n- */\r\n async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-        \r\n-        // Reload data after a successful action\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Approval Operation Failed:\", e);\r\n-        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(await resp.json().catch(() => ({ message: resp.statusText })).then(d => d.message || `Approval failed`));\r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Sends a rejection request to the backend API.\r\n- */\r\n async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-            method: 'PUT', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Operation Failed:\", e);\r\n-        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(await resp.json().catch(() => ({ message: resp.statusText })).then(d => d.message || `Rejection failed`));\r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Sends a deletion request to the backend API.\r\n- */\r\n async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-            method: 'DELETE', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Deletion Operation Failed:\", e);\r\n-        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method: 'DELETE', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(await resp.json().catch(() => ({ message: resp.statusText })).then(d => d.message || `Deletion failed`));\r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Executes a real API call to trigger server-side data synchronization.\r\n- */\r\n async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n-\r\n-    // 1. Set Loading State\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { \r\n-            method: 'POST',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-        }\r\n-\r\n-        // 2. Set Success State\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-        // Reload data after a successful sync\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-        \r\n-    } catch (err) {\r\n-        // 3. Set Failure State\r\n-        console.error(\"Synchronization Error:\", err.message);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n-    } finally {\r\n-        // 4. Reset Button State after a short delay\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Fetches and renders pending membership requests from the backend API.\r\n- */\r\n-async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    \r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-        \r\n-        const requests = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n-\r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-\r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID; \r\n-\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${requestId}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Approve\r\n-                        </button>\r\n-                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Reject\r\n-                        </button>\r\n-                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Delete\r\n-                        </button>\r\n-                    </td>\r\n-                `;\r\n-            });\r\n-            \r\n-            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading pending requests:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Fetches and renders approved residents from the backend API.\r\n- */\r\n-async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-    \r\n-    if (!tableBody || !noResidentsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-\r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            noResidentsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noResidentsMsg.classList.add('hidden');\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading approved residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n- */\r\n-function attachMembershipListeners() {\r\n-    // Attach listener for the Sync button\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    \r\n-    // Attach listener for Clear Filters button\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-    });\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n-// ====================================================================\r\n-\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadAccessChart() {\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n-\r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        // Destroy existing chart instance if it exists before creating a new one\r\n-        if (window.accessChartInstance) {\r\n-            window.accessChartInstance.destroy();\r\n-        }\r\n-        \r\n-        window.accessChartInstance = new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n-\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(await resp.json().catch(() => ({ message: resp.statusText })).then(d => d.message || `Sync failed`));\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n     } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+    } finally {\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n     }\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Fetches and renders payments records.\r\n- */\r\n-async function loadPaymentsRecords() {\r\n-    const tableBody = document.getElementById('paymentsTableBody');\r\n-    if (!tableBody) return; \r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-        \r\n-        const records = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-\r\n-        if (records.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-        } else {\r\n-            records.forEach(record => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading payments records:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load payments records from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Attaches event listeners for payments-specific elements.\r\n- */\r\n-function attachPaymentsListeners() {\r\n-    // Add any payments-specific listeners here\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 👥 RESIDENTS LOGIC (residents.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Fetches and renders all resident details.\r\n- */\r\n-async function loadAllResidents() {\r\n-    const tableBody = document.getElementById('allResidentsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-        } else {\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading all residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load all residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n-// ====================================================================\r\n-\r\n-async function loadVisitorPassOverview() {\r\n-    const overviewSection = document.getElementById('visitorOverviewSection');\r\n-    if (!overviewSection) return;\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n-        safeUpdate(\"todayVisitors\", data.today || 0);\r\n-        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-        \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitor overview:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n-    \r\n-    // Implementation details would be similar to loadPendingRequests()\r\n-}\r\n-\r\n-function attachVisitorListeners() {\r\n-    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n-// ====================================================================\r\n-\r\n-async function loadReportsData() {\r\n-    // Placeholder implementation\r\n-    const reportsContainer = document.getElementById('reportsContainer');\r\n-    if (!reportsContainer) return;\r\n-    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n-        // For simplicity, we just display a success message:\r\n-        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading reports data:\", err);\r\n-        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n-// ====================================================================\r\n-\r\n-async function loadManualOverrides() {\r\n-    const logTableBody = document.getElementById('overrideLogTableBody');\r\n-    if (!logTableBody) return;\r\n-\r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n-    \r\n+async function loadPendingRequests() {\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-        const logs = await resp.json();\r\n-\r\n-        logTableBody.innerHTML = '';\r\n-        if (logs.length === 0) {\r\n-            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        const requests = await resp.json();\r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n         } else {\r\n-            // Populate table rows with logs\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID;\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">Approve</button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">Reject</button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">Delete</button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => button.addEventListener('click', (e) => handleApproveClick(e.target.getAttribute('data-request-id'))));\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => button.addEventListener('click', (e) => handleRejectClick(e.target.getAttribute('data-request-id'))));\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => button.addEventListener('click', (e) => handleDeleteClick(e.target.getAttribute('data-request-id'))));\r\n         }\r\n     } catch (error) {\r\n-        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n     }\r\n }\r\n \r\n-function attachOverrideListeners() {\r\n-    // Attach listener for the 'Perform Manual Override' button\r\n-    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-        \r\n-        try {\r\n-            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n-                method: 'POST',\r\n-                headers: getAuthHeaders(),\r\n-                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n-            });\r\n-            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n-\r\n-            displayMessage(\"Manual override successful!\", false);\r\n-            await loadManualOverrides(); // Reload logs\r\n-\r\n-        } catch (e) {\r\n-            displayMessage(`Manual override failed: ${e.message}`, true);\r\n-        }\r\n-    });\r\n-}\r\n-\r\n-\r\n // ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n+// 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n // ====================================================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-async function loadPageIntoMainContent(url) {\r\n-    // Show a loading state instantly\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n-\r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html; // Inject HTML first\r\n-\r\n-        // 🟢 Execute data loading functions based on the page loaded \r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n-        } \r\n-        \r\n-        // --- MEMBERSHIP PAGES ---\r\n-        else if (url.includes(\"membershiprecords.html\")) {\r\n-            // Approved Residents\r\n-            attachMembershipListeners();\r\n-            await loadApprovedResidents();\r\n-        } else if (url.includes(\"membership.html\")) {\r\n-            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n-            attachMembershipListeners();\r\n-            await loadPendingRequests();\r\n-        }\r\n-        \r\n-        // --- PAYMENTS RECORDS ---\r\n-        else if (url.includes(\"payments.html\")) {\r\n-            attachPaymentsListeners();\r\n-            await loadPaymentsRecords();\r\n-        } \r\n-        \r\n-        // --- RESIDENTS ---\r\n-        else if (url.includes(\"residents.html\")) {\r\n-            await loadAllResidents();\r\n-        } \r\n-        \r\n-        // --- VISITORS MANAGEMENT ---\r\n-        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-            attachVisitorListeners();\r\n-            // Load data relevant to the main visitor pages\r\n-            await loadVisitorPassOverview();\r\n-            await loadPendingVisitorApprovals();\r\n-        }\r\n-        \r\n-        // --- CHARTS AND REPORTS ---\r\n-        else if (url.includes(\"chartsandreports.html\")) {\r\n-            await loadReportsData();\r\n-        } \r\n-        \r\n-        // --- MANUAL OVERRIDES ---\r\n-        else if (url.includes(\"manualoverride.html\")) {\r\n-            attachOverrideListeners();\r\n-            await loadManualOverrides();\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n-    }\r\n-}\r\n-\r\n-// ... (existing sidebar button loop and visitor toggle logic)\r\n-\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => {\r\n-            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-            // Also ensure sub-menu items are correctly reset if needed\r\n-            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n-            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n-            \r\n-            // Re-apply specific default styles for sub-menu items if needed\r\n-            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n-                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            }\r\n-        });\r\n-        \r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n-\r\n-\r\n-// ================================\r\n-// MISC UI TOGGLES\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n-});\r\n-\r\n-// ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n-// ================================\r\n-\r\n-document.addEventListener('DOMContentLoaded', () => {\r\n-    // Load the initial dashboard view when the admin page first loads\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\r\n-// ================================\r\n-// 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n-// ================================\r\n-\r\n const logsTableBody = document.getElementById(\"logsTableBody\");\r\n const filterInputs = document.querySelectorAll(\"#accesslogs .filterInput\");\r\n const exportCsvBtn = document.getElementById(\"exportCsvBtn\");\r\n const exportExcelBtn = document.getElementById(\"exportExcelBtn\");\r\n \r\n-// Function to fetch and populate access logs\r\n async function loadaccesslogs() {\r\n   if (!logsTableBody) return;\r\n   logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading access logs...</td></tr>`;\r\n-\r\n   try {\r\n-    const res = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n-      headers: {\r\n-        \"Content-Type\": \"application/json\",\r\n-        \"Authorization\": `Bearer ${localStorage.getItem(\"accessToken\")}`\r\n-      }\r\n-    });\r\n-\r\n+    const res = await fetch(`${API_HOST}/api/security/accesslogs`, { headers: getAuthHeaders() });\r\n     if (!res.ok) throw new Error(\"Failed to fetch access logs\");\r\n-\r\n     const logs = await res.json();\r\n-\r\n     if (!logs.length) {\r\n       logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500 italic\">No access logs found.</td></tr>`;\r\n       return;\r\n     }\r\n-\r\n     logsTableBody.innerHTML = \"\";\r\n-\r\n     logs.forEach(log => {\r\n       const row = document.createElement(\"tr\");\r\n       row.className = \"hover:bg-gray-100 transition-colors duration-100\";\r\n       row.innerHTML = `\r\n@@ -813,106 +242,39 @@\n         <td class=\"p-2 border-b border-gray-300\">${log.logType}</td>\r\n       `;\r\n       logsTableBody.appendChild(row);\r\n     });\r\n-\r\n   } catch (err) {\r\n     console.error(err);\r\n     logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500\">Error loading access logs</td></tr>`;\r\n   }\r\n }\r\n \r\n-// ================================\r\n-// 🔹 FILTER LOGS\r\n-// ================================\r\n filterInputs.forEach((input, colIndex) => {\r\n   input.addEventListener(\"input\", () => {\r\n     const filterValue = input.value.toLowerCase();\r\n     const rows = logsTableBody.querySelectorAll(\"tr\");\r\n     rows.forEach(row => {\r\n       const cell = row.cells[colIndex];\r\n-      if (!cell) return;\r\n-      row.style.display = cell.textContent.toLowerCase().includes(filterValue) ? \"\" : \"none\";\r\n+      row.style.display = cell && cell.textContent.toLowerCase().includes(filterValue) ? \"\" : \"none\";\r\n     });\r\n   });\r\n });\r\n \r\n-// ================================\r\n-// 🔹 EXPORT FUNCTIONS\r\n-// ================================\r\n function downloadCSV() {\r\n   const rows = Array.from(logsTableBody.querySelectorAll(\"tr\"))\r\n     .filter(r => r.style.display !== \"none\")\r\n     .map(r => Array.from(r.cells).map(cell => `\"${cell.textContent}\"`).join(\",\"))\r\n     .join(\"\\n\");\r\n-\r\n   const blob = new Blob([rows], { type: \"text/csv\" });\r\n   const link = document.createElement(\"a\");\r\n   link.href = URL.createObjectURL(blob);\r\n   link.download = `access_logs_${Date.now()}.csv`;\r\n   link.click();\r\n }\r\n \r\n exportCsvBtn?.addEventListener(\"click\", downloadCSV);\r\n-exportExcelBtn?.addEventListener(\"click\", downloadCSV); // Quick export to CSV; can integrate Excel lib if needed\r\n+exportExcelBtn?.addEventListener(\"click\", downloadCSV);\r\n \r\n-// ================================\r\n-// 🔹 INITIAL LOAD\r\n-// ================================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n   loadaccesslogs();\r\n });\r\n-// adminsdashboard.js\r\n-\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-  const accesslogsTableBody = document.getElementById(\"logsTableBody\");\r\n-\r\n-  // Fetch Access Logs from backend\r\n-  async function loadaccesslogs() {\r\n-    try {\r\n-      const token = localStorage.getItem(\"accessToken\"); // if using JWT auth\r\n-      const response = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n-        headers: {\r\n-          \"Authorization\": `Bearer ${token}`,\r\n-        },\r\n-      });\r\n-\r\n-      if (!response.ok) throw new Error(\"Failed to fetch Access Logs\");\r\n-\r\n-      const logs = await response.json();\r\n-      renderaccesslogs(logs);\r\n-    } catch (err) {\r\n-      console.error(\"Error loading access logs:\", err);\r\n-      accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500 p-4\">Unable to load Access Logs</td></tr>`;\r\n-    }\r\n-  }\r\n-\r\n-  // Render table rows\r\n-  function renderaccesslogs(logs) {\r\n-    if (!logs || logs.length === 0) {\r\n-      accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center p-4\">No logs found</td></tr>`;\r\n-      return;\r\n-    }\r\n-\r\n-    accesslogsTableBody.innerHTML = logs\r\n-      .map(log => `\r\n-        <tr class=\"border-b\">\r\n-          <td class=\"p-2 border-r\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-          <td class=\"p-2 border-r\">${log.userId}</td>\r\n-          <td class=\"p-2 border-r\">${log.action}</td>\r\n-          <td class=\"p-2\">${log.type}</td>\r\n-        </tr>\r\n-      `).join(\"\");\r\n-  }\r\n-\r\n-  // Show Access Logs tab when sidebar button is clicked\r\n-  const accesslogsBtn = document.querySelector('.sidebarBtn[data-target=\"sections/accesslogs.html\"]');\r\n-  accesslogsBtn.addEventListener(\"click\", () => {\r\n-    // Hide all other dynamic sections\r\n-    document.querySelectorAll(\"#main-content-area > div\").forEach(div => div.classList.add(\"hidden\"));\r\n-    // Show Access Logs\r\n-    document.getElementById(\"accesslogs\").classList.remove(\"hidden\");\r\n-\r\n-    // Load logs\r\n-    loadaccesslogs();\r\n-  });\r\n-});\r\n"
                },
                {
                    "date": 1763886993168,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,277 +4,875 @@\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-const API_HOST =  \"http://localhost:4050\"; \r\n+const API_HOST =  \"http://localhost:4050\"; \r\n const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    // Dashboard Overview Endpoints\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-    // Membership Endpoints\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    \r\n-    // General Admin Endpoints\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    // Membership Endpoints\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    \r\n+    // General Admin Endpoints\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n // UTILITIES AND HELPERS\r\n // ================================\r\n \r\n+/**\r\n+ * Creates and returns the standard headers needed for authenticated API calls.\r\n+ */\r\n function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n }\r\n \r\n+/**\r\n+ * Handles error display in a non-alert manner.\r\n+ */\r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-        \r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Formats a timestamp (string or number) into a readable date string.\r\n+ */\r\n function formatTimestamp(timestamp) {\r\n-    try {\r\n-        if (!timestamp) return 'N/A';\r\n-        return new Date(timestamp).toLocaleString();\r\n-    } catch (e) {\r\n-        return 'N/A';\r\n-    }\r\n+    try {\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Safely updates a DOM element's text content.\r\n+ */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    }\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    }\r\n };\r\n \r\n+\r\n // ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC\r\n+// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n // ====================================================================\r\n \r\n+/**\r\n+ * Sends an approval request to the backend API.\r\n+ */\r\n async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(await resp.json().catch(() => ({ message: resp.statusText })).then(d => d.message || `Approval failed`));\r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch (e) {\r\n-        console.error(\"Approval Operation Failed:\", e);\r\n-        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        \r\n+        // Reload data after a successful action\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Sends a rejection request to the backend API.\r\n+ */\r\n async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(await resp.json().catch(() => ({ message: resp.statusText })).then(d => d.message || `Rejection failed`));\r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Operation Failed:\", e);\r\n-        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Sends a deletion request to the backend API.\r\n+ */\r\n async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method: 'DELETE', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(await resp.json().catch(() => ({ message: resp.statusText })).then(d => d.message || `Deletion failed`));\r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch (e) {\r\n-        console.error(\"Deletion Operation Failed:\", e);\r\n-        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Executes a real API call to trigger server-side data synchronization.\r\n+ */\r\n async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n+\r\n+    // 1. Set Loading State\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { \r\n+            method: 'POST',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+        }\r\n+\r\n+        // 2. Set Success State\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+        // Reload data after a successful sync\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+        \r\n+    } catch (err) {\r\n+        // 3. Set Failure State\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+    } finally {\r\n+        // 4. Reset Button State after a short delay\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Fetches and renders pending membership requests from the backend API.\r\n+ */\r\n+async function loadPendingRequests() {\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    \r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        \r\n+        const requests = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n+\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID; \r\n+\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Approve\r\n+                        </button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Reject\r\n+                        </button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Delete\r\n+                        </button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            \r\n+            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Fetches and renders approved residents from the backend API.\r\n+ */\r\n+async function loadApprovedResidents() {\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    \r\n+    if (!tableBody || !noResidentsMsg) return;\r\n+\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading approved residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+ */\r\n+function attachMembershipListeners() {\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n+// ====================================================================\r\n+\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n+    }\r\n+}\r\n+\r\n+async function loadAccessChart() {\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(await resp.json().catch(() => ({ message: resp.statusText })).then(d => d.message || `Sync failed`));\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n+\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        // Destroy existing chart instance if it exists before creating a new one\r\n+        if (window.accessChartInstance) {\r\n+            window.accessChartInstance.destroy();\r\n+        }\r\n+        \r\n+        window.accessChartInstance = new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n+        });\r\n+\r\n     } catch (err) {\r\n-        console.error(\"Synchronization Error:\", err.message);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-    } finally {\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n+        console.error(\"Error loading chart:\", err);\r\n     }\r\n }\r\n \r\n-async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Fetches and renders payments records.\r\n+ */\r\n+async function loadPaymentsRecords() {\r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return; \r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+        \r\n+        const records = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+\r\n+        if (records.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+        } else {\r\n+            records.forEach(record => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading payments records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load payments records from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Attaches event listeners for payments-specific elements.\r\n+ */\r\n+function attachPaymentsListeners() {\r\n+    // Add any payments-specific listeners here\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 👥 RESIDENTS LOGIC (residents.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Fetches and renders all resident details.\r\n+ */\r\n+async function loadAllResidents() {\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n+        } else {\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load all residents from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n+// ====================================================================\r\n+\r\n+async function loadVisitorPassOverview() {\r\n+    const overviewSection = document.getElementById('visitorOverviewSection');\r\n+    if (!overviewSection) return;\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+        safeUpdate(\"todayVisitors\", data.today || 0);\r\n+        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+        \r\n+    } catch (err) {\r\n+        console.error(\"Error loading visitor overview:\", err);\r\n+    }\r\n+}\r\n+\r\n+async function loadPendingVisitorApprovals() {\r\n+    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+    \r\n+    // Implementation details would be similar to loadPendingRequests()\r\n+}\r\n+\r\n+function attachVisitorListeners() {\r\n+    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+    // Placeholder implementation\r\n+    const reportsContainer = document.getElementById('reportsContainer');\r\n+    if (!reportsContainer) return;\r\n+    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n+        // For simplicity, we just display a success message:\r\n+        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading reports data:\", err);\r\n+        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+    const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    if (!logTableBody) return;\r\n+\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    \r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-        const requests = await resp.json();\r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+        const logs = await resp.json();\r\n+\r\n+        logTableBody.innerHTML = '';\r\n+        if (logs.length === 0) {\r\n+            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n         } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID;\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${requestId}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">Approve</button>\r\n-                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">Reject</button>\r\n-                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">Delete</button>\r\n-                    </td>\r\n-                `;\r\n-            });\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(button => button.addEventListener('click', (e) => handleApproveClick(e.target.getAttribute('data-request-id'))));\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(button => button.addEventListener('click', (e) => handleRejectClick(e.target.getAttribute('data-request-id'))));\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(button => button.addEventListener('click', (e) => handleDeleteClick(e.target.getAttribute('data-request-id'))));\r\n+            // Populate table rows with logs\r\n         }\r\n     } catch (error) {\r\n-        console.error(\"Error loading pending requests:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n     }\r\n }\r\n \r\n+function attachOverrideListeners() {\r\n+    // Attach listener for the 'Perform Manual Override' button\r\n+    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+        \r\n+        try {\r\n+            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n+                method: 'POST',\r\n+                headers: getAuthHeaders(),\r\n+                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n+            });\r\n+            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+\r\n+            displayMessage(\"Manual override successful!\", false);\r\n+            await loadManualOverrides(); // Reload logs\r\n+\r\n+        } catch (e) {\r\n+            displayMessage(`Manual override failed: ${e.message}`, true);\r\n+        }\r\n+    });\r\n+}\r\n+\r\n+\r\n // ====================================================================\r\n-// 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n // ====================================================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+async function loadPageIntoMainContent(url) {\r\n+    // Show a loading state instantly\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html; // Inject HTML first\r\n+\r\n+        // 🟢 Execute data loading functions based on the page loaded \r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n+        } \r\n+        \r\n+        // --- MEMBERSHIP PAGES ---\r\n+        else if (url.includes(\"membershiprecords.html\")) {\r\n+            // Approved Residents\r\n+            attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+        }\r\n+        \r\n+        // --- PAYMENTS RECORDS ---\r\n+        else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } \r\n+        \r\n+        // --- RESIDENTS ---\r\n+        else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } \r\n+        \r\n+        // --- VISITORS MANAGEMENT ---\r\n+        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+            attachVisitorListeners();\r\n+            // Load data relevant to the main visitor pages\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        }\r\n+        \r\n+        // --- CHARTS AND REPORTS ---\r\n+        else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } \r\n+        \r\n+        // --- MANUAL OVERRIDES ---\r\n+        else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    }\r\n+}\r\n+\r\n+// ... (existing sidebar button loop and visitor toggle logic)\r\n+\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => {\r\n+            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+            // Also ensure sub-menu items are correctly reset if needed\r\n+            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n+            \r\n+            // Re-apply specific default styles for sub-menu items if needed\r\n+            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n+                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            }\r\n+        });\r\n+        \r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n+\r\n+\r\n+// ================================\r\n+// MISC UI TOGGLES\r\n+// ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+});\r\n+\r\n+// ================================\r\n+// INITIALIZATION ON PAGE LOAD\r\n+// ================================\r\n+\r\n+document.addEventListener('DOMContentLoaded', () => {\r\n+    // Load the initial dashboard view when the admin page first loads\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+});\r\n+// ================================\r\n+// 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n+// ================================\r\n+\r\n const logsTableBody = document.getElementById(\"logsTableBody\");\r\n const filterInputs = document.querySelectorAll(\"#accesslogs .filterInput\");\r\n const exportCsvBtn = document.getElementById(\"exportCsvBtn\");\r\n const exportExcelBtn = document.getElementById(\"exportExcelBtn\");\r\n \r\n-async function loadaccesslogs() {\r\n-  if (!logsTableBody) return;\r\n-  logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading access logs...</td></tr>`;\r\n-  try {\r\n-    const res = await fetch(`${API_HOST}/api/security/accesslogs`, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(\"Failed to fetch access logs\");\r\n-    const logs = await res.json();\r\n-    if (!logs.length) {\r\n-      logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500 italic\">No access logs found.</td></tr>`;\r\n-      return;\r\n-    }\r\n-    logsTableBody.innerHTML = \"\";\r\n-    logs.forEach(log => {\r\n-      const row = document.createElement(\"tr\");\r\n-      row.className = \"hover:bg-gray-100 transition-colors duration-100\";\r\n-      row.innerHTML = `\r\n-        <td class=\"p-2 border-b border-gray-300\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-        <td class=\"p-2 border-b border-gray-300\">${log.userId}</td>\r\n-        <td class=\"p-2 border-b border-gray-300\">${log.action}</td>\r\n-        <td class=\"p-2 border-b border-gray-300\">${log.logType}</td>\r\n-      `;\r\n-      logsTableBody.appendChild(row);\r\n-    });\r\n-  } catch (err) {\r\n-    console.error(err);\r\n-    logsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500\">Error loading access logs</td></tr>`;\r\n-  }\r\n-}\r\n+// Function to fetch and populate access logs\r\n \r\n+// ================================\r\n+// 🔹 FILTER LOGS\r\n+// ================================\r\n filterInputs.forEach((input, colIndex) => {\r\n   input.addEventListener(\"input\", () => {\r\n     const filterValue = input.value.toLowerCase();\r\n     const rows = logsTableBody.querySelectorAll(\"tr\");\r\n     rows.forEach(row => {\r\n       const cell = row.cells[colIndex];\r\n-      row.style.display = cell && cell.textContent.toLowerCase().includes(filterValue) ? \"\" : \"none\";\r\n+      if (!cell) return;\r\n+      row.style.display = cell.textContent.toLowerCase().includes(filterValue) ? \"\" : \"none\";\r\n     });\r\n   });\r\n });\r\n \r\n+// ================================\r\n+// 🔹 EXPORT FUNCTIONS\r\n+// ================================\r\n function downloadCSV() {\r\n   const rows = Array.from(logsTableBody.querySelectorAll(\"tr\"))\r\n     .filter(r => r.style.display !== \"none\")\r\n     .map(r => Array.from(r.cells).map(cell => `\"${cell.textContent}\"`).join(\",\"))\r\n     .join(\"\\n\");\r\n+\r\n   const blob = new Blob([rows], { type: \"text/csv\" });\r\n   const link = document.createElement(\"a\");\r\n   link.href = URL.createObjectURL(blob);\r\n   link.download = `access_logs_${Date.now()}.csv`;\r\n   link.click();\r\n }\r\n \r\n exportCsvBtn?.addEventListener(\"click\", downloadCSV);\r\n-exportExcelBtn?.addEventListener(\"click\", downloadCSV);\r\n+exportExcelBtn?.addEventListener(\"click\", downloadCSV); // Quick export to CSV; can integrate Excel lib if needed\r\n \r\n+// ================================\r\n+// 🔹 INITIAL LOAD\r\n+// ================================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n   loadaccesslogs();\r\n });\r\n+// adminsdashboard.js\r\n+\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+  const accesslogsTableBody = document.getElementById(\"logsTableBody\");\r\n+\r\n+  // Fetch Access Logs from backend\r\n+  async function loadaccesslogs() {\r\n+    try {\r\n+      const token = localStorage.getItem(\"accessToken\"); // if using JWT auth\r\n+      const response = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n+        headers: {\r\n+          \"Authorization\": `Bearer ${token}`,\r\n+        },\r\n+      });\r\n+\r\n+      if (!response.ok) throw new Error(\"Failed to fetch Access Logs\");\r\n+\r\n+      const logs = await response.json();\r\n+      renderaccesslogs(logs);\r\n+    } catch (err) {\r\n+      console.error(\"Error loading access logs:\", err);\r\n+      accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500 p-4\">Unable to load Access Logs</td></tr>`;\r\n+    }\r\n+  }\r\n+\r\n+  // Render table rows\r\n+  function renderaccesslogs(logs) {\r\n+    if (!logs || logs.length === 0) {\r\n+      accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center p-4\">No logs found</td></tr>`;\r\n+      return;\r\n+    }\r\n+\r\n+    accesslogsTableBody.innerHTML = logs\r\n+      .map(log => `\r\n+        <tr class=\"border-b\">\r\n+          <td class=\"p-2 border-r\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+          <td class=\"p-2 border-r\">${log.userId}</td>\r\n+          <td class=\"p-2 border-r\">${log.action}</td>\r\n+          <td class=\"p-2\">${log.type}</td>\r\n+        </tr>\r\n+      `).join(\"\");\r\n+  }\r\n+\r\n+  // Show Access Logs tab when sidebar button is clicked\r\n+  const accesslogsBtn = document.querySelector('.sidebarBtn[data-target=\"sections/accesslogs.html\"]');\r\n+  accesslogsBtn.addEventListener(\"click\", () => {\r\n+    // Hide all other dynamic sections\r\n+    document.querySelectorAll(\"#main-content-area > div\").forEach(div => div.classList.add(\"hidden\"));\r\n+    // Show Access Logs\r\n+    document.getElementById(\"accesslogs\").classList.remove(\"hidden\");\r\n+\r\n+    // Load logs\r\n+    loadaccesslogs();\r\n+  });\r\n+});\r\n"
                },
                {
                    "date": 1763887231693,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -818,61 +818,44 @@\n // ================================\r\n // 🔹 INITIAL LOAD\r\n // ================================\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n-  loadaccesslogs();\r\n-});\r\n-// adminsdashboard.js\r\n+    const accesslogsTableBody = document.getElementById(\"logsTableBody\");\r\n \r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-  const accesslogsTableBody = document.getElementById(\"logsTableBody\");\r\n-\r\n-  // Fetch Access Logs from backend\r\n-  async function loadaccesslogs() {\r\n-    try {\r\n-      const token = localStorage.getItem(\"accessToken\"); // if using JWT auth\r\n-      const response = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n-        headers: {\r\n-          \"Authorization\": `Bearer ${token}`,\r\n-        },\r\n-      });\r\n-\r\n-      if (!response.ok) throw new Error(\"Failed to fetch Access Logs\");\r\n-\r\n-      const logs = await response.json();\r\n-      renderaccesslogs(logs);\r\n-    } catch (err) {\r\n-      console.error(\"Error loading access logs:\", err);\r\n-      accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500 p-4\">Unable to load Access Logs</td></tr>`;\r\n+    async function loadaccesslogs() {\r\n+        try {\r\n+            const token = localStorage.getItem(\"accessToken\");\r\n+            const response = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n+                headers: { \"Authorization\": `Bearer ${token}` },\r\n+            });\r\n+            if (!response.ok) throw new Error(\"Failed to fetch Access Logs\");\r\n+            const logs = await response.json();\r\n+            renderaccesslogs(logs);\r\n+        } catch (err) {\r\n+            console.error(\"Error loading access logs:\", err);\r\n+            accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500 p-4\">Unable to load Access Logs</td></tr>`;\r\n+        }\r\n     }\r\n-  }\r\n \r\n-  // Render table rows\r\n-  function renderaccesslogs(logs) {\r\n-    if (!logs || logs.length === 0) {\r\n-      accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center p-4\">No logs found</td></tr>`;\r\n-      return;\r\n+    function renderaccesslogs(logs) {\r\n+        if (!logs || logs.length === 0) {\r\n+            accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center p-4\">No logs found</td></tr>`;\r\n+            return;\r\n+        }\r\n+        accesslogsTableBody.innerHTML = logs.map(log => `\r\n+            <tr class=\"border-b\">\r\n+                <td class=\"p-2 border-r\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+                <td class=\"p-2 border-r\">${log.userId}</td>\r\n+                <td class=\"p-2 border-r\">${log.action}</td>\r\n+                <td class=\"p-2\">${log.type}</td>\r\n+            </tr>\r\n+        `).join(\"\");\r\n     }\r\n \r\n-    accesslogsTableBody.innerHTML = logs\r\n-      .map(log => `\r\n-        <tr class=\"border-b\">\r\n-          <td class=\"p-2 border-r\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-          <td class=\"p-2 border-r\">${log.userId}</td>\r\n-          <td class=\"p-2 border-r\">${log.action}</td>\r\n-          <td class=\"p-2\">${log.type}</td>\r\n-        </tr>\r\n-      `).join(\"\");\r\n-  }\r\n-\r\n-  // Show Access Logs tab when sidebar button is clicked\r\n-  const accesslogsBtn = document.querySelector('.sidebarBtn[data-target=\"sections/accesslogs.html\"]');\r\n-  accesslogsBtn.addEventListener(\"click\", () => {\r\n-    // Hide all other dynamic sections\r\n-    document.querySelectorAll(\"#main-content-area > div\").forEach(div => div.classList.add(\"hidden\"));\r\n-    // Show Access Logs\r\n-    document.getElementById(\"accesslogs\").classList.remove(\"hidden\");\r\n-\r\n-    // Load logs\r\n-    loadaccesslogs();\r\n-  });\r\n+    // Sidebar button click\r\n+    const accesslogsBtn = document.querySelector('.sidebarBtn[data-target=\"sections/accesslogs.html\"]');\r\n+    accesslogsBtn?.addEventListener(\"click\", () => {\r\n+        document.querySelectorAll(\"#main-content-area > div\").forEach(div => div.classList.add(\"hidden\"));\r\n+        document.getElementById(\"accesslogs\").classList.remove(\"hidden\");\r\n+        loadaccesslogs();\r\n+    });\r\n });\r\n"
                },
                {
                    "date": 1763887375338,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,861 +1,281 @@\n-// adminsdashboard.js\r\n-// This file now includes ALL necessary data loading logic (including Membership)\r\n-// to handle dynamic page loading in the Admin Dashboard.\r\n+// =========================================================\r\n+// adminsdashboard.js – Refactored & Optimized\r\n+// =========================================================\r\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-const API_HOST =  \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"accessToken\"); \r\n+const API_HOST = \"http://localhost:4050\";\r\n+const token = localStorage.getItem(\"accessToken\");\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    // Dashboard Overview\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-    // Membership Endpoints\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    \r\n-    // General Admin Endpoints\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    // Membership\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+\r\n+    // General Admin\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n+document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n-// UTILITIES AND HELPERS\r\n+// UTILITIES & HELPERS\r\n // ================================\r\n-\r\n-/**\r\n- * Creates and returns the standard headers needed for authenticated API calls.\r\n- */\r\n function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n+    return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };\r\n }\r\n \r\n-/**\r\n- * Handles error display in a non-alert manner.\r\n- */\r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-        \r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (!msgElement) return;\r\n+    msgElement.textContent = message;\r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+    setTimeout(() => {\r\n+        msgElement.textContent = '';\r\n+        msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+    }, 5000);\r\n }\r\n \r\n-/**\r\n- * Formats a timestamp (string or number) into a readable date string.\r\n- */\r\n function formatTimestamp(timestamp) {\r\n-    try {\r\n-        if (!timestamp) return 'N/A';\r\n-        return new Date(timestamp).toLocaleString();\r\n-    } catch (e) {\r\n-        return 'N/A';\r\n-    }\r\n+    try {\r\n+        return timestamp ? new Date(timestamp).toLocaleString() : 'N/A';\r\n+    } catch (e) { return 'N/A'; }\r\n }\r\n \r\n-/**\r\n- * Safely updates a DOM element's text content.\r\n- */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    }\r\n+    const element = document.getElementById(id);\r\n+    if (element) element.textContent = value + suffix;\r\n };\r\n \r\n+// ================================\r\n+// 🟢 MEMBERSHIP LOGIC\r\n+// ================================\r\n+async function handleMembershipAction(requestId, actionType) {\r\n+    const actionsMap = {\r\n+        approve: ENDPOINTS.APPROVE_REQUEST,\r\n+        reject: ENDPOINTS.REJECT_REQUEST,\r\n+        delete: ENDPOINTS.DELETE_REQUEST\r\n+    };\r\n+    const confirmMsgs = {\r\n+        approve: `Approve request ${requestId}?`,\r\n+        reject: `Reject request ${requestId}?`,\r\n+        delete: `Delete request ${requestId}? This cannot be undone.`\r\n+    };\r\n \r\n-// ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n-// ====================================================================\r\n+    if (actionType !== 'approve' && !confirm(confirmMsgs[actionType])) return;\r\n \r\n-/**\r\n- * Sends an approval request to the backend API.\r\n- */\r\n-async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+    safeUpdate('actionText', `Processing ${actionType} for ${requestId}...`);\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n+    try {\r\n+        const resp = await fetch(actionsMap[actionType](requestId), { method: actionType === 'delete' ? 'DELETE' : 'PUT', headers: getAuthHeaders() });\r\n+        if (!resp.ok) {\r\n+            const errData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errData.message || resp.statusText);\r\n+        }\r\n \r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-        \r\n-        // Reload data after a successful action\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Approval Operation Failed:\", e);\r\n-        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+        safeUpdate('actionText', `${actionType.charAt(0).toUpperCase() + actionType.slice(1)} Request ${requestId}`);\r\n+        displayMessage(`Successfully ${actionType}d membership request ${requestId}.`);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (err) {\r\n+        console.error(`${actionType} operation failed:`, err);\r\n+        displayMessage(`${actionType.charAt(0).toUpperCase() + actionType.slice(1)} failed: ${err.message}`, true);\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Sends a rejection request to the backend API.\r\n- */\r\n-async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-            method: 'PUT', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Operation Failed:\", e);\r\n-        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Sends a deletion request to the backend API.\r\n- */\r\n-async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-            method: 'DELETE', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Deletion Operation Failed:\", e);\r\n-        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Executes a real API call to trigger server-side data synchronization.\r\n- */\r\n async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n \r\n-    // 1. Set Loading State\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md animate-pulse';\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { \r\n-            method: 'POST',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-        }\r\n-\r\n-        // 2. Set Success State\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-        // Reload data after a successful sync\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-        \r\n-    } catch (err) {\r\n-        // 3. Set Failure State\r\n-        console.error(\"Synchronization Error:\", err.message);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n-    } finally {\r\n-        // 4. Reset Button State after a short delay\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n-    }\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(`Sync failed: ${resp.status}`);\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md';\r\n+        displayMessage(\"Data synchronization successful.\");\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (err) {\r\n+        console.error(\"Sync Error:\", err);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+    } finally {\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Fetches and renders pending membership requests from the backend API.\r\n- */\r\n async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    \r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n \r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-        \r\n-        const requests = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n \r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        const requests = await resp.json();\r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n \r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID; \r\n+        if (requests.length === 0) return noRequestsMsg.classList.remove('hidden');\r\n \r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${requestId}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Approve\r\n-                        </button>\r\n-                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Reject\r\n-                        </button>\r\n-                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Delete\r\n-                        </button>\r\n-                    </td>\r\n-                `;\r\n-            });\r\n-            \r\n-            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading pending requests:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n-    }\r\n-}\r\n+        noRequestsMsg.classList.add('hidden');\r\n+        requests.forEach(req => {\r\n+            const requestId = req.id || req.RequestID;\r\n+            const row = tableBody.insertRow();\r\n+            row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+            row.innerHTML = `\r\n+                <td class=\"px-4 py-3\">${requestId}</td>\r\n+                <td class=\"px-4 py-3 font-medium\">${req.ResidentName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${req.NationalID || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${req.PhoneNumber || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${req.Email || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${req.HouseNumber || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${req.CourtName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${req.RoleName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${req.Status || 'Pending'}</span></td>\r\n+                <td class=\"px-4 py-3\">${formatTimestamp(req.RequestedAt || req.requestedAt)}</td>\r\n+                <td class=\"px-4 py-3 text-center flex space-x-2\">\r\n+                    <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs shadow-md\" data-id=\"${requestId}\">Approve</button>\r\n+                    <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs shadow-md\" data-id=\"${requestId}\">Reject</button>\r\n+                    <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs shadow-md\" data-id=\"${requestId}\">Delete</button>\r\n+                </td>\r\n+            `;\r\n+        });\r\n \r\n-/**\r\n- * Fetches and renders approved residents from the backend API.\r\n- */\r\n-async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-    \r\n-    if (!tableBody || !noResidentsMsg) return;\r\n+        // Attach event listeners\r\n+        tableBody.querySelectorAll('.approve-btn').forEach(btn => btn.addEventListener('click', e => handleMembershipAction(e.target.dataset.id, 'approve')));\r\n+        tableBody.querySelectorAll('.reject-btn').forEach(btn => btn.addEventListener('click', e => handleMembershipAction(e.target.dataset.id, 'reject')));\r\n+        tableBody.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', e => handleMembershipAction(e.target.dataset.id, 'delete')));\r\n \r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-\r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            noResidentsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noResidentsMsg.classList.add('hidden');\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading approved residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents from API.\", true);\r\n-    }\r\n+    } catch (err) {\r\n+        console.error(err);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests.\", true);\r\n+    }\r\n }\r\n \r\n-/**\r\n- * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n- */\r\n-function attachMembershipListeners() {\r\n-    // Attach listener for the Sync button\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    \r\n-    // Attach listener for Clear Filters button\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-    });\r\n-}\r\n+async function loadApprovedResidents() {\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noMsg = document.getElementById('noApprovedResidents');\r\n+    if (!tableBody || !noMsg) return;\r\n \r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n \r\n-// ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n-// ====================================================================\r\n-\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadAccessChart() {\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        const residents = await resp.json();\r\n \r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n+        tableBody.innerHTML = '';\r\n+        if (residents.length === 0) return noMsg.classList.remove('hidden');\r\n+        noMsg.classList.add('hidden');\r\n \r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        // Destroy existing chart instance if it exists before creating a new one\r\n-        if (window.accessChartInstance) {\r\n-            window.accessChartInstance.destroy();\r\n-        }\r\n-        \r\n-        window.accessChartInstance = new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n+        residents.forEach(res => {\r\n+            const row = tableBody.insertRow();\r\n+            row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+            row.innerHTML = `\r\n+                <td class=\"px-4 py-3 font-medium\">${res.ResidentName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${res.NationalID || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${res.PhoneNumber || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${res.Email || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${res.HouseNumber || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${res.CourtName || 'N/A'}</td>\r\n+                <td class=\"px-4 py-3\">${res.RoleName || 'N/A'}</td>\r\n+            `;\r\n         });\r\n-\r\n     } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n+        console.error(err);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading approved residents.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents.\", true);\r\n     }\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Fetches and renders payments records.\r\n- */\r\n-async function loadPaymentsRecords() {\r\n-    const tableBody = document.getElementById('paymentsTableBody');\r\n-    if (!tableBody) return; \r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-        \r\n-        const records = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-\r\n-        if (records.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-        } else {\r\n-            records.forEach(record => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading payments records:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load payments records from API.\", true);\r\n-    }\r\n+// Attach membership listeners\r\n+function attachMembershipListeners() {\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared.\", false);\r\n+    });\r\n }\r\n \r\n-/**\r\n- * Attaches event listeners for payments-specific elements.\r\n- */\r\n-function attachPaymentsListeners() {\r\n-    // Add any payments-specific listeners here\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 👥 RESIDENTS LOGIC (residents.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Fetches and renders all resident details.\r\n- */\r\n-async function loadAllResidents() {\r\n-    const tableBody = document.getElementById('allResidentsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-        } else {\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading all residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load all residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n-// ====================================================================\r\n-\r\n-async function loadVisitorPassOverview() {\r\n-    const overviewSection = document.getElementById('visitorOverviewSection');\r\n-    if (!overviewSection) return;\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n-        safeUpdate(\"todayVisitors\", data.today || 0);\r\n-        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-        \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitor overview:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n-    \r\n-    // Implementation details would be similar to loadPendingRequests()\r\n-}\r\n-\r\n-function attachVisitorListeners() {\r\n-    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n-// ====================================================================\r\n-\r\n-async function loadReportsData() {\r\n-    // Placeholder implementation\r\n-    const reportsContainer = document.getElementById('reportsContainer');\r\n-    if (!reportsContainer) return;\r\n-    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n-        // For simplicity, we just display a success message:\r\n-        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading reports data:\", err);\r\n-        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n-// ====================================================================\r\n-\r\n-async function loadManualOverrides() {\r\n-    const logTableBody = document.getElementById('overrideLogTableBody');\r\n-    if (!logTableBody) return;\r\n-\r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-        const logs = await resp.json();\r\n-\r\n-        logTableBody.innerHTML = '';\r\n-        if (logs.length === 0) {\r\n-            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n-        } else {\r\n-            // Populate table rows with logs\r\n-        }\r\n-    } catch (error) {\r\n-        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n-    }\r\n-}\r\n-\r\n-function attachOverrideListeners() {\r\n-    // Attach listener for the 'Perform Manual Override' button\r\n-    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-        \r\n-        try {\r\n-            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n-                method: 'POST',\r\n-                headers: getAuthHeaders(),\r\n-                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n-            });\r\n-            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n-\r\n-            displayMessage(\"Manual override successful!\", false);\r\n-            await loadManualOverrides(); // Reload logs\r\n-\r\n-        } catch (e) {\r\n-            displayMessage(`Manual override failed: ${e.message}`, true);\r\n-        }\r\n-    });\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n-// ====================================================================\r\n+// ================================\r\n+// ⚡ SIDEBAR PAGE LOADING\r\n+// ================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n async function loadPageIntoMainContent(url) {\r\n-    // Show a loading state instantly\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n \r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html; // Inject HTML first\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html;\r\n \r\n-        // 🟢 Execute data loading functions based on the page loaded \r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n-        } \r\n-        \r\n-        // --- MEMBERSHIP PAGES ---\r\n-        else if (url.includes(\"membershiprecords.html\")) {\r\n-            // Approved Residents\r\n-            attachMembershipListeners();\r\n-            await loadApprovedResidents();\r\n-        } else if (url.includes(\"membership.html\")) {\r\n-            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n-            attachMembershipListeners();\r\n-            await loadPendingRequests();\r\n-        }\r\n-        \r\n-        // --- PAYMENTS RECORDS ---\r\n-        else if (url.includes(\"payments.html\")) {\r\n-            attachPaymentsListeners();\r\n-            await loadPaymentsRecords();\r\n-        } \r\n-        \r\n-        // --- RESIDENTS ---\r\n-        else if (url.includes(\"residents.html\")) {\r\n-            await loadAllResidents();\r\n-        } \r\n-        \r\n-        // --- VISITORS MANAGEMENT ---\r\n-        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-            attachVisitorListeners();\r\n-            // Load data relevant to the main visitor pages\r\n-            await loadVisitorPassOverview();\r\n-            await loadPendingVisitorApprovals();\r\n-        }\r\n-        \r\n-        // --- CHARTS AND REPORTS ---\r\n-        else if (url.includes(\"chartsandreports.html\")) {\r\n-            await loadReportsData();\r\n-        } \r\n-        \r\n-        // --- MANUAL OVERRIDES ---\r\n-        else if (url.includes(\"manualoverride.html\")) {\r\n-            attachOverrideListeners();\r\n-            await loadManualOverrides();\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n-    }\r\n+        // Conditional page-specific loading\r\n+        if (url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n+        else if (url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n+        else if (url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n+        // Add other pages as needed...\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n+    }\r\n }\r\n \r\n-// ... (existing sidebar button loop and visitor toggle logic)\r\n-\r\n+// Sidebar click events\r\n sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => {\r\n-            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-            // Also ensure sub-menu items are correctly reset if needed\r\n-            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n-            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n-            \r\n-            // Re-apply specific default styles for sub-menu items if needed\r\n-            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n-                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            }\r\n-        });\r\n-        \r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n+    btn.addEventListener(\"click\", () => {\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n });\r\n \r\n-\r\n // ================================\r\n-// MISC UI TOGGLES\r\n+// 🔹 INITIALIZATION ON PAGE LOAD\r\n // ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n-});\r\n-\r\n-// ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n-// ================================\r\n-\r\n document.addEventListener('DOMContentLoaded', () => {\r\n-    // Load the initial dashboard view when the admin page first loads\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+    // Load default page\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n-// ================================\r\n-// 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n-// ================================\r\n-\r\n-const logsTableBody = document.getElementById(\"logsTableBody\");\r\n-const filterInputs = document.querySelectorAll(\"#accesslogs .filterInput\");\r\n-const exportCsvBtn = document.getElementById(\"exportCsvBtn\");\r\n-const exportExcelBtn = document.getElementById(\"exportExcelBtn\");\r\n-\r\n-// Function to fetch and populate access logs\r\n-\r\n-// ================================\r\n-// 🔹 FILTER LOGS\r\n-// ================================\r\n-filterInputs.forEach((input, colIndex) => {\r\n-  input.addEventListener(\"input\", () => {\r\n-    const filterValue = input.value.toLowerCase();\r\n-    const rows = logsTableBody.querySelectorAll(\"tr\");\r\n-    rows.forEach(row => {\r\n-      const cell = row.cells[colIndex];\r\n-      if (!cell) return;\r\n-      row.style.display = cell.textContent.toLowerCase().includes(filterValue) ? \"\" : \"none\";\r\n-    });\r\n-  });\r\n-});\r\n-\r\n-// ================================\r\n-// 🔹 EXPORT FUNCTIONS\r\n-// ================================\r\n-function downloadCSV() {\r\n-  const rows = Array.from(logsTableBody.querySelectorAll(\"tr\"))\r\n-    .filter(r => r.style.display !== \"none\")\r\n-    .map(r => Array.from(r.cells).map(cell => `\"${cell.textContent}\"`).join(\",\"))\r\n-    .join(\"\\n\");\r\n-\r\n-  const blob = new Blob([rows], { type: \"text/csv\" });\r\n-  const link = document.createElement(\"a\");\r\n-  link.href = URL.createObjectURL(blob);\r\n-  link.download = `access_logs_${Date.now()}.csv`;\r\n-  link.click();\r\n-}\r\n-\r\n-exportCsvBtn?.addEventListener(\"click\", downloadCSV);\r\n-exportExcelBtn?.addEventListener(\"click\", downloadCSV); // Quick export to CSV; can integrate Excel lib if needed\r\n-\r\n-// ================================\r\n-// 🔹 INITIAL LOAD\r\n-// ================================\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    const accesslogsTableBody = document.getElementById(\"logsTableBody\");\r\n-\r\n-    async function loadaccesslogs() {\r\n-        try {\r\n-            const token = localStorage.getItem(\"accessToken\");\r\n-            const response = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n-                headers: { \"Authorization\": `Bearer ${token}` },\r\n-            });\r\n-            if (!response.ok) throw new Error(\"Failed to fetch Access Logs\");\r\n-            const logs = await response.json();\r\n-            renderaccesslogs(logs);\r\n-        } catch (err) {\r\n-            console.error(\"Error loading access logs:\", err);\r\n-            accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500 p-4\">Unable to load Access Logs</td></tr>`;\r\n-        }\r\n-    }\r\n-\r\n-    function renderaccesslogs(logs) {\r\n-        if (!logs || logs.length === 0) {\r\n-            accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center p-4\">No logs found</td></tr>`;\r\n-            return;\r\n-        }\r\n-        accesslogsTableBody.innerHTML = logs.map(log => `\r\n-            <tr class=\"border-b\">\r\n-                <td class=\"p-2 border-r\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-                <td class=\"p-2 border-r\">${log.userId}</td>\r\n-                <td class=\"p-2 border-r\">${log.action}</td>\r\n-                <td class=\"p-2\">${log.type}</td>\r\n-            </tr>\r\n-        `).join(\"\");\r\n-    }\r\n-\r\n-    // Sidebar button click\r\n-    const accesslogsBtn = document.querySelector('.sidebarBtn[data-target=\"sections/accesslogs.html\"]');\r\n-    accesslogsBtn?.addEventListener(\"click\", () => {\r\n-        document.querySelectorAll(\"#main-content-area > div\").forEach(div => div.classList.add(\"hidden\"));\r\n-        document.getElementById(\"accesslogs\").classList.remove(\"hidden\");\r\n-        loadaccesslogs();\r\n-    });\r\n-});\r\n"
                },
                {
                    "date": 1763887589103,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,281 +1,861 @@\n-// =========================================================\r\n-// adminsdashboard.js – Refactored & Optimized\r\n-// =========================================================\r\n+// adminsdashboard.js\r\n+// This file now includes ALL necessary data loading logic (including Membership)\r\n+// to handle dynamic page loading in the Admin Dashboard.\r\n \r\n // ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n-const API_HOST = \"http://localhost:4050\";\r\n-const token = localStorage.getItem(\"accessToken\");\r\n+const API_HOST =  \"http://localhost:4050\"; \r\n+const token = localStorage.getItem(\"accessToken\"); \r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n-    // Dashboard Overview\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    // Dashboard Overview Endpoints\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-    // Membership\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-\r\n-    // General Admin\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    // Membership Endpoints\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    \r\n+    // General Admin Endpoints\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n // ================================\r\n-document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n+document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n-// UTILITIES & HELPERS\r\n+// UTILITIES AND HELPERS\r\n // ================================\r\n+\r\n+/**\r\n+ * Creates and returns the standard headers needed for authenticated API calls.\r\n+ */\r\n function getAuthHeaders() {\r\n-    return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n }\r\n \r\n+/**\r\n+ * Handles error display in a non-alert manner.\r\n+ */\r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (!msgElement) return;\r\n-    msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-    setTimeout(() => {\r\n-        msgElement.textContent = '';\r\n-        msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-    }, 5000);\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+        \r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Formats a timestamp (string or number) into a readable date string.\r\n+ */\r\n function formatTimestamp(timestamp) {\r\n-    try {\r\n-        return timestamp ? new Date(timestamp).toLocaleString() : 'N/A';\r\n-    } catch (e) { return 'N/A'; }\r\n+    try {\r\n+        if (!timestamp) return 'N/A';\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch (e) {\r\n+        return 'N/A';\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Safely updates a DOM element's text content.\r\n+ */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) element.textContent = value + suffix;\r\n+    const element = document.getElementById(id);\r\n+    if (element) {\r\n+        element.textContent = value + suffix;\r\n+    }\r\n };\r\n \r\n-// ================================\r\n-// 🟢 MEMBERSHIP LOGIC\r\n-// ================================\r\n-async function handleMembershipAction(requestId, actionType) {\r\n-    const actionsMap = {\r\n-        approve: ENDPOINTS.APPROVE_REQUEST,\r\n-        reject: ENDPOINTS.REJECT_REQUEST,\r\n-        delete: ENDPOINTS.DELETE_REQUEST\r\n-    };\r\n-    const confirmMsgs = {\r\n-        approve: `Approve request ${requestId}?`,\r\n-        reject: `Reject request ${requestId}?`,\r\n-        delete: `Delete request ${requestId}? This cannot be undone.`\r\n-    };\r\n \r\n-    if (actionType !== 'approve' && !confirm(confirmMsgs[actionType])) return;\r\n+// ====================================================================\r\n+// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n+// ====================================================================\r\n \r\n-    safeUpdate('actionText', `Processing ${actionType} for ${requestId}...`);\r\n+/**\r\n+ * Sends an approval request to the backend API.\r\n+ */\r\n+async function handleApproveClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n \r\n-    try {\r\n-        const resp = await fetch(actionsMap[actionType](requestId), { method: actionType === 'delete' ? 'DELETE' : 'PUT', headers: getAuthHeaders() });\r\n-        if (!resp.ok) {\r\n-            const errData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errData.message || resp.statusText);\r\n-        }\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n \r\n-        safeUpdate('actionText', `${actionType.charAt(0).toUpperCase() + actionType.slice(1)} Request ${requestId}`);\r\n-        displayMessage(`Successfully ${actionType}d membership request ${requestId}.`);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch (err) {\r\n-        console.error(`${actionType} operation failed:`, err);\r\n-        displayMessage(`${actionType.charAt(0).toUpperCase() + actionType.slice(1)} failed: ${err.message}`, true);\r\n-    }\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n+        \r\n+        // Reload data after a successful action\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Approval Operation Failed:\", e);\r\n+        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Sends a rejection request to the backend API.\r\n+ */\r\n+async function handleRejectClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Operation Failed:\", e);\r\n+        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Sends a deletion request to the backend API.\r\n+ */\r\n+async function handleDeleteClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE', \r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n+        }\r\n+        \r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n+        \r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Operation Failed:\", e);\r\n+        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+/**\r\n+ * Executes a real API call to trigger server-side data synchronization.\r\n+ */\r\n async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n \r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md animate-pulse';\r\n+    // 1. Set Loading State\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(`Sync failed: ${resp.status}`);\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md';\r\n-        displayMessage(\"Data synchronization successful.\");\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch (err) {\r\n-        console.error(\"Sync Error:\", err);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-    } finally {\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n-    }\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { \r\n+            method: 'POST',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+\r\n+        if (!resp.ok) {\r\n+            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n+            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n+        }\r\n+\r\n+        // 2. Set Success State\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n+\r\n+        // Reload data after a successful sync\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+        \r\n+    } catch (err) {\r\n+        // 3. Set Failure State\r\n+        console.error(\"Synchronization Error:\", err.message);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+\r\n+    } finally {\r\n+        // 4. Reset Button State after a short delay\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n+    }\r\n }\r\n \r\n+/**\r\n+ * Fetches and renders pending membership requests from the backend API.\r\n+ */\r\n async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    \r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n \r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        \r\n+        const requests = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-        const requests = await resp.json();\r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n \r\n-        if (requests.length === 0) return noRequestsMsg.classList.remove('hidden');\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID; \r\n \r\n-        noRequestsMsg.classList.add('hidden');\r\n-        requests.forEach(req => {\r\n-            const requestId = req.id || req.RequestID;\r\n-            const row = tableBody.insertRow();\r\n-            row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-            row.innerHTML = `\r\n-                <td class=\"px-4 py-3\">${requestId}</td>\r\n-                <td class=\"px-4 py-3 font-medium\">${req.ResidentName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${req.NationalID || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${req.PhoneNumber || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${req.Email || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${req.HouseNumber || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${req.CourtName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${req.RoleName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${req.Status || 'Pending'}</span></td>\r\n-                <td class=\"px-4 py-3\">${formatTimestamp(req.RequestedAt || req.requestedAt)}</td>\r\n-                <td class=\"px-4 py-3 text-center flex space-x-2\">\r\n-                    <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs shadow-md\" data-id=\"${requestId}\">Approve</button>\r\n-                    <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs shadow-md\" data-id=\"${requestId}\">Reject</button>\r\n-                    <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs shadow-md\" data-id=\"${requestId}\">Delete</button>\r\n-                </td>\r\n-            `;\r\n-        });\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${requestId}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n+                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n+                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Approve\r\n+                        </button>\r\n+                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Reject\r\n+                        </button>\r\n+                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n+                            Delete\r\n+                        </button>\r\n+                    </td>\r\n+                `;\r\n+            });\r\n+            \r\n+            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n+                button.addEventListener('click', (e) => {\r\n+                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n+                });\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading pending requests:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n+}\r\n \r\n-        // Attach event listeners\r\n-        tableBody.querySelectorAll('.approve-btn').forEach(btn => btn.addEventListener('click', e => handleMembershipAction(e.target.dataset.id, 'approve')));\r\n-        tableBody.querySelectorAll('.reject-btn').forEach(btn => btn.addEventListener('click', e => handleMembershipAction(e.target.dataset.id, 'reject')));\r\n-        tableBody.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', e => handleMembershipAction(e.target.dataset.id, 'delete')));\r\n+/**\r\n+ * Fetches and renders approved residents from the backend API.\r\n+ */\r\n+async function loadApprovedResidents() {\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    \r\n+    if (!tableBody || !noResidentsMsg) return;\r\n \r\n-    } catch (err) {\r\n-        console.error(err);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests.\", true);\r\n-    }\r\n+    // Show loading state\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading approved residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents from API.\", true);\r\n+    }\r\n }\r\n \r\n-async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noMsg = document.getElementById('noApprovedResidents');\r\n-    if (!tableBody || !noMsg) return;\r\n+/**\r\n+ * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n+ */\r\n+function attachMembershipListeners() {\r\n+    // Attach listener for the Sync button\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+    \r\n+    // Attach listener for Clear Filters button\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n+        document.getElementById('requestIdFilter').value = \"\";\r\n+        document.getElementById('residentFilter').value = \"\";\r\n+        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n+    });\r\n+}\r\n \r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n \r\n+// ====================================================================\r\n+// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n+// ====================================================================\r\n+\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+\r\n+        safeUpdate(\"totalResidents\", data.residents || 0);\r\n+        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n+        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n+        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading summary:\", err);\r\n+    }\r\n+}\r\n+\r\n+async function loadAccessChart() {\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-        const residents = await resp.json();\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n+            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n \r\n-        tableBody.innerHTML = '';\r\n-        if (residents.length === 0) return noMsg.classList.remove('hidden');\r\n-        noMsg.classList.add('hidden');\r\n+        const accessChartElement = document.getElementById(\"accessChart\");\r\n+        if (!accessChartElement) return;\r\n \r\n-        residents.forEach(res => {\r\n-            const row = tableBody.insertRow();\r\n-            row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-            row.innerHTML = `\r\n-                <td class=\"px-4 py-3 font-medium\">${res.ResidentName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${res.NationalID || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${res.PhoneNumber || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${res.Email || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${res.HouseNumber || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${res.CourtName || 'N/A'}</td>\r\n-                <td class=\"px-4 py-3\">${res.RoleName || 'N/A'}</td>\r\n-            `;\r\n+        const ctx = accessChartElement.getContext(\"2d\");\r\n+        // Destroy existing chart instance if it exists before creating a new one\r\n+        if (window.accessChartInstance) {\r\n+            window.accessChartInstance.destroy();\r\n+        }\r\n+        \r\n+        window.accessChartInstance = new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.days || [],\r\n+                datasets: [{\r\n+                    label: \"Access Attempts\",\r\n+                    data: data.counts || [],\r\n+                    borderWidth: 2,\r\n+                    tension: 0.4,\r\n+                    borderColor: '#2563eb',\r\n+                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n+                    fill: true\r\n+                }]\r\n+            },\r\n+            options: { responsive: true, maintainAspectRatio: false }\r\n         });\r\n+\r\n     } catch (err) {\r\n-        console.error(err);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading approved residents.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents.\", true);\r\n+        console.error(\"Error loading chart:\", err);\r\n     }\r\n }\r\n \r\n-// Attach membership listeners\r\n-function attachMembershipListeners() {\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared.\", false);\r\n-    });\r\n+\r\n+// ====================================================================\r\n+// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Fetches and renders payments records.\r\n+ */\r\n+async function loadPaymentsRecords() {\r\n+    const tableBody = document.getElementById('paymentsTableBody');\r\n+    if (!tableBody) return; \r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n+        \r\n+        const records = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+\r\n+        if (records.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n+        } else {\r\n+            records.forEach(record => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n+                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading payments records:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load payments records from API.\", true);\r\n+    }\r\n }\r\n \r\n-// ================================\r\n-// ⚡ SIDEBAR PAGE LOADING\r\n-// ================================\r\n+/**\r\n+ * Attaches event listeners for payments-specific elements.\r\n+ */\r\n+function attachPaymentsListeners() {\r\n+    // Add any payments-specific listeners here\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 👥 RESIDENTS LOGIC (residents.html)\r\n+// ====================================================================\r\n+\r\n+/**\r\n+ * Fetches and renders all resident details.\r\n+ */\r\n+async function loadAllResidents() {\r\n+    const tableBody = document.getElementById('allResidentsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n+        \r\n+        const residents = await resp.json();\r\n+        \r\n+        tableBody.innerHTML = '';\r\n+        \r\n+        if (residents.length === 0) {\r\n+            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n+        } else {\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n+                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n+                `;\r\n+            });\r\n+        }\r\n+    } catch (error) {\r\n+        console.error(\"Error loading all residents:\", error);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n+        displayMessage(\"Failed to load all residents from API.\", true);\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n+// ====================================================================\r\n+\r\n+async function loadVisitorPassOverview() {\r\n+    const overviewSection = document.getElementById('visitorOverviewSection');\r\n+    if (!overviewSection) return;\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n+        safeUpdate(\"todayVisitors\", data.today || 0);\r\n+        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n+        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n+        \r\n+    } catch (err) {\r\n+        console.error(\"Error loading visitor overview:\", err);\r\n+    }\r\n+}\r\n+\r\n+async function loadPendingVisitorApprovals() {\r\n+    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n+    if (!tableBody) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n+    \r\n+    // Implementation details would be similar to loadPendingRequests()\r\n+}\r\n+\r\n+function attachVisitorListeners() {\r\n+    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n+// ====================================================================\r\n+\r\n+async function loadReportsData() {\r\n+    // Placeholder implementation\r\n+    const reportsContainer = document.getElementById('reportsContainer');\r\n+    if (!reportsContainer) return;\r\n+    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n+        const data = await res.json();\r\n+        \r\n+        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n+        // For simplicity, we just display a success message:\r\n+        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n+\r\n+    } catch (err) {\r\n+        console.error(\"Error loading reports data:\", err);\r\n+        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n+    }\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n+// ====================================================================\r\n+\r\n+async function loadManualOverrides() {\r\n+    const logTableBody = document.getElementById('overrideLogTableBody');\r\n+    if (!logTableBody) return;\r\n+\r\n+    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n+    \r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n+        const logs = await resp.json();\r\n+\r\n+        logTableBody.innerHTML = '';\r\n+        if (logs.length === 0) {\r\n+            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n+        } else {\r\n+            // Populate table rows with logs\r\n+        }\r\n+    } catch (error) {\r\n+        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+    }\r\n+}\r\n+\r\n+function attachOverrideListeners() {\r\n+    // Attach listener for the 'Perform Manual Override' button\r\n+    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n+        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n+        \r\n+        try {\r\n+            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n+            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n+                method: 'POST',\r\n+                headers: getAuthHeaders(),\r\n+                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n+            });\r\n+            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n+\r\n+            displayMessage(\"Manual override successful!\", false);\r\n+            await loadManualOverrides(); // Reload logs\r\n+\r\n+        } catch (e) {\r\n+            displayMessage(`Manual override failed: ${e.message}`, true);\r\n+        }\r\n+    });\r\n+}\r\n+\r\n+\r\n+// ====================================================================\r\n+// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n+// ====================================================================\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n async function loadPageIntoMainContent(url) {\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n+    // Show a loading state instantly\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n \r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html;\r\n+    try {\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html; // Inject HTML first\r\n \r\n-        // Conditional page-specific loading\r\n-        if (url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n-        else if (url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n-        else if (url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n-        // Add other pages as needed...\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n-    }\r\n+        // 🟢 Execute data loading functions based on the page loaded \r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart();\r\n+        } \r\n+        \r\n+        // --- MEMBERSHIP PAGES ---\r\n+        else if (url.includes(\"membershiprecords.html\")) {\r\n+            // Approved Residents\r\n+            attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+        }\r\n+        \r\n+        // --- PAYMENTS RECORDS ---\r\n+        else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } \r\n+        \r\n+        // --- RESIDENTS ---\r\n+        else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } \r\n+        \r\n+        // --- VISITORS MANAGEMENT ---\r\n+        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+            attachVisitorListeners();\r\n+            // Load data relevant to the main visitor pages\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        }\r\n+        \r\n+        // --- CHARTS AND REPORTS ---\r\n+        else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } \r\n+        \r\n+        // --- MANUAL OVERRIDES ---\r\n+        else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n+    }\r\n }\r\n \r\n-// Sidebar click events\r\n+// ... (existing sidebar button loop and visitor toggle logic)\r\n+\r\n sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", () => {\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        sidebarButtons.forEach(b => {\r\n+            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+            // Also ensure sub-menu items are correctly reset if needed\r\n+            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n+            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n+            \r\n+            // Re-apply specific default styles for sub-menu items if needed\r\n+            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n+                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n+                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            }\r\n+        });\r\n+        \r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+\r\n+        const page = btn.dataset.target;\r\n+        if (page) loadPageIntoMainContent(page);\r\n+    });\r\n });\r\n \r\n+\r\n // ================================\r\n-// 🔹 INITIALIZATION ON PAGE LOAD\r\n+// MISC UI TOGGLES\r\n // ================================\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+});\r\n+\r\n+// ================================\r\n+// INITIALIZATION ON PAGE LOAD\r\n+// ================================\r\n+\r\n document.addEventListener('DOMContentLoaded', () => {\r\n-    // Load default page\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+    // Load the initial dashboard view when the admin page first loads\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n+// ================================\r\n+// 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n+// ================================\r\n+\r\n+const logsTableBody = document.getElementById(\"logsTableBody\");\r\n+const filterInputs = document.querySelectorAll(\"#accesslogs .filterInput\");\r\n+const exportCsvBtn = document.getElementById(\"exportCsvBtn\");\r\n+const exportExcelBtn = document.getElementById(\"exportExcelBtn\");\r\n+\r\n+// Function to fetch and populate access logs\r\n+\r\n+// ================================\r\n+// 🔹 FILTER LOGS\r\n+// ================================\r\n+filterInputs.forEach((input, colIndex) => {\r\n+  input.addEventListener(\"input\", () => {\r\n+    const filterValue = input.value.toLowerCase();\r\n+    const rows = logsTableBody.querySelectorAll(\"tr\");\r\n+    rows.forEach(row => {\r\n+      const cell = row.cells[colIndex];\r\n+      if (!cell) return;\r\n+      row.style.display = cell.textContent.toLowerCase().includes(filterValue) ? \"\" : \"none\";\r\n+    });\r\n+  });\r\n+});\r\n+\r\n+// ================================\r\n+// 🔹 EXPORT FUNCTIONS\r\n+// ================================\r\n+function downloadCSV() {\r\n+  const rows = Array.from(logsTableBody.querySelectorAll(\"tr\"))\r\n+    .filter(r => r.style.display !== \"none\")\r\n+    .map(r => Array.from(r.cells).map(cell => `\"${cell.textContent}\"`).join(\",\"))\r\n+    .join(\"\\n\");\r\n+\r\n+  const blob = new Blob([rows], { type: \"text/csv\" });\r\n+  const link = document.createElement(\"a\");\r\n+  link.href = URL.createObjectURL(blob);\r\n+  link.download = `access_logs_${Date.now()}.csv`;\r\n+  link.click();\r\n+}\r\n+\r\n+exportCsvBtn?.addEventListener(\"click\", downloadCSV);\r\n+exportExcelBtn?.addEventListener(\"click\", downloadCSV); // Quick export to CSV; can integrate Excel lib if needed\r\n+\r\n+// ================================\r\n+// 🔹 INITIAL LOAD\r\n+// ================================\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    const accesslogsTableBody = document.getElementById(\"logsTableBody\");\r\n+\r\n+    async function loadaccesslogs() {\r\n+        try {\r\n+            const token = localStorage.getItem(\"accessToken\");\r\n+            const response = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n+                headers: { \"Authorization\": `Bearer ${token}` },\r\n+            });\r\n+            if (!response.ok) throw new Error(\"Failed to fetch Access Logs\");\r\n+            const logs = await response.json();\r\n+            renderaccesslogs(logs);\r\n+        } catch (err) {\r\n+            console.error(\"Error loading access logs:\", err);\r\n+            accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500 p-4\">Unable to load Access Logs</td></tr>`;\r\n+        }\r\n+    }\r\n+\r\n+    function renderaccesslogs(logs) {\r\n+        if (!logs || logs.length === 0) {\r\n+            accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center p-4\">No logs found</td></tr>`;\r\n+            return;\r\n+        }\r\n+        accesslogsTableBody.innerHTML = logs.map(log => `\r\n+            <tr class=\"border-b\">\r\n+                <td class=\"p-2 border-r\">${new Date(log.timestamp).toLocaleString()}</td>\r\n+                <td class=\"p-2 border-r\">${log.userId}</td>\r\n+                <td class=\"p-2 border-r\">${log.action}</td>\r\n+                <td class=\"p-2\">${log.type}</td>\r\n+            </tr>\r\n+        `).join(\"\");\r\n+    }\r\n+\r\n+    // Sidebar button click\r\n+    const accesslogsBtn = document.querySelector('.sidebarBtn[data-target=\"sections/accesslogs.html\"]');\r\n+    accesslogsBtn?.addEventListener(\"click\", () => {\r\n+        document.querySelectorAll(\"#main-content-area > div\").forEach(div => div.classList.add(\"hidden\"));\r\n+        document.getElementById(\"accesslogs\").classList.remove(\"hidden\");\r\n+        loadaccesslogs();\r\n+    });\r\n+});\r\n"
                },
                {
                    "date": 1763887623373,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,861 +1,248 @@\n-// adminsdashboard.js\r\n-// This file now includes ALL necessary data loading logic (including Membership)\r\n-// to handle dynamic page loading in the Admin Dashboard.\r\n+// =========================================================\r\n+// adminsdashboard.js - Unified Admin Dashboard Loader\r\n+// =========================================================\r\n \r\n-// ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n-// ================================\r\n-const API_HOST =  \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"accessToken\"); \r\n+const API_HOST = \"http://localhost:4050\";\r\n+const token = localStorage.getItem(\"accessToken\");\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // Define API Endpoints\r\n const ENDPOINTS = {\r\n-    // Dashboard Overview Endpoints\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n-\r\n-    // Membership Endpoints\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    \r\n-    // General Admin Endpoints\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n-// ================================\r\n-document.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    window.location.href = \"/login.html\";\r\n+document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n-// UTILITIES AND HELPERS\r\n-// ================================\r\n-\r\n-/**\r\n- * Creates and returns the standard headers needed for authenticated API calls.\r\n- */\r\n+// UTILITIES\r\n function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n+    return { \"Content-Type\": \"application/json\", \"Authorization\": `Bearer ${token}` };\r\n }\r\n \r\n-/**\r\n- * Handles error display in a non-alert manner.\r\n- */\r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-        \r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n+    const msgElement = document.getElementById(\"msg\");\r\n+    if (!msgElement) return;\r\n+    msgElement.textContent = message;\r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+    setTimeout(() => {\r\n+        msgElement.textContent = '';\r\n+        msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+    }, 5000);\r\n }\r\n \r\n-/**\r\n- * Formats a timestamp (string or number) into a readable date string.\r\n- */\r\n function formatTimestamp(timestamp) {\r\n-    try {\r\n-        if (!timestamp) return 'N/A';\r\n-        return new Date(timestamp).toLocaleString();\r\n-    } catch (e) {\r\n-        return 'N/A';\r\n-    }\r\n+    if (!timestamp) return 'N/A';\r\n+    try { return new Date(timestamp).toLocaleString(); } \r\n+    catch (e) { return 'N/A'; }\r\n }\r\n \r\n-/**\r\n- * Safely updates a DOM element's text content.\r\n- */\r\n const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) {\r\n-        element.textContent = value + suffix;\r\n-    }\r\n+    const el = document.getElementById(id);\r\n+    if (el) el.textContent = value + suffix;\r\n };\r\n \r\n-\r\n-// ====================================================================\r\n-// 🟢 CORE MEMBERSHIP LOGIC (membership.html & membershiprecords.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Sends an approval request to the backend API.\r\n- */\r\n+// ================================\r\n+// MEMBERSHIP FUNCTIONS\r\n async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Approval failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`, false);\r\n-        \r\n-        // Reload data after a successful action\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Approval Operation Failed:\", e);\r\n-        displayMessage(`Approval failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Approval failed`);\r\n+        displayMessage(`Successfully approved ${requestId}`, false);\r\n+        await loadPendingRequests(); await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n }\r\n \r\n-/**\r\n- * Sends a rejection request to the backend API.\r\n- */\r\n async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-            method: 'PUT', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Rejection failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Operation Failed:\", e);\r\n-        displayMessage(`Rejection failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    if (!confirm(`Reject request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n+        displayMessage(`Successfully rejected ${requestId}`, false);\r\n+        await loadPendingRequests(); await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n }\r\n \r\n-/**\r\n- * Sends a deletion request to the backend API.\r\n- */\r\n async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}? This action is permanent.`)) return;\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-            method: 'DELETE', \r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Deletion failed with status: ${resp.status}`);\r\n-        }\r\n-        \r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`, false);\r\n-        \r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-\r\n-    } catch (e) {\r\n-        console.error(\"Deletion Operation Failed:\", e);\r\n-        displayMessage(`Deletion failed for ${requestId}: ${e.message}`, true);\r\n-    }\r\n+    if (!confirm(`Delete request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n+        displayMessage(`Deleted request ${requestId}`, false);\r\n+        await loadPendingRequests(); await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n }\r\n \r\n-/**\r\n- * Executes a real API call to trigger server-side data synchronization.\r\n- */\r\n async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n-\r\n-    // 1. Set Loading State\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 animate-pulse min-w-[100px]';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { \r\n-            method: 'POST',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-\r\n-        if (!resp.ok) {\r\n-            const errorData = await resp.json().catch(() => ({ message: resp.statusText }));\r\n-            throw new Error(errorData.message || `Sync failed with status: ${resp.status}`);\r\n-        }\r\n-\r\n-        // 2. Set Success State\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(\"Data synchronization was successful. Tables reloading...\", false);\r\n-\r\n-        // Reload data after a successful sync\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-        \r\n-    } catch (err) {\r\n-        // 3. Set Failure State\r\n-        console.error(\"Synchronization Error:\", err.message);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md transition-colors duration-200 min-w-[100px]';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n-\r\n-    } finally {\r\n-        // 4. Reset Button State after a short delay\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n-        }, 3000);\r\n-    }\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent, originalClass = btn.className;\r\n+    btn.disabled = true; btn.textContent='Syncing...'; btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n+        btn.textContent='Sync Complete!'; btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n+        displayMessage(\"Data synchronization successful\", false);\r\n+        await loadPendingRequests(); await loadApprovedResidents();\r\n+    } catch(err){ btn.textContent='Sync Failed ❌'; btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; displayMessage(`Sync failed: ${err.message}`,true); }\r\n+    finally{ setTimeout(()=>{ btn.disabled=false; btn.textContent=originalText; btn.className=originalClass; }, 3000); }\r\n }\r\n \r\n-/**\r\n- * Fetches and renders pending membership requests from the backend API.\r\n- */\r\n async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    \r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading requests...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n-        \r\n-        const requests = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n-\r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-\r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID; \r\n-\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${requestId}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${request.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${request.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-                    <td class=\"px-4 py-3\">${requestedAtString}</td>\r\n-                    <td class=\"px-4 py-3 text-center space-x-2 flex\">\r\n-                        <button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Approve\r\n-                        </button>\r\n-                        <button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Reject\r\n-                        </button>\r\n-                        <button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition duration-150 shadow-md\" data-request-id=\"${requestId}\">\r\n-                            Delete\r\n-                        </button>\r\n-                    </td>\r\n-                `;\r\n-            });\r\n-            \r\n-            // Attach listeners to the new Action buttons (must be done AFTER innerHTML)\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleApproveClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleRejectClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(button => {\r\n-                button.addEventListener('click', (e) => {\r\n-                    handleDeleteClick(e.target.getAttribute('data-request-id'));\r\n-                });\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading pending requests:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n-    }\r\n+    const tbody = document.getElementById('membershipTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error('Failed to fetch pending requests');\r\n+        const requests = await resp.json();\r\n+        tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : '';\r\n+        requests.forEach(r=>{\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML=`\r\n+                <td>${r.RequestID||r.id}</td>\r\n+                <td>${r.ResidentName||'N/A'}</td>\r\n+                <td>${r.NationalID||'N/A'}</td>\r\n+                <td>${r.PhoneNumber||'N/A'}</td>\r\n+                <td>${r.Email||'N/A'}</td>\r\n+                <td>${r.HouseNumber||'N/A'}</td>\r\n+                <td>${r.CourtName||'N/A'}</td>\r\n+                <td>${r.RoleName||'N/A'}</td>\r\n+                <td>${r.Status||'Pending'}</td>\r\n+                <td>${formatTimestamp(r.RequestedAt||r.requestedAt)}</td>\r\n+                <td class=\"flex space-x-1\">\r\n+                    <button class=\"approve-btn\" data-id=\"${r.RequestID||r.id}\">Approve</button>\r\n+                    <button class=\"reject-btn\" data-id=\"${r.RequestID||r.id}\">Reject</button>\r\n+                    <button class=\"delete-btn\" data-id=\"${r.RequestID||r.id}\">Delete</button>\r\n+                </td>\r\n+            `;\r\n+        });\r\n+        tbody.querySelectorAll('.approve-btn').forEach(b=>b.addEventListener('click', e=>handleApproveClick(e.target.dataset.id)));\r\n+        tbody.querySelectorAll('.reject-btn').forEach(b=>b.addEventListener('click', e=>handleRejectClick(e.target.dataset.id)));\r\n+        tbody.querySelectorAll('.delete-btn').forEach(b=>b.addEventListener('click', e=>handleDeleteClick(e.target.dataset.id)));\r\n+    } catch(e){ displayMessage(`Failed to load pending requests: ${e.message}`, true); }\r\n }\r\n \r\n-/**\r\n- * Fetches and renders approved residents from the backend API.\r\n- */\r\n async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-    \r\n-    if (!tableBody || !noResidentsMsg) return;\r\n-\r\n-    // Show loading state\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading approved residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-\r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            noResidentsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noResidentsMsg.classList.add('hidden');\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.NationalID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading approved residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents from API.\", true);\r\n-    }\r\n-}\r\n-\r\n-/**\r\n- * Attaches event listeners for membership-specific elements (Sync, Filters)\r\n- */\r\n-function attachMembershipListeners() {\r\n-    // Attach listener for the Sync button\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-    \r\n-    // Attach listener for Clear Filters button\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-        // Assumes these filter IDs exist on membership.html or membershiprecords.html\r\n-        document.getElementById('requestIdFilter').value = \"\";\r\n-        document.getElementById('residentFilter').value = \"\";\r\n-        displayMessage(\"Filters cleared (API query filtering needs implementation).\", false);\r\n-    });\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📊 DASHBOARD OVERVIEW LOGIC (dashboardoverview.html)\r\n-// ====================================================================\r\n-\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n-        });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        safeUpdate(\"totalResidents\", data.residents || 0);\r\n-        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n-        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n-        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading summary:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadAccessChart() {\r\n+    const tbody = document.getElementById('residentsTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML='<tr><td colspan=\"8\">Loading...</td></tr>';\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_CHART, {\r\n-            headers: { \"Authorization\": `Bearer ${token}` }\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS,{headers:getAuthHeaders()});\r\n+        if(!resp.ok) throw new Error('Failed to fetch approved residents');\r\n+        const residents = await resp.json();\r\n+        tbody.innerHTML = residents.length===0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : '';\r\n+        residents.forEach(r=>{\r\n+            const row=tbody.insertRow();\r\n+            row.innerHTML=`\r\n+                <td>${r.ResidentName||'N/A'}</td>\r\n+                <td>${r.NationalID||'N/A'}</td>\r\n+                <td>${r.PhoneNumber||'N/A'}</td>\r\n+                <td>${r.Email||'N/A'}</td>\r\n+                <td>${r.HouseNumber||'N/A'}</td>\r\n+                <td>${r.CourtName||'N/A'}</td>\r\n+                <td>${r.RoleName||'N/A'}</td>\r\n+            `;\r\n         });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-\r\n-        const accessChartElement = document.getElementById(\"accessChart\");\r\n-        if (!accessChartElement) return;\r\n-\r\n-        const ctx = accessChartElement.getContext(\"2d\");\r\n-        // Destroy existing chart instance if it exists before creating a new one\r\n-        if (window.accessChartInstance) {\r\n-            window.accessChartInstance.destroy();\r\n-        }\r\n-        \r\n-        window.accessChartInstance = new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.days || [],\r\n-                datasets: [{\r\n-                    label: \"Access Attempts\",\r\n-                    data: data.counts || [],\r\n-                    borderWidth: 2,\r\n-                    tension: 0.4,\r\n-                    borderColor: '#2563eb',\r\n-                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n-                    fill: true\r\n-                }]\r\n-            },\r\n-            options: { responsive: true, maintainAspectRatio: false }\r\n-        });\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading chart:\", err);\r\n-    }\r\n+    } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 💵 PAYMENTS RECORDS LOGIC (payments.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Fetches and renders payments records.\r\n- */\r\n-async function loadPaymentsRecords() {\r\n-    const tableBody = document.getElementById('paymentsTableBody');\r\n-    if (!tableBody) return; \r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading payment records...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PAYMENTS_RECORDS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch payments records.\");\r\n-        \r\n-        const records = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-\r\n-        if (records.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-gray-500\">No payment records found.</td></tr>';\r\n-        } else {\r\n-            records.forEach(record => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3\">${record.TransactionID || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3 font-medium\">${record.PayerName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">Ksh ${record.Amount?.toFixed(2) || '0.00'}</td>\r\n-                    <td class=\"px-4 py-3\">${record.PaymentMethod || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${formatTimestamp(record.PaymentDate)}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${record.Status || 'Complete'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading payments records:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load payments records from API.\", true);\r\n-    }\r\n+function attachMembershipListeners(){\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n+        document.getElementById('requestIdFilter').value=''; \r\n+        document.getElementById('residentFilter').value='';\r\n+        displayMessage(\"Filters cleared.\", false);\r\n+    });\r\n }\r\n \r\n-/**\r\n- * Attaches event listeners for payments-specific elements.\r\n- */\r\n-function attachPaymentsListeners() {\r\n-    // Add any payments-specific listeners here\r\n+// ================================\r\n+// DASHBOARD FUNCTIONS\r\n+async function loadDashboardSummary(){\r\n+    try{\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY,{headers:getAuthHeaders()});\r\n+        if(!res.ok) throw new Error(res.statusText);\r\n+        const d=await res.json();\r\n+        safeUpdate(\"totalResidents\",d.residents||0);\r\n+        safeUpdate(\"pendingPayments\",d.pendingPayments||0);\r\n+        safeUpdate(\"compliancePct\",d.compliance||0,'%');\r\n+        safeUpdate(\"overrideCount\",d.overrides||0);\r\n+    }catch(e){ console.error(e); }\r\n }\r\n \r\n-\r\n-// ====================================================================\r\n-// 👥 RESIDENTS LOGIC (residents.html)\r\n-// ====================================================================\r\n-\r\n-/**\r\n- * Fetches and renders all resident details.\r\n- */\r\n-async function loadAllResidents() {\r\n-    const tableBody = document.getElementById('allResidentsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading all residents...</td></tr>';\r\n-\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ALL_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch all residents.\");\r\n-        \r\n-        const residents = await resp.json();\r\n-        \r\n-        tableBody.innerHTML = '';\r\n-        \r\n-        if (residents.length === 0) {\r\n-            tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-gray-500\">No residents found.</td></tr>';\r\n-        } else {\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-                    <td class=\"px-4 py-3 font-medium\">${resident.ResidentName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.PhoneNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.Email || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.HouseNumber || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.CourtName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\">${resident.RoleName || 'N/A'}</td>\r\n-                    <td class=\"px-4 py-3\"><span class=\"bg-green-200 text-green-800 px-2 py-0.5 rounded-full text-xs\">${resident.AccountStatus || 'Active'}</span></td>\r\n-                `;\r\n-            });\r\n-        }\r\n-    } catch (error) {\r\n-        console.error(\"Error loading all residents:\", error);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Error loading data. Check console for details.</td></tr>';\r\n-        displayMessage(\"Failed to load all residents from API.\", true);\r\n-    }\r\n+async function loadAccessChart(){\r\n+    try{\r\n+        const res=await fetch(ENDPOINTS.DASHBOARD_CHART,{headers:getAuthHeaders()});\r\n+        if(!res.ok) throw new Error(res.statusText);\r\n+        const data=await res.json();\r\n+        const el=document.getElementById(\"accessChart\");\r\n+        if(!el) return;\r\n+        const ctx=el.getContext(\"2d\");\r\n+        if(window.accessChartInstance) window.accessChartInstance.destroy();\r\n+        window.accessChartInstance = new Chart(ctx,{\r\n+            type:'line',\r\n+            data:{labels:data.days||[], datasets:[{label:'Access Attempts', data:data.counts||[], borderColor:'#2563eb', backgroundColor:'rgba(37,99,235,0.2)', fill:true}]},\r\n+            options:{responsive:true, maintainAspectRatio:false}\r\n+        });\r\n+    }catch(e){ console.error(e); }\r\n }\r\n \r\n+// ================================\r\n+// SIDEBAR & PAGE LOADING\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContent = document.getElementById(\"main-content-area\");\r\n \r\n-// ====================================================================\r\n-// 🚗 VISITOR MANAGEMENT LOGIC (visitorsaccess.html, etc.)\r\n-// ====================================================================\r\n+async function loadPageIntoMainContent(url){\r\n+    if(!mainContent) return;\r\n+    mainContent.innerHTML='<div>Loading...</div>';\r\n+    try{\r\n+        const res = await fetch(url);\r\n+        if(!res.ok) throw new Error(res.status);\r\n+        const html=await res.text();\r\n+        mainContent.innerHTML=html;\r\n \r\n-async function loadVisitorPassOverview() {\r\n-    const overviewSection = document.getElementById('visitorOverviewSection');\r\n-    if (!overviewSection) return;\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.VISITOR_OVERVIEW, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Assuming your HTML has elements like 'todayVisitors', 'pendingApprovalsCount', 'activeCodes'\r\n-        safeUpdate(\"todayVisitors\", data.today || 0);\r\n-        safeUpdate(\"pendingApprovalsCount\", data.pendingApprovals || 0);\r\n-        safeUpdate(\"activeCodes\", data.activeCodes || 0);\r\n-        \r\n-    } catch (err) {\r\n-        console.error(\"Error loading visitor overview:\", err);\r\n-    }\r\n-}\r\n-\r\n-async function loadPendingVisitorApprovals() {\r\n-    const tableBody = document.getElementById('visitorRequestsTableBody');\r\n-    if (!tableBody) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-4 text-blue-500 italic\">Loading pending visitor requests...</td></tr>';\r\n-    \r\n-    // Implementation details would be similar to loadPendingRequests()\r\n-}\r\n-\r\n-function attachVisitorListeners() {\r\n-    // Attach listeners for visitor related buttons (Approve/Reject/Filters)\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 📈 CHARTS & REPORTS LOGIC (chartsandreports.html)\r\n-// ====================================================================\r\n-\r\n-async function loadReportsData() {\r\n-    // Placeholder implementation\r\n-    const reportsContainer = document.getElementById('reportsContainer');\r\n-    if (!reportsContainer) return;\r\n-    reportsContainer.innerHTML = '<p class=\"text-gray-600 italic\">Fetching complex report data...</p>';\r\n-\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.REPORTS_DATA, { headers: getAuthHeaders() });\r\n-        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n-        const data = await res.json();\r\n-        \r\n-        // Example: If data contains a 'monthlyRevenue' array, you'd render a chart here.\r\n-        // For simplicity, we just display a success message:\r\n-        reportsContainer.innerHTML = `<p class=\"text-green-600 font-semibold\">Reports data loaded (e.g., ${data.length || 0} report metrics).</p>`;\r\n-\r\n-    } catch (err) {\r\n-        console.error(\"Error loading reports data:\", err);\r\n-        reportsContainer.innerHTML = '<p class=\"text-red-600 font-semibold\">Failed to load reports data.</p>';\r\n-    }\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🚨 MANUAL OVERRIDES LOGIC (manualoverride.html)\r\n-// ====================================================================\r\n-\r\n-async function loadManualOverrides() {\r\n-    const logTableBody = document.getElementById('overrideLogTableBody');\r\n-    if (!logTableBody) return;\r\n-\r\n-    logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-blue-500 italic\">Loading override logs...</td></tr>';\r\n-    \r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch override logs.\");\r\n-        const logs = await resp.json();\r\n-\r\n-        logTableBody.innerHTML = '';\r\n-        if (logs.length === 0) {\r\n-            logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-gray-500\">No override logs found.</td></tr>';\r\n-        } else {\r\n-            // Populate table rows with logs\r\n-        }\r\n-    } catch (error) {\r\n-        logTableBody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-4 text-red-500 italic\">Error loading logs.</td></tr>';\r\n+        // Execute page-specific loaders\r\n+        if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n+        else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n+        else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n+        // Add other page loaders like payments, residents, visitors, reports, manual overrides...\r\n+    }catch(e){\r\n+        console.error(e);\r\n+        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n     }\r\n }\r\n \r\n-function attachOverrideListeners() {\r\n-    // Attach listener for the 'Perform Manual Override' button\r\n-    document.getElementById(\"performOverrideBtn\")?.addEventListener(\"click\", async () => {\r\n-        if (!confirm(\"Are you sure you want to perform a manual override?\")) return;\r\n-        \r\n-        try {\r\n-            // Implement API call to ENDPOINTS.MANUAL_OVERRIDE_ACTION\r\n-            const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDE_ACTION, { \r\n-                method: 'POST',\r\n-                headers: getAuthHeaders(),\r\n-                body: JSON.stringify({ action: 'open_gate' }) // Example payload\r\n-            });\r\n-            if (!resp.ok) throw new Error(\"Override API failed.\");\r\n-\r\n-            displayMessage(\"Manual override successful!\", false);\r\n-            await loadManualOverrides(); // Reload logs\r\n-\r\n-        } catch (e) {\r\n-            displayMessage(`Manual override failed: ${e.message}`, true);\r\n-        }\r\n-    });\r\n-}\r\n-\r\n-\r\n-// ====================================================================\r\n-// 🧭 SIDEBAR PAGE LOADING (THE FIXED SWITCH)\r\n-// ====================================================================\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n-\r\n-async function loadPageIntoMainContent(url) {\r\n-    // Show a loading state instantly\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n-\r\n-    try {\r\n-        const res = await fetch(url);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html; // Inject HTML first\r\n-\r\n-        // 🟢 Execute data loading functions based on the page loaded \r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart();\r\n-        } \r\n-        \r\n-        // --- MEMBERSHIP PAGES ---\r\n-        else if (url.includes(\"membershiprecords.html\")) {\r\n-            // Approved Residents\r\n-            attachMembershipListeners();\r\n-            await loadApprovedResidents();\r\n-        } else if (url.includes(\"membership.html\")) {\r\n-            // Pending Requests (Used for \"Membership Requests\" sidebar button)\r\n-            attachMembershipListeners();\r\n-            await loadPendingRequests();\r\n-        }\r\n-        \r\n-        // --- PAYMENTS RECORDS ---\r\n-        else if (url.includes(\"payments.html\")) {\r\n-            attachPaymentsListeners();\r\n-            await loadPaymentsRecords();\r\n-        } \r\n-        \r\n-        // --- RESIDENTS ---\r\n-        else if (url.includes(\"residents.html\")) {\r\n-            await loadAllResidents();\r\n-        } \r\n-        \r\n-        // --- VISITORS MANAGEMENT ---\r\n-        else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-            attachVisitorListeners();\r\n-            // Load data relevant to the main visitor pages\r\n-            await loadVisitorPassOverview();\r\n-            await loadPendingVisitorApprovals();\r\n-        }\r\n-        \r\n-        // --- CHARTS AND REPORTS ---\r\n-        else if (url.includes(\"chartsandreports.html\")) {\r\n-            await loadReportsData();\r\n-        } \r\n-        \r\n-        // --- MANUAL OVERRIDES ---\r\n-        else if (url.includes(\"manualoverride.html\")) {\r\n-            attachOverrideListeners();\r\n-            await loadManualOverrides();\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}. Check console for details.</div>`;\r\n-    }\r\n-}\r\n-\r\n-// ... (existing sidebar button loop and visitor toggle logic)\r\n-\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => {\r\n-            b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-            // Also ensure sub-menu items are correctly reset if needed\r\n-            if (b.closest('#visitorSubMenu')) b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\"); // Reset sub-menu item styles\r\n-            if (b.closest('#visitorSubMenu')) b.classList.remove(\"bg-blue-600\");\r\n-            \r\n-            // Re-apply specific default styles for sub-menu items if needed\r\n-            if (b.closest('#visitorSubMenu') && b.classList.contains('text-sm')) {\r\n-                 b.classList.remove(\"bg-gray-700\", \"hover:bg-gray-600\");\r\n-                 b.classList.add(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            }\r\n-        });\r\n-        \r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        btn.classList.remove(\"bg-gray-700\", \"bg-gray-600\", \"hover:bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-\r\n-        const page = btn.dataset.target;\r\n-        if (page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n-\r\n-\r\n-// ================================\r\n-// MISC UI TOGGLES\r\n-// ================================\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n-\r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n-});\r\n-\r\n-// ================================\r\n-// INITIALIZATION ON PAGE LOAD\r\n-// ================================\r\n-\r\n-document.addEventListener('DOMContentLoaded', () => {\r\n-    // Load the initial dashboard view when the admin page first loads\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\r\n-// ================================\r\n-// 🔹 ACCESS LOGS FOR ADMIN DASHBOARD\r\n-// ================================\r\n-\r\n-const logsTableBody = document.getElementById(\"logsTableBody\");\r\n-const filterInputs = document.querySelectorAll(\"#accesslogs .filterInput\");\r\n-const exportCsvBtn = document.getElementById(\"exportCsvBtn\");\r\n-const exportExcelBtn = document.getElementById(\"exportExcelBtn\");\r\n-\r\n-// Function to fetch and populate access logs\r\n-\r\n-// ================================\r\n-// 🔹 FILTER LOGS\r\n-// ================================\r\n-filterInputs.forEach((input, colIndex) => {\r\n-  input.addEventListener(\"input\", () => {\r\n-    const filterValue = input.value.toLowerCase();\r\n-    const rows = logsTableBody.querySelectorAll(\"tr\");\r\n-    rows.forEach(row => {\r\n-      const cell = row.cells[colIndex];\r\n-      if (!cell) return;\r\n-      row.style.display = cell.textContent.toLowerCase().includes(filterValue) ? \"\" : \"none\";\r\n+// Sidebar click handler\r\n+sidebarButtons.forEach(btn=>{\r\n+    btn.addEventListener(\"click\",()=>{\r\n+        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n+        const page=btn.dataset.target;\r\n+        if(page) loadPageIntoMainContent(page);\r\n     });\r\n-  });\r\n });\r\n \r\n // ================================\r\n-// 🔹 EXPORT FUNCTIONS\r\n-// ================================\r\n-function downloadCSV() {\r\n-  const rows = Array.from(logsTableBody.querySelectorAll(\"tr\"))\r\n-    .filter(r => r.style.display !== \"none\")\r\n-    .map(r => Array.from(r.cells).map(cell => `\"${cell.textContent}\"`).join(\",\"))\r\n-    .join(\"\\n\");\r\n-\r\n-  const blob = new Blob([rows], { type: \"text/csv\" });\r\n-  const link = document.createElement(\"a\");\r\n-  link.href = URL.createObjectURL(blob);\r\n-  link.download = `access_logs_${Date.now()}.csv`;\r\n-  link.click();\r\n-}\r\n-\r\n-exportCsvBtn?.addEventListener(\"click\", downloadCSV);\r\n-exportExcelBtn?.addEventListener(\"click\", downloadCSV); // Quick export to CSV; can integrate Excel lib if needed\r\n-\r\n-// ================================\r\n-// 🔹 INITIAL LOAD\r\n-// ================================\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    const accesslogsTableBody = document.getElementById(\"logsTableBody\");\r\n-\r\n-    async function loadaccesslogs() {\r\n-        try {\r\n-            const token = localStorage.getItem(\"accessToken\");\r\n-            const response = await fetch(\"http://localhost:4050/api/security/accesslogs\", {\r\n-                headers: { \"Authorization\": `Bearer ${token}` },\r\n-            });\r\n-            if (!response.ok) throw new Error(\"Failed to fetch Access Logs\");\r\n-            const logs = await response.json();\r\n-            renderaccesslogs(logs);\r\n-        } catch (err) {\r\n-            console.error(\"Error loading access logs:\", err);\r\n-            accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center text-red-500 p-4\">Unable to load Access Logs</td></tr>`;\r\n-        }\r\n-    }\r\n-\r\n-    function renderaccesslogs(logs) {\r\n-        if (!logs || logs.length === 0) {\r\n-            accesslogsTableBody.innerHTML = `<tr><td colspan=\"4\" class=\"text-center p-4\">No logs found</td></tr>`;\r\n-            return;\r\n-        }\r\n-        accesslogsTableBody.innerHTML = logs.map(log => `\r\n-            <tr class=\"border-b\">\r\n-                <td class=\"p-2 border-r\">${new Date(log.timestamp).toLocaleString()}</td>\r\n-                <td class=\"p-2 border-r\">${log.userId}</td>\r\n-                <td class=\"p-2 border-r\">${log.action}</td>\r\n-                <td class=\"p-2\">${log.type}</td>\r\n-            </tr>\r\n-        `).join(\"\");\r\n-    }\r\n-\r\n-    // Sidebar button click\r\n-    const accesslogsBtn = document.querySelector('.sidebarBtn[data-target=\"sections/accesslogs.html\"]');\r\n-    accesslogsBtn?.addEventListener(\"click\", () => {\r\n-        document.querySelectorAll(\"#main-content-area > div\").forEach(div => div.classList.add(\"hidden\"));\r\n-        document.getElementById(\"accesslogs\").classList.remove(\"hidden\");\r\n-        loadaccesslogs();\r\n-    });\r\n+// INITIAL LOAD\r\n+document.addEventListener('DOMContentLoaded',()=>{\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n"
                },
                {
                    "date": 1763887868331,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -245,4 +245,32 @@\n // INITIAL LOAD\r\n document.addEventListener('DOMContentLoaded',()=>{\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n+// ================================\r\n+// ACCESS LOGS FUNCTIONS\r\n+async function loadAccessLogs() {\r\n+    const tbody = document.getElementById('accessLogsTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML = '<tr><td colspan=\"6\">Loading...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error('Failed to fetch access logs');\r\n+        const logs = await resp.json();\r\n+\r\n+        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"6\">No logs found</td></tr>' : '';\r\n+        logs.forEach(log => {\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML = `\r\n+                <td>${log.id || log.LogID}</td>\r\n+                <td>${log.ResidentName || 'N/A'}</td>\r\n+                <td>${log.HouseNumber || 'N/A'}</td>\r\n+                <td>${log.AccessType || 'N/A'}</td>\r\n+                <td>${formatTimestamp(log.Timestamp || log.timestamp)}</td>\r\n+                <td>${log.Status || 'N/A'}</td>\r\n+            `;\r\n+        });\r\n+    } catch(e) {\r\n+        displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1763888129299,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -245,32 +245,33 @@\n // INITIAL LOAD\r\n document.addEventListener('DOMContentLoaded',()=>{\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n-// ================================\r\n-// ACCESS LOGS FUNCTIONS\r\n-async function loadAccessLogs() {\r\n+async function loadaccesslogs() {\r\n     const tbody = document.getElementById('accessLogsTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML = '<tr><td colspan=\"6\">Loading...</td></tr>';\r\n+    if (!tbody) return;\r\n \r\n+    tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n+\r\n     try {\r\n         const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error('Failed to fetch access logs');\r\n+        if (!resp.ok) throw new Error('Failed to fetch access logs');\r\n+\r\n         const logs = await resp.json();\r\n \r\n-        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"6\">No logs found</td></tr>' : '';\r\n+        tbody.innerHTML = logs.length === 0\r\n+            ? '<tr><td colspan=\"4\">No logs found</td></tr>'\r\n+            : '';\r\n+\r\n         logs.forEach(log => {\r\n             const row = tbody.insertRow();\r\n             row.innerHTML = `\r\n-                <td>${log.id || log.LogID}</td>\r\n-                <td>${log.ResidentName || 'N/A'}</td>\r\n-                <td>${log.HouseNumber || 'N/A'}</td>\r\n-                <td>${log.AccessType || 'N/A'}</td>\r\n                 <td>${formatTimestamp(log.Timestamp || log.timestamp)}</td>\r\n-                <td>${log.Status || 'N/A'}</td>\r\n+                <td>${log.UserID || log.userId}</td>\r\n+                <td>${log.Action || log.action}</td>\r\n+                <td>${log.Type || log.type}</td>\r\n             `;\r\n         });\r\n-    } catch(e) {\r\n+    } catch (e) {\r\n         displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n     }\r\n }\r\n"
                },
                {
                    "date": 1763889472677,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -245,10 +245,10 @@\n // INITIAL LOAD\r\n document.addEventListener('DOMContentLoaded',()=>{\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n-async function loadaccesslogs() {\r\n-    const tbody = document.getElementById('accessLogsTableBody');\r\n+async function loadAccessLogs() {\r\n+    const tbody = document.getElementById('logsTableBody'); // must match HTML\r\n     if (!tbody) return;\r\n \r\n     tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n \r\n@@ -264,14 +264,15 @@\n \r\n         logs.forEach(log => {\r\n             const row = tbody.insertRow();\r\n             row.innerHTML = `\r\n-                <td>${formatTimestamp(log.Timestamp || log.timestamp)}</td>\r\n-                <td>${log.UserID || log.userId}</td>\r\n+                <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n+                <td>${log.UserId || log.userId}</td>\r\n                 <td>${log.Action || log.action}</td>\r\n-                <td>${log.Type || log.type}</td>\r\n+                <td>${log.LogType || log.type}</td>\r\n             `;\r\n         });\r\n     } catch (e) {\r\n         displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n     }\r\n }\r\n+\r\n"
                },
                {
                    "date": 1763890334363,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,8 +23,9 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`, \r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n"
                },
                {
                    "date": 1763890838928,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,10 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`, \r\n+    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`; // now it matches\r\n+ \r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n"
                },
                {
                    "date": 1763890877671,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,10 +23,9 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`; // now it matches\r\n- \r\n+    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`, \r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n"
                },
                {
                    "date": 1763890918931,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,10 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`, \r\n+    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`// now it matches\r\n+\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n"
                },
                {
                    "date": 1763891035710,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`// now it matches\r\n+    ACCESS_LOGS: `${API_HOST}/api/accesslogs/admin/accesslogs`,\r\n \r\n };\r\n \r\n // ================================\r\n"
                },
                {
                    "date": 1763891917387,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,10 +23,9 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/accesslogs/admin/accesslogs`,\r\n-\r\n+    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n"
                },
                {
                    "date": 1763892066094,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,10 @@\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"accessToken\");\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n-// Define API Endpoints\r\n+// ================================\r\n+// ENDPOINTS\r\n const ENDPOINTS = {\r\n     DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n     DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n@@ -67,11 +68,12 @@\n async function handleApproveClick(requestId) {\r\n     safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n     try {\r\n         const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Approval failed`);\r\n+        if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n         displayMessage(`Successfully approved ${requestId}`, false);\r\n-        await loadPendingRequests(); await loadApprovedResidents();\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n     } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleRejectClick(requestId) {\r\n@@ -79,9 +81,10 @@\n     try {\r\n         const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n         if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n         displayMessage(`Successfully rejected ${requestId}`, false);\r\n-        await loadPendingRequests(); await loadApprovedResidents();\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n     } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleDeleteClick(requestId) {\r\n@@ -89,24 +92,38 @@\n     try {\r\n         const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n         if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n         displayMessage(`Deleted request ${requestId}`, false);\r\n-        await loadPendingRequests(); await loadApprovedResidents();\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n     } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleSyncClick(event) {\r\n     const btn = event.currentTarget;\r\n     const originalText = btn.textContent, originalClass = btn.className;\r\n-    btn.disabled = true; btn.textContent='Syncing...'; btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n+    btn.disabled = true; \r\n+    btn.textContent='Syncing...'; \r\n+    btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n     try {\r\n         const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n         if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n-        btn.textContent='Sync Complete!'; btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n+        btn.textContent='Sync Complete!'; \r\n+        btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n         displayMessage(\"Data synchronization successful\", false);\r\n-        await loadPendingRequests(); await loadApprovedResidents();\r\n-    } catch(err){ btn.textContent='Sync Failed ❌'; btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; displayMessage(`Sync failed: ${err.message}`,true); }\r\n-    finally{ setTimeout(()=>{ btn.disabled=false; btn.textContent=originalText; btn.className=originalClass; }, 3000); }\r\n+        await loadPendingRequests(); \r\n+        await loadApprovedResidents();\r\n+    } catch(err){\r\n+        btn.textContent='Sync Failed ❌'; \r\n+        btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; \r\n+        displayMessage(`Sync failed: ${err.message}`,true);\r\n+    } finally {\r\n+        setTimeout(()=>{\r\n+            btn.disabled=false; \r\n+            btn.textContent=originalText; \r\n+            btn.className=originalClass; \r\n+        }, 3000);\r\n+    }\r\n }\r\n \r\n async function loadPendingRequests() {\r\n     const tbody = document.getElementById('membershipTableBody');\r\n@@ -220,13 +237,13 @@\n         if(!res.ok) throw new Error(res.status);\r\n         const html=await res.text();\r\n         mainContent.innerHTML=html;\r\n \r\n-        // Execute page-specific loaders\r\n+        // Page-specific loaders\r\n         if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n         else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n         else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n-        // Add other page loaders like payments, residents, visitors, reports, manual overrides...\r\n+        else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n     }catch(e){\r\n         console.error(e);\r\n         mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n     }\r\n@@ -242,28 +259,18 @@\n     });\r\n });\r\n \r\n // ================================\r\n-// INITIAL LOAD\r\n-document.addEventListener('DOMContentLoaded',()=>{\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-});\r\n+// ACCESS LOGS\r\n async function loadAccessLogs() {\r\n-    const tbody = document.getElementById('logsTableBody'); // must match HTML\r\n+    const tbody = document.getElementById('logsTableBody');\r\n     if (!tbody) return;\r\n-\r\n     tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n-\r\n     try {\r\n         const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n         if (!resp.ok) throw new Error('Failed to fetch access logs');\r\n-\r\n         const logs = await resp.json();\r\n-\r\n-        tbody.innerHTML = logs.length === 0\r\n-            ? '<tr><td colspan=\"4\">No logs found</td></tr>'\r\n-            : '';\r\n-\r\n+        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : '';\r\n         logs.forEach(log => {\r\n             const row = tbody.insertRow();\r\n             row.innerHTML = `\r\n                 <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n@@ -276,4 +283,9 @@\n         displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n     }\r\n }\r\n \r\n+// ================================\r\n+// INITIAL LOAD\r\n+document.addEventListener('DOMContentLoaded',()=>{\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+});\r\n"
                },
                {
                    "date": 1763892393304,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,10 +9,10 @@\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/admin/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/admin/accesschart`,\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n     PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n@@ -24,11 +24,12 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`,\r\n+    ACCESS_LOGS: `${API_HOST}/api/accesslogs`, // Corrected from /api/admin/accesslogs\r\n };\r\n \r\n+\r\n // ================================\r\n // AUTH & LOGOUT\r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n"
                },
                {
                    "date": 1763908049982,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,10 +9,10 @@\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/admin/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/admin/accesschart`,\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n     PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n@@ -24,12 +24,11 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/accesslogs`, // Corrected from /api/admin/accesslogs\r\n+    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`,\r\n };\r\n \r\n-\r\n // ================================\r\n // AUTH & LOGOUT\r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n"
                },
                {
                    "date": 1763908084829,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,10 +9,10 @@\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/admin/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/admin/accesschart`,\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n     PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n@@ -24,11 +24,12 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`,\r\n+    ACCESS_LOGS: `${API_HOST}/api/accesslogs`, // Corrected from /api/admin/accesslogs\r\n };\r\n \r\n+\r\n // ================================\r\n // AUTH & LOGOUT\r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n"
                },
                {
                    "date": 1763909145704,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,18 +1,19 @@\n // =========================================================\r\n-// adminsdashboard.js - Unified Admin Dashboard Loader\r\n+// unifiedDashboard.js - Admin & Security Dashboard Loader\r\n // =========================================================\r\n \r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"accessToken\");\r\n+const userRole = localStorage.getItem(\"userRole\"); // \"admin\" or \"security\"\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/admin/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/admin/accesschart`,\r\n+    DASHBOARD_SUMMARY: userRole === \"admin\" ? `${API_HOST}/api/admin/summary` : `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: userRole === \"admin\" ? `${API_HOST}/api/admin/accesschart` : `${API_HOST}/api/residents/admin/accesschart`,\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n     PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n@@ -24,16 +25,16 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/accesslogs`, // Corrected from /api/admin/accesslogs\r\n+    ACCESS_LOGS: userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n };\r\n \r\n-\r\n // ================================\r\n // AUTH & LOGOUT\r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n+    localStorage.removeItem(\"userRole\");\r\n     window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n@@ -125,8 +126,10 @@\n         }, 3000);\r\n     }\r\n }\r\n \r\n+// ================================\r\n+// LOAD DATA FUNCTIONS\r\n async function loadPendingRequests() {\r\n     const tbody = document.getElementById('membershipTableBody');\r\n     if(!tbody) return;\r\n     tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n@@ -184,17 +187,8 @@\n         });\r\n     } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n }\r\n \r\n-function attachMembershipListeners(){\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n-        document.getElementById('requestIdFilter').value=''; \r\n-        document.getElementById('residentFilter').value='';\r\n-        displayMessage(\"Filters cleared.\", false);\r\n-    });\r\n-}\r\n-\r\n // ================================\r\n // DASHBOARD FUNCTIONS\r\n async function loadDashboardSummary(){\r\n     try{\r\n@@ -286,7 +280,16 @@\n }\r\n \r\n // ================================\r\n // INITIAL LOAD\r\n-document.addEventListener('DOMContentLoaded',()=>{\r\n+document.addEventListener('DOMContentLoaded',()=> {\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n+\r\n+function attachMembershipListeners(){\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n+        document.getElementById('requestIdFilter').value=''; \r\n+        document.getElementById('residentFilter').value='';\r\n+        displayMessage(\"Filters cleared.\", false);\r\n+    });\r\n+}\r\n"
                },
                {
                    "date": 1763951891497,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -292,4 +292,7 @@\n         document.getElementById('residentFilter').value='';\r\n         displayMessage(\"Filters cleared.\", false);\r\n     });\r\n }\r\n+case \"gate-overrides\":\r\n+    loadPage(\"gate_overrides.html\");\r\n+    break;\r\n"
                },
                {
                    "date": 1763952104936,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,8 +237,9 @@\n         if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n         else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n         else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n         else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n+        else if(url.includes(\"gate_overrides.html\")) { await loadGateOverrideLogs(); } // <-- NEW\r\n     }catch(e){\r\n         console.error(e);\r\n         mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n     }\r\n@@ -249,9 +250,30 @@\n     btn.addEventListener(\"click\",()=>{\r\n         sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n         btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n         const page=btn.dataset.target;\r\n-        if(page) loadPageIntoMainContent(page);\r\n+\r\n+        // ================================\r\n+        // DYNAMIC PAGE SWITCH\r\n+        switch(page){\r\n+            case \"dashboardoverview\":\r\n+                loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+                break;\r\n+            case \"membership\":\r\n+                loadPageIntoMainContent('sections/membership.html');\r\n+                break;\r\n+            case \"membershiprecords\":\r\n+                loadPageIntoMainContent('sections/membershiprecords.html');\r\n+                break;\r\n+            case \"accesslogs\":\r\n+                loadPageIntoMainContent('sections/accesslogs.html');\r\n+                break;\r\n+            case \"gate-overrides\":        // <-- NEW\r\n+                loadPageIntoMainContent('sections/gate_overrides.html');\r\n+                break;\r\n+            default:\r\n+                loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+        }\r\n     });\r\n });\r\n \r\n // ================================\r\n@@ -279,20 +301,46 @@\n     }\r\n }\r\n \r\n // ================================\r\n+// GATE OVERRIDE LOGS\r\n+async function loadGateOverrideLogs() {\r\n+    const tbody = document.getElementById('gateOverridesTableBody');\r\n+    if (!tbody) return;\r\n+    tbody.innerHTML = '<tr><td colspan=\"6\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error('Failed to fetch gate override logs');\r\n+        const logs = await resp.json();\r\n+        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"6\">No gate override logs</td></tr>' : '';\r\n+        logs.forEach(log => {\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML = `\r\n+                <td>${log.id}</td>\r\n+                <td>${log.gateId}</td>\r\n+                <td>${log.action}</td>\r\n+                <td>${log.reason}</td>\r\n+                <td>${log.userId}</td>\r\n+                <td>${formatTimestamp(log.createdAt)}</td>\r\n+            `;\r\n+        });\r\n+    } catch(e){\r\n+        displayMessage(`Failed to load gate override logs: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+// ================================\r\n // INITIAL LOAD\r\n document.addEventListener('DOMContentLoaded',()=> {\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n \r\n+// ================================\r\n+// MEMBERSHIP LISTENERS\r\n function attachMembershipListeners(){\r\n     document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n     document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n         document.getElementById('requestIdFilter').value=''; \r\n         document.getElementById('residentFilter').value='';\r\n         displayMessage(\"Filters cleared.\", false);\r\n     });\r\n }\r\n-case \"gate-overrides\":\r\n-    loadPage(\"gate_overrides.html\");\r\n-    break;\r\n"
                },
                {
                    "date": 1763953504553,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,346 +1,99 @@\n-// =========================================================\r\n-// unifiedDashboard.js - Admin & Security Dashboard Loader\r\n-// =========================================================\r\n-\r\n-// 🔑 ENVIRONMENT & AUTH SETUP\r\n-const API_HOST = \"http://localhost:4050\";\r\n-const token = localStorage.getItem(\"accessToken\");\r\n-const userRole = localStorage.getItem(\"userRole\"); // \"admin\" or \"security\"\r\n-if (!token) window.location.href = \"/login.html\";\r\n-\r\n // ================================\r\n-// ENDPOINTS\r\n-const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: userRole === \"admin\" ? `${API_HOST}/api/admin/summary` : `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: userRole === \"admin\" ? `${API_HOST}/api/admin/accesschart` : `${API_HOST}/api/residents/admin/accesschart`,\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n-};\r\n-\r\n+// 🧭 SIDEBAR NAVIGATION (REWRITTEN)\r\n // ================================\r\n-// AUTH & LOGOUT\r\n-document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    localStorage.removeItem(\"userRole\");\r\n-    window.location.href = \"/login.html\";\r\n-});\r\n \r\n-// ================================\r\n-// UTILITIES\r\n-function getAuthHeaders() {\r\n-    return { \"Content-Type\": \"application/json\", \"Authorization\": `Bearer ${token}` };\r\n-}\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n-function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById(\"msg\");\r\n-    if (!msgElement) return;\r\n-    msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-    setTimeout(() => {\r\n-        msgElement.textContent = '';\r\n-        msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-    }, 5000);\r\n-}\r\n+// Visitor submenu toggle\r\n+const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n+const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n+const visitorArrow = document.getElementById(\"visitorArrow\");\r\n \r\n-function formatTimestamp(timestamp) {\r\n-    if (!timestamp) return 'N/A';\r\n-    try { return new Date(timestamp).toLocaleString(); } \r\n-    catch (e) { return 'N/A'; }\r\n-}\r\n+visitorToggle?.addEventListener(\"click\", () => {\r\n+    visitorSubMenu?.classList.toggle(\"hidden\");\r\n+    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+});\r\n \r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const el = document.getElementById(id);\r\n-    if (el) el.textContent = value + suffix;\r\n-};\r\n+// Function to activate a button\r\n+function activateButton(btn) {\r\n+    // Reset all sidebar buttons\r\n+    sidebarButtons.forEach(b => {\r\n+        b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n+        // Optional: reset visitor sub-menu styling if needed\r\n+        if (b.closest('#visitorSubMenu')) {\r\n+            b.classList.remove(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n+            b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\");\r\n+        }\r\n+    });\r\n \r\n-// ================================\r\n-// MEMBERSHIP FUNCTIONS\r\n-async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n-        displayMessage(`Successfully approved ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n+    // Highlight clicked button\r\n+    btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n }\r\n \r\n-async function handleRejectClick(requestId) {\r\n-    if (!confirm(`Reject request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n-        displayMessage(`Successfully rejected ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n-}\r\n+// Function to load page\r\n+async function loadPage(url) {\r\n+    if (!mainContentArea) return;\r\n \r\n-async function handleDeleteClick(requestId) {\r\n-    if (!confirm(`Delete request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n-        displayMessage(`Deleted request ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n-}\r\n+    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n \r\n-async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent, originalClass = btn.className;\r\n-    btn.disabled = true; \r\n-    btn.textContent='Syncing...'; \r\n-    btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n-        btn.textContent='Sync Complete!'; \r\n-        btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n-        displayMessage(\"Data synchronization successful\", false);\r\n-        await loadPendingRequests(); \r\n-        await loadApprovedResidents();\r\n-    } catch(err){\r\n-        btn.textContent='Sync Failed ❌'; \r\n-        btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; \r\n-        displayMessage(`Sync failed: ${err.message}`,true);\r\n-    } finally {\r\n-        setTimeout(()=>{\r\n-            btn.disabled=false; \r\n-            btn.textContent=originalText; \r\n-            btn.className=originalClass; \r\n-        }, 3000);\r\n-    }\r\n-}\r\n+        const res = await fetch(url);\r\n+        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n+        const html = await res.text();\r\n+        mainContentArea.innerHTML = html;\r\n \r\n-// ================================\r\n-// LOAD DATA FUNCTIONS\r\n-async function loadPendingRequests() {\r\n-    const tbody = document.getElementById('membershipTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error('Failed to fetch pending requests');\r\n-        const requests = await resp.json();\r\n-        tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : '';\r\n-        requests.forEach(r=>{\r\n-            const row = tbody.insertRow();\r\n-            row.innerHTML=`\r\n-                <td>${r.RequestID||r.id}</td>\r\n-                <td>${r.ResidentName||'N/A'}</td>\r\n-                <td>${r.NationalID||'N/A'}</td>\r\n-                <td>${r.PhoneNumber||'N/A'}</td>\r\n-                <td>${r.Email||'N/A'}</td>\r\n-                <td>${r.HouseNumber||'N/A'}</td>\r\n-                <td>${r.CourtName||'N/A'}</td>\r\n-                <td>${r.RoleName||'N/A'}</td>\r\n-                <td>${r.Status||'Pending'}</td>\r\n-                <td>${formatTimestamp(r.RequestedAt||r.requestedAt)}</td>\r\n-                <td class=\"flex space-x-1\">\r\n-                    <button class=\"approve-btn\" data-id=\"${r.RequestID||r.id}\">Approve</button>\r\n-                    <button class=\"reject-btn\" data-id=\"${r.RequestID||r.id}\">Reject</button>\r\n-                    <button class=\"delete-btn\" data-id=\"${r.RequestID||r.id}\">Delete</button>\r\n-                </td>\r\n-            `;\r\n-        });\r\n-        tbody.querySelectorAll('.approve-btn').forEach(b=>b.addEventListener('click', e=>handleApproveClick(e.target.dataset.id)));\r\n-        tbody.querySelectorAll('.reject-btn').forEach(b=>b.addEventListener('click', e=>handleRejectClick(e.target.dataset.id)));\r\n-        tbody.querySelectorAll('.delete-btn').forEach(b=>b.addEventListener('click', e=>handleDeleteClick(e.target.dataset.id)));\r\n-    } catch(e){ displayMessage(`Failed to load pending requests: ${e.message}`, true); }\r\n-}\r\n+        // Call page-specific functions\r\n+        if (url.includes(\"dashboardoverview.html\")) {\r\n+            await loadDashboardSummary();\r\n+            await loadAccessChart();\r\n+        } else if (url.includes(\"membership.html\")) {\r\n+            attachMembershipListeners();\r\n+            await loadPendingRequests();\r\n+        } else if (url.includes(\"membershiprecords.html\")) {\r\n+            attachMembershipListeners();\r\n+            await loadApprovedResidents();\r\n+        } else if (url.includes(\"payments.html\")) {\r\n+            attachPaymentsListeners();\r\n+            await loadPaymentsRecords();\r\n+        } else if (url.includes(\"residents.html\")) {\r\n+            await loadAllResidents();\r\n+        } else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n+            attachVisitorListeners();\r\n+            await loadVisitorPassOverview();\r\n+            await loadPendingVisitorApprovals();\r\n+        } else if (url.includes(\"chartsandreports.html\")) {\r\n+            await loadReportsData();\r\n+        } else if (url.includes(\"manualoverride.html\")) {\r\n+            attachOverrideListeners();\r\n+            await loadManualOverrides();\r\n+        }\r\n \r\n-async function loadApprovedResidents() {\r\n-    const tbody = document.getElementById('residentsTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML='<tr><td colspan=\"8\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS,{headers:getAuthHeaders()});\r\n-        if(!resp.ok) throw new Error('Failed to fetch approved residents');\r\n-        const residents = await resp.json();\r\n-        tbody.innerHTML = residents.length===0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : '';\r\n-        residents.forEach(r=>{\r\n-            const row=tbody.insertRow();\r\n-            row.innerHTML=`\r\n-                <td>${r.ResidentName||'N/A'}</td>\r\n-                <td>${r.NationalID||'N/A'}</td>\r\n-                <td>${r.PhoneNumber||'N/A'}</td>\r\n-                <td>${r.Email||'N/A'}</td>\r\n-                <td>${r.HouseNumber||'N/A'}</td>\r\n-                <td>${r.CourtName||'N/A'}</td>\r\n-                <td>${r.RoleName||'N/A'}</td>\r\n-            `;\r\n-        });\r\n-    } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n-}\r\n-\r\n-// ================================\r\n-// DASHBOARD FUNCTIONS\r\n-async function loadDashboardSummary(){\r\n-    try{\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY,{headers:getAuthHeaders()});\r\n-        if(!res.ok) throw new Error(res.statusText);\r\n-        const d=await res.json();\r\n-        safeUpdate(\"totalResidents\",d.residents||0);\r\n-        safeUpdate(\"pendingPayments\",d.pendingPayments||0);\r\n-        safeUpdate(\"compliancePct\",d.compliance||0,'%');\r\n-        safeUpdate(\"overrideCount\",d.overrides||0);\r\n-    }catch(e){ console.error(e); }\r\n-}\r\n-\r\n-async function loadAccessChart(){\r\n-    try{\r\n-        const res=await fetch(ENDPOINTS.DASHBOARD_CHART,{headers:getAuthHeaders()});\r\n-        if(!res.ok) throw new Error(res.statusText);\r\n-        const data=await res.json();\r\n-        const el=document.getElementById(\"accessChart\");\r\n-        if(!el) return;\r\n-        const ctx=el.getContext(\"2d\");\r\n-        if(window.accessChartInstance) window.accessChartInstance.destroy();\r\n-        window.accessChartInstance = new Chart(ctx,{\r\n-            type:'line',\r\n-            data:{labels:data.days||[], datasets:[{label:'Access Attempts', data:data.counts||[], borderColor:'#2563eb', backgroundColor:'rgba(37,99,235,0.2)', fill:true}]},\r\n-            options:{responsive:true, maintainAspectRatio:false}\r\n-        });\r\n-    }catch(e){ console.error(e); }\r\n-}\r\n-\r\n-// ================================\r\n-// SIDEBAR & PAGE LOADING\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContent = document.getElementById(\"main-content-area\");\r\n-\r\n-async function loadPageIntoMainContent(url){\r\n-    if(!mainContent) return;\r\n-    mainContent.innerHTML='<div>Loading...</div>';\r\n-    try{\r\n-        const res = await fetch(url);\r\n-        if(!res.ok) throw new Error(res.status);\r\n-        const html=await res.text();\r\n-        mainContent.innerHTML=html;\r\n-\r\n-        // Page-specific loaders\r\n-        if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n-        else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n-        else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n-        else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n-        else if(url.includes(\"gate_overrides.html\")) { await loadGateOverrideLogs(); } // <-- NEW\r\n-    }catch(e){\r\n-        console.error(e);\r\n-        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n+    } catch (err) {\r\n+        console.error(\"Error loading page:\", err);\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load page. Check console for details.</div>`;\r\n     }\r\n }\r\n \r\n-// Sidebar click handler\r\n-sidebarButtons.forEach(btn=>{\r\n-    btn.addEventListener(\"click\",()=>{\r\n-        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n-        const page=btn.dataset.target;\r\n+// Attach click events to sidebar buttons\r\n+sidebarButtons.forEach(btn => {\r\n+    btn.addEventListener(\"click\", async () => {\r\n+        activateButton(btn);\r\n \r\n-        // ================================\r\n-        // DYNAMIC PAGE SWITCH\r\n-        switch(page){\r\n-            case \"dashboardoverview\":\r\n-                loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-                break;\r\n-            case \"membership\":\r\n-                loadPageIntoMainContent('sections/membership.html');\r\n-                break;\r\n-            case \"membershiprecords\":\r\n-                loadPageIntoMainContent('sections/membershiprecords.html');\r\n-                break;\r\n-            case \"accesslogs\":\r\n-                loadPageIntoMainContent('sections/accesslogs.html');\r\n-                break;\r\n-            case \"gate-overrides\":        // <-- NEW\r\n-                loadPageIntoMainContent('sections/gate_overrides.html');\r\n-                break;\r\n-            default:\r\n-                loadPageIntoMainContent('sections/dashboardoverview.html');\r\n-        }\r\n+        // Load page (prepend 'sections/' if needed)\r\n+        const page = btn.dataset.target;\r\n+        if (page) await loadPage(`sections/${page}`);\r\n     });\r\n });\r\n \r\n // ================================\r\n-// ACCESS LOGS\r\n-async function loadAccessLogs() {\r\n-    const tbody = document.getElementById('logsTableBody');\r\n-    if (!tbody) return;\r\n-    tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error('Failed to fetch access logs');\r\n-        const logs = await resp.json();\r\n-        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : '';\r\n-        logs.forEach(log => {\r\n-            const row = tbody.insertRow();\r\n-            row.innerHTML = `\r\n-                <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n-                <td>${log.UserId || log.userId}</td>\r\n-                <td>${log.Action || log.action}</td>\r\n-                <td>${log.LogType || log.type}</td>\r\n-            `;\r\n-        });\r\n-    } catch (e) {\r\n-        displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n-    }\r\n-}\r\n-\r\n+// INITIAL LOAD\r\n // ================================\r\n-// GATE OVERRIDE LOGS\r\n-async function loadGateOverrideLogs() {\r\n-    const tbody = document.getElementById('gateOverridesTableBody');\r\n-    if (!tbody) return;\r\n-    tbody.innerHTML = '<tr><td colspan=\"6\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.MANUAL_OVERRIDES_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error('Failed to fetch gate override logs');\r\n-        const logs = await resp.json();\r\n-        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"6\">No gate override logs</td></tr>' : '';\r\n-        logs.forEach(log => {\r\n-            const row = tbody.insertRow();\r\n-            row.innerHTML = `\r\n-                <td>${log.id}</td>\r\n-                <td>${log.gateId}</td>\r\n-                <td>${log.action}</td>\r\n-                <td>${log.reason}</td>\r\n-                <td>${log.userId}</td>\r\n-                <td>${formatTimestamp(log.createdAt)}</td>\r\n-            `;\r\n-        });\r\n-    } catch(e){\r\n-        displayMessage(`Failed to load gate override logs: ${e.message}`, true);\r\n-    }\r\n-}\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    // Load default dashboard page\r\n+    const defaultPage = 'sections/dashboardoverview.html';\r\n+    const defaultBtn = document.querySelector(`.sidebarBtn[data-target=\"dashboardoverview.html\"]`);\r\n+    if (defaultBtn) activateButton(defaultBtn);\r\n \r\n-// ================================\r\n-// INITIAL LOAD\r\n-document.addEventListener('DOMContentLoaded',()=> {\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+    loadPage(defaultPage);\r\n });\r\n-\r\n-// ================================\r\n-// MEMBERSHIP LISTENERS\r\n-function attachMembershipListeners(){\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n-        document.getElementById('requestIdFilter').value=''; \r\n-        document.getElementById('residentFilter').value='';\r\n-        displayMessage(\"Filters cleared.\", false);\r\n-    });\r\n-}\r\n"
                },
                {
                    "date": 1763953648695,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,99 +1,304 @@\n+// adminsdashboard.js\r\n+// Full admin dashboard JS with working sidebar and page loaders\r\n+\r\n // ================================\r\n-// 🧭 SIDEBAR NAVIGATION (REWRITTEN)\r\n+// 🔑 ENVIRONMENT & AUTH SETUP\r\n // ================================\r\n+const API_HOST = \"http://localhost:4050\";\r\n+const token = localStorage.getItem(\"accessToken\");\r\n+if (!token) window.location.href = \"/login.html\";\r\n \r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n+// ================================\r\n+// API ENDPOINTS\r\n+// ================================\r\n+const ENDPOINTS = {\r\n+    // Dashboard\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n \r\n-// Visitor submenu toggle\r\n-const visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\n-const visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\n-const visitorArrow = document.getElementById(\"visitorArrow\");\r\n+    // Membership\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n \r\n-visitorToggle?.addEventListener(\"click\", () => {\r\n-    visitorSubMenu?.classList.toggle(\"hidden\");\r\n-    visitorArrow?.classList.toggle(\"rotate-90\");\r\n+    // General Admin\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+};\r\n+\r\n+// ================================\r\n+// AUTH & LOGOUT\r\n+// ================================\r\n+document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    window.location.href = \"/login.html\";\r\n });\r\n \r\n-// Function to activate a button\r\n-function activateButton(btn) {\r\n-    // Reset all sidebar buttons\r\n-    sidebarButtons.forEach(b => {\r\n-        b.classList.remove(\"bg-blue-600\", \"text-white\");\r\n-        // Optional: reset visitor sub-menu styling if needed\r\n-        if (b.closest('#visitorSubMenu')) {\r\n-            b.classList.remove(\"bg-gray-600\", \"hover:bg-blue-500/50\");\r\n-            b.classList.add(\"bg-gray-700\", \"hover:bg-gray-600\", \"text-white\");\r\n+// ================================\r\n+// UTILITIES\r\n+// ================================\r\n+function getAuthHeaders() {\r\n+    return {\r\n+        'Content-Type': 'application/json',\r\n+        'Authorization': `Bearer ${token}`\r\n+    };\r\n+}\r\n+\r\n+function displayMessage(message, isError = false) {\r\n+    const msgElement = document.getElementById('msg');\r\n+    if (msgElement) {\r\n+        msgElement.textContent = message;\r\n+        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n+            isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'\r\n+        }`;\r\n+        setTimeout(() => {\r\n+            msgElement.textContent = '';\r\n+            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+        }, 5000);\r\n+    }\r\n+}\r\n+\r\n+function formatTimestamp(timestamp) {\r\n+    if (!timestamp) return 'N/A';\r\n+    return new Date(timestamp).toLocaleString();\r\n+}\r\n+\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+    const element = document.getElementById(id);\r\n+    if (element) element.textContent = value + suffix;\r\n+};\r\n+\r\n+// ================================\r\n+// 🟢 MEMBERSHIP LOGIC\r\n+// ================================\r\n+async function handleApproveClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+        if (!resp.ok) throw new Error((await resp.json()).message || `Approval failed: ${resp.status}`);\r\n+        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n+        displayMessage(`Successfully approved membership request ${requestId}.`);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (e) {\r\n+        console.error(\"Approval Failed:\", e);\r\n+        displayMessage(`Approval failed: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+async function handleRejectClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+            method: 'PUT',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+        if (!resp.ok) throw new Error((await resp.json()).message || `Rejection failed: ${resp.status}`);\r\n+        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n+        displayMessage(`Successfully rejected membership request ${requestId}.`);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (e) {\r\n+        console.error(\"Rejection Failed:\", e);\r\n+        displayMessage(`Rejection failed: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+async function handleDeleteClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n+    if (!confirm(`Are you sure you want to DELETE request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+            method: 'DELETE',\r\n+            headers: getAuthHeaders(),\r\n+        });\r\n+        if (!resp.ok) throw new Error((await resp.json()).message || `Deletion failed: ${resp.status}`);\r\n+        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n+        displayMessage(`Successfully deleted membership request ${requestId}.`);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (e) {\r\n+        console.error(\"Deletion Failed:\", e);\r\n+        displayMessage(`Deletion failed: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n+async function handleSyncClick(event) {\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent;\r\n+    const originalClasses = btn.className;\r\n+\r\n+    btn.disabled = true;\r\n+    btn.textContent = 'Syncing...';\r\n+    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md animate-pulse';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error((await resp.json()).message || `Sync failed: ${resp.status}`);\r\n+        btn.textContent = 'Sync Complete! ✔️';\r\n+        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md';\r\n+        displayMessage(\"Data synchronization successful!\");\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch (err) {\r\n+        console.error(\"Sync Failed:\", err);\r\n+        btn.textContent = 'Sync Failed ❌';\r\n+        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md';\r\n+        displayMessage(`Sync failed: ${err.message}`, true);\r\n+    } finally {\r\n+        setTimeout(() => {\r\n+            btn.disabled = false;\r\n+            btn.textContent = originalText;\r\n+            btn.className = originalClasses;\r\n+        }, 3000);\r\n+    }\r\n+}\r\n+\r\n+async function loadPendingRequests() {\r\n+    const tableBody = document.getElementById('membershipTableBody');\r\n+    const countElement = document.getElementById('membershipCount');\r\n+    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n+    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading...</td></tr>';\r\n+\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        const requests = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        countElement.textContent = requests.length;\r\n+\r\n+        if (requests.length === 0) {\r\n+            noRequestsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noRequestsMsg.classList.add('hidden');\r\n+            requests.forEach(request => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n+                const requestId = request.id || request.RequestID;\r\n+                row.innerHTML = `\r\n+<td>${requestId}</td>\r\n+<td>${request.ResidentName || 'N/A'}</td>\r\n+<td>${request.NationalID || 'N/A'}</td>\r\n+<td>${request.PhoneNumber || 'N/A'}</td>\r\n+<td>${request.Email || 'N/A'}</td>\r\n+<td>${request.HouseNumber || 'N/A'}</td>\r\n+<td>${request.CourtName || 'N/A'}</td>\r\n+<td>${request.RoleName || 'N/A'}</td>\r\n+<td><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n+<td>${requestedAtString}</td>\r\n+<td class=\"flex space-x-2\">\r\n+<button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Approve</button>\r\n+<button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Reject</button>\r\n+<button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Delete</button>\r\n+</td>`;\r\n+            });\r\n+            tableBody.querySelectorAll('.approve-btn').forEach(btn => btn.addEventListener('click', e => handleApproveClick(e.target.dataset.requestId)));\r\n+            tableBody.querySelectorAll('.reject-btn').forEach(btn => btn.addEventListener('click', e => handleRejectClick(e.target.dataset.requestId)));\r\n+            tableBody.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', e => handleDeleteClick(e.target.dataset.requestId)));\r\n         }\r\n-    });\r\n+    } catch (err) {\r\n+        console.error(\"Error loading pending requests:\", err);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Failed to load pending requests.</td></tr>';\r\n+        displayMessage(\"Failed to load pending requests from API.\", true);\r\n+    }\r\n+}\r\n \r\n-    // Highlight clicked button\r\n-    btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+async function loadApprovedResidents() {\r\n+    const tableBody = document.getElementById('residentsTableBody');\r\n+    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n+    if (!tableBody || !noResidentsMsg) return;\r\n+\r\n+    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        const residents = await resp.json();\r\n+\r\n+        tableBody.innerHTML = '';\r\n+        if (residents.length === 0) {\r\n+            noResidentsMsg.classList.remove('hidden');\r\n+        } else {\r\n+            noResidentsMsg.classList.add('hidden');\r\n+            residents.forEach(resident => {\r\n+                const row = tableBody.insertRow();\r\n+                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n+                row.innerHTML = `\r\n+<td>${resident.ResidentName || 'N/A'}</td>\r\n+<td>${resident.NationalID || 'N/A'}</td>\r\n+<td>${resident.PhoneNumber || 'N/A'}</td>\r\n+<td>${resident.Email || 'N/A'}</td>\r\n+<td>${resident.HouseNumber || 'N/A'}</td>\r\n+<td>${resident.CourtName || 'N/A'}</td>\r\n+<td>${resident.RoleName || 'N/A'}</td>`;\r\n+            });\r\n+        }\r\n+    } catch (err) {\r\n+        console.error(\"Error loading approved residents:\", err);\r\n+        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Failed to load approved residents.</td></tr>';\r\n+        displayMessage(\"Failed to load approved residents.\", true);\r\n+    }\r\n }\r\n \r\n-// Function to load page\r\n-async function loadPage(url) {\r\n-    if (!mainContentArea) return;\r\n+// ================================\r\n+// 🧭 SIDEBAR & PAGE LOADING\r\n+// ================================\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContentArea = document.getElementById(\"main-content-area\");\r\n \r\n+async function loadPageIntoMainContent(page) {\r\n     mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n-\r\n     try {\r\n-        const res = await fetch(url);\r\n+        const res = await fetch(`./sections/${page}`);\r\n         if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n         const html = await res.text();\r\n         mainContentArea.innerHTML = html;\r\n \r\n-        // Call page-specific functions\r\n-        if (url.includes(\"dashboardoverview.html\")) {\r\n+        // Call loaders\r\n+        if (page === \"dashboardoverview.html\") {\r\n             await loadDashboardSummary();\r\n             await loadAccessChart();\r\n-        } else if (url.includes(\"membership.html\")) {\r\n+        } else if (page === \"membership.html\") {\r\n             attachMembershipListeners();\r\n             await loadPendingRequests();\r\n-        } else if (url.includes(\"membershiprecords.html\")) {\r\n+        } else if (page === \"membershiprecords.html\") {\r\n             attachMembershipListeners();\r\n             await loadApprovedResidents();\r\n-        } else if (url.includes(\"payments.html\")) {\r\n-            attachPaymentsListeners();\r\n-            await loadPaymentsRecords();\r\n-        } else if (url.includes(\"residents.html\")) {\r\n-            await loadAllResidents();\r\n-        } else if (url.includes(\"visitorsaccess.html\") || url.includes(\"visitorpass.html\")) {\r\n-            attachVisitorListeners();\r\n-            await loadVisitorPassOverview();\r\n-            await loadPendingVisitorApprovals();\r\n-        } else if (url.includes(\"chartsandreports.html\")) {\r\n-            await loadReportsData();\r\n-        } else if (url.includes(\"manualoverride.html\")) {\r\n-            attachOverrideListeners();\r\n-            await loadManualOverrides();\r\n         }\r\n-\r\n     } catch (err) {\r\n         console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load page. Check console for details.</div>`;\r\n+        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${page}. Check console for details.</div>`;\r\n     }\r\n }\r\n \r\n-// Attach click events to sidebar buttons\r\n+// Sidebar button click\r\n sidebarButtons.forEach(btn => {\r\n     btn.addEventListener(\"click\", async () => {\r\n-        activateButton(btn);\r\n-\r\n-        // Load page (prepend 'sections/' if needed)\r\n+        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n         const page = btn.dataset.target;\r\n-        if (page) await loadPage(`sections/${page}`);\r\n+        if (page) await loadPageIntoMainContent(page);\r\n     });\r\n });\r\n \r\n // ================================\r\n-// INITIAL LOAD\r\n+// INITIALIZATION\r\n // ================================\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    // Load default dashboard page\r\n-    const defaultPage = 'sections/dashboardoverview.html';\r\n-    const defaultBtn = document.querySelector(`.sidebarBtn[data-target=\"dashboardoverview.html\"]`);\r\n-    if (defaultBtn) activateButton(defaultBtn);\r\n-\r\n-    loadPage(defaultPage);\r\n+document.addEventListener('DOMContentLoaded', () => {\r\n+    loadPageIntoMainContent('dashboardoverview.html');\r\n });\r\n"
                },
                {
                    "date": 1763953686186,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,304 +1,292 @@\n-// adminsdashboard.js\r\n-// Full admin dashboard JS with working sidebar and page loaders\r\n+// =========================================================\r\n+// adminsdashboard.js - Unified Admin Dashboard Loader\r\n+// =========================================================\r\n \r\n-// ================================\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n-// ================================\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"accessToken\");\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // ================================\r\n-// API ENDPOINTS\r\n-// ================================\r\n+// ENDPOINTS\r\n const ENDPOINTS = {\r\n-    // Dashboard\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n-\r\n-    // Membership\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/admin/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/admin/accesschart`,\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n     PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n     REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n     DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-\r\n-    // General Admin\r\n     PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n     ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n     VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    ACCESS_LOGS: `${API_HOST}/api/accesslogs`, // Corrected from /api/admin/accesslogs\r\n };\r\n \r\n+\r\n // ================================\r\n // AUTH & LOGOUT\r\n-// ================================\r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n     window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n // UTILITIES\r\n-// ================================\r\n function getAuthHeaders() {\r\n-    return {\r\n-        'Content-Type': 'application/json',\r\n-        'Authorization': `Bearer ${token}`\r\n-    };\r\n+    return { \"Content-Type\": \"application/json\", \"Authorization\": `Bearer ${token}` };\r\n }\r\n \r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById('msg');\r\n-    if (msgElement) {\r\n-        msgElement.textContent = message;\r\n-        msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n-            isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'\r\n-        }`;\r\n-        setTimeout(() => {\r\n-            msgElement.textContent = '';\r\n-            msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-        }, 5000);\r\n-    }\r\n+    const msgElement = document.getElementById(\"msg\");\r\n+    if (!msgElement) return;\r\n+    msgElement.textContent = message;\r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+    setTimeout(() => {\r\n+        msgElement.textContent = '';\r\n+        msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+    }, 5000);\r\n }\r\n \r\n function formatTimestamp(timestamp) {\r\n     if (!timestamp) return 'N/A';\r\n-    return new Date(timestamp).toLocaleString();\r\n+    try { return new Date(timestamp).toLocaleString(); } \r\n+    catch (e) { return 'N/A'; }\r\n }\r\n \r\n const safeUpdate = (id, value, suffix = '') => {\r\n-    const element = document.getElementById(id);\r\n-    if (element) element.textContent = value + suffix;\r\n+    const el = document.getElementById(id);\r\n+    if (el) el.textContent = value + suffix;\r\n };\r\n \r\n // ================================\r\n-// 🟢 MEMBERSHIP LOGIC\r\n-// ================================\r\n+// MEMBERSHIP FUNCTIONS\r\n async function handleApproveClick(requestId) {\r\n     safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-        if (!resp.ok) throw new Error((await resp.json()).message || `Approval failed: ${resp.status}`);\r\n-        safeUpdate('actionText', `Approved Request ${requestId}`);\r\n-        displayMessage(`Successfully approved membership request ${requestId}.`);\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n+        displayMessage(`Successfully approved ${requestId}`, false);\r\n         await loadPendingRequests();\r\n         await loadApprovedResidents();\r\n-    } catch (e) {\r\n-        console.error(\"Approval Failed:\", e);\r\n-        displayMessage(`Approval failed: ${e.message}`, true);\r\n-    }\r\n+    } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleRejectClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Rejection for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to REJECT request ${requestId}?`)) return;\r\n+    if (!confirm(`Reject request ${requestId}?`)) return;\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-            method: 'PUT',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-        if (!resp.ok) throw new Error((await resp.json()).message || `Rejection failed: ${resp.status}`);\r\n-        safeUpdate('actionText', `Rejected Request ${requestId}`);\r\n-        displayMessage(`Successfully rejected membership request ${requestId}.`);\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n+        displayMessage(`Successfully rejected ${requestId}`, false);\r\n         await loadPendingRequests();\r\n         await loadApprovedResidents();\r\n-    } catch (e) {\r\n-        console.error(\"Rejection Failed:\", e);\r\n-        displayMessage(`Rejection failed: ${e.message}`, true);\r\n-    }\r\n+    } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleDeleteClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Deletion for ${requestId}...`);\r\n-    if (!confirm(`Are you sure you want to DELETE request ${requestId}?`)) return;\r\n+    if (!confirm(`Delete request ${requestId}?`)) return;\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-            method: 'DELETE',\r\n-            headers: getAuthHeaders(),\r\n-        });\r\n-        if (!resp.ok) throw new Error((await resp.json()).message || `Deletion failed: ${resp.status}`);\r\n-        safeUpdate('actionText', `Deleted Request ${requestId}`);\r\n-        displayMessage(`Successfully deleted membership request ${requestId}.`);\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n+        displayMessage(`Deleted request ${requestId}`, false);\r\n         await loadPendingRequests();\r\n         await loadApprovedResidents();\r\n-    } catch (e) {\r\n-        console.error(\"Deletion Failed:\", e);\r\n-        displayMessage(`Deletion failed: ${e.message}`, true);\r\n-    }\r\n+    } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleSyncClick(event) {\r\n     const btn = event.currentTarget;\r\n-    const originalText = btn.textContent;\r\n-    const originalClasses = btn.className;\r\n-\r\n-    btn.disabled = true;\r\n-    btn.textContent = 'Syncing...';\r\n-    btn.className = 'bg-yellow-500 text-white px-4 py-2 rounded-lg font-semibold shadow-md animate-pulse';\r\n-\r\n+    const originalText = btn.textContent, originalClass = btn.className;\r\n+    btn.disabled = true; \r\n+    btn.textContent='Syncing...'; \r\n+    btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { method: 'POST', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error((await resp.json()).message || `Sync failed: ${resp.status}`);\r\n-        btn.textContent = 'Sync Complete! ✔️';\r\n-        btn.className = 'bg-green-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md';\r\n-        displayMessage(\"Data synchronization successful!\");\r\n-        await loadPendingRequests();\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n+        btn.textContent='Sync Complete!'; \r\n+        btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n+        displayMessage(\"Data synchronization successful\", false);\r\n+        await loadPendingRequests(); \r\n         await loadApprovedResidents();\r\n-    } catch (err) {\r\n-        console.error(\"Sync Failed:\", err);\r\n-        btn.textContent = 'Sync Failed ❌';\r\n-        btn.className = 'bg-red-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md';\r\n-        displayMessage(`Sync failed: ${err.message}`, true);\r\n+    } catch(err){\r\n+        btn.textContent='Sync Failed ❌'; \r\n+        btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; \r\n+        displayMessage(`Sync failed: ${err.message}`,true);\r\n     } finally {\r\n-        setTimeout(() => {\r\n-            btn.disabled = false;\r\n-            btn.textContent = originalText;\r\n-            btn.className = originalClasses;\r\n+        setTimeout(()=>{\r\n+            btn.disabled=false; \r\n+            btn.textContent=originalText; \r\n+            btn.className=originalClass; \r\n         }, 3000);\r\n     }\r\n }\r\n \r\n async function loadPendingRequests() {\r\n-    const tableBody = document.getElementById('membershipTableBody');\r\n-    const countElement = document.getElementById('membershipCount');\r\n-    const noRequestsMsg = document.getElementById('noPendingRequests');\r\n-    if (!tableBody || !countElement || !noRequestsMsg) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-blue-500 italic\">Loading...</td></tr>';\r\n-\r\n+    const tbody = document.getElementById('membershipTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch pending requests.\");\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error('Failed to fetch pending requests');\r\n         const requests = await resp.json();\r\n-\r\n-        tableBody.innerHTML = '';\r\n-        countElement.textContent = requests.length;\r\n-\r\n-        if (requests.length === 0) {\r\n-            noRequestsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noRequestsMsg.classList.add('hidden');\r\n-            requests.forEach(request => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                const requestedAtString = formatTimestamp(request.RequestedAt || request.requestedAt);\r\n-                const requestId = request.id || request.RequestID;\r\n-                row.innerHTML = `\r\n-<td>${requestId}</td>\r\n-<td>${request.ResidentName || 'N/A'}</td>\r\n-<td>${request.NationalID || 'N/A'}</td>\r\n-<td>${request.PhoneNumber || 'N/A'}</td>\r\n-<td>${request.Email || 'N/A'}</td>\r\n-<td>${request.HouseNumber || 'N/A'}</td>\r\n-<td>${request.CourtName || 'N/A'}</td>\r\n-<td>${request.RoleName || 'N/A'}</td>\r\n-<td><span class=\"bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full text-xs\">${request.Status || 'Pending'}</span></td>\r\n-<td>${requestedAtString}</td>\r\n-<td class=\"flex space-x-2\">\r\n-<button class=\"approve-btn bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Approve</button>\r\n-<button class=\"reject-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Reject</button>\r\n-<button class=\"delete-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs\" data-request-id=\"${requestId}\">Delete</button>\r\n-</td>`;\r\n-            });\r\n-            tableBody.querySelectorAll('.approve-btn').forEach(btn => btn.addEventListener('click', e => handleApproveClick(e.target.dataset.requestId)));\r\n-            tableBody.querySelectorAll('.reject-btn').forEach(btn => btn.addEventListener('click', e => handleRejectClick(e.target.dataset.requestId)));\r\n-            tableBody.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', e => handleDeleteClick(e.target.dataset.requestId)));\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading pending requests:\", err);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"11\" class=\"text-center py-4 text-red-500 italic\">Failed to load pending requests.</td></tr>';\r\n-        displayMessage(\"Failed to load pending requests from API.\", true);\r\n-    }\r\n+        tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : '';\r\n+        requests.forEach(r=>{\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML=`\r\n+                <td>${r.RequestID||r.id}</td>\r\n+                <td>${r.ResidentName||'N/A'}</td>\r\n+                <td>${r.NationalID||'N/A'}</td>\r\n+                <td>${r.PhoneNumber||'N/A'}</td>\r\n+                <td>${r.Email||'N/A'}</td>\r\n+                <td>${r.HouseNumber||'N/A'}</td>\r\n+                <td>${r.CourtName||'N/A'}</td>\r\n+                <td>${r.RoleName||'N/A'}</td>\r\n+                <td>${r.Status||'Pending'}</td>\r\n+                <td>${formatTimestamp(r.RequestedAt||r.requestedAt)}</td>\r\n+                <td class=\"flex space-x-1\">\r\n+                    <button class=\"approve-btn\" data-id=\"${r.RequestID||r.id}\">Approve</button>\r\n+                    <button class=\"reject-btn\" data-id=\"${r.RequestID||r.id}\">Reject</button>\r\n+                    <button class=\"delete-btn\" data-id=\"${r.RequestID||r.id}\">Delete</button>\r\n+                </td>\r\n+            `;\r\n+        });\r\n+        tbody.querySelectorAll('.approve-btn').forEach(b=>b.addEventListener('click', e=>handleApproveClick(e.target.dataset.id)));\r\n+        tbody.querySelectorAll('.reject-btn').forEach(b=>b.addEventListener('click', e=>handleRejectClick(e.target.dataset.id)));\r\n+        tbody.querySelectorAll('.delete-btn').forEach(b=>b.addEventListener('click', e=>handleDeleteClick(e.target.dataset.id)));\r\n+    } catch(e){ displayMessage(`Failed to load pending requests: ${e.message}`, true); }\r\n }\r\n \r\n async function loadApprovedResidents() {\r\n-    const tableBody = document.getElementById('residentsTableBody');\r\n-    const noResidentsMsg = document.getElementById('noApprovedResidents');\r\n-    if (!tableBody || !noResidentsMsg) return;\r\n-\r\n-    tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-blue-500 italic\">Loading...</td></tr>';\r\n+    const tbody = document.getElementById('residentsTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML='<tr><td colspan=\"8\">Loading...</td></tr>';\r\n     try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error(\"Failed to fetch approved residents.\");\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS,{headers:getAuthHeaders()});\r\n+        if(!resp.ok) throw new Error('Failed to fetch approved residents');\r\n         const residents = await resp.json();\r\n+        tbody.innerHTML = residents.length===0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : '';\r\n+        residents.forEach(r=>{\r\n+            const row=tbody.insertRow();\r\n+            row.innerHTML=`\r\n+                <td>${r.ResidentName||'N/A'}</td>\r\n+                <td>${r.NationalID||'N/A'}</td>\r\n+                <td>${r.PhoneNumber||'N/A'}</td>\r\n+                <td>${r.Email||'N/A'}</td>\r\n+                <td>${r.HouseNumber||'N/A'}</td>\r\n+                <td>${r.CourtName||'N/A'}</td>\r\n+                <td>${r.RoleName||'N/A'}</td>\r\n+            `;\r\n+        });\r\n+    } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n+}\r\n \r\n-        tableBody.innerHTML = '';\r\n-        if (residents.length === 0) {\r\n-            noResidentsMsg.classList.remove('hidden');\r\n-        } else {\r\n-            noResidentsMsg.classList.add('hidden');\r\n-            residents.forEach(resident => {\r\n-                const row = tableBody.insertRow();\r\n-                row.className = 'hover:bg-blue-50 transition-colors duration-100';\r\n-                row.innerHTML = `\r\n-<td>${resident.ResidentName || 'N/A'}</td>\r\n-<td>${resident.NationalID || 'N/A'}</td>\r\n-<td>${resident.PhoneNumber || 'N/A'}</td>\r\n-<td>${resident.Email || 'N/A'}</td>\r\n-<td>${resident.HouseNumber || 'N/A'}</td>\r\n-<td>${resident.CourtName || 'N/A'}</td>\r\n-<td>${resident.RoleName || 'N/A'}</td>`;\r\n-            });\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading approved residents:\", err);\r\n-        tableBody.innerHTML = '<tr><td colspan=\"8\" class=\"text-center py-4 text-red-500 italic\">Failed to load approved residents.</td></tr>';\r\n-        displayMessage(\"Failed to load approved residents.\", true);\r\n-    }\r\n+function attachMembershipListeners(){\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n+        document.getElementById('requestIdFilter').value=''; \r\n+        document.getElementById('residentFilter').value='';\r\n+        displayMessage(\"Filters cleared.\", false);\r\n+    });\r\n }\r\n \r\n // ================================\r\n-// 🧭 SIDEBAR & PAGE LOADING\r\n+// DASHBOARD FUNCTIONS\r\n+async function loadDashboardSummary(){\r\n+    try{\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY,{headers:getAuthHeaders()});\r\n+        if(!res.ok) throw new Error(res.statusText);\r\n+        const d=await res.json();\r\n+        safeUpdate(\"totalResidents\",d.residents||0);\r\n+        safeUpdate(\"pendingPayments\",d.pendingPayments||0);\r\n+        safeUpdate(\"compliancePct\",d.compliance||0,'%');\r\n+        safeUpdate(\"overrideCount\",d.overrides||0);\r\n+    }catch(e){ console.error(e); }\r\n+}\r\n+\r\n+async function loadAccessChart(){\r\n+    try{\r\n+        const res=await fetch(ENDPOINTS.DASHBOARD_CHART,{headers:getAuthHeaders()});\r\n+        if(!res.ok) throw new Error(res.statusText);\r\n+        const data=await res.json();\r\n+        const el=document.getElementById(\"accessChart\");\r\n+        if(!el) return;\r\n+        const ctx=el.getContext(\"2d\");\r\n+        if(window.accessChartInstance) window.accessChartInstance.destroy();\r\n+        window.accessChartInstance = new Chart(ctx,{\r\n+            type:'line',\r\n+            data:{labels:data.days||[], datasets:[{label:'Access Attempts', data:data.counts||[], borderColor:'#2563eb', backgroundColor:'rgba(37,99,235,0.2)', fill:true}]},\r\n+            options:{responsive:true, maintainAspectRatio:false}\r\n+        });\r\n+    }catch(e){ console.error(e); }\r\n+}\r\n+\r\n // ================================\r\n+// SIDEBAR & PAGE LOADING\r\n const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContentArea = document.getElementById(\"main-content-area\");\r\n+const mainContent = document.getElementById(\"main-content-area\");\r\n \r\n-async function loadPageIntoMainContent(page) {\r\n-    mainContentArea.innerHTML = '<div class=\"text-center p-12 text-lg text-gray-500 font-semibold\">Loading content...</div>';\r\n-    try {\r\n-        const res = await fetch(`./sections/${page}`);\r\n-        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n-        const html = await res.text();\r\n-        mainContentArea.innerHTML = html;\r\n+async function loadPageIntoMainContent(url){\r\n+    if(!mainContent) return;\r\n+    mainContent.innerHTML='<div>Loading...</div>';\r\n+    try{\r\n+        const res = await fetch(url);\r\n+        if(!res.ok) throw new Error(res.status);\r\n+        const html=await res.text();\r\n+        mainContent.innerHTML=html;\r\n \r\n-        // Call loaders\r\n-        if (page === \"dashboardoverview.html\") {\r\n-            await loadDashboardSummary();\r\n-            await loadAccessChart();\r\n-        } else if (page === \"membership.html\") {\r\n-            attachMembershipListeners();\r\n-            await loadPendingRequests();\r\n-        } else if (page === \"membershiprecords.html\") {\r\n-            attachMembershipListeners();\r\n-            await loadApprovedResidents();\r\n-        }\r\n-    } catch (err) {\r\n-        console.error(\"Error loading page:\", err);\r\n-        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${page}. Check console for details.</div>`;\r\n+        // Page-specific loaders\r\n+        if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n+        else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n+        else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n+        else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n+    }catch(e){\r\n+        console.error(e);\r\n+        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n     }\r\n }\r\n \r\n-// Sidebar button click\r\n-sidebarButtons.forEach(btn => {\r\n-    btn.addEventListener(\"click\", async () => {\r\n-        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-        const page = btn.dataset.target;\r\n-        if (page) await loadPageIntoMainContent(page);\r\n+// Sidebar click handler\r\n+sidebarButtons.forEach(btn=>{\r\n+    btn.addEventListener(\"click\",()=>{\r\n+        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n+        const page=btn.dataset.target;\r\n+        if(page) loadPageIntoMainContent(page);\r\n     });\r\n });\r\n \r\n // ================================\r\n-// INITIALIZATION\r\n+// ACCESS LOGS\r\n+async function loadAccessLogs() {\r\n+    const tbody = document.getElementById('logsTableBody');\r\n+    if (!tbody) return;\r\n+    tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error('Failed to fetch access logs');\r\n+        const logs = await resp.json();\r\n+        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : '';\r\n+        logs.forEach(log => {\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML = `\r\n+                <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n+                <td>${log.UserId || log.userId}</td>\r\n+                <td>${log.Action || log.action}</td>\r\n+                <td>${log.LogType || log.type}</td>\r\n+            `;\r\n+        });\r\n+    } catch (e) {\r\n+        displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n+    }\r\n+}\r\n+\r\n // ================================\r\n-document.addEventListener('DOMContentLoaded', () => {\r\n-    loadPageIntoMainContent('dashboardoverview.html');\r\n+// INITIAL LOAD\r\n+document.addEventListener('DOMContentLoaded',()=>{\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n"
                },
                {
                    "date": 1763953930573,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,10 +9,10 @@\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/admin/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/admin/accesschart`,\r\n+    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n     PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n@@ -24,12 +24,11 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/accesslogs`, // Corrected from /api/admin/accesslogs\r\n+    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`,\r\n };\r\n \r\n-\r\n // ================================\r\n // AUTH & LOGOUT\r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n"
                },
                {
                    "date": 1763954144054,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,18 +1,19 @@\n // =========================================================\r\n-// adminsdashboard.js - Unified Admin Dashboard Loader\r\n+// unifiedDashboard.js - Admin & Security Dashboard Loader\r\n // =========================================================\r\n \r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n const API_HOST = \"http://localhost:4050\";\r\n const token = localStorage.getItem(\"accessToken\");\r\n+const userRole = localStorage.getItem(\"userRole\"); // \"admin\" or \"security\"\r\n if (!token) window.location.href = \"/login.html\";\r\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: `${API_HOST}/api/residents/admin/accesschart`,\r\n+    DASHBOARD_SUMMARY: userRole === \"admin\" ? `${API_HOST}/api/admin/summary` : `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: userRole === \"admin\" ? `${API_HOST}/api/admin/accesschart` : `${API_HOST}/api/residents/admin/accesschart`,\r\n     SYNC: `${API_HOST}/api/admin/sync`,\r\n     PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n@@ -24,15 +25,16 @@\n     PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n     REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n     MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n     MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`,\r\n+    ACCESS_LOGS: userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n+    localStorage.removeItem(\"userRole\");\r\n     window.location.href = \"/login.html\";\r\n });\r\n \r\n // ================================\r\n@@ -124,8 +126,10 @@\n         }, 3000);\r\n     }\r\n }\r\n \r\n+// ================================\r\n+// LOAD DATA FUNCTIONS\r\n async function loadPendingRequests() {\r\n     const tbody = document.getElementById('membershipTableBody');\r\n     if(!tbody) return;\r\n     tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n@@ -183,17 +187,8 @@\n         });\r\n     } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n }\r\n \r\n-function attachMembershipListeners(){\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n-        document.getElementById('requestIdFilter').value=''; \r\n-        document.getElementById('residentFilter').value='';\r\n-        displayMessage(\"Filters cleared.\", false);\r\n-    });\r\n-}\r\n-\r\n // ================================\r\n // DASHBOARD FUNCTIONS\r\n async function loadDashboardSummary(){\r\n     try{\r\n@@ -285,7 +280,16 @@\n }\r\n \r\n // ================================\r\n // INITIAL LOAD\r\n-document.addEventListener('DOMContentLoaded',()=>{\r\n+document.addEventListener('DOMContentLoaded',()=> {\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n+\r\n+function attachMembershipListeners(){\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n+        document.getElementById('requestIdFilter').value=''; \r\n+        document.getElementById('residentFilter').value='';\r\n+        displayMessage(\"Filters cleared.\", false);\r\n+    });\r\n+}\r\n"
                },
                {
                    "date": 1763957776041,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,15 +18,9 @@\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n     REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n     DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n     ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n     ACCESS_LOGS: userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n };\r\n \r\n // ================================\r\n@@ -65,130 +59,50 @@\n     if (el) el.textContent = value + suffix;\r\n };\r\n \r\n // ================================\r\n-// MEMBERSHIP FUNCTIONS\r\n-async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n-        displayMessage(`Successfully approved ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n-}\r\n+// SIDEBAR & PAGE LOADING\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContent = document.getElementById(\"main-content-area\");\r\n \r\n-async function handleRejectClick(requestId) {\r\n-    if (!confirm(`Reject request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n-        displayMessage(`Successfully rejected ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n-}\r\n+async function loadPageIntoMainContent(url){\r\n+    if(!mainContent) return;\r\n+    mainContent.innerHTML='<div>Loading...</div>';\r\n+    try{\r\n+        const res = await fetch(url);\r\n+        if(!res.ok) throw new Error(res.status);\r\n+        const html=await res.text();\r\n+        mainContent.innerHTML=html;\r\n \r\n-async function handleDeleteClick(requestId) {\r\n-    if (!confirm(`Delete request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n-        displayMessage(`Deleted request ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n-}\r\n-\r\n-async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent, originalClass = btn.className;\r\n-    btn.disabled = true; \r\n-    btn.textContent='Syncing...'; \r\n-    btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n-        btn.textContent='Sync Complete!'; \r\n-        btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n-        displayMessage(\"Data synchronization successful\", false);\r\n-        await loadPendingRequests(); \r\n-        await loadApprovedResidents();\r\n-    } catch(err){\r\n-        btn.textContent='Sync Failed ❌'; \r\n-        btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; \r\n-        displayMessage(`Sync failed: ${err.message}`,true);\r\n-    } finally {\r\n-        setTimeout(()=>{\r\n-            btn.disabled=false; \r\n-            btn.textContent=originalText; \r\n-            btn.className=originalClass; \r\n-        }, 3000);\r\n+        // Page-specific loaders\r\n+        if(url.includes(\"dashboardoverview.html\")) { \r\n+            await loadDashboardSummary(); \r\n+            await loadAccessChart(); \r\n+        } \r\n+        else if(url.includes(\"membership.html\")) { \r\n+            import('/js/membership.js').then(module => {\r\n+                module.initMembershipPage();\r\n+            });\r\n+        } \r\n+        else if(url.includes(\"accesslogs.html\")) { \r\n+            await loadAccessLogs(); \r\n+        }\r\n+    } catch(e){\r\n+        console.error(e);\r\n+        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n     }\r\n }\r\n \r\n-// ================================\r\n-// LOAD DATA FUNCTIONS\r\n-async function loadPendingRequests() {\r\n-    const tbody = document.getElementById('membershipTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error('Failed to fetch pending requests');\r\n-        const requests = await resp.json();\r\n-        tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : '';\r\n-        requests.forEach(r=>{\r\n-            const row = tbody.insertRow();\r\n-            row.innerHTML=`\r\n-                <td>${r.RequestID||r.id}</td>\r\n-                <td>${r.ResidentName||'N/A'}</td>\r\n-                <td>${r.NationalID||'N/A'}</td>\r\n-                <td>${r.PhoneNumber||'N/A'}</td>\r\n-                <td>${r.Email||'N/A'}</td>\r\n-                <td>${r.HouseNumber||'N/A'}</td>\r\n-                <td>${r.CourtName||'N/A'}</td>\r\n-                <td>${r.RoleName||'N/A'}</td>\r\n-                <td>${r.Status||'Pending'}</td>\r\n-                <td>${formatTimestamp(r.RequestedAt||r.requestedAt)}</td>\r\n-                <td class=\"flex space-x-1\">\r\n-                    <button class=\"approve-btn\" data-id=\"${r.RequestID||r.id}\">Approve</button>\r\n-                    <button class=\"reject-btn\" data-id=\"${r.RequestID||r.id}\">Reject</button>\r\n-                    <button class=\"delete-btn\" data-id=\"${r.RequestID||r.id}\">Delete</button>\r\n-                </td>\r\n-            `;\r\n-        });\r\n-        tbody.querySelectorAll('.approve-btn').forEach(b=>b.addEventListener('click', e=>handleApproveClick(e.target.dataset.id)));\r\n-        tbody.querySelectorAll('.reject-btn').forEach(b=>b.addEventListener('click', e=>handleRejectClick(e.target.dataset.id)));\r\n-        tbody.querySelectorAll('.delete-btn').forEach(b=>b.addEventListener('click', e=>handleDeleteClick(e.target.dataset.id)));\r\n-    } catch(e){ displayMessage(`Failed to load pending requests: ${e.message}`, true); }\r\n-}\r\n+// Sidebar click handler\r\n+sidebarButtons.forEach(btn=>{\r\n+    btn.addEventListener(\"click\",()=>{\r\n+        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n+        const page=btn.dataset.target;\r\n+        if(page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n \r\n-async function loadApprovedResidents() {\r\n-    const tbody = document.getElementById('residentsTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML='<tr><td colspan=\"8\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS,{headers:getAuthHeaders()});\r\n-        if(!resp.ok) throw new Error('Failed to fetch approved residents');\r\n-        const residents = await resp.json();\r\n-        tbody.innerHTML = residents.length===0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : '';\r\n-        residents.forEach(r=>{\r\n-            const row=tbody.insertRow();\r\n-            row.innerHTML=`\r\n-                <td>${r.ResidentName||'N/A'}</td>\r\n-                <td>${r.NationalID||'N/A'}</td>\r\n-                <td>${r.PhoneNumber||'N/A'}</td>\r\n-                <td>${r.Email||'N/A'}</td>\r\n-                <td>${r.HouseNumber||'N/A'}</td>\r\n-                <td>${r.CourtName||'N/A'}</td>\r\n-                <td>${r.RoleName||'N/A'}</td>\r\n-            `;\r\n-        });\r\n-    } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n-}\r\n-\r\n // ================================\r\n // DASHBOARD FUNCTIONS\r\n async function loadDashboardSummary(){\r\n     try{\r\n@@ -219,43 +133,8 @@\n     }catch(e){ console.error(e); }\r\n }\r\n \r\n // ================================\r\n-// SIDEBAR & PAGE LOADING\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContent = document.getElementById(\"main-content-area\");\r\n-\r\n-async function loadPageIntoMainContent(url){\r\n-    if(!mainContent) return;\r\n-    mainContent.innerHTML='<div>Loading...</div>';\r\n-    try{\r\n-        const res = await fetch(url);\r\n-        if(!res.ok) throw new Error(res.status);\r\n-        const html=await res.text();\r\n-        mainContent.innerHTML=html;\r\n-\r\n-        // Page-specific loaders\r\n-        if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n-        else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n-        else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n-        else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n-    }catch(e){\r\n-        console.error(e);\r\n-        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n-    }\r\n-}\r\n-\r\n-// Sidebar click handler\r\n-sidebarButtons.forEach(btn=>{\r\n-    btn.addEventListener(\"click\",()=>{\r\n-        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n-        const page=btn.dataset.target;\r\n-        if(page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n-\r\n-// ================================\r\n // ACCESS LOGS\r\n async function loadAccessLogs() {\r\n     const tbody = document.getElementById('logsTableBody');\r\n     if (!tbody) return;\r\n@@ -283,13 +162,4 @@\n // INITIAL LOAD\r\n document.addEventListener('DOMContentLoaded',()=> {\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n-\r\n-function attachMembershipListeners(){\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n-        document.getElementById('requestIdFilter').value=''; \r\n-        document.getElementById('residentFilter').value='';\r\n-        displayMessage(\"Filters cleared.\", false);\r\n-    });\r\n-}\r\n"
                },
                {
                    "date": 1763958251343,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,15 @@\n     APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n     APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n     REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n     DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n     ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n     ACCESS_LOGS: userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n };\r\n \r\n // ================================\r\n@@ -59,50 +65,130 @@\n     if (el) el.textContent = value + suffix;\r\n };\r\n \r\n // ================================\r\n-// SIDEBAR & PAGE LOADING\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContent = document.getElementById(\"main-content-area\");\r\n+// MEMBERSHIP FUNCTIONS\r\n+async function handleApproveClick(requestId) {\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n+        displayMessage(`Successfully approved ${requestId}`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n+}\r\n \r\n-async function loadPageIntoMainContent(url){\r\n-    if(!mainContent) return;\r\n-    mainContent.innerHTML='<div>Loading...</div>';\r\n-    try{\r\n-        const res = await fetch(url);\r\n-        if(!res.ok) throw new Error(res.status);\r\n-        const html=await res.text();\r\n-        mainContent.innerHTML=html;\r\n+async function handleRejectClick(requestId) {\r\n+    if (!confirm(`Reject request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n+        displayMessage(`Successfully rejected ${requestId}`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n+}\r\n \r\n-        // Page-specific loaders\r\n-        if(url.includes(\"dashboardoverview.html\")) { \r\n-            await loadDashboardSummary(); \r\n-            await loadAccessChart(); \r\n-        } \r\n-        else if(url.includes(\"membership.html\")) { \r\n-            import('/js/membership.js').then(module => {\r\n-                module.initMembershipPage();\r\n-            });\r\n-        } \r\n-        else if(url.includes(\"accesslogs.html\")) { \r\n-            await loadAccessLogs(); \r\n-        }\r\n-    } catch(e){\r\n-        console.error(e);\r\n-        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n+async function handleDeleteClick(requestId) {\r\n+    if (!confirm(`Delete request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n+        displayMessage(`Deleted request ${requestId}`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n+}\r\n+\r\n+async function handleSyncClick(event) {\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent, originalClass = btn.className;\r\n+    btn.disabled = true; \r\n+    btn.textContent='Syncing...'; \r\n+    btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n+        btn.textContent='Sync Complete!'; \r\n+        btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n+        displayMessage(\"Data synchronization successful\", false);\r\n+        await loadPendingRequests(); \r\n+        await loadApprovedResidents();\r\n+    } catch(err){\r\n+        btn.textContent='Sync Failed ❌'; \r\n+        btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; \r\n+        displayMessage(`Sync failed: ${err.message}`,true);\r\n+    } finally {\r\n+        setTimeout(()=>{\r\n+            btn.disabled=false; \r\n+            btn.textContent=originalText; \r\n+            btn.className=originalClass; \r\n+        }, 3000);\r\n     }\r\n }\r\n \r\n-// Sidebar click handler\r\n-sidebarButtons.forEach(btn=>{\r\n-    btn.addEventListener(\"click\",()=>{\r\n-        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n-        const page=btn.dataset.target;\r\n-        if(page) loadPageIntoMainContent(page);\r\n-    });\r\n-});\r\n+// ================================\r\n+// LOAD DATA FUNCTIONS\r\n+async function loadPendingRequests() {\r\n+    const tbody = document.getElementById('membershipTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error('Failed to fetch pending requests');\r\n+        const requests = await resp.json();\r\n+        tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : '';\r\n+        requests.forEach(r=>{\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML=`\r\n+                <td>${r.RequestID||r.id}</td>\r\n+                <td>${r.ResidentName||'N/A'}</td>\r\n+                <td>${r.NationalID||'N/A'}</td>\r\n+                <td>${r.PhoneNumber||'N/A'}</td>\r\n+                <td>${r.Email||'N/A'}</td>\r\n+                <td>${r.HouseNumber||'N/A'}</td>\r\n+                <td>${r.CourtName||'N/A'}</td>\r\n+                <td>${r.RoleName||'N/A'}</td>\r\n+                <td>${r.Status||'Pending'}</td>\r\n+                <td>${formatTimestamp(r.RequestedAt||r.requestedAt)}</td>\r\n+                <td class=\"flex space-x-1\">\r\n+                    <button class=\"approve-btn\" data-id=\"${r.RequestID||r.id}\">Approve</button>\r\n+                    <button class=\"reject-btn\" data-id=\"${r.RequestID||r.id}\">Reject</button>\r\n+                    <button class=\"delete-btn\" data-id=\"${r.RequestID||r.id}\">Delete</button>\r\n+                </td>\r\n+            `;\r\n+        });\r\n+        tbody.querySelectorAll('.approve-btn').forEach(b=>b.addEventListener('click', e=>handleApproveClick(e.target.dataset.id)));\r\n+        tbody.querySelectorAll('.reject-btn').forEach(b=>b.addEventListener('click', e=>handleRejectClick(e.target.dataset.id)));\r\n+        tbody.querySelectorAll('.delete-btn').forEach(b=>b.addEventListener('click', e=>handleDeleteClick(e.target.dataset.id)));\r\n+    } catch(e){ displayMessage(`Failed to load pending requests: ${e.message}`, true); }\r\n+}\r\n \r\n+async function loadApprovedResidents() {\r\n+    const tbody = document.getElementById('residentsTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML='<tr><td colspan=\"8\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS,{headers:getAuthHeaders()});\r\n+        if(!resp.ok) throw new Error('Failed to fetch approved residents');\r\n+        const residents = await resp.json();\r\n+        tbody.innerHTML = residents.length===0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : '';\r\n+        residents.forEach(r=>{\r\n+            const row=tbody.insertRow();\r\n+            row.innerHTML=`\r\n+                <td>${r.ResidentName||'N/A'}</td>\r\n+                <td>${r.NationalID||'N/A'}</td>\r\n+                <td>${r.PhoneNumber||'N/A'}</td>\r\n+                <td>${r.Email||'N/A'}</td>\r\n+                <td>${r.HouseNumber||'N/A'}</td>\r\n+                <td>${r.CourtName||'N/A'}</td>\r\n+                <td>${r.RoleName||'N/A'}</td>\r\n+            `;\r\n+        });\r\n+    } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n+}\r\n+\r\n // ================================\r\n // DASHBOARD FUNCTIONS\r\n async function loadDashboardSummary(){\r\n     try{\r\n@@ -133,8 +219,43 @@\n     }catch(e){ console.error(e); }\r\n }\r\n \r\n // ================================\r\n+// SIDEBAR & PAGE LOADING\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContent = document.getElementById(\"main-content-area\");\r\n+\r\n+async function loadPageIntoMainContent(url){\r\n+    if(!mainContent) return;\r\n+    mainContent.innerHTML='<div>Loading...</div>';\r\n+    try{\r\n+        const res = await fetch(url);\r\n+        if(!res.ok) throw new Error(res.status);\r\n+        const html=await res.text();\r\n+        mainContent.innerHTML=html;\r\n+\r\n+        // Page-specific loaders\r\n+        if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n+        else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n+        else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n+        else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n+    }catch(e){\r\n+        console.error(e);\r\n+        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n+    }\r\n+}\r\n+\r\n+// Sidebar click handler\r\n+sidebarButtons.forEach(btn=>{\r\n+    btn.addEventListener(\"click\",()=>{\r\n+        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n+        const page=btn.dataset.target;\r\n+        if(page) loadPageIntoMainContent(page);\r\n+    });\r\n+});\r\n+\r\n+// ================================\r\n // ACCESS LOGS\r\n async function loadAccessLogs() {\r\n     const tbody = document.getElementById('logsTableBody');\r\n     if (!tbody) return;\r\n@@ -162,4 +283,13 @@\n // INITIAL LOAD\r\n document.addEventListener('DOMContentLoaded',()=> {\r\n     loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n+\r\n+function attachMembershipListeners(){\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n+        document.getElementById('requestIdFilter').value=''; \r\n+        document.getElementById('residentFilter').value='';\r\n+        displayMessage(\"Filters cleared.\", false);\r\n+    });\r\n+}\r\n"
                },
                {
                    "date": 1763983964576,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -292,4 +292,15 @@\n         document.getElementById('residentFilter').value='';\r\n         displayMessage(\"Filters cleared.\", false);\r\n     });\r\n }\r\n+// Example sidebar loader\r\n+async function loadSidebarPage(url, containerSelector) {\r\n+    const container = document.querySelector(containerSelector);\r\n+    const res = await fetch(url);\r\n+    const html = await res.text();\r\n+    container.innerHTML = html;\r\n+\r\n+    // ✅ After injecting HTML, initialize JS\r\n+    const token = localStorage.getItem('accessToken');\r\n+    loadCourts('#courtDropdown', token); // call the function to populate courts\r\n+}\r\n"
                },
                {
                    "date": 1763986193167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,304 +3,496 @@\n // =========================================================\r\n \r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n const API_HOST = \"http://localhost:4050\";\r\n-const token = localStorage.getItem(\"accessToken\");\r\n const userRole = localStorage.getItem(\"userRole\"); // \"admin\" or \"security\"\r\n-if (!token) window.location.href = \"/login.html\";\r\n+if (!localStorage.getItem(\"accessToken\")) {\r\n+  // if no token redirect to login\r\n+  window.location.href = \"/login.html\";\r\n+}\r\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: userRole === \"admin\" ? `${API_HOST}/api/admin/summary` : `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: userRole === \"admin\" ? `${API_HOST}/api/admin/accesschart` : `${API_HOST}/api/residents/admin/accesschart`,\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n+  DASHBOARD_SUMMARY:\r\n+    userRole === \"admin\"\r\n+      ? `${API_HOST}/api/admin/summary`\r\n+      : `${API_HOST}/api/residents/dashboard/summary`,\r\n+  DASHBOARD_CHART:\r\n+    userRole === \"admin\"\r\n+      ? `${API_HOST}/api/admin/accesschart`\r\n+      : `${API_HOST}/api/residents/admin/accesschart`,\r\n+  SYNC: `${API_HOST}/api/admin/sync`,\r\n+  PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+  APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+  APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+  REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+  DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+  PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+  ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+  VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+  PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+  REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+  MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+  MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+  ACCESS_LOGS:\r\n+    userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n+  COURTS: `${API_HOST}/api/courts`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n-document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+document.addEventListener(\"click\", (e) => {\r\n+  // delegated logout (works even if element loaded later)\r\n+  if (e.target && e.target.id === \"logoutBtn\") {\r\n     localStorage.removeItem(\"accessToken\");\r\n     localStorage.removeItem(\"userRole\");\r\n     window.location.href = \"/login.html\";\r\n+  }\r\n });\r\n \r\n // ================================\r\n // UTILITIES\r\n function getAuthHeaders() {\r\n-    return { \"Content-Type\": \"application/json\", \"Authorization\": `Bearer ${token}` };\r\n+  const token = localStorage.getItem(\"accessToken\");\r\n+  const headers = { \"Content-Type\": \"application/json\" };\r\n+  if (token) headers[\"Authorization\"] = `Bearer ${token}`;\r\n+  return headers;\r\n }\r\n \r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById(\"msg\");\r\n-    if (!msgElement) return;\r\n-    msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-    setTimeout(() => {\r\n-        msgElement.textContent = '';\r\n-        msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-    }, 5000);\r\n+  const msgElement = document.getElementById(\"msg\");\r\n+  if (!msgElement) {\r\n+    console[isError ? \"error\" : \"log\"](message);\r\n+    return;\r\n+  }\r\n+  msgElement.textContent = message;\r\n+  msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n+    isError ? \"bg-red-100 text-red-800\" : \"bg-green-100 text-green-800\"\r\n+  }`;\r\n+  setTimeout(() => {\r\n+    msgElement.textContent = \"\";\r\n+    msgElement.className = \"text-sm text-gray-700 mb-3\";\r\n+  }, 5000);\r\n }\r\n \r\n function formatTimestamp(timestamp) {\r\n-    if (!timestamp) return 'N/A';\r\n-    try { return new Date(timestamp).toLocaleString(); } \r\n-    catch (e) { return 'N/A'; }\r\n+  if (!timestamp) return \"N/A\";\r\n+  try {\r\n+    return new Date(timestamp).toLocaleString();\r\n+  } catch (e) {\r\n+    return \"N/A\";\r\n+  }\r\n }\r\n \r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const el = document.getElementById(id);\r\n-    if (el) el.textContent = value + suffix;\r\n+const safeUpdate = (id, value, suffix = \"\") => {\r\n+  const el = document.getElementById(id);\r\n+  if (el) el.textContent = value + suffix;\r\n };\r\n \r\n // ================================\r\n-// MEMBERSHIP FUNCTIONS\r\n+// COURTS (loadCourts) - uses fetch so no external deps\r\n+async function loadCourts(dropdownSelector = \"#courtDropdown\") {\r\n+  try {\r\n+    const dropdown = document.querySelector(dropdownSelector);\r\n+    if (!dropdown) {\r\n+      console.warn(\"loadCourts: dropdown element not found:\", dropdownSelector);\r\n+      return;\r\n+    }\r\n+\r\n+    // show a loading option\r\n+    dropdown.innerHTML = `<option value=\"\">Loading courts...</option>`;\r\n+\r\n+    const res = await fetch(ENDPOINTS.COURTS, {\r\n+      method: \"GET\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+\r\n+    if (!res.ok) {\r\n+      // if unauthorized, maybe token expired\r\n+      if (res.status === 401 || res.status === 403) {\r\n+        console.warn(\"loadCourts: unauthorized, redirecting to login\");\r\n+        // you may want to show a message instead of redirecting automatically\r\n+        // window.location.href = '/login.html';\r\n+      }\r\n+      throw new Error(`Failed to fetch courts (${res.status})`);\r\n+    }\r\n+\r\n+    const courts = await res.json();\r\n+\r\n+    // populate dropdown\r\n+    dropdown.innerHTML = `<option value=\"\">Select a court</option>`;\r\n+    if (!Array.isArray(courts) || courts.length === 0) {\r\n+      dropdown.innerHTML = `<option value=\"\">No courts available</option>`;\r\n+      return;\r\n+    }\r\n+\r\n+    courts.forEach((c) => {\r\n+      const option = document.createElement(\"option\");\r\n+      // support both shapes: { CourtName } or { courtName } or plain string\r\n+      const name = c?.CourtName ?? c?.courtName ?? (typeof c === \"string\" ? c : \"\");\r\n+      option.value = name;\r\n+      option.textContent = name;\r\n+      dropdown.appendChild(option);\r\n+    });\r\n+    console.log(\"loadCourts: populated\", courts.length, \"courts\");\r\n+  } catch (err) {\r\n+    console.error(\"loadCourts error:\", err);\r\n+    const dropdown = document.querySelector(dropdownSelector);\r\n+    if (dropdown) dropdown.innerHTML = `<option value=\"\">Failed to load courts</option>`;\r\n+  }\r\n+}\r\n+\r\n+// ================================\r\n+// MEMBERSHIP FUNCTIONS (approve/reject/delete/sync)\r\n async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n-        displayMessage(`Successfully approved ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n+  safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+      method: \"PUT\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n+    displayMessage(`Successfully approved ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Approval failed: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n async function handleRejectClick(requestId) {\r\n-    if (!confirm(`Reject request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n-        displayMessage(`Successfully rejected ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n+  if (!confirm(`Reject request ${requestId}?`)) return;\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+      method: \"PUT\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Rejection failed`);\r\n+    displayMessage(`Successfully rejected ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Rejection failed: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n async function handleDeleteClick(requestId) {\r\n-    if (!confirm(`Delete request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n-        displayMessage(`Deleted request ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n+  if (!confirm(`Delete request ${requestId}?`)) return;\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+      method: \"DELETE\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Deletion failed`);\r\n+    displayMessage(`Deleted request ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Deletion failed: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent, originalClass = btn.className;\r\n-    btn.disabled = true; \r\n-    btn.textContent='Syncing...'; \r\n-    btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n-        btn.textContent='Sync Complete!'; \r\n-        btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n-        displayMessage(\"Data synchronization successful\", false);\r\n-        await loadPendingRequests(); \r\n-        await loadApprovedResidents();\r\n-    } catch(err){\r\n-        btn.textContent='Sync Failed ❌'; \r\n-        btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; \r\n-        displayMessage(`Sync failed: ${err.message}`,true);\r\n-    } finally {\r\n-        setTimeout(()=>{\r\n-            btn.disabled=false; \r\n-            btn.textContent=originalText; \r\n-            btn.className=originalClass; \r\n-        }, 3000);\r\n-    }\r\n+  const btn = event.currentTarget;\r\n+  const originalText = btn.textContent,\r\n+    originalClass = btn.className;\r\n+  btn.disabled = true;\r\n+  btn.textContent = \"Syncing...\";\r\n+  btn.className = \"bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse\";\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.SYNC, { method: \"POST\", headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Sync failed\");\r\n+    btn.textContent = \"Sync Complete!\";\r\n+    btn.className = \"bg-green-600 text-white px-4 py-2 rounded-lg\";\r\n+    displayMessage(\"Data synchronization successful\", false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (err) {\r\n+    btn.textContent = \"Sync Failed ❌\";\r\n+    btn.className = \"bg-red-600 text-white px-4 py-2 rounded-lg\";\r\n+    displayMessage(`Sync failed: ${err.message}`, true);\r\n+  } finally {\r\n+    setTimeout(() => {\r\n+      btn.disabled = false;\r\n+      btn.textContent = originalText;\r\n+      btn.className = originalClass;\r\n+    }, 3000);\r\n+  }\r\n }\r\n \r\n // ================================\r\n // LOAD DATA FUNCTIONS\r\n async function loadPendingRequests() {\r\n-    const tbody = document.getElementById('membershipTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error('Failed to fetch pending requests');\r\n-        const requests = await resp.json();\r\n-        tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : '';\r\n-        requests.forEach(r=>{\r\n-            const row = tbody.insertRow();\r\n-            row.innerHTML=`\r\n-                <td>${r.RequestID||r.id}</td>\r\n-                <td>${r.ResidentName||'N/A'}</td>\r\n-                <td>${r.NationalID||'N/A'}</td>\r\n-                <td>${r.PhoneNumber||'N/A'}</td>\r\n-                <td>${r.Email||'N/A'}</td>\r\n-                <td>${r.HouseNumber||'N/A'}</td>\r\n-                <td>${r.CourtName||'N/A'}</td>\r\n-                <td>${r.RoleName||'N/A'}</td>\r\n-                <td>${r.Status||'Pending'}</td>\r\n-                <td>${formatTimestamp(r.RequestedAt||r.requestedAt)}</td>\r\n+  const tbody = document.getElementById(\"membershipTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"11\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch pending requests\");\r\n+    const requests = await resp.json();\r\n+    tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : \"\";\r\n+    requests.forEach((r) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n+                <td>${r.RequestID || r.id || \"N/A\"}</td>\r\n+                <td>${r.ResidentName || \"N/A\"}</td>\r\n+                <td>${r.NationalID || \"N/A\"}</td>\r\n+                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n+                <td>${r.Email || \"N/A\"}</td>\r\n+                <td>${r.HouseNumber || \"N/A\"}</td>\r\n+                <td>${r.CourtName || \"N/A\"}</td>\r\n+                <td>${r.RoleName || \"N/A\"}</td>\r\n+                <td>${r.Status || \"Pending\"}</td>\r\n+                <td>${formatTimestamp(r.RequestedAt || r.requestedAt)}</td>\r\n                 <td class=\"flex space-x-1\">\r\n-                    <button class=\"approve-btn\" data-id=\"${r.RequestID||r.id}\">Approve</button>\r\n-                    <button class=\"reject-btn\" data-id=\"${r.RequestID||r.id}\">Reject</button>\r\n-                    <button class=\"delete-btn\" data-id=\"${r.RequestID||r.id}\">Delete</button>\r\n+                    <button class=\"approve-btn\" data-id=\"${r.RequestID || r.id}\">Approve</button>\r\n+                    <button class=\"reject-btn\" data-id=\"${r.RequestID || r.id}\">Reject</button>\r\n+                    <button class=\"delete-btn\" data-id=\"${r.RequestID || r.id}\">Delete</button>\r\n                 </td>\r\n             `;\r\n-        });\r\n-        tbody.querySelectorAll('.approve-btn').forEach(b=>b.addEventListener('click', e=>handleApproveClick(e.target.dataset.id)));\r\n-        tbody.querySelectorAll('.reject-btn').forEach(b=>b.addEventListener('click', e=>handleRejectClick(e.target.dataset.id)));\r\n-        tbody.querySelectorAll('.delete-btn').forEach(b=>b.addEventListener('click', e=>handleDeleteClick(e.target.dataset.id)));\r\n-    } catch(e){ displayMessage(`Failed to load pending requests: ${e.message}`, true); }\r\n+    });\r\n+    tbody.querySelectorAll(\".approve-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleApproveClick(e.target.dataset.id))\r\n+    );\r\n+    tbody.querySelectorAll(\".reject-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleRejectClick(e.target.dataset.id))\r\n+    );\r\n+    tbody.querySelectorAll(\".delete-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleDeleteClick(e.target.dataset.id))\r\n+    );\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load pending requests: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n async function loadApprovedResidents() {\r\n-    const tbody = document.getElementById('residentsTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML='<tr><td colspan=\"8\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS,{headers:getAuthHeaders()});\r\n-        if(!resp.ok) throw new Error('Failed to fetch approved residents');\r\n-        const residents = await resp.json();\r\n-        tbody.innerHTML = residents.length===0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : '';\r\n-        residents.forEach(r=>{\r\n-            const row=tbody.insertRow();\r\n-            row.innerHTML=`\r\n-                <td>${r.ResidentName||'N/A'}</td>\r\n-                <td>${r.NationalID||'N/A'}</td>\r\n-                <td>${r.PhoneNumber||'N/A'}</td>\r\n-                <td>${r.Email||'N/A'}</td>\r\n-                <td>${r.HouseNumber||'N/A'}</td>\r\n-                <td>${r.CourtName||'N/A'}</td>\r\n-                <td>${r.RoleName||'N/A'}</td>\r\n+  const tbody = document.getElementById(\"residentsTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"8\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch approved residents\");\r\n+    const residents = await resp.json();\r\n+    tbody.innerHTML = residents.length === 0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : \"\";\r\n+    residents.forEach((r) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n+                <td>${r.ResidentName || \"N/A\"}</td>\r\n+                <td>${r.NationalID || \"N/A\"}</td>\r\n+                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n+                <td>${r.Email || \"N/A\"}</td>\r\n+                <td>${r.HouseNumber || \"N/A\"}</td>\r\n+                <td>${r.CourtName || \"N/A\"}</td>\r\n+                <td>${r.RoleName || \"N/A\"}</td>\r\n             `;\r\n-        });\r\n-    } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n+    });\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load approved residents: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n // ================================\r\n // DASHBOARD FUNCTIONS\r\n-async function loadDashboardSummary(){\r\n-    try{\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY,{headers:getAuthHeaders()});\r\n-        if(!res.ok) throw new Error(res.statusText);\r\n-        const d=await res.json();\r\n-        safeUpdate(\"totalResidents\",d.residents||0);\r\n-        safeUpdate(\"pendingPayments\",d.pendingPayments||0);\r\n-        safeUpdate(\"compliancePct\",d.compliance||0,'%');\r\n-        safeUpdate(\"overrideCount\",d.overrides||0);\r\n-    }catch(e){ console.error(e); }\r\n+async function loadDashboardSummary() {\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(res.statusText);\r\n+    const d = await res.json();\r\n+    safeUpdate(\"totalResidents\", d.residents || 0);\r\n+    safeUpdate(\"pendingPayments\", d.pendingPayments || 0);\r\n+    safeUpdate(\"compliancePct\", d.compliance || 0, \"%\");\r\n+    safeUpdate(\"overrideCount\", d.overrides || 0);\r\n+  } catch (e) {\r\n+    console.error(\"loadDashboardSummary error:\", e);\r\n+  }\r\n }\r\n \r\n-async function loadAccessChart(){\r\n-    try{\r\n-        const res=await fetch(ENDPOINTS.DASHBOARD_CHART,{headers:getAuthHeaders()});\r\n-        if(!res.ok) throw new Error(res.statusText);\r\n-        const data=await res.json();\r\n-        const el=document.getElementById(\"accessChart\");\r\n-        if(!el) return;\r\n-        const ctx=el.getContext(\"2d\");\r\n-        if(window.accessChartInstance) window.accessChartInstance.destroy();\r\n-        window.accessChartInstance = new Chart(ctx,{\r\n-            type:'line',\r\n-            data:{labels:data.days||[], datasets:[{label:'Access Attempts', data:data.counts||[], borderColor:'#2563eb', backgroundColor:'rgba(37,99,235,0.2)', fill:true}]},\r\n-            options:{responsive:true, maintainAspectRatio:false}\r\n-        });\r\n-    }catch(e){ console.error(e); }\r\n+async function loadAccessChart() {\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(res.statusText);\r\n+    const data = await res.json();\r\n+    const el = document.getElementById(\"accessChart\");\r\n+    if (!el) return;\r\n+    const ctx = el.getContext(\"2d\");\r\n+    if (window.accessChartInstance) window.accessChartInstance.destroy();\r\n+    window.accessChartInstance = new Chart(ctx, {\r\n+      type: \"line\",\r\n+      data: {\r\n+        labels: data.days || [],\r\n+        datasets: [\r\n+          {\r\n+            label: \"Access Attempts\",\r\n+            data: data.counts || [],\r\n+            borderColor: \"#2563eb\",\r\n+            backgroundColor: \"rgba(37,99,235,0.2)\",\r\n+            fill: true,\r\n+          },\r\n+        ],\r\n+      },\r\n+      options: { responsive: true, maintainAspectRatio: false },\r\n+    });\r\n+  } catch (e) {\r\n+    console.error(\"loadAccessChart error:\", e);\r\n+  }\r\n }\r\n \r\n // ================================\r\n // SIDEBAR & PAGE LOADING\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContent = document.getElementById(\"main-content-area\");\r\n+// cache selectors after DOM ready\r\n+let sidebarButtons = [];\r\n+let mainContent = null;\r\n \r\n-async function loadPageIntoMainContent(url){\r\n-    if(!mainContent) return;\r\n-    mainContent.innerHTML='<div>Loading...</div>';\r\n-    try{\r\n-        const res = await fetch(url);\r\n-        if(!res.ok) throw new Error(res.status);\r\n-        const html=await res.text();\r\n-        mainContent.innerHTML=html;\r\n+async function loadPageIntoMainContent(url) {\r\n+  if (!mainContent) {\r\n+    console.warn(\"mainContent container not found\");\r\n+    return;\r\n+  }\r\n \r\n-        // Page-specific loaders\r\n-        if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n-        else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n-        else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n-        else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n-    }catch(e){\r\n-        console.error(e);\r\n-        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n+  mainContent.innerHTML = '<div>Loading...</div>';\r\n+  try {\r\n+    const res = await fetch(url);\r\n+    if (!res.ok) throw new Error(res.status);\r\n+    const html = await res.text();\r\n+    mainContent.innerHTML = html;\r\n+\r\n+    // Page-specific loaders\r\n+    if (url.includes(\"dashboardoverview.html\")) {\r\n+      await loadDashboardSummary();\r\n+      await loadAccessChart();\r\n+    } else if (url.includes(\"membership.html\")) {\r\n+      // attach any click handlers in membership page\r\n+      attachMembershipListeners();\r\n+\r\n+      // populate courts AFTER the HTML is injected\r\n+      await loadCourts(\"#courtDropdown\");\r\n+\r\n+      // then load pending requests table\r\n+      await loadPendingRequests();\r\n+    } else if (url.includes(\"membershiprecords.html\")) {\r\n+      attachMembershipListeners();\r\n+      await loadApprovedResidents();\r\n+    } else if (url.includes(\"accesslogs.html\")) {\r\n+      await loadAccessLogs();\r\n     }\r\n+  } catch (e) {\r\n+    console.error(\"loadPageIntoMainContent error:\", e);\r\n+    mainContent.innerHTML = `<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n+  }\r\n }\r\n \r\n-// Sidebar click handler\r\n-sidebarButtons.forEach(btn=>{\r\n-    btn.addEventListener(\"click\",()=>{\r\n-        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n-        const page=btn.dataset.target;\r\n-        if(page) loadPageIntoMainContent(page);\r\n+// Sidebar click handler - will be wired in DOMContentLoaded\r\n+function wireSidebarButtons() {\r\n+  sidebarButtons = Array.from(document.querySelectorAll(\".sidebarBtn\"));\r\n+  mainContent = document.getElementById(\"main-content-area\");\r\n+\r\n+  if (!mainContent) console.warn(\"#main-content-area not found\");\r\n+\r\n+  sidebarButtons.forEach((btn) => {\r\n+    btn.addEventListener(\"click\", (ev) => {\r\n+      // visual active state\r\n+      sidebarButtons.forEach((b) => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+      btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n+      const page = btn.dataset.target;\r\n+      if (page) loadPageIntoMainContent(page);\r\n     });\r\n-});\r\n+  });\r\n+}\r\n \r\n // ================================\r\n // ACCESS LOGS\r\n async function loadAccessLogs() {\r\n-    const tbody = document.getElementById('logsTableBody');\r\n-    if (!tbody) return;\r\n-    tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error('Failed to fetch access logs');\r\n-        const logs = await resp.json();\r\n-        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : '';\r\n-        logs.forEach(log => {\r\n-            const row = tbody.insertRow();\r\n-            row.innerHTML = `\r\n+  const tbody = document.getElementById(\"logsTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch access logs\");\r\n+    const logs = await resp.json();\r\n+    tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : \"\";\r\n+    logs.forEach((log) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n                 <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n                 <td>${log.UserId || log.userId}</td>\r\n                 <td>${log.Action || log.action}</td>\r\n                 <td>${log.LogType || log.type}</td>\r\n             `;\r\n-        });\r\n-    } catch (e) {\r\n-        displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n-    }\r\n+    });\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n // ================================\r\n-// INITIAL LOAD\r\n-document.addEventListener('DOMContentLoaded',()=> {\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+// INITIAL LOAD (wire up once DOM is ready)\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+  // wire event handlers for dynamic loading\r\n+  wireSidebarButtons();\r\n+\r\n+  // load default page (dashboard overview)\r\n+  loadPageIntoMainContent(\"sections/dashboardoverview.html\");\r\n });\r\n \r\n-function attachMembershipListeners(){\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n-        document.getElementById('requestIdFilter').value=''; \r\n-        document.getElementById('residentFilter').value='';\r\n-        displayMessage(\"Filters cleared.\", false);\r\n+// ================================\r\n+// MISC: membership page listeners\r\n+function attachMembershipListeners() {\r\n+  // Sync button\r\n+  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+\r\n+  // Clear filters\r\n+  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+    const rid = document.getElementById(\"requestIdFilter\");\r\n+    const rf = document.getElementById(\"residentFilter\");\r\n+    if (rid) rid.value = \"\";\r\n+    if (rf) rf.value = \"\";\r\n+    displayMessage(\"Filters cleared.\", false);\r\n+  });\r\n+\r\n+  // membership form submission if present\r\n+  const membershipForm = document.getElementById(\"membershipForm\");\r\n+  if (membershipForm) {\r\n+    membershipForm.removeEventListener(\"submit\", membershipFormSubmitHandler);\r\n+    membershipForm.addEventListener(\"submit\", membershipFormSubmitHandler);\r\n+  }\r\n+}\r\n+\r\n+async function membershipFormSubmitHandler(e) {\r\n+  e.preventDefault();\r\n+  const form = e.target;\r\n+  const submitBtn = form.querySelector('button[type=\"submit\"]');\r\n+  if (submitBtn) submitBtn.disabled = true;\r\n+\r\n+  // gather form data\r\n+  const fd = new FormData(form);\r\n+  const payload = Object.fromEntries(fd.entries());\r\n+\r\n+  try {\r\n+    const resp = await fetch(`${API_HOST}/api/admin/requests`, {\r\n+      method: \"POST\",\r\n+      headers: getAuthHeaders(),\r\n+      body: JSON.stringify(payload),\r\n     });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Submit failed\");\r\n+    displayMessage(\"Membership request submitted.\", false);\r\n+\r\n+    // clear form or update UI as needed\r\n+    form.reset();\r\n+  } catch (err) {\r\n+    displayMessage(`Failed to submit: ${err.message}`, true);\r\n+  } finally {\r\n+    if (submitBtn) submitBtn.disabled = false;\r\n+  }\r\n }\r\n-// Example sidebar loader\r\n-async function loadSidebarPage(url, containerSelector) {\r\n-    const container = document.querySelector(containerSelector);\r\n-    const res = await fetch(url);\r\n-    const html = await res.text();\r\n-    container.innerHTML = html;\r\n \r\n-    // ✅ After injecting HTML, initialize JS\r\n-    const token = localStorage.getItem('accessToken');\r\n-    loadCourts('#courtDropdown', token); // call the function to populate courts\r\n-}\r\n+// ================================\r\n+// Export or expose functions for debugging (optional)\r\n+window._app = {\r\n+  loadCourts,\r\n+  loadPendingRequests,\r\n+  loadApprovedResidents,\r\n+  loadPageIntoMainContent,\r\n+  loadDashboardSummary,\r\n+  loadAccessChart,\r\n+};\r\n"
                },
                {
                    "date": 1763986247635,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,496 +3,304 @@\n // =========================================================\r\n \r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n const API_HOST = \"http://localhost:4050\";\r\n+const token = localStorage.getItem(\"accessToken\");\r\n const userRole = localStorage.getItem(\"userRole\"); // \"admin\" or \"security\"\r\n-if (!localStorage.getItem(\"accessToken\")) {\r\n-  // if no token redirect to login\r\n-  window.location.href = \"/login.html\";\r\n-}\r\n+if (!token) window.location.href = \"/login.html\";\r\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-  DASHBOARD_SUMMARY:\r\n-    userRole === \"admin\"\r\n-      ? `${API_HOST}/api/admin/summary`\r\n-      : `${API_HOST}/api/residents/dashboard/summary`,\r\n-  DASHBOARD_CHART:\r\n-    userRole === \"admin\"\r\n-      ? `${API_HOST}/api/admin/accesschart`\r\n-      : `${API_HOST}/api/residents/admin/accesschart`,\r\n-  SYNC: `${API_HOST}/api/admin/sync`,\r\n-  PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-  APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-  APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-  REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-  DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-  PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-  ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-  VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-  PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-  REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-  MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-  MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-  ACCESS_LOGS:\r\n-    userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n-  COURTS: `${API_HOST}/api/courts`,\r\n+    DASHBOARD_SUMMARY: userRole === \"admin\" ? `${API_HOST}/api/admin/summary` : `${API_HOST}/api/residents/dashboard/summary`,\r\n+    DASHBOARD_CHART: userRole === \"admin\" ? `${API_HOST}/api/admin/accesschart` : `${API_HOST}/api/residents/admin/accesschart`,\r\n+    SYNC: `${API_HOST}/api/admin/sync`,\r\n+    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+    ACCESS_LOGS: userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n-document.addEventListener(\"click\", (e) => {\r\n-  // delegated logout (works even if element loaded later)\r\n-  if (e.target && e.target.id === \"logoutBtn\") {\r\n+document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n     localStorage.removeItem(\"accessToken\");\r\n     localStorage.removeItem(\"userRole\");\r\n     window.location.href = \"/login.html\";\r\n-  }\r\n });\r\n \r\n // ================================\r\n // UTILITIES\r\n function getAuthHeaders() {\r\n-  const token = localStorage.getItem(\"accessToken\");\r\n-  const headers = { \"Content-Type\": \"application/json\" };\r\n-  if (token) headers[\"Authorization\"] = `Bearer ${token}`;\r\n-  return headers;\r\n+    return { \"Content-Type\": \"application/json\", \"Authorization\": `Bearer ${token}` };\r\n }\r\n \r\n function displayMessage(message, isError = false) {\r\n-  const msgElement = document.getElementById(\"msg\");\r\n-  if (!msgElement) {\r\n-    console[isError ? \"error\" : \"log\"](message);\r\n-    return;\r\n-  }\r\n-  msgElement.textContent = message;\r\n-  msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n-    isError ? \"bg-red-100 text-red-800\" : \"bg-green-100 text-green-800\"\r\n-  }`;\r\n-  setTimeout(() => {\r\n-    msgElement.textContent = \"\";\r\n-    msgElement.className = \"text-sm text-gray-700 mb-3\";\r\n-  }, 5000);\r\n+    const msgElement = document.getElementById(\"msg\");\r\n+    if (!msgElement) return;\r\n+    msgElement.textContent = message;\r\n+    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n+    setTimeout(() => {\r\n+        msgElement.textContent = '';\r\n+        msgElement.className = 'text-sm text-gray-700 mb-3';\r\n+    }, 5000);\r\n }\r\n \r\n function formatTimestamp(timestamp) {\r\n-  if (!timestamp) return \"N/A\";\r\n-  try {\r\n-    return new Date(timestamp).toLocaleString();\r\n-  } catch (e) {\r\n-    return \"N/A\";\r\n-  }\r\n+    if (!timestamp) return 'N/A';\r\n+    try { return new Date(timestamp).toLocaleString(); } \r\n+    catch (e) { return 'N/A'; }\r\n }\r\n \r\n-const safeUpdate = (id, value, suffix = \"\") => {\r\n-  const el = document.getElementById(id);\r\n-  if (el) el.textContent = value + suffix;\r\n+const safeUpdate = (id, value, suffix = '') => {\r\n+    const el = document.getElementById(id);\r\n+    if (el) el.textContent = value + suffix;\r\n };\r\n \r\n // ================================\r\n-// COURTS (loadCourts) - uses fetch so no external deps\r\n-async function loadCourts(dropdownSelector = \"#courtDropdown\") {\r\n-  try {\r\n-    const dropdown = document.querySelector(dropdownSelector);\r\n-    if (!dropdown) {\r\n-      console.warn(\"loadCourts: dropdown element not found:\", dropdownSelector);\r\n-      return;\r\n-    }\r\n-\r\n-    // show a loading option\r\n-    dropdown.innerHTML = `<option value=\"\">Loading courts...</option>`;\r\n-\r\n-    const res = await fetch(ENDPOINTS.COURTS, {\r\n-      method: \"GET\",\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-\r\n-    if (!res.ok) {\r\n-      // if unauthorized, maybe token expired\r\n-      if (res.status === 401 || res.status === 403) {\r\n-        console.warn(\"loadCourts: unauthorized, redirecting to login\");\r\n-        // you may want to show a message instead of redirecting automatically\r\n-        // window.location.href = '/login.html';\r\n-      }\r\n-      throw new Error(`Failed to fetch courts (${res.status})`);\r\n-    }\r\n-\r\n-    const courts = await res.json();\r\n-\r\n-    // populate dropdown\r\n-    dropdown.innerHTML = `<option value=\"\">Select a court</option>`;\r\n-    if (!Array.isArray(courts) || courts.length === 0) {\r\n-      dropdown.innerHTML = `<option value=\"\">No courts available</option>`;\r\n-      return;\r\n-    }\r\n-\r\n-    courts.forEach((c) => {\r\n-      const option = document.createElement(\"option\");\r\n-      // support both shapes: { CourtName } or { courtName } or plain string\r\n-      const name = c?.CourtName ?? c?.courtName ?? (typeof c === \"string\" ? c : \"\");\r\n-      option.value = name;\r\n-      option.textContent = name;\r\n-      dropdown.appendChild(option);\r\n-    });\r\n-    console.log(\"loadCourts: populated\", courts.length, \"courts\");\r\n-  } catch (err) {\r\n-    console.error(\"loadCourts error:\", err);\r\n-    const dropdown = document.querySelector(dropdownSelector);\r\n-    if (dropdown) dropdown.innerHTML = `<option value=\"\">Failed to load courts</option>`;\r\n-  }\r\n-}\r\n-\r\n-// ================================\r\n-// MEMBERSHIP FUNCTIONS (approve/reject/delete/sync)\r\n+// MEMBERSHIP FUNCTIONS\r\n async function handleApproveClick(requestId) {\r\n-  safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-      method: \"PUT\",\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n-    displayMessage(`Successfully approved ${requestId}`, false);\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    displayMessage(`Approval failed: ${e.message}`, true);\r\n-  }\r\n+    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n+        displayMessage(`Successfully approved ${requestId}`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleRejectClick(requestId) {\r\n-  if (!confirm(`Reject request ${requestId}?`)) return;\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-      method: \"PUT\",\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Rejection failed`);\r\n-    displayMessage(`Successfully rejected ${requestId}`, false);\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    displayMessage(`Rejection failed: ${e.message}`, true);\r\n-  }\r\n+    if (!confirm(`Reject request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n+        displayMessage(`Successfully rejected ${requestId}`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleDeleteClick(requestId) {\r\n-  if (!confirm(`Delete request ${requestId}?`)) return;\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-      method: \"DELETE\",\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Deletion failed`);\r\n-    displayMessage(`Deleted request ${requestId}`, false);\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    displayMessage(`Deletion failed: ${e.message}`, true);\r\n-  }\r\n+    if (!confirm(`Delete request ${requestId}?`)) return;\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n+        displayMessage(`Deleted request ${requestId}`, false);\r\n+        await loadPendingRequests();\r\n+        await loadApprovedResidents();\r\n+    } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n }\r\n \r\n async function handleSyncClick(event) {\r\n-  const btn = event.currentTarget;\r\n-  const originalText = btn.textContent,\r\n-    originalClass = btn.className;\r\n-  btn.disabled = true;\r\n-  btn.textContent = \"Syncing...\";\r\n-  btn.className = \"bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse\";\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.SYNC, { method: \"POST\", headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Sync failed\");\r\n-    btn.textContent = \"Sync Complete!\";\r\n-    btn.className = \"bg-green-600 text-white px-4 py-2 rounded-lg\";\r\n-    displayMessage(\"Data synchronization successful\", false);\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-  } catch (err) {\r\n-    btn.textContent = \"Sync Failed ❌\";\r\n-    btn.className = \"bg-red-600 text-white px-4 py-2 rounded-lg\";\r\n-    displayMessage(`Sync failed: ${err.message}`, true);\r\n-  } finally {\r\n-    setTimeout(() => {\r\n-      btn.disabled = false;\r\n-      btn.textContent = originalText;\r\n-      btn.className = originalClass;\r\n-    }, 3000);\r\n-  }\r\n+    const btn = event.currentTarget;\r\n+    const originalText = btn.textContent, originalClass = btn.className;\r\n+    btn.disabled = true; \r\n+    btn.textContent='Syncing...'; \r\n+    btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n+        btn.textContent='Sync Complete!'; \r\n+        btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n+        displayMessage(\"Data synchronization successful\", false);\r\n+        await loadPendingRequests(); \r\n+        await loadApprovedResidents();\r\n+    } catch(err){\r\n+        btn.textContent='Sync Failed ❌'; \r\n+        btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; \r\n+        displayMessage(`Sync failed: ${err.message}`,true);\r\n+    } finally {\r\n+        setTimeout(()=>{\r\n+            btn.disabled=false; \r\n+            btn.textContent=originalText; \r\n+            btn.className=originalClass; \r\n+        }, 3000);\r\n+    }\r\n }\r\n \r\n // ================================\r\n // LOAD DATA FUNCTIONS\r\n async function loadPendingRequests() {\r\n-  const tbody = document.getElementById(\"membershipTableBody\");\r\n-  if (!tbody) return;\r\n-  tbody.innerHTML = '<tr><td colspan=\"11\">Loading...</td></tr>';\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch pending requests\");\r\n-    const requests = await resp.json();\r\n-    tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : \"\";\r\n-    requests.forEach((r) => {\r\n-      const row = tbody.insertRow();\r\n-      row.innerHTML = `\r\n-                <td>${r.RequestID || r.id || \"N/A\"}</td>\r\n-                <td>${r.ResidentName || \"N/A\"}</td>\r\n-                <td>${r.NationalID || \"N/A\"}</td>\r\n-                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n-                <td>${r.Email || \"N/A\"}</td>\r\n-                <td>${r.HouseNumber || \"N/A\"}</td>\r\n-                <td>${r.CourtName || \"N/A\"}</td>\r\n-                <td>${r.RoleName || \"N/A\"}</td>\r\n-                <td>${r.Status || \"Pending\"}</td>\r\n-                <td>${formatTimestamp(r.RequestedAt || r.requestedAt)}</td>\r\n+    const tbody = document.getElementById('membershipTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers:getAuthHeaders() });\r\n+        if(!resp.ok) throw new Error('Failed to fetch pending requests');\r\n+        const requests = await resp.json();\r\n+        tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : '';\r\n+        requests.forEach(r=>{\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML=`\r\n+                <td>${r.RequestID||r.id}</td>\r\n+                <td>${r.ResidentName||'N/A'}</td>\r\n+                <td>${r.NationalID||'N/A'}</td>\r\n+                <td>${r.PhoneNumber||'N/A'}</td>\r\n+                <td>${r.Email||'N/A'}</td>\r\n+                <td>${r.HouseNumber||'N/A'}</td>\r\n+                <td>${r.CourtName||'N/A'}</td>\r\n+                <td>${r.RoleName||'N/A'}</td>\r\n+                <td>${r.Status||'Pending'}</td>\r\n+                <td>${formatTimestamp(r.RequestedAt||r.requestedAt)}</td>\r\n                 <td class=\"flex space-x-1\">\r\n-                    <button class=\"approve-btn\" data-id=\"${r.RequestID || r.id}\">Approve</button>\r\n-                    <button class=\"reject-btn\" data-id=\"${r.RequestID || r.id}\">Reject</button>\r\n-                    <button class=\"delete-btn\" data-id=\"${r.RequestID || r.id}\">Delete</button>\r\n+                    <button class=\"approve-btn\" data-id=\"${r.RequestID||r.id}\">Approve</button>\r\n+                    <button class=\"reject-btn\" data-id=\"${r.RequestID||r.id}\">Reject</button>\r\n+                    <button class=\"delete-btn\" data-id=\"${r.RequestID||r.id}\">Delete</button>\r\n                 </td>\r\n             `;\r\n-    });\r\n-    tbody.querySelectorAll(\".approve-btn\").forEach((b) =>\r\n-      b.addEventListener(\"click\", (e) => handleApproveClick(e.target.dataset.id))\r\n-    );\r\n-    tbody.querySelectorAll(\".reject-btn\").forEach((b) =>\r\n-      b.addEventListener(\"click\", (e) => handleRejectClick(e.target.dataset.id))\r\n-    );\r\n-    tbody.querySelectorAll(\".delete-btn\").forEach((b) =>\r\n-      b.addEventListener(\"click\", (e) => handleDeleteClick(e.target.dataset.id))\r\n-    );\r\n-  } catch (e) {\r\n-    displayMessage(`Failed to load pending requests: ${e.message}`, true);\r\n-  }\r\n+        });\r\n+        tbody.querySelectorAll('.approve-btn').forEach(b=>b.addEventListener('click', e=>handleApproveClick(e.target.dataset.id)));\r\n+        tbody.querySelectorAll('.reject-btn').forEach(b=>b.addEventListener('click', e=>handleRejectClick(e.target.dataset.id)));\r\n+        tbody.querySelectorAll('.delete-btn').forEach(b=>b.addEventListener('click', e=>handleDeleteClick(e.target.dataset.id)));\r\n+    } catch(e){ displayMessage(`Failed to load pending requests: ${e.message}`, true); }\r\n }\r\n \r\n async function loadApprovedResidents() {\r\n-  const tbody = document.getElementById(\"residentsTableBody\");\r\n-  if (!tbody) return;\r\n-  tbody.innerHTML = '<tr><td colspan=\"8\">Loading...</td></tr>';\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch approved residents\");\r\n-    const residents = await resp.json();\r\n-    tbody.innerHTML = residents.length === 0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : \"\";\r\n-    residents.forEach((r) => {\r\n-      const row = tbody.insertRow();\r\n-      row.innerHTML = `\r\n-                <td>${r.ResidentName || \"N/A\"}</td>\r\n-                <td>${r.NationalID || \"N/A\"}</td>\r\n-                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n-                <td>${r.Email || \"N/A\"}</td>\r\n-                <td>${r.HouseNumber || \"N/A\"}</td>\r\n-                <td>${r.CourtName || \"N/A\"}</td>\r\n-                <td>${r.RoleName || \"N/A\"}</td>\r\n+    const tbody = document.getElementById('residentsTableBody');\r\n+    if(!tbody) return;\r\n+    tbody.innerHTML='<tr><td colspan=\"8\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS,{headers:getAuthHeaders()});\r\n+        if(!resp.ok) throw new Error('Failed to fetch approved residents');\r\n+        const residents = await resp.json();\r\n+        tbody.innerHTML = residents.length===0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : '';\r\n+        residents.forEach(r=>{\r\n+            const row=tbody.insertRow();\r\n+            row.innerHTML=`\r\n+                <td>${r.ResidentName||'N/A'}</td>\r\n+                <td>${r.NationalID||'N/A'}</td>\r\n+                <td>${r.PhoneNumber||'N/A'}</td>\r\n+                <td>${r.Email||'N/A'}</td>\r\n+                <td>${r.HouseNumber||'N/A'}</td>\r\n+                <td>${r.CourtName||'N/A'}</td>\r\n+                <td>${r.RoleName||'N/A'}</td>\r\n             `;\r\n-    });\r\n-  } catch (e) {\r\n-    displayMessage(`Failed to load approved residents: ${e.message}`, true);\r\n-  }\r\n+        });\r\n+    } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n }\r\n \r\n // ================================\r\n // DASHBOARD FUNCTIONS\r\n-async function loadDashboardSummary() {\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(res.statusText);\r\n-    const d = await res.json();\r\n-    safeUpdate(\"totalResidents\", d.residents || 0);\r\n-    safeUpdate(\"pendingPayments\", d.pendingPayments || 0);\r\n-    safeUpdate(\"compliancePct\", d.compliance || 0, \"%\");\r\n-    safeUpdate(\"overrideCount\", d.overrides || 0);\r\n-  } catch (e) {\r\n-    console.error(\"loadDashboardSummary error:\", e);\r\n-  }\r\n+async function loadDashboardSummary(){\r\n+    try{\r\n+        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY,{headers:getAuthHeaders()});\r\n+        if(!res.ok) throw new Error(res.statusText);\r\n+        const d=await res.json();\r\n+        safeUpdate(\"totalResidents\",d.residents||0);\r\n+        safeUpdate(\"pendingPayments\",d.pendingPayments||0);\r\n+        safeUpdate(\"compliancePct\",d.compliance||0,'%');\r\n+        safeUpdate(\"overrideCount\",d.overrides||0);\r\n+    }catch(e){ console.error(e); }\r\n }\r\n \r\n-async function loadAccessChart() {\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(res.statusText);\r\n-    const data = await res.json();\r\n-    const el = document.getElementById(\"accessChart\");\r\n-    if (!el) return;\r\n-    const ctx = el.getContext(\"2d\");\r\n-    if (window.accessChartInstance) window.accessChartInstance.destroy();\r\n-    window.accessChartInstance = new Chart(ctx, {\r\n-      type: \"line\",\r\n-      data: {\r\n-        labels: data.days || [],\r\n-        datasets: [\r\n-          {\r\n-            label: \"Access Attempts\",\r\n-            data: data.counts || [],\r\n-            borderColor: \"#2563eb\",\r\n-            backgroundColor: \"rgba(37,99,235,0.2)\",\r\n-            fill: true,\r\n-          },\r\n-        ],\r\n-      },\r\n-      options: { responsive: true, maintainAspectRatio: false },\r\n-    });\r\n-  } catch (e) {\r\n-    console.error(\"loadAccessChart error:\", e);\r\n-  }\r\n+async function loadAccessChart(){\r\n+    try{\r\n+        const res=await fetch(ENDPOINTS.DASHBOARD_CHART,{headers:getAuthHeaders()});\r\n+        if(!res.ok) throw new Error(res.statusText);\r\n+        const data=await res.json();\r\n+        const el=document.getElementById(\"accessChart\");\r\n+        if(!el) return;\r\n+        const ctx=el.getContext(\"2d\");\r\n+        if(window.accessChartInstance) window.accessChartInstance.destroy();\r\n+        window.accessChartInstance = new Chart(ctx,{\r\n+            type:'line',\r\n+            data:{labels:data.days||[], datasets:[{label:'Access Attempts', data:data.counts||[], borderColor:'#2563eb', backgroundColor:'rgba(37,99,235,0.2)', fill:true}]},\r\n+            options:{responsive:true, maintainAspectRatio:false}\r\n+        });\r\n+    }catch(e){ console.error(e); }\r\n }\r\n \r\n // ================================\r\n // SIDEBAR & PAGE LOADING\r\n-// cache selectors after DOM ready\r\n-let sidebarButtons = [];\r\n-let mainContent = null;\r\n+const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n+const mainContent = document.getElementById(\"main-content-area\");\r\n \r\n-async function loadPageIntoMainContent(url) {\r\n-  if (!mainContent) {\r\n-    console.warn(\"mainContent container not found\");\r\n-    return;\r\n-  }\r\n+async function loadPageIntoMainContent(url){\r\n+    if(!mainContent) return;\r\n+    mainContent.innerHTML='<div>Loading...</div>';\r\n+    try{\r\n+        const res = await fetch(url);\r\n+        if(!res.ok) throw new Error(res.status);\r\n+        const html=await res.text();\r\n+        mainContent.innerHTML=html;\r\n \r\n-  mainContent.innerHTML = '<div>Loading...</div>';\r\n-  try {\r\n-    const res = await fetch(url);\r\n-    if (!res.ok) throw new Error(res.status);\r\n-    const html = await res.text();\r\n-    mainContent.innerHTML = html;\r\n-\r\n-    // Page-specific loaders\r\n-    if (url.includes(\"dashboardoverview.html\")) {\r\n-      await loadDashboardSummary();\r\n-      await loadAccessChart();\r\n-    } else if (url.includes(\"membership.html\")) {\r\n-      // attach any click handlers in membership page\r\n-      attachMembershipListeners();\r\n-\r\n-      // populate courts AFTER the HTML is injected\r\n-      await loadCourts(\"#courtDropdown\");\r\n-\r\n-      // then load pending requests table\r\n-      await loadPendingRequests();\r\n-    } else if (url.includes(\"membershiprecords.html\")) {\r\n-      attachMembershipListeners();\r\n-      await loadApprovedResidents();\r\n-    } else if (url.includes(\"accesslogs.html\")) {\r\n-      await loadAccessLogs();\r\n+        // Page-specific loaders\r\n+        if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n+        else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n+        else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n+        else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n+    }catch(e){\r\n+        console.error(e);\r\n+        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n     }\r\n-  } catch (e) {\r\n-    console.error(\"loadPageIntoMainContent error:\", e);\r\n-    mainContent.innerHTML = `<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n-  }\r\n }\r\n \r\n-// Sidebar click handler - will be wired in DOMContentLoaded\r\n-function wireSidebarButtons() {\r\n-  sidebarButtons = Array.from(document.querySelectorAll(\".sidebarBtn\"));\r\n-  mainContent = document.getElementById(\"main-content-area\");\r\n-\r\n-  if (!mainContent) console.warn(\"#main-content-area not found\");\r\n-\r\n-  sidebarButtons.forEach((btn) => {\r\n-    btn.addEventListener(\"click\", (ev) => {\r\n-      // visual active state\r\n-      sidebarButtons.forEach((b) => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-      btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n-      const page = btn.dataset.target;\r\n-      if (page) loadPageIntoMainContent(page);\r\n+// Sidebar click handler\r\n+sidebarButtons.forEach(btn=>{\r\n+    btn.addEventListener(\"click\",()=>{\r\n+        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n+        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n+        const page=btn.dataset.target;\r\n+        if(page) loadPageIntoMainContent(page);\r\n     });\r\n-  });\r\n-}\r\n+});\r\n \r\n // ================================\r\n // ACCESS LOGS\r\n async function loadAccessLogs() {\r\n-  const tbody = document.getElementById(\"logsTableBody\");\r\n-  if (!tbody) return;\r\n-  tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch access logs\");\r\n-    const logs = await resp.json();\r\n-    tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : \"\";\r\n-    logs.forEach((log) => {\r\n-      const row = tbody.insertRow();\r\n-      row.innerHTML = `\r\n+    const tbody = document.getElementById('logsTableBody');\r\n+    if (!tbody) return;\r\n+    tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n+    try {\r\n+        const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n+        if (!resp.ok) throw new Error('Failed to fetch access logs');\r\n+        const logs = await resp.json();\r\n+        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : '';\r\n+        logs.forEach(log => {\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML = `\r\n                 <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n                 <td>${log.UserId || log.userId}</td>\r\n                 <td>${log.Action || log.action}</td>\r\n                 <td>${log.LogType || log.type}</td>\r\n             `;\r\n-    });\r\n-  } catch (e) {\r\n-    displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n-  }\r\n+        });\r\n+    } catch (e) {\r\n+        displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n+    }\r\n }\r\n \r\n // ================================\r\n-// INITIAL LOAD (wire up once DOM is ready)\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-  // wire event handlers for dynamic loading\r\n-  wireSidebarButtons();\r\n-\r\n-  // load default page (dashboard overview)\r\n-  loadPageIntoMainContent(\"sections/dashboardoverview.html\");\r\n+// INITIAL LOAD\r\n+document.addEventListener('DOMContentLoaded',()=> {\r\n+    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n });\r\n \r\n-// ================================\r\n-// MISC: membership page listeners\r\n-function attachMembershipListeners() {\r\n-  // Sync button\r\n-  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-\r\n-  // Clear filters\r\n-  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-    const rid = document.getElementById(\"requestIdFilter\");\r\n-    const rf = document.getElementById(\"residentFilter\");\r\n-    if (rid) rid.value = \"\";\r\n-    if (rf) rf.value = \"\";\r\n-    displayMessage(\"Filters cleared.\", false);\r\n-  });\r\n-\r\n-  // membership form submission if present\r\n-  const membershipForm = document.getElementById(\"membershipForm\");\r\n-  if (membershipForm) {\r\n-    membershipForm.removeEventListener(\"submit\", membershipFormSubmitHandler);\r\n-    membershipForm.addEventListener(\"submit\", membershipFormSubmitHandler);\r\n-  }\r\n+function attachMembershipListeners(){\r\n+    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n+    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n+        document.getElementById('requestIdFilter').value=''; \r\n+        document.getElementById('residentFilter').value='';\r\n+        displayMessage(\"Filters cleared.\", false);\r\n+    });\r\n }\r\n+// Example sidebar loader\r\n+async function loadSidebarPage(url, containerSelector) {\r\n+    const container = document.querySelector(containerSelector);\r\n+    const res = await fetch(url);\r\n+    const html = await res.text();\r\n+    container.innerHTML = html;\r\n \r\n-async function membershipFormSubmitHandler(e) {\r\n-  e.preventDefault();\r\n-  const form = e.target;\r\n-  const submitBtn = form.querySelector('button[type=\"submit\"]');\r\n-  if (submitBtn) submitBtn.disabled = true;\r\n-\r\n-  // gather form data\r\n-  const fd = new FormData(form);\r\n-  const payload = Object.fromEntries(fd.entries());\r\n-\r\n-  try {\r\n-    const resp = await fetch(`${API_HOST}/api/admin/requests`, {\r\n-      method: \"POST\",\r\n-      headers: getAuthHeaders(),\r\n-      body: JSON.stringify(payload),\r\n-    });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Submit failed\");\r\n-    displayMessage(\"Membership request submitted.\", false);\r\n-\r\n-    // clear form or update UI as needed\r\n-    form.reset();\r\n-  } catch (err) {\r\n-    displayMessage(`Failed to submit: ${err.message}`, true);\r\n-  } finally {\r\n-    if (submitBtn) submitBtn.disabled = false;\r\n-  }\r\n+    // ✅ After injecting HTML, initialize JS\r\n+    const token = localStorage.getItem('accessToken');\r\n+    loadCourts('#courtDropdown', token); // call the function to populate courts\r\n }\r\n-\r\n-// ================================\r\n-// Export or expose functions for debugging (optional)\r\n-window._app = {\r\n-  loadCourts,\r\n-  loadPendingRequests,\r\n-  loadApprovedResidents,\r\n-  loadPageIntoMainContent,\r\n-  loadDashboardSummary,\r\n-  loadAccessChart,\r\n-};\r\n"
                },
                {
                    "date": 1763986293850,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,304 +3,496 @@\n // =========================================================\r\n \r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n const API_HOST = \"http://localhost:4050\";\r\n-const token = localStorage.getItem(\"accessToken\");\r\n const userRole = localStorage.getItem(\"userRole\"); // \"admin\" or \"security\"\r\n-if (!token) window.location.href = \"/login.html\";\r\n+if (!localStorage.getItem(\"accessToken\")) {\r\n+  // if no token redirect to login\r\n+  window.location.href = \"/login.html\";\r\n+}\r\n \r\n // ================================\r\n // ENDPOINTS\r\n const ENDPOINTS = {\r\n-    DASHBOARD_SUMMARY: userRole === \"admin\" ? `${API_HOST}/api/admin/summary` : `${API_HOST}/api/residents/dashboard/summary`,\r\n-    DASHBOARD_CHART: userRole === \"admin\" ? `${API_HOST}/api/admin/accesschart` : `${API_HOST}/api/residents/admin/accesschart`,\r\n-    SYNC: `${API_HOST}/api/admin/sync`,\r\n-    PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-    APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-    APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-    REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-    DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-    PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-    ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-    VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-    PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-    REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-    MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-    MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-    ACCESS_LOGS: userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n+  DASHBOARD_SUMMARY:\r\n+    userRole === \"admin\"\r\n+      ? `${API_HOST}/api/admin/summary`\r\n+      : `${API_HOST}/api/residents/dashboard/summary`,\r\n+  DASHBOARD_CHART:\r\n+    userRole === \"admin\"\r\n+      ? `${API_HOST}/api/admin/accesschart`\r\n+      : `${API_HOST}/api/residents/admin/accesschart`,\r\n+  SYNC: `${API_HOST}/api/admin/sync`,\r\n+  PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+  APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+  APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+  REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+  DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+  PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+  ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+  VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+  PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+  REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+  MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+  MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+  ACCESS_LOGS:\r\n+    userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n+  COURTS: `${API_HOST}/api/courts`,\r\n };\r\n \r\n // ================================\r\n // AUTH & LOGOUT\r\n-document.getElementById(\"logoutBtn\")?.addEventListener(\"click\", () => {\r\n+document.addEventListener(\"click\", (e) => {\r\n+  // delegated logout (works even if element loaded later)\r\n+  if (e.target && e.target.id === \"logoutBtn\") {\r\n     localStorage.removeItem(\"accessToken\");\r\n     localStorage.removeItem(\"userRole\");\r\n     window.location.href = \"/login.html\";\r\n+  }\r\n });\r\n \r\n // ================================\r\n // UTILITIES\r\n function getAuthHeaders() {\r\n-    return { \"Content-Type\": \"application/json\", \"Authorization\": `Bearer ${token}` };\r\n+  const token = localStorage.getItem(\"accessToken\");\r\n+  const headers = { \"Content-Type\": \"application/json\" };\r\n+  if (token) headers[\"Authorization\"] = `Bearer ${token}`;\r\n+  return headers;\r\n }\r\n \r\n function displayMessage(message, isError = false) {\r\n-    const msgElement = document.getElementById(\"msg\");\r\n-    if (!msgElement) return;\r\n-    msgElement.textContent = message;\r\n-    msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;\r\n-    setTimeout(() => {\r\n-        msgElement.textContent = '';\r\n-        msgElement.className = 'text-sm text-gray-700 mb-3';\r\n-    }, 5000);\r\n+  const msgElement = document.getElementById(\"msg\");\r\n+  if (!msgElement) {\r\n+    console[isError ? \"error\" : \"log\"](message);\r\n+    return;\r\n+  }\r\n+  msgElement.textContent = message;\r\n+  msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n+    isError ? \"bg-red-100 text-red-800\" : \"bg-green-100 text-green-800\"\r\n+  }`;\r\n+  setTimeout(() => {\r\n+    msgElement.textContent = \"\";\r\n+    msgElement.className = \"text-sm text-gray-700 mb-3\";\r\n+  }, 5000);\r\n }\r\n \r\n function formatTimestamp(timestamp) {\r\n-    if (!timestamp) return 'N/A';\r\n-    try { return new Date(timestamp).toLocaleString(); } \r\n-    catch (e) { return 'N/A'; }\r\n+  if (!timestamp) return \"N/A\";\r\n+  try {\r\n+    return new Date(timestamp).toLocaleString();\r\n+  } catch (e) {\r\n+    return \"N/A\";\r\n+  }\r\n }\r\n \r\n-const safeUpdate = (id, value, suffix = '') => {\r\n-    const el = document.getElementById(id);\r\n-    if (el) el.textContent = value + suffix;\r\n+const safeUpdate = (id, value, suffix = \"\") => {\r\n+  const el = document.getElementById(id);\r\n+  if (el) el.textContent = value + suffix;\r\n };\r\n \r\n // ================================\r\n-// MEMBERSHIP FUNCTIONS\r\n+// COURTS (loadCourts) - uses fetch so no external deps\r\n+async function loadCourts(dropdownSelector = \"#courtDropdown\") {\r\n+  try {\r\n+    const dropdown = document.querySelector(dropdownSelector);\r\n+    if (!dropdown) {\r\n+      console.warn(\"loadCourts: dropdown element not found:\", dropdownSelector);\r\n+      return;\r\n+    }\r\n+\r\n+    // show a loading option\r\n+    dropdown.innerHTML = `<option value=\"\">Loading courts...</option>`;\r\n+\r\n+    const res = await fetch(ENDPOINTS.COURTS, {\r\n+      method: \"GET\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+\r\n+    if (!res.ok) {\r\n+      // if unauthorized, maybe token expired\r\n+      if (res.status === 401 || res.status === 403) {\r\n+        console.warn(\"loadCourts: unauthorized, redirecting to login\");\r\n+        // you may want to show a message instead of redirecting automatically\r\n+        // window.location.href = '/login.html';\r\n+      }\r\n+      throw new Error(`Failed to fetch courts (${res.status})`);\r\n+    }\r\n+\r\n+    const courts = await res.json();\r\n+\r\n+    // populate dropdown\r\n+    dropdown.innerHTML = `<option value=\"\">Select a court</option>`;\r\n+    if (!Array.isArray(courts) || courts.length === 0) {\r\n+      dropdown.innerHTML = `<option value=\"\">No courts available</option>`;\r\n+      return;\r\n+    }\r\n+\r\n+    courts.forEach((c) => {\r\n+      const option = document.createElement(\"option\");\r\n+      // support both shapes: { CourtName } or { courtName } or plain string\r\n+      const name = c?.CourtName ?? c?.courtName ?? (typeof c === \"string\" ? c : \"\");\r\n+      option.value = name;\r\n+      option.textContent = name;\r\n+      dropdown.appendChild(option);\r\n+    });\r\n+    console.log(\"loadCourts: populated\", courts.length, \"courts\");\r\n+  } catch (err) {\r\n+    console.error(\"loadCourts error:\", err);\r\n+    const dropdown = document.querySelector(dropdownSelector);\r\n+    if (dropdown) dropdown.innerHTML = `<option value=\"\">Failed to load courts</option>`;\r\n+  }\r\n+}\r\n+\r\n+// ================================\r\n+// MEMBERSHIP FUNCTIONS (approve/reject/delete/sync)\r\n async function handleApproveClick(requestId) {\r\n-    safeUpdate('actionText', `Processing Approval for ${requestId}...`);\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), { method: 'PUT', headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n-        displayMessage(`Successfully approved ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Approval failed: ${e.message}`, true); }\r\n+  safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+      method: \"PUT\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n+    displayMessage(`Successfully approved ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Approval failed: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n async function handleRejectClick(requestId) {\r\n-    if (!confirm(`Reject request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), { method:'PUT', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Rejection failed`);\r\n-        displayMessage(`Successfully rejected ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Rejection failed: ${e.message}`, true); }\r\n+  if (!confirm(`Reject request ${requestId}?`)) return;\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+      method: \"PUT\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Rejection failed`);\r\n+    displayMessage(`Successfully rejected ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Rejection failed: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n async function handleDeleteClick(requestId) {\r\n-    if (!confirm(`Delete request ${requestId}?`)) return;\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), { method:'DELETE', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || `Deletion failed`);\r\n-        displayMessage(`Deleted request ${requestId}`, false);\r\n-        await loadPendingRequests();\r\n-        await loadApprovedResidents();\r\n-    } catch(e){ displayMessage(`Deletion failed: ${e.message}`, true); }\r\n+  if (!confirm(`Delete request ${requestId}?`)) return;\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+      method: \"DELETE\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Deletion failed`);\r\n+    displayMessage(`Deleted request ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Deletion failed: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n async function handleSyncClick(event) {\r\n-    const btn = event.currentTarget;\r\n-    const originalText = btn.textContent, originalClass = btn.className;\r\n-    btn.disabled = true; \r\n-    btn.textContent='Syncing...'; \r\n-    btn.className='bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.SYNC, { method:'POST', headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error((await resp.json().catch(()=>({}))).message || 'Sync failed');\r\n-        btn.textContent='Sync Complete!'; \r\n-        btn.className='bg-green-600 text-white px-4 py-2 rounded-lg';\r\n-        displayMessage(\"Data synchronization successful\", false);\r\n-        await loadPendingRequests(); \r\n-        await loadApprovedResidents();\r\n-    } catch(err){\r\n-        btn.textContent='Sync Failed ❌'; \r\n-        btn.className='bg-red-600 text-white px-4 py-2 rounded-lg'; \r\n-        displayMessage(`Sync failed: ${err.message}`,true);\r\n-    } finally {\r\n-        setTimeout(()=>{\r\n-            btn.disabled=false; \r\n-            btn.textContent=originalText; \r\n-            btn.className=originalClass; \r\n-        }, 3000);\r\n-    }\r\n+  const btn = event.currentTarget;\r\n+  const originalText = btn.textContent,\r\n+    originalClass = btn.className;\r\n+  btn.disabled = true;\r\n+  btn.textContent = \"Syncing...\";\r\n+  btn.className = \"bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse\";\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.SYNC, { method: \"POST\", headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Sync failed\");\r\n+    btn.textContent = \"Sync Complete!\";\r\n+    btn.className = \"bg-green-600 text-white px-4 py-2 rounded-lg\";\r\n+    displayMessage(\"Data synchronization successful\", false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (err) {\r\n+    btn.textContent = \"Sync Failed ❌\";\r\n+    btn.className = \"bg-red-600 text-white px-4 py-2 rounded-lg\";\r\n+    displayMessage(`Sync failed: ${err.message}`, true);\r\n+  } finally {\r\n+    setTimeout(() => {\r\n+      btn.disabled = false;\r\n+      btn.textContent = originalText;\r\n+      btn.className = originalClass;\r\n+    }, 3000);\r\n+  }\r\n }\r\n \r\n // ================================\r\n // LOAD DATA FUNCTIONS\r\n async function loadPendingRequests() {\r\n-    const tbody = document.getElementById('membershipTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML='<tr><td colspan=\"11\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers:getAuthHeaders() });\r\n-        if(!resp.ok) throw new Error('Failed to fetch pending requests');\r\n-        const requests = await resp.json();\r\n-        tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : '';\r\n-        requests.forEach(r=>{\r\n-            const row = tbody.insertRow();\r\n-            row.innerHTML=`\r\n-                <td>${r.RequestID||r.id}</td>\r\n-                <td>${r.ResidentName||'N/A'}</td>\r\n-                <td>${r.NationalID||'N/A'}</td>\r\n-                <td>${r.PhoneNumber||'N/A'}</td>\r\n-                <td>${r.Email||'N/A'}</td>\r\n-                <td>${r.HouseNumber||'N/A'}</td>\r\n-                <td>${r.CourtName||'N/A'}</td>\r\n-                <td>${r.RoleName||'N/A'}</td>\r\n-                <td>${r.Status||'Pending'}</td>\r\n-                <td>${formatTimestamp(r.RequestedAt||r.requestedAt)}</td>\r\n+  const tbody = document.getElementById(\"membershipTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"11\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch pending requests\");\r\n+    const requests = await resp.json();\r\n+    tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : \"\";\r\n+    requests.forEach((r) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n+                <td>${r.RequestID || r.id || \"N/A\"}</td>\r\n+                <td>${r.ResidentName || \"N/A\"}</td>\r\n+                <td>${r.NationalID || \"N/A\"}</td>\r\n+                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n+                <td>${r.Email || \"N/A\"}</td>\r\n+                <td>${r.HouseNumber || \"N/A\"}</td>\r\n+                <td>${r.CourtName || \"N/A\"}</td>\r\n+                <td>${r.RoleName || \"N/A\"}</td>\r\n+                <td>${r.Status || \"Pending\"}</td>\r\n+                <td>${formatTimestamp(r.RequestedAt || r.requestedAt)}</td>\r\n                 <td class=\"flex space-x-1\">\r\n-                    <button class=\"approve-btn\" data-id=\"${r.RequestID||r.id}\">Approve</button>\r\n-                    <button class=\"reject-btn\" data-id=\"${r.RequestID||r.id}\">Reject</button>\r\n-                    <button class=\"delete-btn\" data-id=\"${r.RequestID||r.id}\">Delete</button>\r\n+                    <button class=\"approve-btn\" data-id=\"${r.RequestID || r.id}\">Approve</button>\r\n+                    <button class=\"reject-btn\" data-id=\"${r.RequestID || r.id}\">Reject</button>\r\n+                    <button class=\"delete-btn\" data-id=\"${r.RequestID || r.id}\">Delete</button>\r\n                 </td>\r\n             `;\r\n-        });\r\n-        tbody.querySelectorAll('.approve-btn').forEach(b=>b.addEventListener('click', e=>handleApproveClick(e.target.dataset.id)));\r\n-        tbody.querySelectorAll('.reject-btn').forEach(b=>b.addEventListener('click', e=>handleRejectClick(e.target.dataset.id)));\r\n-        tbody.querySelectorAll('.delete-btn').forEach(b=>b.addEventListener('click', e=>handleDeleteClick(e.target.dataset.id)));\r\n-    } catch(e){ displayMessage(`Failed to load pending requests: ${e.message}`, true); }\r\n+    });\r\n+    tbody.querySelectorAll(\".approve-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleApproveClick(e.target.dataset.id))\r\n+    );\r\n+    tbody.querySelectorAll(\".reject-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleRejectClick(e.target.dataset.id))\r\n+    );\r\n+    tbody.querySelectorAll(\".delete-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleDeleteClick(e.target.dataset.id))\r\n+    );\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load pending requests: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n async function loadApprovedResidents() {\r\n-    const tbody = document.getElementById('residentsTableBody');\r\n-    if(!tbody) return;\r\n-    tbody.innerHTML='<tr><td colspan=\"8\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS,{headers:getAuthHeaders()});\r\n-        if(!resp.ok) throw new Error('Failed to fetch approved residents');\r\n-        const residents = await resp.json();\r\n-        tbody.innerHTML = residents.length===0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : '';\r\n-        residents.forEach(r=>{\r\n-            const row=tbody.insertRow();\r\n-            row.innerHTML=`\r\n-                <td>${r.ResidentName||'N/A'}</td>\r\n-                <td>${r.NationalID||'N/A'}</td>\r\n-                <td>${r.PhoneNumber||'N/A'}</td>\r\n-                <td>${r.Email||'N/A'}</td>\r\n-                <td>${r.HouseNumber||'N/A'}</td>\r\n-                <td>${r.CourtName||'N/A'}</td>\r\n-                <td>${r.RoleName||'N/A'}</td>\r\n+  const tbody = document.getElementById(\"residentsTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"8\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch approved residents\");\r\n+    const residents = await resp.json();\r\n+    tbody.innerHTML = residents.length === 0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : \"\";\r\n+    residents.forEach((r) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n+                <td>${r.ResidentName || \"N/A\"}</td>\r\n+                <td>${r.NationalID || \"N/A\"}</td>\r\n+                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n+                <td>${r.Email || \"N/A\"}</td>\r\n+                <td>${r.HouseNumber || \"N/A\"}</td>\r\n+                <td>${r.CourtName || \"N/A\"}</td>\r\n+                <td>${r.RoleName || \"N/A\"}</td>\r\n             `;\r\n-        });\r\n-    } catch(e){ displayMessage(`Failed to load approved residents: ${e.message}`, true); }\r\n+    });\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load approved residents: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n // ================================\r\n // DASHBOARD FUNCTIONS\r\n-async function loadDashboardSummary(){\r\n-    try{\r\n-        const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY,{headers:getAuthHeaders()});\r\n-        if(!res.ok) throw new Error(res.statusText);\r\n-        const d=await res.json();\r\n-        safeUpdate(\"totalResidents\",d.residents||0);\r\n-        safeUpdate(\"pendingPayments\",d.pendingPayments||0);\r\n-        safeUpdate(\"compliancePct\",d.compliance||0,'%');\r\n-        safeUpdate(\"overrideCount\",d.overrides||0);\r\n-    }catch(e){ console.error(e); }\r\n+async function loadDashboardSummary() {\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(res.statusText);\r\n+    const d = await res.json();\r\n+    safeUpdate(\"totalResidents\", d.residents || 0);\r\n+    safeUpdate(\"pendingPayments\", d.pendingPayments || 0);\r\n+    safeUpdate(\"compliancePct\", d.compliance || 0, \"%\");\r\n+    safeUpdate(\"overrideCount\", d.overrides || 0);\r\n+  } catch (e) {\r\n+    console.error(\"loadDashboardSummary error:\", e);\r\n+  }\r\n }\r\n \r\n-async function loadAccessChart(){\r\n-    try{\r\n-        const res=await fetch(ENDPOINTS.DASHBOARD_CHART,{headers:getAuthHeaders()});\r\n-        if(!res.ok) throw new Error(res.statusText);\r\n-        const data=await res.json();\r\n-        const el=document.getElementById(\"accessChart\");\r\n-        if(!el) return;\r\n-        const ctx=el.getContext(\"2d\");\r\n-        if(window.accessChartInstance) window.accessChartInstance.destroy();\r\n-        window.accessChartInstance = new Chart(ctx,{\r\n-            type:'line',\r\n-            data:{labels:data.days||[], datasets:[{label:'Access Attempts', data:data.counts||[], borderColor:'#2563eb', backgroundColor:'rgba(37,99,235,0.2)', fill:true}]},\r\n-            options:{responsive:true, maintainAspectRatio:false}\r\n-        });\r\n-    }catch(e){ console.error(e); }\r\n+async function loadAccessChart() {\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(res.statusText);\r\n+    const data = await res.json();\r\n+    const el = document.getElementById(\"accessChart\");\r\n+    if (!el) return;\r\n+    const ctx = el.getContext(\"2d\");\r\n+    if (window.accessChartInstance) window.accessChartInstance.destroy();\r\n+    window.accessChartInstance = new Chart(ctx, {\r\n+      type: \"line\",\r\n+      data: {\r\n+        labels: data.days || [],\r\n+        datasets: [\r\n+          {\r\n+            label: \"Access Attempts\",\r\n+            data: data.counts || [],\r\n+            borderColor: \"#2563eb\",\r\n+            backgroundColor: \"rgba(37,99,235,0.2)\",\r\n+            fill: true,\r\n+          },\r\n+        ],\r\n+      },\r\n+      options: { responsive: true, maintainAspectRatio: false },\r\n+    });\r\n+  } catch (e) {\r\n+    console.error(\"loadAccessChart error:\", e);\r\n+  }\r\n }\r\n \r\n // ================================\r\n // SIDEBAR & PAGE LOADING\r\n-const sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\n-const mainContent = document.getElementById(\"main-content-area\");\r\n+// cache selectors after DOM ready\r\n+let sidebarButtons = [];\r\n+let mainContent = null;\r\n \r\n-async function loadPageIntoMainContent(url){\r\n-    if(!mainContent) return;\r\n-    mainContent.innerHTML='<div>Loading...</div>';\r\n-    try{\r\n-        const res = await fetch(url);\r\n-        if(!res.ok) throw new Error(res.status);\r\n-        const html=await res.text();\r\n-        mainContent.innerHTML=html;\r\n+async function loadPageIntoMainContent(url) {\r\n+  if (!mainContent) {\r\n+    console.warn(\"mainContent container not found\");\r\n+    return;\r\n+  }\r\n \r\n-        // Page-specific loaders\r\n-        if(url.includes(\"dashboardoverview.html\")) { await loadDashboardSummary(); await loadAccessChart(); }\r\n-        else if(url.includes(\"membership.html\")) { attachMembershipListeners(); await loadPendingRequests(); }\r\n-        else if(url.includes(\"membershiprecords.html\")) { attachMembershipListeners(); await loadApprovedResidents(); }\r\n-        else if(url.includes(\"accesslogs.html\")) { await loadAccessLogs(); }\r\n-    }catch(e){\r\n-        console.error(e);\r\n-        mainContent.innerHTML=`<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n+  mainContent.innerHTML = '<div>Loading...</div>';\r\n+  try {\r\n+    const res = await fetch(url);\r\n+    if (!res.ok) throw new Error(res.status);\r\n+    const html = await res.text();\r\n+    mainContent.innerHTML = html;\r\n+\r\n+    // Page-specific loaders\r\n+    if (url.includes(\"dashboardoverview.html\")) {\r\n+      await loadDashboardSummary();\r\n+      await loadAccessChart();\r\n+    } else if (url.includes(\"membership.html\")) {\r\n+      // attach any click handlers in membership page\r\n+      attachMembershipListeners();\r\n+\r\n+      // populate courts AFTER the HTML is injected\r\n+      await loadCourts(\"#courtDropdown\");\r\n+\r\n+      // then load pending requests table\r\n+      await loadPendingRequests();\r\n+    } else if (url.includes(\"membershiprecords.html\")) {\r\n+      attachMembershipListeners();\r\n+      await loadApprovedResidents();\r\n+    } else if (url.includes(\"accesslogs.html\")) {\r\n+      await loadAccessLogs();\r\n     }\r\n+  } catch (e) {\r\n+    console.error(\"loadPageIntoMainContent error:\", e);\r\n+    mainContent.innerHTML = `<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n+  }\r\n }\r\n \r\n-// Sidebar click handler\r\n-sidebarButtons.forEach(btn=>{\r\n-    btn.addEventListener(\"click\",()=>{\r\n-        sidebarButtons.forEach(b=>b.classList.remove(\"bg-blue-600\",\"text-white\"));\r\n-        btn.classList.add(\"bg-blue-600\",\"text-white\");\r\n-        const page=btn.dataset.target;\r\n-        if(page) loadPageIntoMainContent(page);\r\n+// Sidebar click handler - will be wired in DOMContentLoaded\r\n+function wireSidebarButtons() {\r\n+  sidebarButtons = Array.from(document.querySelectorAll(\".sidebarBtn\"));\r\n+  mainContent = document.getElementById(\"main-content-area\");\r\n+\r\n+  if (!mainContent) console.warn(\"#main-content-area not found\");\r\n+\r\n+  sidebarButtons.forEach((btn) => {\r\n+    btn.addEventListener(\"click\", (ev) => {\r\n+      // visual active state\r\n+      sidebarButtons.forEach((b) => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+      btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n+      const page = btn.dataset.target;\r\n+      if (page) loadPageIntoMainContent(page);\r\n     });\r\n-});\r\n+  });\r\n+}\r\n \r\n // ================================\r\n // ACCESS LOGS\r\n async function loadAccessLogs() {\r\n-    const tbody = document.getElementById('logsTableBody');\r\n-    if (!tbody) return;\r\n-    tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n-    try {\r\n-        const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n-        if (!resp.ok) throw new Error('Failed to fetch access logs');\r\n-        const logs = await resp.json();\r\n-        tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : '';\r\n-        logs.forEach(log => {\r\n-            const row = tbody.insertRow();\r\n-            row.innerHTML = `\r\n+  const tbody = document.getElementById(\"logsTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch access logs\");\r\n+    const logs = await resp.json();\r\n+    tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : \"\";\r\n+    logs.forEach((log) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n                 <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n                 <td>${log.UserId || log.userId}</td>\r\n                 <td>${log.Action || log.action}</td>\r\n                 <td>${log.LogType || log.type}</td>\r\n             `;\r\n-        });\r\n-    } catch (e) {\r\n-        displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n-    }\r\n+    });\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n+  }\r\n }\r\n \r\n // ================================\r\n-// INITIAL LOAD\r\n-document.addEventListener('DOMContentLoaded',()=> {\r\n-    loadPageIntoMainContent('sections/dashboardoverview.html');\r\n+// INITIAL LOAD (wire up once DOM is ready)\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+  // wire event handlers for dynamic loading\r\n+  wireSidebarButtons();\r\n+\r\n+  // load default page (dashboard overview)\r\n+  loadPageIntoMainContent(\"sections/dashboardoverview.html\");\r\n });\r\n \r\n-function attachMembershipListeners(){\r\n-    document.getElementById(\"syncBtn\")?.addEventListener(\"click\",handleSyncClick);\r\n-    document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", ()=>{\r\n-        document.getElementById('requestIdFilter').value=''; \r\n-        document.getElementById('residentFilter').value='';\r\n-        displayMessage(\"Filters cleared.\", false);\r\n+// ================================\r\n+// MISC: membership page listeners\r\n+function attachMembershipListeners() {\r\n+  // Sync button\r\n+  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+\r\n+  // Clear filters\r\n+  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+    const rid = document.getElementById(\"requestIdFilter\");\r\n+    const rf = document.getElementById(\"residentFilter\");\r\n+    if (rid) rid.value = \"\";\r\n+    if (rf) rf.value = \"\";\r\n+    displayMessage(\"Filters cleared.\", false);\r\n+  });\r\n+\r\n+  // membership form submission if present\r\n+  const membershipForm = document.getElementById(\"membershipForm\");\r\n+  if (membershipForm) {\r\n+    membershipForm.removeEventListener(\"submit\", membershipFormSubmitHandler);\r\n+    membershipForm.addEventListener(\"submit\", membershipFormSubmitHandler);\r\n+  }\r\n+}\r\n+\r\n+async function membershipFormSubmitHandler(e) {\r\n+  e.preventDefault();\r\n+  const form = e.target;\r\n+  const submitBtn = form.querySelector('button[type=\"submit\"]');\r\n+  if (submitBtn) submitBtn.disabled = true;\r\n+\r\n+  // gather form data\r\n+  const fd = new FormData(form);\r\n+  const payload = Object.fromEntries(fd.entries());\r\n+\r\n+  try {\r\n+    const resp = await fetch(`${API_HOST}/api/admin/requests`, {\r\n+      method: \"POST\",\r\n+      headers: getAuthHeaders(),\r\n+      body: JSON.stringify(payload),\r\n     });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Submit failed\");\r\n+    displayMessage(\"Membership request submitted.\", false);\r\n+\r\n+    // clear form or update UI as needed\r\n+    form.reset();\r\n+  } catch (err) {\r\n+    displayMessage(`Failed to submit: ${err.message}`, true);\r\n+  } finally {\r\n+    if (submitBtn) submitBtn.disabled = false;\r\n+  }\r\n }\r\n-// Example sidebar loader\r\n-async function loadSidebarPage(url, containerSelector) {\r\n-    const container = document.querySelector(containerSelector);\r\n-    const res = await fetch(url);\r\n-    const html = await res.text();\r\n-    container.innerHTML = html;\r\n \r\n-    // ✅ After injecting HTML, initialize JS\r\n-    const token = localStorage.getItem('accessToken');\r\n-    loadCourts('#courtDropdown', token); // call the function to populate courts\r\n-}\r\n+// ================================\r\n+// Export or expose functions for debugging (optional)\r\n+window._app = {\r\n+  loadCourts,\r\n+  loadPendingRequests,\r\n+  loadApprovedResidents,\r\n+  loadPageIntoMainContent,\r\n+  loadDashboardSummary,\r\n+  loadAccessChart,\r\n+};\r\n"
                },
                {
                    "date": 1763986610820,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -90,59 +90,55 @@\n };\r\n \r\n // ================================\r\n // COURTS (loadCourts) - uses fetch so no external deps\r\n-async function loadCourts(dropdownSelector = \"#courtDropdown\") {\r\n-  try {\r\n-    const dropdown = document.querySelector(dropdownSelector);\r\n+async function loadCourts(selector) {\r\n+    console.log(\"➡️ loadCourts() CALLED\");\r\n+\r\n+    const token = localStorage.getItem(\"accessToken\");\r\n+    if (!token) {\r\n+        console.error(\"❌ No token found in localStorage\");\r\n+        return;\r\n+    }\r\n+\r\n+    const dropdown = document.querySelector(selector);\r\n     if (!dropdown) {\r\n-      console.warn(\"loadCourts: dropdown element not found:\", dropdownSelector);\r\n-      return;\r\n+        console.error(\"❌ Court dropdown element NOT found in DOM:\", selector);\r\n+        return;\r\n     }\r\n \r\n-    // show a loading option\r\n-    dropdown.innerHTML = `<option value=\"\">Loading courts...</option>`;\r\n+    try {\r\n+        console.log(\"➡️ Fetching courts from backend...\");\r\n \r\n-    const res = await fetch(ENDPOINTS.COURTS, {\r\n-      method: \"GET\",\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n+        const response = await fetch(`${API_HOST}/api/courts/all`, {\r\n+            headers: {\r\n+                \"Authorization\": `Bearer ${token}`\r\n+            }\r\n+        });\r\n \r\n-    if (!res.ok) {\r\n-      // if unauthorized, maybe token expired\r\n-      if (res.status === 401 || res.status === 403) {\r\n-        console.warn(\"loadCourts: unauthorized, redirecting to login\");\r\n-        // you may want to show a message instead of redirecting automatically\r\n-        // window.location.href = '/login.html';\r\n-      }\r\n-      throw new Error(`Failed to fetch courts (${res.status})`);\r\n-    }\r\n+        console.log(\"➡️ Response status:\", response.status);\r\n \r\n-    const courts = await res.json();\r\n+        if (!response.ok) {\r\n+            throw new Error(\"Backend returned error \" + response.status);\r\n+        }\r\n \r\n-    // populate dropdown\r\n-    dropdown.innerHTML = `<option value=\"\">Select a court</option>`;\r\n-    if (!Array.isArray(courts) || courts.length === 0) {\r\n-      dropdown.innerHTML = `<option value=\"\">No courts available</option>`;\r\n-      return;\r\n+        const courts = await response.json();\r\n+\r\n+        console.log(\"➡️ Courts received:\", courts);\r\n+\r\n+        dropdown.innerHTML = `<option value=\"\">Select Court</option>`;\r\n+        courts.forEach(court => {\r\n+            dropdown.innerHTML += `<option value=\"${court.CourtID}\">${court.CourtName}</option>`;\r\n+        });\r\n+\r\n+        console.log(\"✅ Courts loaded successfully\");\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"❌ Failed to load courts:\", error);\r\n     }\r\n-\r\n-    courts.forEach((c) => {\r\n-      const option = document.createElement(\"option\");\r\n-      // support both shapes: { CourtName } or { courtName } or plain string\r\n-      const name = c?.CourtName ?? c?.courtName ?? (typeof c === \"string\" ? c : \"\");\r\n-      option.value = name;\r\n-      option.textContent = name;\r\n-      dropdown.appendChild(option);\r\n-    });\r\n-    console.log(\"loadCourts: populated\", courts.length, \"courts\");\r\n-  } catch (err) {\r\n-    console.error(\"loadCourts error:\", err);\r\n-    const dropdown = document.querySelector(dropdownSelector);\r\n-    if (dropdown) dropdown.innerHTML = `<option value=\"\">Failed to load courts</option>`;\r\n-  }\r\n }\r\n \r\n+\r\n // ================================\r\n // MEMBERSHIP FUNCTIONS (approve/reject/delete/sync)\r\n async function handleApproveClick(requestId) {\r\n   safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n"
                },
                {
                    "date": 1763986639610,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -136,9 +136,8 @@\n         console.error(\"❌ Failed to load courts:\", error);\r\n     }\r\n }\r\n \r\n-\r\n // ================================\r\n // MEMBERSHIP FUNCTIONS (approve/reject/delete/sync)\r\n async function handleApproveClick(requestId) {\r\n   safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n"
                },
                {
                    "date": 1763987611636,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,9 +108,9 @@\n \r\n     try {\r\n         console.log(\"➡️ Fetching courts from backend...\");\r\n \r\n-        const response = await fetch(`${API_HOST}/api/courts/all`, {\r\n+        const response = await fetch(`${API_HOST}/api/courts/`, {\r\n             headers: {\r\n                 \"Authorization\": `Bearer ${token}`\r\n             }\r\n         });\r\n"
                },
                {
                    "date": 1763987638560,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -108,9 +108,9 @@\n \r\n     try {\r\n         console.log(\"➡️ Fetching courts from backend...\");\r\n \r\n-        const response = await fetch(`${API_HOST}/api/courts/`, {\r\n+        const response = await fetch(`${API_HOST}/api/courts/all`, {\r\n             headers: {\r\n                 \"Authorization\": `Bearer ${token}`\r\n             }\r\n         });\r\n"
                },
                {
                    "date": 1764014943661,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,493 +1,112 @@\n-// =========================================================\r\n-// unifiedDashboard.js - Admin & Security Dashboard Loader\r\n-// =========================================================\r\n+// ================================\r\n+// 🔑 ENVIRONMENT & AUTH SETUP\r\n+// ================================\r\n+const API_HOST = \"http://localhost:4050\"; \r\n+const token = localStorage.getItem(\"accessToken\");\r\n \r\n-// 🔑 ENVIRONMENT & AUTH SETUP\r\n-const API_HOST = \"http://localhost:4050\";\r\n-const userRole = localStorage.getItem(\"userRole\"); // \"admin\" or \"security\"\r\n-if (!localStorage.getItem(\"accessToken\")) {\r\n-  // if no token redirect to login\r\n-  window.location.href = \"/login.html\";\r\n+if (!token) {\r\n+    window.location.href = \"/login.html\";\r\n }\r\n \r\n // ================================\r\n-// ENDPOINTS\r\n+// 📌 CORRECT ADMIN API ENDPOINTS\r\n+// ================================\r\n const ENDPOINTS = {\r\n-  DASHBOARD_SUMMARY:\r\n-    userRole === \"admin\"\r\n-      ? `${API_HOST}/api/admin/summary`\r\n-      : `${API_HOST}/api/residents/dashboard/summary`,\r\n-  DASHBOARD_CHART:\r\n-    userRole === \"admin\"\r\n-      ? `${API_HOST}/api/admin/accesschart`\r\n-      : `${API_HOST}/api/residents/admin/accesschart`,\r\n-  SYNC: `${API_HOST}/api/admin/sync`,\r\n-  PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n-  APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n-  APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n-  REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n-  DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n-  PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n-  ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n-  VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n-  PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n-  REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n-  MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n-  MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n-  ACCESS_LOGS:\r\n-    userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n-  COURTS: `${API_HOST}/api/courts`,\r\n+    dashboardSummary: `${API_HOST}/api/admin/dashboard/summary`,\r\n+    accessChart: `${API_HOST}/api/admin/dashboard/accesschart`,\r\n+    approvedResidents: `${API_HOST}/api/admin/residents/approved`,\r\n+    pendingRequests: `${API_HOST}/api/admin/residents/pending`\r\n };\r\n \r\n // ================================\r\n-// AUTH & LOGOUT\r\n-document.addEventListener(\"click\", (e) => {\r\n-  // delegated logout (works even if element loaded later)\r\n-  if (e.target && e.target.id === \"logoutBtn\") {\r\n-    localStorage.removeItem(\"accessToken\");\r\n-    localStorage.removeItem(\"userRole\");\r\n-    window.location.href = \"/login.html\";\r\n-  }\r\n-});\r\n-\r\n+// 📌 LOAD DASHBOARD SUMMARY\r\n // ================================\r\n-// UTILITIES\r\n-function getAuthHeaders() {\r\n-  const token = localStorage.getItem(\"accessToken\");\r\n-  const headers = { \"Content-Type\": \"application/json\" };\r\n-  if (token) headers[\"Authorization\"] = `Bearer ${token}`;\r\n-  return headers;\r\n-}\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.dashboardSummary, {\r\n+            headers: { Authorization: `Bearer ${token}` }\r\n+        });\r\n \r\n-function displayMessage(message, isError = false) {\r\n-  const msgElement = document.getElementById(\"msg\");\r\n-  if (!msgElement) {\r\n-    console[isError ? \"error\" : \"log\"](message);\r\n-    return;\r\n-  }\r\n-  msgElement.textContent = message;\r\n-  msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n-    isError ? \"bg-red-100 text-red-800\" : \"bg-green-100 text-green-800\"\r\n-  }`;\r\n-  setTimeout(() => {\r\n-    msgElement.textContent = \"\";\r\n-    msgElement.className = \"text-sm text-gray-700 mb-3\";\r\n-  }, 5000);\r\n-}\r\n+        if (!res.ok) throw new Error(\"Failed to fetch summary\");\r\n \r\n-function formatTimestamp(timestamp) {\r\n-  if (!timestamp) return \"N/A\";\r\n-  try {\r\n-    return new Date(timestamp).toLocaleString();\r\n-  } catch (e) {\r\n-    return \"N/A\";\r\n-  }\r\n-}\r\n+        const data = await res.json();\r\n \r\n-const safeUpdate = (id, value, suffix = \"\") => {\r\n-  const el = document.getElementById(id);\r\n-  if (el) el.textContent = value + suffix;\r\n-};\r\n+        document.getElementById(\"totalResidents\").textContent = data.TotalResidents || 0;\r\n+        document.getElementById(\"totalVisitors\").textContent = data.TotalVisitors || 0;\r\n+        document.getElementById(\"totalAccessLogs\").textContent = data.TotalAccessLogs || 0;\r\n+        document.getElementById(\"pendingRequests\").textContent = data.PendingRequests || 0;\r\n \r\n-// ================================\r\n-// COURTS (loadCourts) - uses fetch so no external deps\r\n-async function loadCourts(selector) {\r\n-    console.log(\"➡️ loadCourts() CALLED\");\r\n-\r\n-    const token = localStorage.getItem(\"accessToken\");\r\n-    if (!token) {\r\n-        console.error(\"❌ No token found in localStorage\");\r\n-        return;\r\n+    } catch (err) {\r\n+        console.error(\"Summary Load Error:\", err);\r\n     }\r\n+}\r\n \r\n-    const dropdown = document.querySelector(selector);\r\n-    if (!dropdown) {\r\n-        console.error(\"❌ Court dropdown element NOT found in DOM:\", selector);\r\n-        return;\r\n-    }\r\n-\r\n+// ================================\r\n+// 📌 LOAD ACCESS CHART\r\n+// ================================\r\n+async function loadAccessChart() {\r\n     try {\r\n-        console.log(\"➡️ Fetching courts from backend...\");\r\n-\r\n-        const response = await fetch(`${API_HOST}/api/courts/all`, {\r\n-            headers: {\r\n-                \"Authorization\": `Bearer ${token}`\r\n-            }\r\n+        const res = await fetch(ENDPOINTS.accessChart, {\r\n+            headers: { Authorization: `Bearer ${token}` }\r\n         });\r\n \r\n-        console.log(\"➡️ Response status:\", response.status);\r\n+        if (!res.ok) throw new Error(\"Failed to fetch chart\");\r\n \r\n-        if (!response.ok) {\r\n-            throw new Error(\"Backend returned error \" + response.status);\r\n-        }\r\n+        const data = await res.json();\r\n \r\n-        const courts = await response.json();\r\n+        const ctx = document.getElementById(\"accessChartCanvas\").getContext(\"2d\");\r\n \r\n-        console.log(\"➡️ Courts received:\", courts);\r\n-\r\n-        dropdown.innerHTML = `<option value=\"\">Select Court</option>`;\r\n-        courts.forEach(court => {\r\n-            dropdown.innerHTML += `<option value=\"${court.CourtID}\">${court.CourtName}</option>`;\r\n+        new Chart(ctx, {\r\n+            type: \"line\",\r\n+            data: {\r\n+                labels: data.map(row => row.Month),\r\n+                datasets: [{\r\n+                    label: \"Monthly Access Logs\",\r\n+                    data: data.map(row => row.TotalAccess),\r\n+                    borderWidth: 2\r\n+                }]\r\n+            }\r\n         });\r\n \r\n-        console.log(\"✅ Courts loaded successfully\");\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"❌ Failed to load courts:\", error);\r\n+    } catch (err) {\r\n+        console.error(\"Access Chart Error:\", err);\r\n     }\r\n }\r\n \r\n // ================================\r\n-// MEMBERSHIP FUNCTIONS (approve/reject/delete/sync)\r\n-async function handleApproveClick(requestId) {\r\n-  safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n-      method: \"PUT\",\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n-    displayMessage(`Successfully approved ${requestId}`, false);\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    displayMessage(`Approval failed: ${e.message}`, true);\r\n-  }\r\n-}\r\n+// 📌 LOAD PAGE SECTIONS\r\n+// ================================\r\n+async function loadPageIntoMainContent(page) {\r\n+    const container = document.getElementById(\"main-content\");\r\n \r\n-async function handleRejectClick(requestId) {\r\n-  if (!confirm(`Reject request ${requestId}?`)) return;\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n-      method: \"PUT\",\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Rejection failed`);\r\n-    displayMessage(`Successfully rejected ${requestId}`, false);\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    displayMessage(`Rejection failed: ${e.message}`, true);\r\n-  }\r\n-}\r\n+    const response = await fetch(page);\r\n+    const html = await response.text();\r\n+    container.innerHTML = html;\r\n \r\n-async function handleDeleteClick(requestId) {\r\n-  if (!confirm(`Delete request ${requestId}?`)) return;\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n-      method: \"DELETE\",\r\n-      headers: getAuthHeaders(),\r\n-    });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Deletion failed`);\r\n-    displayMessage(`Deleted request ${requestId}`, false);\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-  } catch (e) {\r\n-    displayMessage(`Deletion failed: ${e.message}`, true);\r\n-  }\r\n-}\r\n+    if (page.includes(\"dashboard\")) {\r\n+        await loadDashboardSummary();\r\n+        await loadAccessChart();\r\n+    }\r\n \r\n-async function handleSyncClick(event) {\r\n-  const btn = event.currentTarget;\r\n-  const originalText = btn.textContent,\r\n-    originalClass = btn.className;\r\n-  btn.disabled = true;\r\n-  btn.textContent = \"Syncing...\";\r\n-  btn.className = \"bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse\";\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.SYNC, { method: \"POST\", headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Sync failed\");\r\n-    btn.textContent = \"Sync Complete!\";\r\n-    btn.className = \"bg-green-600 text-white px-4 py-2 rounded-lg\";\r\n-    displayMessage(\"Data synchronization successful\", false);\r\n-    await loadPendingRequests();\r\n-    await loadApprovedResidents();\r\n-  } catch (err) {\r\n-    btn.textContent = \"Sync Failed ❌\";\r\n-    btn.className = \"bg-red-600 text-white px-4 py-2 rounded-lg\";\r\n-    displayMessage(`Sync failed: ${err.message}`, true);\r\n-  } finally {\r\n-    setTimeout(() => {\r\n-      btn.disabled = false;\r\n-      btn.textContent = originalText;\r\n-      btn.className = originalClass;\r\n-    }, 3000);\r\n-  }\r\n+    if (page.includes(\"manage-residents\")) {\r\n+        loadApprovedResidents();\r\n+        loadPendingRequests();\r\n+    }\r\n }\r\n \r\n // ================================\r\n-// LOAD DATA FUNCTIONS\r\n-async function loadPendingRequests() {\r\n-  const tbody = document.getElementById(\"membershipTableBody\");\r\n-  if (!tbody) return;\r\n-  tbody.innerHTML = '<tr><td colspan=\"11\">Loading...</td></tr>';\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch pending requests\");\r\n-    const requests = await resp.json();\r\n-    tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : \"\";\r\n-    requests.forEach((r) => {\r\n-      const row = tbody.insertRow();\r\n-      row.innerHTML = `\r\n-                <td>${r.RequestID || r.id || \"N/A\"}</td>\r\n-                <td>${r.ResidentName || \"N/A\"}</td>\r\n-                <td>${r.NationalID || \"N/A\"}</td>\r\n-                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n-                <td>${r.Email || \"N/A\"}</td>\r\n-                <td>${r.HouseNumber || \"N/A\"}</td>\r\n-                <td>${r.CourtName || \"N/A\"}</td>\r\n-                <td>${r.RoleName || \"N/A\"}</td>\r\n-                <td>${r.Status || \"Pending\"}</td>\r\n-                <td>${formatTimestamp(r.RequestedAt || r.requestedAt)}</td>\r\n-                <td class=\"flex space-x-1\">\r\n-                    <button class=\"approve-btn\" data-id=\"${r.RequestID || r.id}\">Approve</button>\r\n-                    <button class=\"reject-btn\" data-id=\"${r.RequestID || r.id}\">Reject</button>\r\n-                    <button class=\"delete-btn\" data-id=\"${r.RequestID || r.id}\">Delete</button>\r\n-                </td>\r\n-            `;\r\n-    });\r\n-    tbody.querySelectorAll(\".approve-btn\").forEach((b) =>\r\n-      b.addEventListener(\"click\", (e) => handleApproveClick(e.target.dataset.id))\r\n-    );\r\n-    tbody.querySelectorAll(\".reject-btn\").forEach((b) =>\r\n-      b.addEventListener(\"click\", (e) => handleRejectClick(e.target.dataset.id))\r\n-    );\r\n-    tbody.querySelectorAll(\".delete-btn\").forEach((b) =>\r\n-      b.addEventListener(\"click\", (e) => handleDeleteClick(e.target.dataset.id))\r\n-    );\r\n-  } catch (e) {\r\n-    displayMessage(`Failed to load pending requests: ${e.message}`, true);\r\n-  }\r\n-}\r\n-\r\n-async function loadApprovedResidents() {\r\n-  const tbody = document.getElementById(\"residentsTableBody\");\r\n-  if (!tbody) return;\r\n-  tbody.innerHTML = '<tr><td colspan=\"8\">Loading...</td></tr>';\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch approved residents\");\r\n-    const residents = await resp.json();\r\n-    tbody.innerHTML = residents.length === 0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : \"\";\r\n-    residents.forEach((r) => {\r\n-      const row = tbody.insertRow();\r\n-      row.innerHTML = `\r\n-                <td>${r.ResidentName || \"N/A\"}</td>\r\n-                <td>${r.NationalID || \"N/A\"}</td>\r\n-                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n-                <td>${r.Email || \"N/A\"}</td>\r\n-                <td>${r.HouseNumber || \"N/A\"}</td>\r\n-                <td>${r.CourtName || \"N/A\"}</td>\r\n-                <td>${r.RoleName || \"N/A\"}</td>\r\n-            `;\r\n-    });\r\n-  } catch (e) {\r\n-    displayMessage(`Failed to load approved residents: ${e.message}`, true);\r\n-  }\r\n-}\r\n-\r\n+// 📌 CLICK SIDEBAR NAVIGATION\r\n // ================================\r\n-// DASHBOARD FUNCTIONS\r\n-async function loadDashboardSummary() {\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(res.statusText);\r\n-    const d = await res.json();\r\n-    safeUpdate(\"totalResidents\", d.residents || 0);\r\n-    safeUpdate(\"pendingPayments\", d.pendingPayments || 0);\r\n-    safeUpdate(\"compliancePct\", d.compliance || 0, \"%\");\r\n-    safeUpdate(\"overrideCount\", d.overrides || 0);\r\n-  } catch (e) {\r\n-    console.error(\"loadDashboardSummary error:\", e);\r\n-  }\r\n-}\r\n-\r\n-async function loadAccessChart() {\r\n-  try {\r\n-    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, { headers: getAuthHeaders() });\r\n-    if (!res.ok) throw new Error(res.statusText);\r\n-    const data = await res.json();\r\n-    const el = document.getElementById(\"accessChart\");\r\n-    if (!el) return;\r\n-    const ctx = el.getContext(\"2d\");\r\n-    if (window.accessChartInstance) window.accessChartInstance.destroy();\r\n-    window.accessChartInstance = new Chart(ctx, {\r\n-      type: \"line\",\r\n-      data: {\r\n-        labels: data.days || [],\r\n-        datasets: [\r\n-          {\r\n-            label: \"Access Attempts\",\r\n-            data: data.counts || [],\r\n-            borderColor: \"#2563eb\",\r\n-            backgroundColor: \"rgba(37,99,235,0.2)\",\r\n-            fill: true,\r\n-          },\r\n-        ],\r\n-      },\r\n-      options: { responsive: true, maintainAspectRatio: false },\r\n+document.querySelectorAll(\".sidebar-link\").forEach(link => {\r\n+    link.addEventListener(\"click\", () => {\r\n+        const page = link.getAttribute(\"data-page\");\r\n+        loadPageIntoMainContent(page);\r\n     });\r\n-  } catch (e) {\r\n-    console.error(\"loadAccessChart error:\", e);\r\n-  }\r\n-}\r\n+});\r\n \r\n // ================================\r\n-// SIDEBAR & PAGE LOADING\r\n-// cache selectors after DOM ready\r\n-let sidebarButtons = [];\r\n-let mainContent = null;\r\n-\r\n-async function loadPageIntoMainContent(url) {\r\n-  if (!mainContent) {\r\n-    console.warn(\"mainContent container not found\");\r\n-    return;\r\n-  }\r\n-\r\n-  mainContent.innerHTML = '<div>Loading...</div>';\r\n-  try {\r\n-    const res = await fetch(url);\r\n-    if (!res.ok) throw new Error(res.status);\r\n-    const html = await res.text();\r\n-    mainContent.innerHTML = html;\r\n-\r\n-    // Page-specific loaders\r\n-    if (url.includes(\"dashboardoverview.html\")) {\r\n-      await loadDashboardSummary();\r\n-      await loadAccessChart();\r\n-    } else if (url.includes(\"membership.html\")) {\r\n-      // attach any click handlers in membership page\r\n-      attachMembershipListeners();\r\n-\r\n-      // populate courts AFTER the HTML is injected\r\n-      await loadCourts(\"#courtDropdown\");\r\n-\r\n-      // then load pending requests table\r\n-      await loadPendingRequests();\r\n-    } else if (url.includes(\"membershiprecords.html\")) {\r\n-      attachMembershipListeners();\r\n-      await loadApprovedResidents();\r\n-    } else if (url.includes(\"accesslogs.html\")) {\r\n-      await loadAccessLogs();\r\n-    }\r\n-  } catch (e) {\r\n-    console.error(\"loadPageIntoMainContent error:\", e);\r\n-    mainContent.innerHTML = `<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n-  }\r\n-}\r\n-\r\n-// Sidebar click handler - will be wired in DOMContentLoaded\r\n-function wireSidebarButtons() {\r\n-  sidebarButtons = Array.from(document.querySelectorAll(\".sidebarBtn\"));\r\n-  mainContent = document.getElementById(\"main-content-area\");\r\n-\r\n-  if (!mainContent) console.warn(\"#main-content-area not found\");\r\n-\r\n-  sidebarButtons.forEach((btn) => {\r\n-    btn.addEventListener(\"click\", (ev) => {\r\n-      // visual active state\r\n-      sidebarButtons.forEach((b) => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n-      btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n-\r\n-      const page = btn.dataset.target;\r\n-      if (page) loadPageIntoMainContent(page);\r\n-    });\r\n-  });\r\n-}\r\n-\r\n+// 📌 INITIAL PAGE LOAD\r\n // ================================\r\n-// ACCESS LOGS\r\n-async function loadAccessLogs() {\r\n-  const tbody = document.getElementById(\"logsTableBody\");\r\n-  if (!tbody) return;\r\n-  tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n-  try {\r\n-    const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n-    if (!resp.ok) throw new Error(\"Failed to fetch access logs\");\r\n-    const logs = await resp.json();\r\n-    tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : \"\";\r\n-    logs.forEach((log) => {\r\n-      const row = tbody.insertRow();\r\n-      row.innerHTML = `\r\n-                <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n-                <td>${log.UserId || log.userId}</td>\r\n-                <td>${log.Action || log.action}</td>\r\n-                <td>${log.LogType || log.type}</td>\r\n-            `;\r\n-    });\r\n-  } catch (e) {\r\n-    displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n-  }\r\n-}\r\n-\r\n-// ================================\r\n-// INITIAL LOAD (wire up once DOM is ready)\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n-  // wire event handlers for dynamic loading\r\n-  wireSidebarButtons();\r\n-\r\n-  // load default page (dashboard overview)\r\n-  loadPageIntoMainContent(\"sections/dashboardoverview.html\");\r\n+    loadPageIntoMainContent(\"pages/dashboard.html\");\r\n });\r\n-\r\n-// ================================\r\n-// MISC: membership page listeners\r\n-function attachMembershipListeners() {\r\n-  // Sync button\r\n-  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n-\r\n-  // Clear filters\r\n-  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n-    const rid = document.getElementById(\"requestIdFilter\");\r\n-    const rf = document.getElementById(\"residentFilter\");\r\n-    if (rid) rid.value = \"\";\r\n-    if (rf) rf.value = \"\";\r\n-    displayMessage(\"Filters cleared.\", false);\r\n-  });\r\n-\r\n-  // membership form submission if present\r\n-  const membershipForm = document.getElementById(\"membershipForm\");\r\n-  if (membershipForm) {\r\n-    membershipForm.removeEventListener(\"submit\", membershipFormSubmitHandler);\r\n-    membershipForm.addEventListener(\"submit\", membershipFormSubmitHandler);\r\n-  }\r\n-}\r\n-\r\n-async function membershipFormSubmitHandler(e) {\r\n-  e.preventDefault();\r\n-  const form = e.target;\r\n-  const submitBtn = form.querySelector('button[type=\"submit\"]');\r\n-  if (submitBtn) submitBtn.disabled = true;\r\n-\r\n-  // gather form data\r\n-  const fd = new FormData(form);\r\n-  const payload = Object.fromEntries(fd.entries());\r\n-\r\n-  try {\r\n-    const resp = await fetch(`${API_HOST}/api/admin/requests`, {\r\n-      method: \"POST\",\r\n-      headers: getAuthHeaders(),\r\n-      body: JSON.stringify(payload),\r\n-    });\r\n-    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Submit failed\");\r\n-    displayMessage(\"Membership request submitted.\", false);\r\n-\r\n-    // clear form or update UI as needed\r\n-    form.reset();\r\n-  } catch (err) {\r\n-    displayMessage(`Failed to submit: ${err.message}`, true);\r\n-  } finally {\r\n-    if (submitBtn) submitBtn.disabled = false;\r\n-  }\r\n-}\r\n-\r\n-// ================================\r\n-// Export or expose functions for debugging (optional)\r\n-window._app = {\r\n-  loadCourts,\r\n-  loadPendingRequests,\r\n-  loadApprovedResidents,\r\n-  loadPageIntoMainContent,\r\n-  loadDashboardSummary,\r\n-  loadAccessChart,\r\n-};\r\n"
                },
                {
                    "date": 1764014959059,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,112 +1,493 @@\n-// ================================\r\n+// =========================================================\r\n+// unifiedDashboard.js - Admin & Security Dashboard Loader\r\n+// =========================================================\r\n+\r\n // 🔑 ENVIRONMENT & AUTH SETUP\r\n-// ================================\r\n-const API_HOST = \"http://localhost:4050\"; \r\n-const token = localStorage.getItem(\"accessToken\");\r\n-\r\n-if (!token) {\r\n-    window.location.href = \"/login.html\";\r\n+const API_HOST = \"http://localhost:4050\";\r\n+const userRole = localStorage.getItem(\"userRole\"); // \"admin\" or \"security\"\r\n+if (!localStorage.getItem(\"accessToken\")) {\r\n+  // if no token redirect to login\r\n+  window.location.href = \"/login.html\";\r\n }\r\n \r\n // ================================\r\n-// 📌 CORRECT ADMIN API ENDPOINTS\r\n-// ================================\r\n+// ENDPOINTS\r\n const ENDPOINTS = {\r\n-    dashboardSummary: `${API_HOST}/api/admin/dashboard/summary`,\r\n-    accessChart: `${API_HOST}/api/admin/dashboard/accesschart`,\r\n-    approvedResidents: `${API_HOST}/api/admin/residents/approved`,\r\n-    pendingRequests: `${API_HOST}/api/admin/residents/pending`\r\n+  DASHBOARD_SUMMARY:\r\n+    userRole === \"admin\"\r\n+      ? `${API_HOST}/api/admin/summary`\r\n+      : `${API_HOST}/api/residents/dashboard/summary`,\r\n+  DASHBOARD_CHART:\r\n+    userRole === \"admin\"\r\n+      ? `${API_HOST}/api/admin/accesschart`\r\n+      : `${API_HOST}/api/residents/admin/accesschart`,\r\n+  SYNC: `${API_HOST}/api/admin/sync`,\r\n+  PENDING_REQUESTS: `${API_HOST}/api/admin/requests/pending`,\r\n+  APPROVED_RESIDENTS: `${API_HOST}/api/admin/residents/approved`,\r\n+  APPROVE_REQUEST: (id) => `${API_HOST}/api/admin/approve/${id}`,\r\n+  REJECT_REQUEST: (id) => `${API_HOST}/api/admin/reject/${id}`,\r\n+  DELETE_REQUEST: (id) => `${API_HOST}/api/admin/delete/${id}`,\r\n+  PAYMENTS_RECORDS: `${API_HOST}/api/admin/payments/records`,\r\n+  ALL_RESIDENTS: `${API_HOST}/api/admin/residents/all`,\r\n+  VISITOR_OVERVIEW: `${API_HOST}/api/admin/visitors/overview`,\r\n+  PENDING_VISITOR_APPROVALS: `${API_HOST}/api/admin/visitors/pending`,\r\n+  REPORTS_DATA: `${API_HOST}/api/admin/reports`,\r\n+  MANUAL_OVERRIDES_LOGS: `${API_HOST}/api/admin/override/logs`,\r\n+  MANUAL_OVERRIDE_ACTION: `${API_HOST}/api/admin/override/action`,\r\n+  ACCESS_LOGS:\r\n+    userRole === \"admin\" ? `${API_HOST}/api/admin/accesslogs` : `${API_HOST}/api/accesslogs`,\r\n+  COURTS: `${API_HOST}/api/courts`,\r\n };\r\n \r\n // ================================\r\n-// 📌 LOAD DASHBOARD SUMMARY\r\n+// AUTH & LOGOUT\r\n+document.addEventListener(\"click\", (e) => {\r\n+  // delegated logout (works even if element loaded later)\r\n+  if (e.target && e.target.id === \"logoutBtn\") {\r\n+    localStorage.removeItem(\"accessToken\");\r\n+    localStorage.removeItem(\"userRole\");\r\n+    window.location.href = \"/login.html\";\r\n+  }\r\n+});\r\n+\r\n // ================================\r\n-async function loadDashboardSummary() {\r\n-    try {\r\n-        const res = await fetch(ENDPOINTS.dashboardSummary, {\r\n-            headers: { Authorization: `Bearer ${token}` }\r\n-        });\r\n+// UTILITIES\r\n+function getAuthHeaders() {\r\n+  const token = localStorage.getItem(\"accessToken\");\r\n+  const headers = { \"Content-Type\": \"application/json\" };\r\n+  if (token) headers[\"Authorization\"] = `Bearer ${token}`;\r\n+  return headers;\r\n+}\r\n \r\n-        if (!res.ok) throw new Error(\"Failed to fetch summary\");\r\n+function displayMessage(message, isError = false) {\r\n+  const msgElement = document.getElementById(\"msg\");\r\n+  if (!msgElement) {\r\n+    console[isError ? \"error\" : \"log\"](message);\r\n+    return;\r\n+  }\r\n+  msgElement.textContent = message;\r\n+  msgElement.className = `p-3 rounded-lg text-sm font-semibold mb-3 ${\r\n+    isError ? \"bg-red-100 text-red-800\" : \"bg-green-100 text-green-800\"\r\n+  }`;\r\n+  setTimeout(() => {\r\n+    msgElement.textContent = \"\";\r\n+    msgElement.className = \"text-sm text-gray-700 mb-3\";\r\n+  }, 5000);\r\n+}\r\n \r\n-        const data = await res.json();\r\n+function formatTimestamp(timestamp) {\r\n+  if (!timestamp) return \"N/A\";\r\n+  try {\r\n+    return new Date(timestamp).toLocaleString();\r\n+  } catch (e) {\r\n+    return \"N/A\";\r\n+  }\r\n+}\r\n \r\n-        document.getElementById(\"totalResidents\").textContent = data.TotalResidents || 0;\r\n-        document.getElementById(\"totalVisitors\").textContent = data.TotalVisitors || 0;\r\n-        document.getElementById(\"totalAccessLogs\").textContent = data.TotalAccessLogs || 0;\r\n-        document.getElementById(\"pendingRequests\").textContent = data.PendingRequests || 0;\r\n+const safeUpdate = (id, value, suffix = \"\") => {\r\n+  const el = document.getElementById(id);\r\n+  if (el) el.textContent = value + suffix;\r\n+};\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Summary Load Error:\", err);\r\n+// ================================\r\n+// COURTS (loadCourts) - uses fetch so no external deps\r\n+async function loadCourts(selector) {\r\n+    console.log(\"➡️ loadCourts() CALLED\");\r\n+\r\n+    const token = localStorage.getItem(\"accessToken\");\r\n+    if (!token) {\r\n+        console.error(\"❌ No token found in localStorage\");\r\n+        return;\r\n     }\r\n-}\r\n \r\n-// ================================\r\n-// 📌 LOAD ACCESS CHART\r\n-// ================================\r\n-async function loadAccessChart() {\r\n+    const dropdown = document.querySelector(selector);\r\n+    if (!dropdown) {\r\n+        console.error(\"❌ Court dropdown element NOT found in DOM:\", selector);\r\n+        return;\r\n+    }\r\n+\r\n     try {\r\n-        const res = await fetch(ENDPOINTS.accessChart, {\r\n-            headers: { Authorization: `Bearer ${token}` }\r\n+        console.log(\"➡️ Fetching courts from backend...\");\r\n+\r\n+        const response = await fetch(`${API_HOST}/api/courts/all`, {\r\n+            headers: {\r\n+                \"Authorization\": `Bearer ${token}`\r\n+            }\r\n         });\r\n \r\n-        if (!res.ok) throw new Error(\"Failed to fetch chart\");\r\n+        console.log(\"➡️ Response status:\", response.status);\r\n \r\n-        const data = await res.json();\r\n+        if (!response.ok) {\r\n+            throw new Error(\"Backend returned error \" + response.status);\r\n+        }\r\n \r\n-        const ctx = document.getElementById(\"accessChartCanvas\").getContext(\"2d\");\r\n+        const courts = await response.json();\r\n \r\n-        new Chart(ctx, {\r\n-            type: \"line\",\r\n-            data: {\r\n-                labels: data.map(row => row.Month),\r\n-                datasets: [{\r\n-                    label: \"Monthly Access Logs\",\r\n-                    data: data.map(row => row.TotalAccess),\r\n-                    borderWidth: 2\r\n-                }]\r\n-            }\r\n+        console.log(\"➡️ Courts received:\", courts);\r\n+\r\n+        dropdown.innerHTML = `<option value=\"\">Select Court</option>`;\r\n+        courts.forEach(court => {\r\n+            dropdown.innerHTML += `<option value=\"${court.CourtID}\">${court.CourtName}</option>`;\r\n         });\r\n \r\n-    } catch (err) {\r\n-        console.error(\"Access Chart Error:\", err);\r\n+        console.log(\"✅ Courts loaded successfully\");\r\n+\r\n+    } catch (error) {\r\n+        console.error(\"❌ Failed to load courts:\", error);\r\n     }\r\n }\r\n \r\n // ================================\r\n-// 📌 LOAD PAGE SECTIONS\r\n+// MEMBERSHIP FUNCTIONS (approve/reject/delete/sync)\r\n+async function handleApproveClick(requestId) {\r\n+  safeUpdate(\"actionText\", `Processing Approval for ${requestId}...`);\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.APPROVE_REQUEST(requestId), {\r\n+      method: \"PUT\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Approval failed`);\r\n+    displayMessage(`Successfully approved ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Approval failed: ${e.message}`, true);\r\n+  }\r\n+}\r\n+\r\n+async function handleRejectClick(requestId) {\r\n+  if (!confirm(`Reject request ${requestId}?`)) return;\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.REJECT_REQUEST(requestId), {\r\n+      method: \"PUT\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Rejection failed`);\r\n+    displayMessage(`Successfully rejected ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Rejection failed: ${e.message}`, true);\r\n+  }\r\n+}\r\n+\r\n+async function handleDeleteClick(requestId) {\r\n+  if (!confirm(`Delete request ${requestId}?`)) return;\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.DELETE_REQUEST(requestId), {\r\n+      method: \"DELETE\",\r\n+      headers: getAuthHeaders(),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || `Deletion failed`);\r\n+    displayMessage(`Deleted request ${requestId}`, false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (e) {\r\n+    displayMessage(`Deletion failed: ${e.message}`, true);\r\n+  }\r\n+}\r\n+\r\n+async function handleSyncClick(event) {\r\n+  const btn = event.currentTarget;\r\n+  const originalText = btn.textContent,\r\n+    originalClass = btn.className;\r\n+  btn.disabled = true;\r\n+  btn.textContent = \"Syncing...\";\r\n+  btn.className = \"bg-yellow-500 text-white px-4 py-2 rounded-lg animate-pulse\";\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.SYNC, { method: \"POST\", headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Sync failed\");\r\n+    btn.textContent = \"Sync Complete!\";\r\n+    btn.className = \"bg-green-600 text-white px-4 py-2 rounded-lg\";\r\n+    displayMessage(\"Data synchronization successful\", false);\r\n+    await loadPendingRequests();\r\n+    await loadApprovedResidents();\r\n+  } catch (err) {\r\n+    btn.textContent = \"Sync Failed ❌\";\r\n+    btn.className = \"bg-red-600 text-white px-4 py-2 rounded-lg\";\r\n+    displayMessage(`Sync failed: ${err.message}`, true);\r\n+  } finally {\r\n+    setTimeout(() => {\r\n+      btn.disabled = false;\r\n+      btn.textContent = originalText;\r\n+      btn.className = originalClass;\r\n+    }, 3000);\r\n+  }\r\n+}\r\n+\r\n // ================================\r\n-async function loadPageIntoMainContent(page) {\r\n-    const container = document.getElementById(\"main-content\");\r\n+// LOAD DATA FUNCTIONS\r\n+async function loadPendingRequests() {\r\n+  const tbody = document.getElementById(\"membershipTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"11\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.PENDING_REQUESTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch pending requests\");\r\n+    const requests = await resp.json();\r\n+    tbody.innerHTML = requests.length === 0 ? '<tr><td colspan=\"11\">No requests</td></tr>' : \"\";\r\n+    requests.forEach((r) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n+                <td>${r.RequestID || r.id || \"N/A\"}</td>\r\n+                <td>${r.ResidentName || \"N/A\"}</td>\r\n+                <td>${r.NationalID || \"N/A\"}</td>\r\n+                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n+                <td>${r.Email || \"N/A\"}</td>\r\n+                <td>${r.HouseNumber || \"N/A\"}</td>\r\n+                <td>${r.CourtName || \"N/A\"}</td>\r\n+                <td>${r.RoleName || \"N/A\"}</td>\r\n+                <td>${r.Status || \"Pending\"}</td>\r\n+                <td>${formatTimestamp(r.RequestedAt || r.requestedAt)}</td>\r\n+                <td class=\"flex space-x-1\">\r\n+                    <button class=\"approve-btn\" data-id=\"${r.RequestID || r.id}\">Approve</button>\r\n+                    <button class=\"reject-btn\" data-id=\"${r.RequestID || r.id}\">Reject</button>\r\n+                    <button class=\"delete-btn\" data-id=\"${r.RequestID || r.id}\">Delete</button>\r\n+                </td>\r\n+            `;\r\n+    });\r\n+    tbody.querySelectorAll(\".approve-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleApproveClick(e.target.dataset.id))\r\n+    );\r\n+    tbody.querySelectorAll(\".reject-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleRejectClick(e.target.dataset.id))\r\n+    );\r\n+    tbody.querySelectorAll(\".delete-btn\").forEach((b) =>\r\n+      b.addEventListener(\"click\", (e) => handleDeleteClick(e.target.dataset.id))\r\n+    );\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load pending requests: ${e.message}`, true);\r\n+  }\r\n+}\r\n \r\n-    const response = await fetch(page);\r\n-    const html = await response.text();\r\n-    container.innerHTML = html;\r\n+async function loadApprovedResidents() {\r\n+  const tbody = document.getElementById(\"residentsTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"8\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.APPROVED_RESIDENTS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch approved residents\");\r\n+    const residents = await resp.json();\r\n+    tbody.innerHTML = residents.length === 0 ? '<tr><td colspan=\"8\">No residents</td></tr>' : \"\";\r\n+    residents.forEach((r) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n+                <td>${r.ResidentName || \"N/A\"}</td>\r\n+                <td>${r.NationalID || \"N/A\"}</td>\r\n+                <td>${r.PhoneNumber || \"N/A\"}</td>\r\n+                <td>${r.Email || \"N/A\"}</td>\r\n+                <td>${r.HouseNumber || \"N/A\"}</td>\r\n+                <td>${r.CourtName || \"N/A\"}</td>\r\n+                <td>${r.RoleName || \"N/A\"}</td>\r\n+            `;\r\n+    });\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load approved residents: ${e.message}`, true);\r\n+  }\r\n+}\r\n \r\n-    if (page.includes(\"dashboard\")) {\r\n-        await loadDashboardSummary();\r\n-        await loadAccessChart();\r\n-    }\r\n+// ================================\r\n+// DASHBOARD FUNCTIONS\r\n+async function loadDashboardSummary() {\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_SUMMARY, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(res.statusText);\r\n+    const d = await res.json();\r\n+    safeUpdate(\"totalResidents\", d.residents || 0);\r\n+    safeUpdate(\"pendingPayments\", d.pendingPayments || 0);\r\n+    safeUpdate(\"compliancePct\", d.compliance || 0, \"%\");\r\n+    safeUpdate(\"overrideCount\", d.overrides || 0);\r\n+  } catch (e) {\r\n+    console.error(\"loadDashboardSummary error:\", e);\r\n+  }\r\n+}\r\n \r\n-    if (page.includes(\"manage-residents\")) {\r\n-        loadApprovedResidents();\r\n-        loadPendingRequests();\r\n+async function loadAccessChart() {\r\n+  try {\r\n+    const res = await fetch(ENDPOINTS.DASHBOARD_CHART, { headers: getAuthHeaders() });\r\n+    if (!res.ok) throw new Error(res.statusText);\r\n+    const data = await res.json();\r\n+    const el = document.getElementById(\"accessChart\");\r\n+    if (!el) return;\r\n+    const ctx = el.getContext(\"2d\");\r\n+    if (window.accessChartInstance) window.accessChartInstance.destroy();\r\n+    window.accessChartInstance = new Chart(ctx, {\r\n+      type: \"line\",\r\n+      data: {\r\n+        labels: data.days || [],\r\n+        datasets: [\r\n+          {\r\n+            label: \"Access Attempts\",\r\n+            data: data.counts || [],\r\n+            borderColor: \"#2563eb\",\r\n+            backgroundColor: \"rgba(37,99,235,0.2)\",\r\n+            fill: true,\r\n+          },\r\n+        ],\r\n+      },\r\n+      options: { responsive: true, maintainAspectRatio: false },\r\n+    });\r\n+  } catch (e) {\r\n+    console.error(\"loadAccessChart error:\", e);\r\n+  }\r\n+}\r\n+\r\n+// ================================\r\n+// SIDEBAR & PAGE LOADING\r\n+// cache selectors after DOM ready\r\n+let sidebarButtons = [];\r\n+let mainContent = null;\r\n+\r\n+async function loadPageIntoMainContent(url) {\r\n+  if (!mainContent) {\r\n+    console.warn(\"mainContent container not found\");\r\n+    return;\r\n+  }\r\n+\r\n+  mainContent.innerHTML = '<div>Loading...</div>';\r\n+  try {\r\n+    const res = await fetch(url);\r\n+    if (!res.ok) throw new Error(res.status);\r\n+    const html = await res.text();\r\n+    mainContent.innerHTML = html;\r\n+\r\n+    // Page-specific loaders\r\n+    if (url.includes(\"dashboardoverview.html\")) {\r\n+      await loadDashboardSummary();\r\n+      await loadAccessChart();\r\n+    } else if (url.includes(\"membership.html\")) {\r\n+      // attach any click handlers in membership page\r\n+      attachMembershipListeners();\r\n+\r\n+      // populate courts AFTER the HTML is injected\r\n+      await loadCourts(\"#courtDropdown\");\r\n+\r\n+      // then load pending requests table\r\n+      await loadPendingRequests();\r\n+    } else if (url.includes(\"membershiprecords.html\")) {\r\n+      attachMembershipListeners();\r\n+      await loadApprovedResidents();\r\n+    } else if (url.includes(\"accesslogs.html\")) {\r\n+      await loadAccessLogs();\r\n     }\r\n+  } catch (e) {\r\n+    console.error(\"loadPageIntoMainContent error:\", e);\r\n+    mainContent.innerHTML = `<div class=\"text-red-600\">Failed to load: ${url}</div>`;\r\n+  }\r\n }\r\n \r\n+// Sidebar click handler - will be wired in DOMContentLoaded\r\n+function wireSidebarButtons() {\r\n+  sidebarButtons = Array.from(document.querySelectorAll(\".sidebarBtn\"));\r\n+  mainContent = document.getElementById(\"main-content-area\");\r\n+\r\n+  if (!mainContent) console.warn(\"#main-content-area not found\");\r\n+\r\n+  sidebarButtons.forEach((btn) => {\r\n+    btn.addEventListener(\"click\", (ev) => {\r\n+      // visual active state\r\n+      sidebarButtons.forEach((b) => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n+      btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n+\r\n+      const page = btn.dataset.target;\r\n+      if (page) loadPageIntoMainContent(page);\r\n+    });\r\n+  });\r\n+}\r\n+\r\n // ================================\r\n-// 📌 CLICK SIDEBAR NAVIGATION\r\n+// ACCESS LOGS\r\n+async function loadAccessLogs() {\r\n+  const tbody = document.getElementById(\"logsTableBody\");\r\n+  if (!tbody) return;\r\n+  tbody.innerHTML = '<tr><td colspan=\"4\">Loading...</td></tr>';\r\n+  try {\r\n+    const resp = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n+    if (!resp.ok) throw new Error(\"Failed to fetch access logs\");\r\n+    const logs = await resp.json();\r\n+    tbody.innerHTML = logs.length === 0 ? '<tr><td colspan=\"4\">No logs found</td></tr>' : \"\";\r\n+    logs.forEach((log) => {\r\n+      const row = tbody.insertRow();\r\n+      row.innerHTML = `\r\n+                <td>${formatTimestamp(log.TimestampUtc || log.timestamp)}</td>\r\n+                <td>${log.UserId || log.userId}</td>\r\n+                <td>${log.Action || log.action}</td>\r\n+                <td>${log.LogType || log.type}</td>\r\n+            `;\r\n+    });\r\n+  } catch (e) {\r\n+    displayMessage(`Failed to load access logs: ${e.message}`, true);\r\n+  }\r\n+}\r\n+\r\n // ================================\r\n-document.querySelectorAll(\".sidebar-link\").forEach(link => {\r\n-    link.addEventListener(\"click\", () => {\r\n-        const page = link.getAttribute(\"data-page\");\r\n-        loadPageIntoMainContent(page);\r\n-    });\r\n+// INITIAL LOAD (wire up once DOM is ready)\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+  // wire event handlers for dynamic loading\r\n+  wireSidebarButtons();\r\n+\r\n+  // load default page (dashboard overview)\r\n+  loadPageIntoMainContent(\"sections/dashboardoverview.html\");\r\n });\r\n \r\n // ================================\r\n-// 📌 INITIAL PAGE LOAD\r\n+// MISC: membership page listeners\r\n+function attachMembershipListeners() {\r\n+  // Sync button\r\n+  document.getElementById(\"syncBtn\")?.addEventListener(\"click\", handleSyncClick);\r\n+\r\n+  // Clear filters\r\n+  document.getElementById(\"clearFilterBtn\")?.addEventListener(\"click\", () => {\r\n+    const rid = document.getElementById(\"requestIdFilter\");\r\n+    const rf = document.getElementById(\"residentFilter\");\r\n+    if (rid) rid.value = \"\";\r\n+    if (rf) rf.value = \"\";\r\n+    displayMessage(\"Filters cleared.\", false);\r\n+  });\r\n+\r\n+  // membership form submission if present\r\n+  const membershipForm = document.getElementById(\"membershipForm\");\r\n+  if (membershipForm) {\r\n+    membershipForm.removeEventListener(\"submit\", membershipFormSubmitHandler);\r\n+    membershipForm.addEventListener(\"submit\", membershipFormSubmitHandler);\r\n+  }\r\n+}\r\n+\r\n+async function membershipFormSubmitHandler(e) {\r\n+  e.preventDefault();\r\n+  const form = e.target;\r\n+  const submitBtn = form.querySelector('button[type=\"submit\"]');\r\n+  if (submitBtn) submitBtn.disabled = true;\r\n+\r\n+  // gather form data\r\n+  const fd = new FormData(form);\r\n+  const payload = Object.fromEntries(fd.entries());\r\n+\r\n+  try {\r\n+    const resp = await fetch(`${API_HOST}/api/admin/requests`, {\r\n+      method: \"POST\",\r\n+      headers: getAuthHeaders(),\r\n+      body: JSON.stringify(payload),\r\n+    });\r\n+    if (!resp.ok) throw new Error((await resp.json().catch(() => ({}))).message || \"Submit failed\");\r\n+    displayMessage(\"Membership request submitted.\", false);\r\n+\r\n+    // clear form or update UI as needed\r\n+    form.reset();\r\n+  } catch (err) {\r\n+    displayMessage(`Failed to submit: ${err.message}`, true);\r\n+  } finally {\r\n+    if (submitBtn) submitBtn.disabled = false;\r\n+  }\r\n+}\r\n+\r\n // ================================\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    loadPageIntoMainContent(\"pages/dashboard.html\");\r\n-});\r\n+// Export or expose functions for debugging (optional)\r\n+window._app = {\r\n+  loadCourts,\r\n+  loadPendingRequests,\r\n+  loadApprovedResidents,\r\n+  loadPageIntoMainContent,\r\n+  loadDashboardSummary,\r\n+  loadAccessChart,\r\n+};\r\n"
                },
                {
                    "date": 1764020147290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -490,4 +490,19 @@\n   loadPageIntoMainContent,\r\n   loadDashboardSummary,\r\n   loadAccessChart,\r\n };\r\n+async function loadDashboardSummary() {\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.dashboardSummary, {\r\n+            headers: { Authorization: `Bearer ${token}` }\r\n+        });\r\n+        if (!res.ok) throw new Error(\"Failed to fetch summary\");\r\n+        const data = await res.json();\r\n+        document.getElementById(\"totalResidents\").textContent = data.TotalResidents || 0;\r\n+        document.getElementById(\"totalVisitors\").textContent = data.TotalVisitors || 0;\r\n+        document.getElementById(\"totalAccessLogs\").textContent = data.TotalAccessLogs || 0;\r\n+        document.getElementById(\"pendingRequests\").textContent = data.PendingRequests || 0;\r\n+    } catch (err) {\r\n+        console.error(\"Dashboard summary load error:\", err);\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1764020175107,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -505,4 +505,15 @@\n     } catch (err) {\r\n         console.error(\"Dashboard summary load error:\", err);\r\n     }\r\n }\r\n+async function loadPageIntoMainContent(page) {\r\n+    const container = document.getElementById(\"main-content\");\r\n+    const response = await fetch(page);\r\n+    const html = await response.text();\r\n+    container.innerHTML = html;\r\n+\r\n+    if (page.includes(\"dashboard\")) {\r\n+        await loadDashboardSummary(); // <-- call it here\r\n+        await loadAccessChart();      // make sure you have this function too\r\n+    }\r\n+}\r\n"
                }
            ],
            "date": 1763638300168,
            "name": "Commit-0",
            "content": "// ================================\r\n// AUTH & LOGOUT\r\n// ================================\r\nconst token = localStorage.getItem(\"accessToken\");\r\nif (!token) window.location.href = \"/login.html\";\r\n\r\ndocument.getElementById(\"logoutBtn\").addEventListener(\"click\", () => {\r\n    localStorage.removeItem(\"accessToken\");\r\n    window.location.href = \"/login.html\";\r\n});\r\n\r\n// ================================\r\n// SIDEBAR PAGE LOADING\r\n// ================================\r\nconst sidebarButtons = document.querySelectorAll(\".sidebarBtn\");\r\nconst mainContentArea = document.getElementById(\"main-content-area\");\r\n\r\nasync function loadPageIntoMainContent(url) {\r\n    try {\r\n        const res = await fetch(url);\r\n        if (!res.ok) throw new Error(`Failed to load page: ${res.status}`);\r\n        const html = await res.text();\r\n        mainContentArea.innerHTML = html;\r\n\r\n        // For subsequent (non-initial) dashboard loads (via button click), \r\n        // we call the functions directly after innerHTML.\r\n        if (url.includes(\"dashboardoverview.html\")) {\r\n            // NOTE: We don't need setTimeout here for subsequent clicks, \r\n            // as the initial load issue is bypassed.\r\n            await loadDashboardSummary(); \r\n            await loadAccessChart();\r\n        }\r\n    } catch (err) {\r\n        console.error(\"Error loading page:\", err);\r\n        mainContentArea.innerHTML = `<div class=\"p-6 text-red-600 font-bold\">Failed to load: ${url}</div>`;\r\n    }\r\n}\r\n\r\nsidebarButtons.forEach(btn => {\r\n    btn.addEventListener(\"click\", async () => {\r\n        sidebarButtons.forEach(b => b.classList.remove(\"bg-blue-600\", \"text-white\"));\r\n        btn.classList.add(\"bg-blue-600\", \"text-white\");\r\n\r\n        const page = btn.dataset.target;\r\n        if (page) loadPageIntoMainContent(page);\r\n    });\r\n});\r\n\r\n// *** REMOVED: loadPageIntoMainContent(\"sections/dashboardoverview.html\"); ***\r\n// The initial page load is handled by the index.html content itself.\r\n\r\n// ================================\r\n// VISITOR MANAGEMENT TOGGLE\r\n// ================================\r\nconst visitorToggle = document.getElementById(\"visitorManagementToggle\");\r\nconst visitorSubMenu = document.getElementById(\"visitorSubMenu\");\r\nconst visitorArrow = document.getElementById(\"visitorArrow\");\r\n\r\nvisitorToggle.addEventListener(\"click\", () => {\r\n    visitorSubMenu.classList.toggle(\"hidden\");\r\n    visitorArrow.classList.toggle(\"rotate-90\");\r\n});\r\n\r\n// ================================\r\n// SAFE UPDATE HELPER\r\n// ================================\r\nconst safeUpdate = (id, value, suffix = '') => {\r\n    const element = document.getElementById(id);\r\n    if (element) {\r\n        element.textContent = value + suffix;\r\n    } else {\r\n        // This warning should now only appear if an ID is misspelled \r\n        // or a sidebar page is missing the element.\r\n        console.warn(`Element with ID '${id}' not found in the DOM for update.`);\r\n    }\r\n};\r\n\r\n// ================================\r\n// DASHBOARD SUMMARY\r\n// ================================\r\nasync function loadDashboardSummary() {\r\n    try {\r\n        const res = await fetch(\"http://localhost:4050/api/residents/dashboard/summary\", {\r\n            headers: { \"Authorization\": `Bearer ${token}` }\r\n        });\r\n        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n        const data = await res.json();\r\n\r\n        safeUpdate(\"totalResidents\", data.residents || 0);\r\n        safeUpdate(\"pendingPayments\", data.pendingPayments || 0);\r\n        safeUpdate(\"compliancePct\", data.compliance || 0, '%');\r\n        safeUpdate(\"overrideCount\", data.overrides || 0);\r\n\r\n    } catch (err) {\r\n        console.error(\"Error loading summary:\", err);\r\n    }\r\n}\r\n\r\n// ================================\r\n// ACCESS CHART\r\n// ================================\r\nasync function loadAccessChart() {\r\n    try {\r\n        const res = await fetch(\"http://localhost:4050/api/residents/admin/accesschart\", {\r\n            headers: { \"Authorization\": `Bearer ${token}` }\r\n        });\r\n        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n        const data = await res.json();\r\n\r\n        const accessChartElement = document.getElementById(\"accessChart\");\r\n        if (!accessChartElement) return;\r\n\r\n        const ctx = accessChartElement.getContext(\"2d\");\r\n        new Chart(ctx, {\r\n            type: \"line\",\r\n            data: {\r\n                labels: data.days || [],\r\n                datasets: [{\r\n                    label: \"Access Attempts\",\r\n                    data: data.counts || [],\r\n                    borderWidth: 2,\r\n                    tension: 0.4,\r\n                    borderColor: '#2563eb',\r\n                    backgroundColor: 'rgba(37,99,235,0.2)',\r\n                    fill: true\r\n                }]\r\n            },\r\n            options: { responsive: true, maintainAspectRatio: false }\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(\"Error loading chart:\", err);\r\n    }\r\n}\r\n\r\n// ================================\r\n// INITIALIZATION ON PAGE LOAD\r\n// ================================\r\n/**\r\n * Run this function once on initial page load.\r\n * Since the Dashboard Overview content is ALREADY present in index.html, \r\n * we can call the data functions directly without a wrapper or delay.\r\n */\r\n(async function initializeDashboard() {\r\n    await loadDashboardSummary();\r\n    await loadAccessChart();\r\n})();\r\nasync function loadMembershipRequests() {\r\n    try {\r\n        const res = await fetch(\"http://localhost:4050/api/admin/memberships\", {\r\n            headers: { \"Authorization\": `Bearer ${token}` }\r\n        });\r\n        if (!res.ok) throw new Error(`API Error: ${res.status}`);\r\n        const requests = await res.json();\r\n\r\n        const container = document.getElementById(\"dynamic-section-content\");\r\n        if (!container) return;\r\n\r\n        if (requests.length === 0) {\r\n            container.innerHTML = \"<p class='text-gray-500 text-center'>No membership requests found.</p>\";\r\n            return;\r\n        }\r\n\r\n        let html = `<table class=\"min-w-full bg-white shadow-md rounded-lg overflow-hidden\">\r\n                        <thead class=\"bg-gray-200\">\r\n                            <tr>\r\n                                <th class=\"py-2 px-4\">Name</th>\r\n                                <th class=\"py-2 px-4\">National ID</th>\r\n                                <th class=\"py-2 px-4\">Phone</th>\r\n                                <th class=\"py-2 px-4\">Email</th>\r\n                                <th class=\"py-2 px-4\">House</th>\r\n                                <th class=\"py-2 px-4\">Court</th>\r\n                                <th class=\"py-2 px-4\">Status</th>\r\n                                <th class=\"py-2 px-4\">Requested At</th>\r\n                                <th class=\"py-2 px-4\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>`;\r\n\r\n        requests.forEach(r => {\r\n            html += `<tr class=\"border-b\">\r\n                        <td class=\"py-2 px-4\">${r.ResidentName}</td>\r\n                        <td class=\"py-2 px-4\">${r.NationalID}</td>\r\n                        <td class=\"py-2 px-4\">${r.PhoneNumber}</td>\r\n                        <td class=\"py-2 px-4\">${r.Email}</td>\r\n                        <td class=\"py-2 px-4\">${r.HouseNumber}</td>\r\n                        <td class=\"py-2 px-4\">${r.CourtName}</td>\r\n                        <td class=\"py-2 px-4\">${r.Status}</td>\r\n                        <td class=\"py-2 px-4\">${new Date(r.RequestedAt).toLocaleString()}</td>\r\n                        <td class=\"py-2 px-4\">\r\n                            ${r.Status === \"Pending\" ? `<button class=\"approve-btn bg-green-500 px-2 py-1 text-white rounded\" data-id=\"${r.RequestID}\">Approve</button>` : \"\"}\r\n                        </td>\r\n                     </tr>`;\r\n        });\r\n\r\n        html += `</tbody></table>`;\r\n        container.innerHTML = html;\r\n\r\n        // Add click handlers for approve buttons\r\n        document.querySelectorAll(\".approve-btn\").forEach(btn => {\r\n            btn.addEventListener(\"click\", async (e) => {\r\n                const requestId = btn.dataset.id;\r\n                try {\r\n                    const resp = await fetch(\"http://localhost:4050/api/admin/approveResident\", {\r\n                        method: \"POST\",\r\n                        headers: {\r\n                            \"Content-Type\": \"application/json\",\r\n                            \"Authorization\": `Bearer ${token}`\r\n                        },\r\n                        body: JSON.stringify({ requestId })\r\n                    });\r\n                    if (!resp.ok) throw new Error(\"Failed to approve\");\r\n                    btn.parentElement.textContent = \"Approved ✅\";\r\n                } catch (err) {\r\n                    alert(\"Error approving request: \" + err.message);\r\n                }\r\n            });\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(\"Error loading membership requests:\", err);\r\n    }\r\n}\r\n"
        }
    ]
}