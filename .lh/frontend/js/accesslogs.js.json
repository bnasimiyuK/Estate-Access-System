{
    "sourceFile": "frontend/js/accesslogs.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1763846456936,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763846501785,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,45 +1,56 @@\n-// backend/routes/accessLogsRoutes.js\r\n-import { Router } from \"express\";\r\n-import { dbPool } from \"../server.js\";\r\n-import { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\r\n+const API = { logs: '/api/access/logs' };\r\n+const logsTbody = document.getElementById('logsTbody');\r\n+const logsFrom = document.getElementById('logsFrom');\r\n+const logsTo = document.getElementById('logsTo');\r\n+const logsFilter = document.getElementById('logsFilter');\r\n+const logsRefresh = document.getElementById('logsRefresh');\r\n \r\n-const router = Router();\r\n+async function loadLogs(from=null, to=null) {\r\n+  logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-center\">Loading...</td></tr>';\r\n \r\n-// GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\r\n-router.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\r\n-    try {\r\n-        const { from, to } = req.query;\r\n-        let query = `SELECT TOP (1000)\r\n-            [Id],\r\n-            [TimestampUtc],\r\n-            [UserId],\r\n-            [Action],\r\n-            [Resource],\r\n-            [IpAddress],\r\n-            [UserAgent],\r\n-            [Referrer],\r\n-            [Metadata],\r\n-            [LogType]\r\n-        FROM [EstateAccessManagementSystem].[dbo].[accesslogs]`;\r\n-        \r\n-        if (from && to) {\r\n-            query += \" WHERE CAST(TimestampUtc AS DATE) BETWEEN @from AND @to\";\r\n-        }\r\n-        query += \" ORDER BY TimestampUtc DESC\";\r\n+  try {\r\n+    const params = {};\r\n+    if (from) params.from = from;\r\n+    if (to) params.to = to;\r\n \r\n-        const pool = await dbPool;\r\n-        const request = pool.request();\r\n-        if (from && to) {\r\n-            request.input(\"from\", \"Date\", from);\r\n-            request.input(\"to\", \"Date\", to);\r\n-        }\r\n+    const res = await axios.get(API.logs, { params });\r\n+    const arr = Array.isArray(res.data) ? res.data : [];\r\n \r\n-        const result = await request.query(query);\r\n-        res.json(result.recordset);\r\n-    } catch (err) {\r\n-        console.error(\"Access logs error:\", err);\r\n-        res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\r\n+    if (!arr.length) {\r\n+      logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-center\">No logs</td></tr>';\r\n+      return;\r\n     }\r\n+\r\n+    logsTbody.innerHTML = '';\r\n+    arr.forEach(log => {\r\n+      const tr = document.createElement('tr');\r\n+      tr.innerHTML = `\r\n+        <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n+        <td class=\"p-2 border\">${log.LogType || log.Action}</td>\r\n+        <td class=\"p-2 border\"><pre class=\"whitespace-pre-wrap\">${JSON.stringify({\r\n+          UserId: log.UserId,\r\n+          Action: log.Action,\r\n+          Resource: log.Resource,\r\n+          IpAddress: log.IpAddress,\r\n+          UserAgent: log.UserAgent,\r\n+          Referrer: log.Referrer,\r\n+          Metadata: log.Metadata\r\n+        }, null, 2)}</pre></td>\r\n+      `;\r\n+      logsTbody.appendChild(tr);\r\n+    });\r\n+\r\n+  } catch (err) {\r\n+    console.error(err);\r\n+    logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-red-600\">Error loading logs</td></tr>';\r\n+  }\r\n+}\r\n+\r\n+logsFilter.addEventListener('click', () => {\r\n+  const from = logsFrom.value || null;\r\n+  const to = logsTo.value || null;\r\n+  loadLogs(from, to);\r\n });\r\n \r\n-export default router;\r\n+logsRefresh.addEventListener('click', () => loadLogs());\r\n+loadLogs(); // initial load\r\n"
                },
                {
                    "date": 1763846749359,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,53 +4,53 @@\n const logsTo = document.getElementById('logsTo');\r\n const logsFilter = document.getElementById('logsFilter');\r\n const logsRefresh = document.getElementById('logsRefresh');\r\n \r\n-async function loadLogs(from=null, to=null) {\r\n-  logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-center\">Loading...</td></tr>';\r\n+async function loadLogs(from = null, to = null) {\r\n+    logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-center\">Loading...</td></tr>';\r\n \r\n-  try {\r\n-    const params = {};\r\n-    if (from) params.from = from;\r\n-    if (to) params.to = to;\r\n+    try {\r\n+        const params = {};\r\n+        if (from) params.from = from;\r\n+        if (to) params.to = to;\r\n \r\n-    const res = await axios.get(API.logs, { params });\r\n-    const arr = Array.isArray(res.data) ? res.data : [];\r\n+        const res = await axios.get(API.logs, { params });\r\n+        const arr = Array.isArray(res.data) ? res.data : [];\r\n \r\n-    if (!arr.length) {\r\n-      logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-center\">No logs</td></tr>';\r\n-      return;\r\n-    }\r\n+        if (!arr.length) {\r\n+            logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-center\">No logs</td></tr>';\r\n+            return;\r\n+        }\r\n \r\n-    logsTbody.innerHTML = '';\r\n-    arr.forEach(log => {\r\n-      const tr = document.createElement('tr');\r\n-      tr.innerHTML = `\r\n-        <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n-        <td class=\"p-2 border\">${log.LogType || log.Action}</td>\r\n-        <td class=\"p-2 border\"><pre class=\"whitespace-pre-wrap\">${JSON.stringify({\r\n-          UserId: log.UserId,\r\n-          Action: log.Action,\r\n-          Resource: log.Resource,\r\n-          IpAddress: log.IpAddress,\r\n-          UserAgent: log.UserAgent,\r\n-          Referrer: log.Referrer,\r\n-          Metadata: log.Metadata\r\n-        }, null, 2)}</pre></td>\r\n-      `;\r\n-      logsTbody.appendChild(tr);\r\n-    });\r\n+        logsTbody.innerHTML = '';\r\n+        arr.forEach(log => {\r\n+            const tr = document.createElement('tr');\r\n+            tr.innerHTML = `\r\n+                <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n+                <td class=\"p-2 border\">${log.LogType || log.Action}</td>\r\n+                <td class=\"p-2 border\"><pre class=\"whitespace-pre-wrap\">${JSON.stringify({\r\n+                    UserId: log.UserId,\r\n+                    Action: log.Action,\r\n+                    Resource: log.Resource,\r\n+                    IpAddress: log.IpAddress,\r\n+                    UserAgent: log.UserAgent,\r\n+                    Referrer: log.Referrer,\r\n+                    Metadata: log.Metadata\r\n+                }, null, 2)}</pre></td>\r\n+            `;\r\n+            logsTbody.appendChild(tr);\r\n+        });\r\n \r\n-  } catch (err) {\r\n-    console.error(err);\r\n-    logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-red-600\">Error loading logs</td></tr>';\r\n-  }\r\n+    } catch (err) {\r\n+        console.error(err);\r\n+        logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-red-600\">Error loading logs</td></tr>';\r\n+    }\r\n }\r\n \r\n logsFilter.addEventListener('click', () => {\r\n-  const from = logsFrom.value || null;\r\n-  const to = logsTo.value || null;\r\n-  loadLogs(from, to);\r\n+    const from = logsFrom.value || null;\r\n+    const to = logsTo.value || null;\r\n+    loadLogs(from, to);\r\n });\r\n \r\n logsRefresh.addEventListener('click', () => loadLogs());\r\n loadLogs(); // initial load\r\n"
                },
                {
                    "date": 1763862329068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,56 +1,107 @@\n-const API = { logs: '/api/access/logs' };\r\n-const logsTbody = document.getElementById('logsTbody');\r\n-const logsFrom = document.getElementById('logsFrom');\r\n-const logsTo = document.getElementById('logsTo');\r\n-const logsFilter = document.getElementById('logsFilter');\r\n-const logsRefresh = document.getElementById('logsRefresh');\r\n+// ===============================\r\n+// Access Logs Page Script\r\n+// ===============================\r\n \r\n-async function loadLogs(from = null, to = null) {\r\n-    logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-center\">Loading...</td></tr>';\r\n+// Backend API\r\n+const API_HOST = \"http://localhost:4050\";\r\n \r\n+// Load logs immediately when page loads\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    checkAuth();\r\n+    loadAccessLogs();\r\n+});\r\n+\r\n+// ===============================\r\n+// AUTH CHECK (JWT)\r\n+// ===============================\r\n+function checkAuth() {\r\n+    const token = localStorage.getItem(\"token\");\r\n+    if (!token) {\r\n+        alert(\"You must login first\");\r\n+        window.location.href = \"/login.html\";\r\n+    }\r\n+}\r\n+\r\n+// ===============================\r\n+// FETCH ACCESS LOGS\r\n+// ===============================\r\n+async function loadAccessLogs() {\r\n+    const tableBody = document.getElementById(\"logsTableBody\");\r\n+    tableBody.innerHTML = `\r\n+        <tr><td colspan=\"8\" style=\"text-align:center;\">Loading...</td></tr>\r\n+    `;\r\n+\r\n+    const fromDate = document.getElementById(\"fromDate\").value;\r\n+    const toDate = document.getElementById(\"toDate\").value;\r\n+\r\n+    let url = `${API_HOST}/api/access/logs`;\r\n+\r\n+    // add filters dynamically\r\n+    if (fromDate && toDate) {\r\n+        url += `?from=${fromDate}&to=${toDate}`;\r\n+    }\r\n+\r\n     try {\r\n-        const params = {};\r\n-        if (from) params.from = from;\r\n-        if (to) params.to = to;\r\n+        const token = localStorage.getItem(\"token\");\r\n \r\n-        const res = await axios.get(API.logs, { params });\r\n-        const arr = Array.isArray(res.data) ? res.data : [];\r\n+        const res = await fetch(url, {\r\n+            headers: {\r\n+                \"Authorization\": `Bearer ${token}`\r\n+            }\r\n+        });\r\n \r\n-        if (!arr.length) {\r\n-            logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-center\">No logs</td></tr>';\r\n-            return;\r\n+        if (!res.ok) {\r\n+            throw new Error(`HTTP Error ${res.status}`);\r\n         }\r\n \r\n-        logsTbody.innerHTML = '';\r\n-        arr.forEach(log => {\r\n-            const tr = document.createElement('tr');\r\n-            tr.innerHTML = `\r\n-                <td class=\"p-2 border\">${new Date(log.TimestampUtc).toLocaleString()}</td>\r\n-                <td class=\"p-2 border\">${log.LogType || log.Action}</td>\r\n-                <td class=\"p-2 border\"><pre class=\"whitespace-pre-wrap\">${JSON.stringify({\r\n-                    UserId: log.UserId,\r\n-                    Action: log.Action,\r\n-                    Resource: log.Resource,\r\n-                    IpAddress: log.IpAddress,\r\n-                    UserAgent: log.UserAgent,\r\n-                    Referrer: log.Referrer,\r\n-                    Metadata: log.Metadata\r\n-                }, null, 2)}</pre></td>\r\n-            `;\r\n-            logsTbody.appendChild(tr);\r\n-        });\r\n+        const logs = await res.json();\r\n+        renderAccessLogs(logs);\r\n \r\n-    } catch (err) {\r\n-        console.error(err);\r\n-        logsTbody.innerHTML = '<tr><td colspan=\"3\" class=\"p-4 text-red-600\">Error loading logs</td></tr>';\r\n+    } catch (error) {\r\n+        console.error(\"Failed to load access logs:\", error);\r\n+        tableBody.innerHTML = `\r\n+            <tr><td colspan=\"8\" style=\"text-align:center;color:red;\">\r\n+                Failed to load logs. ${error.message}\r\n+            </td></tr>\r\n+        `;\r\n     }\r\n }\r\n \r\n-logsFilter.addEventListener('click', () => {\r\n-    const from = logsFrom.value || null;\r\n-    const to = logsTo.value || null;\r\n-    loadLogs(from, to);\r\n+// ===============================\r\n+// RENDER TABLE\r\n+// ===============================\r\n+function renderAccessLogs(logs) {\r\n+    const tableBody = document.getElementById(\"logsTableBody\");\r\n+    tableBody.innerHTML = \"\";\r\n+\r\n+    if (!logs.length) {\r\n+        tableBody.innerHTML = `\r\n+            <tr><td colspan=\"8\" style=\"text-align:center;\">No logs available</td></tr>\r\n+        `;\r\n+        return;\r\n+    }\r\n+\r\n+    logs.forEach((log, index) => {\r\n+        const row = document.createElement(\"tr\");\r\n+\r\n+        row.innerHTML = `\r\n+            <td>${index + 1}</td>\r\n+            <td>${log.timestampUtc ? new Date(log.timestampUtc).toLocaleString() : \"—\"}</td>\r\n+            <td>${log.userId ?? \"—\"}</td>\r\n+            <td>${log.action ?? \"—\"}</td>\r\n+            <td>${log.resource ?? \"—\"}</td>\r\n+            <td>${log.ipAddress ?? \"—\"}</td>\r\n+            <td>${log.userAgent ?? \"—\"}</td>\r\n+            <td>${log.logType ?? \"—\"}</td>\r\n+        `;\r\n+\r\n+        tableBody.appendChild(row);\r\n+    });\r\n+}\r\n+\r\n+// ===============================\r\n+// FILTER BUTTON\r\n+// ===============================\r\n+document.getElementById(\"filterBtn\")?.addEventListener(\"click\", () => {\r\n+    loadAccessLogs();\r\n });\r\n-\r\n-logsRefresh.addEventListener('click', () => loadLogs());\r\n-loadLogs(); // initial load\r\n"
                },
                {
                    "date": 1763862887987,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,45 @@\n+// public/js/accesslogs.js\r\n+\r\n+const API_HOST = \"http://localhost:4050\";  // adjust if needed\r\n+const token = localStorage.getItem(\"token\"); // Admin JWT\r\n+\r\n+async function loadAccessLogs() {\r\n+  try {\r\n+    const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n+      headers: {\r\n+        \"Authorization\": `Bearer ${token}`\r\n+      }\r\n+    });\r\n+\r\n+    if (!response.ok) throw new Error(\"Failed to fetch logs\");\r\n+\r\n+    const logs = await response.json();\r\n+    renderLogs(logs);\r\n+  } catch (error) {\r\n+    console.error(\"Error loading logs:\", error);\r\n+  }\r\n+}\r\n+\r\n+function renderLogs(data) {\r\n+  const tbody = document.getElementById(\"logsTableBody\");\r\n+  tbody.innerHTML = \"\";\r\n+\r\n+  data.forEach((log, index) => {\r\n+    const tr = document.createElement(\"tr\");\r\n+\r\n+    tr.innerHTML = `\r\n+      <td>${index + 1}</td>\r\n+      <td>${log.timestamp}</td>\r\n+      <td>${log.userId || \"—\"}</td>\r\n+      <td>${log.action}</td>\r\n+      <td>${log.resource}</td>\r\n+      <td>${log.ipAddress}</td>\r\n+      <td>${log.userAgent}</td>\r\n+      <td>${log.logType}</td>\r\n+    `;\r\n+\r\n+    tbody.appendChild(tr);\r\n+  });\r\n+}\r\n+\r\n+document.addEventListener(\"DOMContentLoaded\", loadAccessLogs);\r\n"
                },
                {
                    "date": 1763864382215,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,152 +1,32 @@\n-// public/js/accesslogs.js\r\n-\r\n-const API_HOST = \"http://localhost:4050\";  // adjust if needed\r\n-const token = localStorage.getItem(\"token\"); // Admin JWT\r\n-\r\n-async function loadAccessLogs() {\r\n-  try {\r\n-    const response = await fetch(`${API_HOST}/api/access/logs`, {\r\n-      headers: {\r\n-        \"Authorization\": `Bearer ${token}`\r\n-      }\r\n-    });\r\n-\r\n-    if (!response.ok) throw new Error(\"Failed to fetch logs\");\r\n-\r\n-    const logs = await response.json();\r\n-    renderLogs(logs);\r\n-  } catch (error) {\r\n-    console.error(\"Error loading logs:\", error);\r\n-  }\r\n-}\r\n-\r\n-function renderLogs(data) {\r\n-  const tbody = document.getElementById(\"logsTableBody\");\r\n-  tbody.innerHTML = \"\";\r\n-\r\n-  data.forEach((log, index) => {\r\n-    const tr = document.createElement(\"tr\");\r\n-\r\n-    tr.innerHTML = `\r\n-      <td>${index + 1}</td>\r\n-      <td>${log.timestamp}</td>\r\n-      <td>${log.userId || \"—\"}</td>\r\n-      <td>${log.action}</td>\r\n-      <td>${log.resource}</td>\r\n-      <td>${log.ipAddress}</td>\r\n-      <td>${log.userAgent}</td>\r\n-      <td>${log.logType}</td>\r\n-    `;\r\n-\r\n-    tbody.appendChild(tr);\r\n-  });\r\n-}\r\n-\r\n-document.addEventListener(\"DOMContentLoaded\", loadAccessLogs);\r\n-// ===============================\r\n-// Access Logs Page Script\r\n-// ===============================\r\n-\r\n-// Backend API\r\n-const API_HOST = \"http://localhost:4050\";\r\n-\r\n-// Load logs immediately when page loads\r\n-document.addEventListener(\"DOMContentLoaded\", () => {\r\n-    checkAuth();\r\n-    loadAccessLogs();\r\n-});\r\n-\r\n-// ===============================\r\n-// AUTH CHECK (JWT)\r\n-// ===============================\r\n-function checkAuth() {\r\n-    const token = localStorage.getItem(\"token\");\r\n-    if (!token) {\r\n-        alert(\"You must login first\");\r\n-        window.location.href = \"/login.html\";\r\n-    }\r\n-}\r\n-\r\n-// ===============================\r\n-// FETCH ACCESS LOGS\r\n-// ===============================\r\n-async function loadAccessLogs() {\r\n-    const tableBody = document.getElementById(\"logsTableBody\");\r\n-    tableBody.innerHTML = `\r\n-        <tr><td colspan=\"8\" style=\"text-align:center;\">Loading...</td></tr>\r\n-    `;\r\n-\r\n-    const fromDate = document.getElementById(\"fromDate\").value;\r\n-    const toDate = document.getElementById(\"toDate\").value;\r\n-\r\n-    let url = `${API_HOST}/api/access/logs`;\r\n-\r\n-    // add filters dynamically\r\n-    if (fromDate && toDate) {\r\n-        url += `?from=${fromDate}&to=${toDate}`;\r\n-    }\r\n-\r\n+ async function fetchLogs() {\r\n     try {\r\n-        const token = localStorage.getItem(\"token\");\r\n+      const response = await fetch(\"http://localhost:4050/api/logs\");\r\n+      if (!response.ok) throw new Error(\"Network response was not ok\");\r\n \r\n-        const res = await fetch(url, {\r\n-            headers: {\r\n-                \"Authorization\": `Bearer ${token}`\r\n-            }\r\n-        });\r\n+      const logs = await response.json();\r\n+      const tbody = document.querySelector(\"#logsTable tbody\");\r\n+      tbody.innerHTML = \"\";\r\n \r\n-        if (!res.ok) {\r\n-            throw new Error(`HTTP Error ${res.status}`);\r\n-        }\r\n-\r\n-        const logs = await res.json();\r\n-        renderAccessLogs(logs);\r\n-\r\n-    } catch (error) {\r\n-        console.error(\"Failed to load access logs:\", error);\r\n-        tableBody.innerHTML = `\r\n-            <tr><td colspan=\"8\" style=\"text-align:center;color:red;\">\r\n-                Failed to load logs. ${error.message}\r\n-            </td></tr>\r\n-        `;\r\n-    }\r\n-}\r\n-\r\n-// ===============================\r\n-// RENDER TABLE\r\n-// ===============================\r\n-function renderAccessLogs(logs) {\r\n-    const tableBody = document.getElementById(\"logsTableBody\");\r\n-    tableBody.innerHTML = \"\";\r\n-\r\n-    if (!logs.length) {\r\n-        tableBody.innerHTML = `\r\n-            <tr><td colspan=\"8\" style=\"text-align:center;\">No logs available</td></tr>\r\n-        `;\r\n-        return;\r\n-    }\r\n-\r\n-    logs.forEach((log, index) => {\r\n+      logs.forEach(log => {\r\n         const row = document.createElement(\"tr\");\r\n-\r\n         row.innerHTML = `\r\n-            <td>${index + 1}</td>\r\n-            <td>${log.timestampUtc ? new Date(log.timestampUtc).toLocaleString() : \"—\"}</td>\r\n-            <td>${log.userId ?? \"—\"}</td>\r\n-            <td>${log.action ?? \"—\"}</td>\r\n-            <td>${log.resource ?? \"—\"}</td>\r\n-            <td>${log.ipAddress ?? \"—\"}</td>\r\n-            <td>${log.userAgent ?? \"—\"}</td>\r\n-            <td>${log.logType ?? \"—\"}</td>\r\n+          <td>${log.Id}</td>\r\n+          <td>${log.TimestampUtc}</td>\r\n+          <td>${log.UserId}</td>\r\n+          <td>${log.Action}</td>\r\n+          <td>${log.Resource}</td>\r\n+          <td>${log.IpAddress}</td>\r\n+          <td>${log.UserAgent}</td>\r\n+          <td>${log.Referrer}</td>\r\n+          <td><pre>${JSON.stringify(log.Metadata, null, 2)}</pre></td>\r\n+          <td>${log.LogType}</td>\r\n         `;\r\n+        tbody.appendChild(row);\r\n+      });\r\n+    } catch (err) {\r\n+      console.error(\"Error fetching logs:\", err);\r\n+    }\r\n+  }\r\n \r\n-        tableBody.appendChild(row);\r\n-    });\r\n-}\r\n-\r\n-// ===============================\r\n-// FILTER BUTTON\r\n-// ===============================\r\n-document.getElementById(\"filterBtn\")?.addEventListener(\"click\", () => {\r\n-    loadAccessLogs();\r\n-});\r\n+  // Load logs on page load\r\n+  window.onload = fetchLogs;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763889971172,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,32 +1,100 @@\n- async function fetchLogs() {\r\n+// js/accesslogs.js\r\n+const API_HOST = \"http://localhost:4050\";\r\n+const ENDPOINTS = {\r\n+    ACCESS_LOGS: `${API_HOST}/api/admin/accesslogs`, // adjust endpoint if needed\r\n+};\r\n+\r\n+// Get auth headers\r\n+function getAuthHeaders() {\r\n+    const token = localStorage.getItem(\"accessToken\");\r\n+    return { \"Content-Type\": \"application/json\", \"Authorization\": `Bearer ${token}` };\r\n+}\r\n+\r\n+// Format timestamp nicely\r\n+function formatTimestamp(timestamp) {\r\n+    if (!timestamp) return \"N/A\";\r\n     try {\r\n-      const response = await fetch(\"http://localhost:4050/api/logs\");\r\n-      if (!response.ok) throw new Error(\"Network response was not ok\");\r\n+        return new Date(timestamp).toLocaleString();\r\n+    } catch {\r\n+        return timestamp;\r\n+    }\r\n+}\r\n \r\n-      const logs = await response.json();\r\n-      const tbody = document.querySelector(\"#logsTable tbody\");\r\n-      tbody.innerHTML = \"\";\r\n+// Display message to user\r\n+function displayMessage(msg, isError = false) {\r\n+    const div = document.createElement(\"div\");\r\n+    div.textContent = msg;\r\n\\ No newline at end of file\n+    div.className = `p-2 mb-2 rounded text-sm ${isError ? \"bg-red-100 text-red-700\" : \"bg-green-100 text-green-700\"}`;\r\n+    document.body.prepend(div);\r\n+    setTimeout(() => div.remove(), 5000);\r\n+}\r\n \r\n-      logs.forEach(log => {\r\n-        const row = document.createElement(\"tr\");\r\n-        row.innerHTML = `\r\n-          <td>${log.Id}</td>\r\n-          <td>${log.TimestampUtc}</td>\r\n-          <td>${log.UserId}</td>\r\n-          <td>${log.Action}</td>\r\n-          <td>${log.Resource}</td>\r\n-          <td>${log.IpAddress}</td>\r\n-          <td>${log.UserAgent}</td>\r\n-          <td>${log.Referrer}</td>\r\n-          <td><pre>${JSON.stringify(log.Metadata, null, 2)}</pre></td>\r\n-          <td>${log.LogType}</td>\r\n-        `;\r\n-        tbody.appendChild(row);\r\n-      });\r\n+// Load access logs into table\r\n+export async function loadaccesslogs() {\r\n+    const tbody = document.getElementById(\"logsTableBody\");\r\n+    if (!tbody) return;\r\n+    tbody.innerHTML = '<tr><td colspan=\"4\" class=\"p-3\">Loading...</td></tr>';\r\n+\r\n+    try {\r\n+        const res = await fetch(ENDPOINTS.ACCESS_LOGS, { headers: getAuthHeaders() });\r\n+        if (!res.ok) throw new Error(`HTTP ${res.status} - Failed to fetch logs`);\r\n+        const logs = await res.json();\r\n+\r\n+        tbody.innerHTML = logs.length === 0\r\n+            ? '<tr><td colspan=\"4\" class=\"p-3 text-center\">No logs found</td></tr>'\r\n+            : '';\r\n+\r\n+        logs.forEach(log => {\r\n+            const row = tbody.insertRow();\r\n+            row.innerHTML = `\r\n+                <td class=\"p-2 border-b\">${formatTimestamp(log.Timestamp || log.timestamp || log.TimestampUtc)}</td>\r\n+                <td class=\"p-2 border-b\">${log.UserID || log.userId || log.User}</td>\r\n+                <td class=\"p-2 border-b\">${log.Action || log.action}</td>\r\n+                <td class=\"p-2 border-b\">${log.LogType || log.type}</td>\r\n+            `;\r\n+        });\r\n     } catch (err) {\r\n-      console.error(\"Error fetching logs:\", err);\r\n+        console.error(err);\r\n+        tbody.innerHTML = `<tr><td colspan=\"4\" class=\"p-3 text-red-700\">Failed to load logs</td></tr>`;\r\n+        displayMessage(`Error: ${err.message}`, true);\r\n     }\r\n-  }\r\n+}\r\n \r\n-  // Load logs on page load\r\n-  window.onload = fetchLogs;\n+// Optional: Filter table by input fields\r\n+export function attachFilters() {\r\n+    const inputs = document.querySelectorAll(\"#accessLogsTable thead input\");\r\n+    if (!inputs) return;\r\n+\r\n+    inputs.forEach((input, index) => {\r\n+        input.addEventListener(\"input\", () => {\r\n+            const filter = input.value.toLowerCase();\r\n+            const rows = document.querySelectorAll(\"#logsTableBody tr\");\r\n+            rows.forEach(row => {\r\n+                const cell = row.cells[index];\r\n+                row.style.display = cell && cell.textContent.toLowerCase().includes(filter) ? \"\" : \"none\";\r\n+            });\r\n+        });\r\n+    });\r\n+}\r\n+\r\n+// Optional: Export to CSV\r\n+export function exportCSV() {\r\n+    const rows = document.querySelectorAll(\"#logsTableBody tr\");\r\n+    let csv = \"Timestamp,User/Visitor ID,Action,Log Type\\n\";\r\n+    rows.forEach(row => {\r\n+        if (row.style.display === \"none\") return;\r\n+        const cells = row.querySelectorAll(\"td\");\r\n+        const rowData = Array.from(cells).map(c => `\"${c.textContent.replace(/\"/g,'\"\"')}\"`).join(\",\");\r\n+        csv += rowData + \"\\n\";\r\n+    });\r\n+    const blob = new Blob([csv], { type: \"text/csv\" });\r\n+    const link = document.createElement(\"a\");\r\n+    link.href = URL.createObjectURL(blob);\r\n+    link.download = \"access_logs.csv\";\r\n+    link.click();\r\n+}\r\n+\r\n+// Initialize\r\n+document.addEventListener(\"DOMContentLoaded\", () => {\r\n+    if (typeof loadaccesslogs === \"function\") loadaccesslogs();\r\n+});\r\n"
                },
                {
                    "date": 1763890763692,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,9 +61,9 @@\n }\r\n \r\n // Optional: Filter table by input fields\r\n export function attachFilters() {\r\n-    const inputs = document.querySelectorAll(\"#accessLogsTable thead input\");\r\n+    const inputs = document.querySelectorAll(\"#accesslogsTable thead input\");\r\n     if (!inputs) return;\r\n \r\n     inputs.forEach((input, index) => {\r\n         input.addEventListener(\"input\", () => {\r\n@@ -96,5 +96,5 @@\n \r\n // Initialize\r\n document.addEventListener(\"DOMContentLoaded\", () => {\r\n     if (typeof loadaccesslogs === \"function\") loadaccesslogs();\r\n-});\n\\ No newline at end of file\n+});\r\n"
                }
            ],
            "date": 1763846456936,
            "name": "Commit-0",
            "content": "// backend/routes/accessLogsRoutes.js\r\nimport { Router } from \"express\";\r\nimport { dbPool } from \"../server.js\";\r\nimport { authenticateJWT, isAdmin } from \"../middleware/authMiddleware.js\";\r\n\r\nconst router = Router();\r\n\r\n// GET /api/access/logs?from=YYYY-MM-DD&to=YYYY-MM-DD\r\nrouter.get(\"/logs\", authenticateJWT, isAdmin, async (req, res) => {\r\n    try {\r\n        const { from, to } = req.query;\r\n        let query = `SELECT TOP (1000)\r\n            [Id],\r\n            [TimestampUtc],\r\n            [UserId],\r\n            [Action],\r\n            [Resource],\r\n            [IpAddress],\r\n            [UserAgent],\r\n            [Referrer],\r\n            [Metadata],\r\n            [LogType]\r\n        FROM [EstateAccessManagementSystem].[dbo].[accesslogs]`;\r\n        \r\n        if (from && to) {\r\n            query += \" WHERE CAST(TimestampUtc AS DATE) BETWEEN @from AND @to\";\r\n        }\r\n        query += \" ORDER BY TimestampUtc DESC\";\r\n\r\n        const pool = await dbPool;\r\n        const request = pool.request();\r\n        if (from && to) {\r\n            request.input(\"from\", \"Date\", from);\r\n            request.input(\"to\", \"Date\", to);\r\n        }\r\n\r\n        const result = await request.query(query);\r\n        res.json(result.recordset);\r\n    } catch (err) {\r\n        console.error(\"Access logs error:\", err);\r\n        res.status(500).json({ message: \"Failed to fetch access logs\", details: err.message });\r\n    }\r\n});\r\n\r\nexport default router;\r\n"
        }
    ]
}